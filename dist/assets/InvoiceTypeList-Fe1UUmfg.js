import{u as O}from"./useApi-CTBDEoea.js";import{r as o,y as X,K as Y,c as V,a as i,b as l,w as s,u as $,v as y,F as P,d as Z,t as r,D as ee,q as j,o as d,O as q,ax as ae,i as te,h as z,A as E,m as g,C as D,e as le,ay as se,a5 as oe,az as ie,a1 as ne}from"./index-DPR0tjT6.js";import{_ as F}from"./AppCard-DxtAeMMp.js";import{A as G}from"./AppSwitch-D-YUIM8I.js";import{_ as K}from"./AppButton-DiF3_7lr.js";import{_ as re}from"./AppInput-CYR4AaBJ.js";import{A as ce}from"./AppDataTable-CV9gFKLg.js";import{A as de}from"./AppDialog-CVbZwWX_.js";import{_ as ue}from"./LoadingSpinner-BZRbwFnn.js";import{_ as pe}from"./EmptyState-Cza6ENNq.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./usePermissions-BOh6stgy.js";function ve(){const T=O("/api/invoice-types"),u=o([]),m=o(!1),_=o(0);return{invoiceTypes:u,loading:m,total:_,fetchInvoiceTypes:async(v={})=>{m.value=!0;try{const c=await T.get(v,{showLoading:!1});return u.value=c.data||[],_.value=c.total||0,c}catch(c){throw u.value=[],_.value=0,c}finally{m.value=!1}},deleteInvoiceType:async v=>await T.remove(v,{successMessage:"تم حذف نوع الفاتورة بنجاح"})}}const fe={class:"invoice-types-page"},ge={class:"d-flex align-center flex-wrap gap-4"},_e={class:"type-card-image d-flex align-center justify-center pa-4 bg-primary-lighten-5 position-relative"},ye={class:"text-body-2 text-grey-darken-1 text-truncate-3 height-60"},he={class:"d-flex align-center py-2"},xe={class:"font-weight-bold text-body-1"},be={class:"text-caption text-grey"},we={key:2,class:"mt-8 d-flex align-center justify-space-between flex-wrap gap-4 px-2"},Ve={class:"text-body-2 text-grey"},Te={__name:"InvoiceTypeList",setup(T){const{invoiceTypes:u,loading:m,fetchInvoiceTypes:_}=ve(),L=O("/api/invoice-types"),h=o(1),v=o(12),c=o(""),f=o("grid"),x=o({}),b=o(!1),U=o(""),A=o(""),B=o("تأكيد"),w=o(null),R=[{title:"النوع",key:"name",sortable:!0},{title:"التصنيف",key:"type",sortable:!1},{title:"الحالة",key:"is_active",sortable:!1,align:"center"},{title:"الإجراءات",key:"actions",sortable:!1,align:"end"}],p=X(()=>{if(!c.value)return u.value;const t=c.value.toLowerCase();return u.value.filter(a=>a.name.toLowerCase().includes(t)||C(a.type).toLowerCase().includes(t)||I(a.type).toLowerCase().includes(t))}),H=((t,a)=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>t(...n),a)}})(()=>{h.value=1},500),S=t=>({sale:"ri-shopping-cart-line",purchase:"ri-shopping-bag-line",return:"ri-arrow-go-back-line",installment:"ri-bank-card-line"})[t]||"ri-file-text-line",k=t=>({sale:"success",purchase:"info",return:"warning",installment:"purple"})[t]||"primary",C=t=>({sale:"بيع",purchase:"شراء",return:"مرتجع",installment:"تقسيط"})[t]||t,I=t=>({sale:"تؤثر على المخزون والإيرادات",purchase:"تزيد المخزون والمصروفات",return:"عكس عملية البيع أو الشراء",installment:"إنشاء جدول أقساط وتحصيلات"})[t]||"نوع فاتورة مخصص",M=(t,a)=>{const e=a?"تفعيل":"تعطيل";U.value=`${e} نوع الفاتورة`,A.value=`هل أنت متأكد من ${e} نوع الفاتورة "${t.name}"؟`,B.value=e,w.value={type:t,newStatus:a},b.value=!0},J=async()=>{if(!w.value)return;const{type:t,newStatus:a}=w.value;b.value=!1,await Q(t,a),w.value=null},Q=async(t,a)=>{x.value[t.id]=!0;try{await L.update(t.id,{is_active:a},{showSuccess:!1});const e=u.value.findIndex(W=>W.id===t.id);e!==-1&&(u.value[e].is_active=a);const n=a?"تم تفعيل":"تم تعطيل";j.success(`${n} نوع الفاتورة "${t.name}" بنجاح`)}catch(e){console.error("Error toggling invoice type status:",e),j.error("حدث خطأ أثناء تغيير الحالة")}finally{x.value[t.id]=!1}},N=()=>_({per_page:-1});return Y(N),(t,a)=>(d(),V("div",fe,[a[6]||(a[6]=i("div",{class:"page-header d-flex align-center justify-space-between mb-6"},[i("div",null,[i("h1",{class:"text-h4 font-weight-bold ml-2"},"أنواع الفواتير"),i("p",{class:"text-body-1 text-grey"},"تفعيل وتعطيل أنواع الفواتير المتاحة في النظام")])],-1)),l(F,{class:"mb-6"},{default:s(()=>[i("div",ge,[l(re,{modelValue:c.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>c.value=e),$(H)],label:"بحث عن نوع...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(q),l(ae,{variant:"outlined",density:"comfortable",color:"primary"},{default:s(()=>[l(K,{active:f.value==="grid",icon:"ri-grid-fill",onClick:a[1]||(a[1]=e=>f.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(K,{active:f.value==="list",icon:"ri-list-check",onClick:a[2]||(a[2]=e=>f.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),$(m)&&!p.value.length?(d(),y(ue,{key:0,size:"64",text:"جاري تحميل الأنواع..."})):p.value.length?(d(),V(P,{key:2},[f.value==="grid"?(d(),y(Z,{key:0},{default:s(()=>[(d(!0),V(P,null,te(p.value,e=>(d(),y(le,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[l(F,{class:"type-card h-100","no-padding":""},{actions:s(()=>[l(q),l(G,{modelValue:e.is_active,"onUpdate:modelValue":[n=>e.is_active=n,n=>M(e,n)],"hide-details":"",loading:x.value[e.id],density:"compact"},null,8,["modelValue","onUpdate:modelValue","loading"])]),default:s(()=>[i("div",_e,[l(E,{size:"100",rounded:"lg",class:"elevation-1 bg-white"},{default:s(()=>[l(z,{icon:S(e.type),size:"48",color:k(e.type)},null,8,["icon","color"])]),_:2},1024),l(D,{color:e.is_active?"success":"error",size:"x-small",class:"position-absolute top-2 right-2 font-weight-bold",variant:"flat"},{default:s(()=>[g(r(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),l(se,null,{default:s(()=>[l(oe,{class:"text-h6 font-weight-bold"},{default:s(()=>[g(r(e.name),1)]),_:2},1024),l(ie,{class:"d-flex align-center mt-1"},{default:s(()=>[l(z,{icon:"ri-information-line",size:"14",class:"me-1"}),g(" "+r(C(e.type)),1)]),_:2},1024)]),_:2},1024),l(ne,{class:"pt-0"},{default:s(()=>[i("p",ye,r(I(e.type)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(d(),y(ce,{key:1,headers:R,items:p.value,"total-items":p.value.length,loading:$(m),page:h.value,"onUpdate:page":a[3]||(a[3]=e=>h.value=e),"items-per-page":v.value,"onUpdate:itemsPerPage":a[4]||(a[4]=e=>v.value=e),searchable:!1,"can-edit":!1,"can-delete":!1,"can-view":!1,"onUpdate:options":N},{"item.name":s(({item:e})=>[i("div",he,[l(E,{color:"primary-lighten-5",size:"40",class:"me-3 border"},{default:s(()=>[l(z,{icon:S(e.type),color:k(e.type),size:"small"},null,8,["icon","color"])]),_:2},1024),i("div",null,[i("div",xe,r(e.name),1),i("div",be,r(I(e.type)),1)])])]),"item.type":s(({item:e})=>[l(D,{color:k(e.type),size:"small",variant:"tonal"},{default:s(()=>[g(r(C(e.type)),1)]),_:2},1032,["color"])]),"item.is_active":s(({item:e})=>[l(D,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:s(()=>[g(r(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),"extra-actions":s(({item:e})=>[l(G,{modelValue:e.is_active,"onUpdate:modelValue":[n=>e.is_active=n,n=>M(e,n)],"hide-details":"",loading:x.value[e.id],density:"compact"},null,8,["modelValue","onUpdate:modelValue","loading"])]),_:1},8,["items","total-items","loading","page","items-per-page"])),f.value==="grid"?(d(),V("div",we,[i("div",Ve,"عرض "+r(p.value.length)+" من إجمالي "+r(p.value.length)+" نوع",1)])):ee("",!0)],64)):(d(),y(pe,{key:1,icon:"ri-file-list-line",title:"لا توجد أنواع فواتير",message:"لم يتم العثور على أنواع مطابقة"})),l(de,{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=e=>b.value=e),title:U.value,icon:"ri-question-line","confirm-color":"primary","confirm-text":B.value,onConfirm:J},{default:s(()=>[g(r(A.value),1)]),_:1},8,["modelValue","title","confirm-text"])]))}},Pe=me(Te,[["__scopeId","data-v-ba76319c"]]);export{Pe as default};
