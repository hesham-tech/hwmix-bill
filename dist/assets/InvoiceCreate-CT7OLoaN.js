import{r as y,z as U,L as X,x as _,w as n,V as Y,o as d,b as t,d as s,af as Z,e as w,f as u,i as k,ad as j,ag as ee,c as p,j as S,F as T,ah as te,n as f,v as i,E as b,R as le,O as B,ai as se,h as ae,p as ne,D as oe,Q as ie,B as de,a4 as ue,a5 as re}from"./index-Flp88uEA.js";import{u as C}from"./useApi-Dl4iYKvS.js";import{_ as ce,a as me}from"./ProductSelector-Dymt0pj6.js";import{_ as h}from"./AppButton-DMkx3xLA.js";import{_ as A}from"./AppCard-D6xOpfLS.js";import{_ as x}from"./AppInput-CHj3RTxZ.js";import"./AppAutocomplete-BmWJjGE8.js";const pe={class:"d-flex align-center justify-space-between mb-6"},ve={class:"d-flex align-center"},_e={class:"pa-4"},fe={class:"d-flex align-center mb-4"},ge={class:"pa-4"},ye={class:"d-flex align-center mb-4"},be={class:"font-weight-medium"},xe={key:0,class:"text-caption text-grey"},he={class:"text-center"},Ve={class:"text-left"},we={class:"text-left text-error"},ke={class:"text-left font-weight-bold text-success"},Ce={class:"text-center"},Ae={class:"pa-4"},Ue={class:"d-flex align-center mb-4"},je={class:"d-flex flex-column gap-2"},$e={class:"d-flex justify-space-between border-bottom pb-2"},Ie={class:"font-weight-bold"},Le={class:"d-flex justify-space-between border-bottom pb-2"},Me={class:"font-weight-bold"},Se={key:0,class:"d-flex justify-space-between"},Te={class:"font-weight-bold"},Be={class:"text-primary text-caption font-weight-bold"},Pe={class:"font-weight-bold text-success"},De={class:"d-flex align-center mb-4"},Ee={class:"d-flex flex-column gap-2 mb-4"},Ne={class:"d-flex justify-space-between text-body-1"},ze={class:"font-weight-medium"},Fe={key:0,class:"d-flex justify-space-between text-body-1 text-error"},Re={key:1,class:"d-flex justify-space-between text-body-1"},qe={key:2,class:"d-flex justify-space-between text-body-1"},Ge={class:"d-flex justify-space-between align-center px-4 py-3 bg-success-lighten-5 rounded-lg border border-success mb-6"},Oe={class:"text-h5 font-weight-black text-success"},Qe={key:0,class:"text-center mt-2 pa-2 rounded bg-warning-lighten-5 text-warning font-weight-bold"},We={class:"d-flex align-center justify-space-between pa-4"},He={key:1},Je={class:"d-flex gap-2"},at={__name:"InvoiceCreate",setup(Ke){const $=ne(),P=C("/api/invoices"),{get:D}=C("/api/invoice-types"),{get:E}=C("/api/warehouses"),{get:N}=C("/api/payment-methods"),v=y(1),z=[{title:"معلومات الفاتورة",value:1},{title:"المنتجات",value:2},{title:"المراجعة والدفع",value:3}],l=y({customer:null,invoice_type_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,warehouse_id:null,items:[],discount_percentage:0,tax_percentage:14,shipping_cost:0,payment_method_id:null,amount_paid:0,notes:""}),I=y([]),L=y([]),M=y([]),V=y(!1),r=U(()=>{const o=l.value.items.reduce((J,K)=>J+parseFloat(K.total),0),e=o*(l.value.discount_percentage/100),a=o-e,m=a*(l.value.tax_percentage/100),g=a+m+l.value.shipping_cost,H=g-l.value.amount_paid;return{subtotal:o,discountAmount:e,taxableAmount:a,taxAmount:m,total:g,remaining:H}}),F=U(()=>v.value===1?l.value.customer&&l.value.invoice_date:v.value===2?l.value.items.length>0:!0),R=U(()=>l.value.customer&&l.value.items.length>0&&!V.value),q=()=>{$.push("/invoices")},G=o=>{l.value.customer=o},O=o=>{l.value.items.push(o)},Q=o=>{l.value.items.splice(o,1)},W=async()=>{V.value=!0;try{const o={customer_id:l.value.customer.id,invoice_type_id:l.value.invoice_type_id,invoice_date:l.value.invoice_date,due_date:l.value.due_date,warehouse_id:l.value.warehouse_id,items:l.value.items,discount_percentage:l.value.discount_percentage,tax_percentage:l.value.tax_percentage,shipping_cost:l.value.shipping_cost,payment_method_id:l.value.payment_method_id,amount_paid:l.value.amount_paid,notes:l.value.notes,total:r.value.total},e=await P.create(o,{successMessage:"تم إنشاء الفاتورة بنجاح"});$.push(`/invoices/${e.data.id}`)}catch{}finally{V.value=!1}},c=o=>o?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(o):"0.00 ج.م";return X(async()=>{try{const[o,e,a]=await Promise.all([D({},{showLoading:!1}),E({},{showLoading:!1}),N({},{showLoading:!1})]);I.value=o.data||[],L.value=e.data||[],M.value=a.data||[]}catch(o){console.error("Error loading data:",o)}}),(o,e)=>(d(),_(Y,{fluid:""},{default:n(()=>[t("div",pe,[t("div",ve,[s(h,{icon:"ri-arrow-right-line",variant:"text",color:"secondary",onClick:q,class:"me-3"}),e[14]||(e[14]=t("div",null,[t("h1",{class:"text-h4 font-weight-bold"},"فاتورة جديدة"),t("p",{class:"text-body-1 text-grey"},"إنشاء فاتورة جديدة بخطوات سهلة")],-1))])]),s(ae,null,{default:n(()=>[s(Z,{modelValue:v.value,"onUpdate:modelValue":e[13]||(e[13]=a=>v.value=a),items:z,"alt-labels":""},{"item.1":n(()=>[t("div",_e,[s(w,null,{default:n(()=>[s(u,{cols:"12"},{default:n(()=>[t("div",fe,[s(k,{icon:"ri-user-settings-line",color:"primary",class:"me-2"}),e[15]||(e[15]=t("h3",{class:"text-h6 font-weight-bold"},"معلومات العميل والفاتورة",-1))])]),_:1}),s(u,{cols:"12",md:"6"},{default:n(()=>[s(ce,{modelValue:l.value.customer,"onUpdate:modelValue":[e[0]||(e[0]=a=>l.value.customer=a),G]},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"6"},{default:n(()=>[s(j,{modelValue:l.value.invoice_type_id,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.invoice_type_id=a),items:I.value,"item-title":"name","item-value":"id",label:"نوع الفاتورة *",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-file-copy-line"},null,8,["modelValue","items"])]),_:1}),s(u,{cols:"12",md:"4"},{default:n(()=>[s(x,{modelValue:l.value.invoice_date,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.invoice_date=a),type:"date",label:"تاريخ الفاتورة *","prepend-inner-icon":"ri-calendar-line"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"4"},{default:n(()=>[s(x,{modelValue:l.value.due_date,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.due_date=a),type:"date",label:"تاريخ الاستحقاق","prepend-inner-icon":"ri-calendar-check-line"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12",md:"4"},{default:n(()=>[s(j,{modelValue:l.value.warehouse_id,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.warehouse_id=a),items:L.value,"item-title":"name","item-value":"id",label:"المخزن",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-building-line"},null,8,["modelValue","items"])]),_:1})]),_:1})])]),"item.2":n(()=>[t("div",ge,[s(w,null,{default:n(()=>[s(u,{cols:"12"},{default:n(()=>[t("div",ye,[s(k,{icon:"ri-shopping-bag-line",color:"primary",class:"me-2"}),e[16]||(e[16]=t("h3",{class:"text-h6 font-weight-bold"},"المنتجات",-1))])]),_:1}),s(u,{cols:"12"},{default:n(()=>[s(me,{onAdd:O})]),_:1}),l.value.items.length>0?(d(),_(u,{key:0,cols:"12"},{default:n(()=>[s(A,{class:"mt-4",title:"المنتجات المحددة",subtitle:`إجمالي العناصر: ${l.value.items.length}`,icon:"ri-list-check-2"},{default:n(()=>[s(ee,null,{default:n(()=>[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",{class:"text-right"},"المنتج"),t("th",{class:"text-center"},"الكمية"),t("th",{class:"text-left"},"السعر"),t("th",{class:"text-left"},"الخصم"),t("th",{class:"text-left"},"الإجمالي"),t("th",{class:"text-center"},"إجراءات")])],-1)),t("tbody",null,[(d(!0),p(T,null,S(l.value.items,(a,m)=>(d(),p("tr",{key:m},[t("td",null,[t("div",be,i(a.product_name),1),a.variant_name?(d(),p("div",xe,i(a.variant_name),1)):b("",!0)]),t("td",he,[s(oe,{size:"small",variant:"tonal",color:"primary"},{default:n(()=>[f(i(a.quantity),1)]),_:2},1024)]),t("td",Ve,i(c(a.unit_price)),1),t("td",we,i(a.discount_percentage)+"%",1),t("td",ke,i(c(a.total)),1),t("td",Ce,[s(h,{icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف",onClick:g=>Q(m)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1},8,["subtitle"])]),_:1})):(d(),_(u,{key:1,cols:"12"},{default:n(()=>[s(te,{type:"info",variant:"tonal",border:"start"},{default:n(()=>e[18]||(e[18]=[f(" لم يتم إضافة منتجات بعد. ابحث عن منتج أعلاه للإضافة. ")])),_:1})]),_:1}))]),_:1})])]),"item.3":n(()=>[t("div",Ae,[s(w,null,{default:n(()=>[s(u,{cols:"12",md:"7"},{default:n(()=>[t("div",Ue,[s(k,{icon:"ri-eye-line",color:"primary",class:"me-2"}),e[19]||(e[19]=t("h3",{class:"text-h6 font-weight-bold"},"مراجعة الفاتورة",-1))]),s(A,{title:"معلومات العميل",icon:"ri-user-line",class:"mb-6"},{default:n(()=>{var a,m,g;return[t("div",je,[t("div",$e,[e[20]||(e[20]=t("span",{class:"text-grey"},"الاسم:",-1)),t("span",Ie,i((a=l.value.customer)==null?void 0:a.name),1)]),t("div",Le,[e[21]||(e[21]=t("span",{class:"text-grey"},"الهاتف:",-1)),t("span",Me,i((m=l.value.customer)==null?void 0:m.phone),1)]),(g=l.value.customer)!=null&&g.email?(d(),p("div",Se,[e[22]||(e[22]=t("span",{class:"text-grey"},"البريد:",-1)),t("span",Te,i(l.value.customer.email),1)])):b("",!0)])]}),_:1}),s(A,{title:"ملخص المنتجات",icon:"ri-shopping-cart-2-line"},{default:n(()=>[s(le,{density:"compact"},{default:n(()=>[(d(!0),p(T,null,S(l.value.items,(a,m)=>(d(),_(ie,{key:m,class:"px-0"},{prepend:n(()=>[s(de,{size:"32",color:"primary-lighten-5",class:"me-3"},{default:n(()=>[t("span",Be,i(a.quantity),1)]),_:2},1024)]),append:n(()=>[t("span",Pe,i(c(a.total)),1)]),default:n(()=>[s(ue,{class:"font-weight-medium"},{default:n(()=>[f(i(a.product_name),1)]),_:2},1024),s(re,null,{default:n(()=>[f(i(c(a.unit_price)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),s(u,{cols:"12",md:"5"},{default:n(()=>[t("div",De,[s(k,{icon:"ri-secure-payment-line",color:"primary",class:"me-2"}),e[23]||(e[23]=t("h3",{class:"text-h6 font-weight-bold"},"الدفع والإجمالي",-1))]),s(A,null,{default:n(()=>[s(w,{dense:""},{default:n(()=>[s(u,{cols:"6"},{default:n(()=>[s(x,{modelValue:l.value.discount_percentage,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.discount_percentage=a),modelModifiers:{number:!0},label:"خصم %",type:"number","prepend-inner-icon":"ri-percent-line"},null,8,["modelValue"])]),_:1}),s(u,{cols:"6"},{default:n(()=>[s(x,{modelValue:l.value.tax_percentage,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.tax_percentage=a),modelModifiers:{number:!0},label:"ضريبة %",type:"number","prepend-inner-icon":"ri-percent-line"},null,8,["modelValue"])]),_:1}),s(u,{cols:"12"},{default:n(()=>[s(x,{modelValue:l.value.shipping_cost,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.shipping_cost=a),modelModifiers:{number:!0},label:"تكلفة الشحن",type:"number","prepend-inner-icon":"ri-truck-line"},null,8,["modelValue"])]),_:1})]),_:1}),s(B,{class:"my-4"}),t("div",Ee,[t("div",Ne,[e[24]||(e[24]=t("span",{class:"text-grey"},"المجموع الفرعي:",-1)),t("span",ze,i(c(r.value.subtotal)),1)]),r.value.discountAmount>0?(d(),p("div",Fe,[e[25]||(e[25]=t("span",null,"إجمالي الخصم:",-1)),t("span",null,"-"+i(c(r.value.discountAmount)),1)])):b("",!0),r.value.taxAmount>0?(d(),p("div",Re,[e[26]||(e[26]=t("span",{class:"text-grey"},"إجمالي الضريبة:",-1)),t("span",null,i(c(r.value.taxAmount)),1)])):b("",!0),l.value.shipping_cost>0?(d(),p("div",qe,[e[27]||(e[27]=t("span",{class:"text-grey"},"تكلفة الشحن:",-1)),t("span",null,i(c(l.value.shipping_cost)),1)])):b("",!0)]),t("div",Ge,[e[28]||(e[28]=t("span",{class:"text-h6 font-weight-bold text-success"},"الإجمالي النهائي:",-1)),t("span",Oe,i(c(r.value.total)),1)]),s(j,{modelValue:l.value.payment_method_id,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.payment_method_id=a),items:M.value,"item-title":"name","item-value":"id",label:"طريقة الدفع",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-bank-card-line",class:"mb-4"},null,8,["modelValue","items"]),s(x,{modelValue:l.value.amount_paid,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.amount_paid=a),modelModifiers:{number:!0},label:"المبلغ المدفوع حالياً",type:"number",min:"0",max:r.value.total,"prepend-inner-icon":"ri-money-dollar-circle-line"},null,8,["modelValue","max"]),r.value.remaining>0?(d(),p("div",Qe," المبلغ المتبقي: "+i(c(r.value.remaining)),1)):b("",!0),s(se,{modelValue:l.value.notes,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.notes=a),label:"ملاحظات إضافية",rows:"3",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-sticky-note-line",class:"mt-4","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),actions:n(()=>[s(B),t("div",We,[v.value>1?(d(),_(h,{key:0,variant:"outlined",color:"secondary","prepend-icon":"ri-arrow-right-line",onClick:e[11]||(e[11]=a=>v.value--)},{default:n(()=>e[29]||(e[29]=[f(" السابق ")])),_:1})):(d(),p("div",He)),t("div",Je,[v.value<3?(d(),_(h,{key:0,"append-icon":"ri-arrow-left-line",disabled:!F.value,onClick:e[12]||(e[12]=a=>v.value++)},{default:n(()=>e[30]||(e[30]=[f(" التالي ")])),_:1},8,["disabled"])):(d(),_(h,{key:1,color:"success","prepend-icon":"ri-save-line",loading:V.value,disabled:!R.value,onClick:W},{default:n(()=>e[31]||(e[31]=[f(" حفظ وإنشاء الفاتورة ")])),_:1},8,["loading","disabled"]))])])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}};export{at as default};
