import{r as f,J as T,o as h,s as P,w as a,b as t,l as p,e as D,a8 as B,d as G,A as K,g as z,z as M,a as u,t as g,M as O,B as S,c as F,ag as R,u as N,m as q}from"./index-CuR9-sbN.js";import{u as J}from"./useProductsData-BLhB-E08.js";import{u as I}from"./useApi-CjhFmPue.js";import{_ as W}from"./AppCard-CXpBKc1t.js";import{_ as U}from"./AppButton-CREzoRf6.js";import{_ as H}from"./AppInput-06Y7zOXl.js";import{A as Q}from"./AppDataTable-CnA5lOqV.js";import{A as X}from"./AppDialog-vLCI3uF9.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={__name:"ProductFilters",props:{filters:{type:Object,required:!0}},emits:["filter-change","update:filters"],setup(n,{emit:y}){const k=n,w=y,_=I("/api/categories"),l=I("/api/brands"),r=f([]),e=f([]),d=f(!1),b=f(!1),x=[{title:"متوفر",value:"in_stock"},{title:"مخزون منخفض",value:"low_stock"},{title:"نفذ المخزون",value:"out_of_stock"}];let V;const $=c=>{clearTimeout(V),V=setTimeout(()=>{w("update:filters",{...k.filters,search:c}),w("filter-change")},300)},A=async()=>{d.value=!0;try{const c=await _.get({per_page:100},{showLoading:!1,showError:!1});r.value=c.data||[]}finally{d.value=!1}},E=async()=>{b.value=!0;try{const c=await l.get({per_page:100},{showLoading:!1,showError:!1});e.value=c.data||[]}finally{b.value=!1}};return T(()=>{A(),E()}),(c,s)=>(h(),P(W,{title:"تصفية المنتجات",icon:"ri-filter-3-line",class:"mb-4"},{actions:a(()=>[t(U,{variant:"text",color:"secondary",size:"small","prepend-icon":"ri-refresh-line",onClick:c.resetFilters},{default:a(()=>s[6]||(s[6]=[p(" مسح الكل ")])),_:1},8,["onClick"])]),default:a(()=>[t(G,{dense:""},{default:a(()=>[t(D,{cols:"12",md:"4"},{default:a(()=>[t(H,{"model-value":n.filters.search,label:"البحث السريع",placeholder:"اسم المنتج، SKU، أو باركود","prepend-inner-icon":"ri-search-line","onUpdate:modelValue":$},null,8,["model-value"])]),_:1}),t(D,{cols:"12",md:"3"},{default:a(()=>[t(B,{modelValue:n.filters.category_id,"onUpdate:modelValue":[s[0]||(s[0]=m=>n.filters.category_id=m),s[1]||(s[1]=m=>c.$emit("filter-change"))],items:r.value,loading:d.value,"item-title":"name","item-value":"id",label:"الفئة",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-folder-line",clearable:"","hide-details":""},null,8,["modelValue","items","loading"])]),_:1}),t(D,{cols:"12",md:"3"},{default:a(()=>[t(B,{modelValue:n.filters.brand_id,"onUpdate:modelValue":[s[2]||(s[2]=m=>n.filters.brand_id=m),s[3]||(s[3]=m=>c.$emit("filter-change"))],items:e.value,loading:b.value,"item-title":"name","item-value":"id",label:"العلامة التجارية",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-award-line",clearable:"","hide-details":""},null,8,["modelValue","items","loading"])]),_:1}),t(D,{cols:"12",md:"2"},{default:a(()=>[t(B,{modelValue:n.filters.stock_status,"onUpdate:modelValue":[s[4]||(s[4]=m=>n.filters.stock_status=m),s[5]||(s[5]=m=>c.$emit("filter-change"))],items:x,label:"حالة المخزون",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-archive-line",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},ee={class:"d-flex flex-column"},te={class:"font-weight-bold text-body-1"},ae={class:"text-caption text-grey d-flex align-center mt-1"},le={key:1,class:"text-grey-lighten-1 text-caption"},ie={class:"d-flex flex-column text-right"},se={class:"font-weight-black text-success"},oe={class:"text-caption text-grey"},ne={class:"d-flex justify-end gap-1"},re={__name:"ProductDataTable",props:{items:{type:Array,required:!0},loading:{type:Boolean,default:!1},page:{type:Number,default:1},itemsPerPage:{type:Number,default:10},total:{type:Number,default:0}},emits:["create","view","edit","delete","update:page","update:items-per-page"],setup(n){const y=[{title:"صورة",key:"image",width:"80px",sortable:!1},{title:"المنتج وتفاصيله",key:"name",minWidth:"250px"},{title:"العلامة التجارية",key:"brand",width:"150px"},{title:"سعر البيع",key:"price",align:"end",width:"150px"},{title:"المخزون",key:"stock",align:"center",width:"100px"},{title:"الحالة",key:"is_active",align:"center",width:"120px"},{title:"",key:"actions",sortable:!1,align:"end",width:"120px"}],k=l=>l?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(l):"0.00 ج.م",w=l=>!l||l===0?"error":l<10?"warning":"success",_=l=>!l||l===0?"ri-close-circle-line":l<10?"ri-error-warning-line":"ri-checkbox-circle-line";return(l,r)=>(h(),P(Q,{headers:y,items:n.items,loading:n.loading,"items-length":n.total,"items-per-page":n.itemsPerPage,page:n.page,title:"قائمة المنتجات",icon:"ri-shopping-bag-3-line","onUpdate:page":r[1]||(r[1]=e=>l.$emit("update:page",e)),"onUpdate:itemsPerPage":r[2]||(r[2]=e=>l.$emit("update:items-per-page",e))},{actions:a(()=>[t(U,{color:"primary","prepend-icon":"ri-add-line",onClick:r[0]||(r[0]=e=>l.$emit("create"))},{default:a(()=>r[3]||(r[3]=[p(" منتج جديد ")])),_:1})]),"item.image":a(({item:e})=>[t(M,{size:"48",rounded:"lg",border:"",class:"bg-grey-lighten-4"},{default:a(()=>[e.image?(h(),P(K,{key:0,src:e.image,cover:""},null,8,["src"])):(h(),P(z,{key:1,icon:"ri-image-line",size:"20",color:"grey-lighten-1"}))]),_:2},1024)]),"item.name":a(({item:e})=>{var d;return[u("div",ee,[u("span",te,g(e.name),1),u("span",ae,[t(z,{icon:"ri-barcode-line",size:"14",class:"me-1"}),p(" "+g(e.sku||"بدون SKU")+" ",1),t(O,{vertical:"",class:"mx-2"}),t(z,{icon:"ri-folder-line",size:"14",class:"me-1"}),p(" "+g(((d=e.category)==null?void 0:d.name)||"غير مصنف"),1)])])]}),"item.brand":a(({item:e})=>[e.brand?(h(),P(S,{key:0,size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:a(()=>[p(g(e.brand.name),1)]),_:2},1024)):(h(),F("span",le,"لا توجد ماركة"))]),"item.price":a(({item:e})=>[u("div",ie,[u("span",se,g(k(e.selling_price)),1),u("span",oe,"التكلفة: "+g(k(e.cost_price)),1)])]),"item.stock":a(({item:e})=>[t(S,{color:w(e.stock_quantity),size:"small",variant:"tonal",class:"font-weight-bold"},{default:a(()=>[t(z,{icon:_(e.stock_quantity),size:"14",class:"me-1"},null,8,["icon"]),p(" "+g(e.stock_quantity||0),1)]),_:2},1032,["color"])]),"item.is_active":a(({item:e})=>[t(S,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold px-3"},{default:a(()=>[p(g(e.is_active?"نشط":"غير نشط"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:e})=>[u("div",ne,[t(U,{icon:"ri-eye-line",size:"x-small",variant:"text",color:"info",tooltip:"عرض",onClick:d=>l.$emit("view",e)},null,8,["onClick"]),t(U,{icon:"ri-edit-line",size:"x-small",variant:"text",color:"primary",tooltip:"تعديل",onClick:d=>l.$emit("edit",e)},null,8,["onClick"]),t(U,{icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف",onClick:d=>l.$emit("delete",e)},null,8,["onClick"])])]),_:1},8,["items","loading","items-length","items-per-page","page"]))}},de={class:"pa-6"},ce={class:"mt-2 text-error font-weight-medium"},ue={__name:"ProductList",setup(n){const y=q(),{products:k,loading:w,total:_,fetchProducts:l,deleteProduct:r}=J(),e=f(1),d=f(10),b=R({search:"",category_id:null,brand_id:null,stock_status:null}),x=f(!1),V=f(null),$=f(!1),A=()=>{y.push("/products/create")},E=o=>{y.push(`/products/${o.id}`)},c=o=>{y.push(`/products/${o.id}/edit`)},s=o=>{V.value=o,x.value=!0},m=async()=>{$.value=!0;try{await r(V.value.id),x.value=!1,await C()}catch(o){console.error("Error deleting product:",o)}finally{$.value=!1}},L=()=>{e.value=1,C()},j=o=>{d.value=o,e.value=1,C()},C=async()=>{const o={page:e.value,per_page:d.value,...b};Object.keys(o).forEach(i=>{(o[i]===null||o[i]==="")&&delete o[i]}),await l(o)};return T(()=>{C()}),(o,i)=>(h(),F("div",de,[i[6]||(i[6]=u("div",{class:"mb-6"},[u("h1",{class:"text-h4 font-weight-bold"},"المنتجات"),u("p",{class:"text-body-1 text-grey"},"إدارة منتجات المخزون والأسعار والمستويات")],-1)),t(Z,{filters:b,"onUpdate:filters":i[0]||(i[0]=v=>b=v),onFilterChange:L},null,8,["filters"]),t(re,{items:N(k),loading:N(w),page:e.value,"items-per-page":d.value,total:N(_),onCreate:A,onView:E,onEdit:c,onDelete:s,"onUpdate:page":i[1]||(i[1]=v=>{e.value=v,C()}),"onUpdate:itemsPerPage":j},null,8,["items","loading","page","items-per-page","total"]),t(X,{modelValue:x.value,"onUpdate:modelValue":i[2]||(i[2]=v=>x.value=v),title:"تأكيد حذف المنتج",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف المنتج",loading:$.value,onConfirm:m},{default:a(()=>{var v;return[i[4]||(i[4]=p(' هل أنت متأكد من حذف المنتج "')),u("strong",null,g((v=V.value)==null?void 0:v.name),1),i[5]||(i[5]=p('"؟ ')),u("div",ce,[t(z,{icon:"ri-error-warning-line",size:"small",class:"me-1"}),i[3]||(i[3]=p(" سيتم حذف جميع البيانات المتعلقة بهذا المنتج نهائياً. "))])]}),_:1},8,["modelValue","loading"])]))}},we=Y(ue,[["__scopeId","data-v-320d271b"]]);export{we as default};
