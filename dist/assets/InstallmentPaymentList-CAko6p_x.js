import{au as ee,r as u,y as N,av as C,q as x,aw as M,o as d,c as A,v as y,a8 as E,w as o,b as i,f as q,F as J,i as W,e as L,d as X,K as te,a as r,u as V,m as z,t as h,C as ae,h as F,D as Q,N as le,Q as ne,P as se,z as oe,A as re,a2 as ie,a3 as ce}from"./index-DPR0tjT6.js";import{u as de,a as ue}from"./index-C10_qYxj.js";import{A as me}from"./AppDataTable-CV9gFKLg.js";import{_ as U}from"./AppButton-DiF3_7lr.js";import{A as ye}from"./AppDialog-CVbZwWX_.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as pe}from"./EmptyState-Cza6ENNq.js";import{f as R,a as G}from"./formatters-CKQiR5Fb.js";import"./usePermissions-BOh6stgy.js";const he=ee("installment",()=>{const t=u([]),k=u(null),w=u([]),g=u([]),n=u(!1),S=u(0),D=u(1),P=u(10),m=u(""),f=u([]),v=u(null),b=u(null),T=N(()=>{var a,e;return{page:D.value,per_page:P.value,search:m.value,status:v.value,customer_id:b.value,sort_by:((a=f.value[0])==null?void 0:a.key)||"",order:((e=f.value[0])==null?void 0:e.order)||"desc"}});async function _(){n.value=!0;try{const a=await C.getPlans(T.value,{showToast:!1});return t.value=a.data,S.value=a.total,a}catch(a){throw console.error("Error fetching plans:",a),a}finally{n.value=!1}}async function p(a){n.value=!0;try{const e=await C.getOne(a,{full:!0});return k.value=e.data[0],e.data[0]}catch(e){throw console.error("Error fetching plan:",e),e}finally{n.value=!1}}async function s(a){n.value=!0;try{const e=await C.createPlan(a);return await _(),x.success("تم إنشاء خطة التقسيط بنجاح"),e.data[0]}catch(e){throw console.error("Error creating plan:",e),x.error("فشل إنشاء خطة التقسيط - يرجى التحقق من البيانات"),e}finally{n.value=!1}}async function c(a,e){n.value=!0;try{const l=await C.updatePlan(a,e);return await _(),x.success("تم تحديث خطة التقسيط بنجاح"),l.data[0]}catch(l){throw console.error("Error updating plan:",l),l}finally{n.value=!1}}async function I(a){n.value=!0;try{await C.delete(a),await _(),x.success("تم حذف خطة التقسيط بنجاح")}catch(e){throw console.error("Error deleting plan:",e),e}finally{n.value=!1}}async function H(a=null){n.value=!0;try{const e=a?{installment_plan_id:a}:{},l=await C.getPayments(e,{showToast:!1});return w.value=l.data,l}catch(e){throw console.error("Error fetching payments:",e),e}finally{n.value=!1}}async function $(a){n.value=!0;try{const e=await C.createPayment(a);return x.success("تم تسجيل الدفعة بنجاح"),e.data[0]}catch(e){throw console.error("Error creating payment:",e),e}finally{n.value=!1}}async function O(a){n.value=!0;try{const e=await M.getByPayment(a,{showToast:!1});return g.value=e.data,e}catch(e){throw console.error("Error fetching payment details:",e),e}finally{n.value=!1}}async function K(a){n.value=!0;try{const e=await M.createDetail(a);return x.success("تم تسجيل تفاصيل الدفعة بنجاح"),e.data[0]}catch(e){throw console.error("Error creating payment detail:",e),e}finally{n.value=!1}}async function Y(a,e){n.value=!0;try{await M.replaceDetail(a,e),x.success("تم تحديث تفاصيل الدفعة بنجاح")}catch(l){throw console.error("Error updating payment detail:",l),x.error("فشل التحديث - استخدم حذف وإعادة إنشاء"),l}finally{n.value=!1}}function j(){v.value=null,b.value=null,m.value="",D.value=1}return{plans:t,currentPlan:k,payments:w,paymentDetails:g,loading:n,totalItems:S,page:D,itemsPerPage:P,search:m,sortBy:f,statusFilter:v,customerFilter:b,params:T,fetchPlans:_,fetchPlan:p,createPlan:s,updatePlan:c,deletePlan:I,fetchPayments:H,createPayment:$,fetchPaymentDetails:O,createPaymentDetail:K,updatePaymentDetail:Y,resetFilters:j}});function ge(){const t=he(),{isOpen:k,formData:w,isEditMode:g,open:n,close:S}=de(),{showConfirm:D,confirmMessage:P,confirm:m,handleConfirm:f,handleCancel:v}=ue(),b=N(()=>t.plans),T=N(()=>t.payments),_=N(()=>t.loading),p=N(()=>t.totalItems),s=async()=>{await t.fetchPlans()};return{plans:b,payments:T,loading:_,totalItems:p,formData:w,isEditMode:g,isOpen:k,open:n,close:S,showConfirm:D,confirmMessage:P,handleConfirm:async()=>{await f(),await s()},handleCancel:v,loadPlans:s,loadPlan:async l=>await t.fetchPlan(l),savePlan:async l=>g.value?await t.updatePlan(w.value.id,l):await t.createPlan(l),handleDeletePlan:l=>{m("هل أنت متأكد من حذف خطة التقسيط؟",async()=>{await t.deletePlan(l.id)})},handleEditPlan:l=>{n(l)},handleCreatePlan:()=>{n({})},loadPayments:async(l=null)=>{await t.fetchPayments(l)},createPayment:async l=>await t.createPayment(l),loadPaymentDetails:async l=>await t.fetchPaymentDetails(l),createPaymentDetail:async l=>await t.createPaymentDetail(l),updatePaymentDetail:async(l,Z)=>await t.updatePaymentDetail(l,Z)}}const ve={class:"app-skeleton"},we={__name:"AppSkeleton",props:{type:{type:String,default:"card",validator:t=>["table","card","list","form","article","dashboard","custom"].includes(t)},loading:{type:Boolean,default:!0},count:{type:Number,default:4},skeletonType:{type:String,default:"card"}},setup(t){return(k,w)=>(d(),A("div",ve,[t.type==="table"?(d(),y(E,{key:0,type:"table-heading, table-row-divider@3",loading:t.loading},null,8,["loading"])):t.type==="card"?(d(),y(q,{key:1},{default:o(()=>[i(E,{type:"card",loading:t.loading},null,8,["loading"])]),_:1})):t.type==="list"?(d(),y(E,{key:2,type:"list-item-avatar-three-line@3",loading:t.loading},null,8,["loading"])):t.type==="form"?(d(),y(E,{key:3,type:"card-heading, list-item@3, actions",loading:t.loading},null,8,["loading"])):t.type==="article"?(d(),y(E,{key:4,type:"article, actions",loading:t.loading},null,8,["loading"])):t.type==="dashboard"?(d(),y(X,{key:5},{default:o(()=>[(d(!0),A(J,null,W(t.count,g=>(d(),y(L,{key:g,cols:"12",md:"6",lg:"3"},{default:o(()=>[i(q,null,{default:o(()=>[i(E,{type:"card"})]),_:1})]),_:2},1024))),128))]),_:1})):(d(),y(E,{key:6,type:t.skeletonType,loading:t.loading},null,8,["type","loading"]))]))}},Pe=fe(we,[["__scopeId","data-v-20871f58"]]),B={CASH:"cash",CARD:"card",TRANSFER:"transfer",CHECK:"check"},be={[B.CASH]:"نقدي",[B.CARD]:"بطاقة",[B.TRANSFER]:"تحويل",[B.CHECK]:"شيك"},_e={class:"installment-payments-page"},xe={class:"px-6 pb-6"},ke={class:"font-weight-black text-h6 text-success"},De={class:"font-weight-medium text-body-1"},Ce={class:"text-caption text-grey text-truncate d-inline-block",style:{"max-width":"200px"}},Ee={class:"d-flex justify-end"},Ve={key:0},Ae={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-2"},Se={class:"text-h5 font-weight-black text-success"},Te={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-2"},Ie={class:"text-h6 font-weight-bold"},Ne={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-4"},Le={class:"d-flex align-center"},ze={class:"font-weight-bold"},Be={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-4"},Me={class:"text-body-2"},Fe={class:"d-flex align-center mb-4"},Re={key:0,class:"py-12"},He={key:1},$e={class:"text-primary text-caption font-weight-bold"},Oe={class:"text-h6 font-weight-black text-primary"},Xe={__name:"InstallmentPaymentList",props:{planId:{type:[Number,String],default:null}},setup(t){const k=t,{payments:w,loading:g,loadPayments:n,loadPaymentDetails:S}=ge(),D=[{title:"المبلغ",key:"amount",sortable:!0},{title:"التاريخ",key:"date",sortable:!0},{title:"الطريقة",key:"method",sortable:!1},{title:"ملاحظات",key:"notes",sortable:!1},{title:"الإجراءات",key:"actions",sortable:!1}],P=u(!1),m=u(null),f=u([]),v=u(!1),b=p=>be[p]||p,T=async p=>{m.value=p,P.value=!0,v.value=!0;try{const s=await S(p.id);f.value=s.data}finally{v.value=!1}},_=()=>{console.log("Add payment")};return te(()=>{n(k.planId)}),(p,s)=>(d(),A("div",_e,[r("div",xe,[i(me,{headers:D,items:V(w),loading:V(g),title:`سجل دفعات الخطة #${t.planId||"العامة"}`,icon:"ri-money-dollar-box-line"},{actions:o(()=>[i(U,{color:"primary","prepend-icon":"ri-add-line",onClick:_},{default:o(()=>s[1]||(s[1]=[z(" تسجيل دفعة جديدة ")])),_:1})]),"item.amount":o(({item:c})=>[r("div",ke,h(V(R)(c.amount)),1)]),"item.date":o(({item:c})=>[r("div",De,h(V(G)(c.date)),1)]),"item.method":o(({item:c})=>[i(ae,{size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold px-3"},{default:o(()=>[i(F,{icon:"ri-wallet-line",size:"14",class:"me-1"}),z(" "+h(b(c.method)),1)]),_:2},1024)]),"item.notes":o(({item:c})=>[r("span",Ce,h(c.notes||"---"),1)]),"item.actions":o(({item:c})=>[r("div",Ee,[i(U,{icon:"ri-eye-line",size:"x-small",variant:"text",color:"info",tooltip:"عرض التفاصيل الكاملة",onClick:I=>T(c)},null,8,["onClick"])])]),_:1},8,["items","loading","title"])]),i(ye,{modelValue:P.value,"onUpdate:modelValue":s[0]||(s[0]=c=>P.value=c),title:"تفاصيل دفعة القسط",icon:"ri-information-line","max-width":"600","hide-confirm":""},{default:o(()=>[m.value?(d(),A("div",Ve,[i(X,{dense:""},{default:o(()=>[i(L,{cols:"12",sm:"6"},{default:o(()=>[r("div",Ae,[s[2]||(s[2]=r("div",{class:"text-caption text-grey mb-1"},"قيمة الدفعة",-1)),r("div",Se,h(V(R)(m.value.amount)),1)])]),_:1}),i(L,{cols:"12",sm:"6"},{default:o(()=>[r("div",Te,[s[3]||(s[3]=r("div",{class:"text-caption text-grey mb-1"},"تاريخ العملية",-1)),r("div",Ie,h(V(G)(m.value.date)),1)])]),_:1}),i(L,{cols:"12"},{default:o(()=>[r("div",Ne,[s[4]||(s[4]=r("div",{class:"text-caption text-grey mb-1"},"طريقة الدفع",-1)),r("div",Le,[i(F,{icon:"ri-wallet-line",size:"small",class:"me-2"}),r("span",ze,h(b(m.value.method)),1)])])]),_:1}),m.value.notes?(d(),y(L,{key:0,cols:"12"},{default:o(()=>[r("div",Be,[s[5]||(s[5]=r("div",{class:"text-caption text-grey mb-1"},"ملاحظات إضافية",-1)),r("div",Me,h(m.value.notes),1)])]),_:1})):Q("",!0)]),_:1}),i(le,{class:"my-4"}),r("div",Fe,[i(F,{icon:"ri-list-check-line",size:"small",color:"primary",class:"me-2"}),s[6]||(s[6]=r("h4",{class:"text-subtitle-1 font-weight-bold"},"توزيع الدفعة على الأقساط",-1))]),v.value?(d(),A("div",Re,[i(Pe,{type:"list"})])):f.value.length?(d(),A("div",He,[i(ne,{border:"",class:"rounded-lg pa-0 overflow-hidden"},{default:o(()=>[(d(!0),A(J,null,W(f.value,(c,I)=>(d(),y(se,{key:c.id,class:oe({"border-b":I<f.value.length-1})},{prepend:o(()=>[i(re,{color:"primary-lighten-5",size:"32",class:"me-3"},{default:o(()=>[r("span",$e,"#"+h(c.installment_id),1)]),_:2},1024)]),append:o(()=>[r("div",Oe,h(V(R)(c.amount_paid)),1)]),default:o(()=>[i(ie,{class:"font-weight-bold"},{default:o(()=>s[7]||(s[7]=[z("قسط مستحق")])),_:1}),i(ce,{class:"text-grey"},{default:o(()=>s[8]||(s[8]=[z("تم سداد جزء من قيمة القسط")])),_:1})]),_:2},1032,["class"]))),128))]),_:1})])):(d(),y(pe,{key:2,title:"لا توجد تفاصيل لتوزيع هذه الدفعة",icon:"ri-error-warning-line"}))])):Q("",!0)]),_:1},8,["modelValue"])]))}};export{Xe as default};
