import{R as ue,r as i,w as F,o as r,c as g,d as e,j as l,b,t as D,a9 as q,U as T,ap as L,a4 as E,a5 as k,a1 as G,k as I,F as A,A as j,a8 as ye,q as h,W as Ve,aq as X,Y as ne,u as x,X as Y,Z as re,P as ke,ar as xe,a as O,as as ie,_ as de,af as _e,s as we,V as Ce,m as Ue,a3 as te,a7 as Ie,i as Ne,a6 as S,M as H,G as Re,H as De,K as Pe,$ as W,z as $e,f as qe,at as Ae,au as Se,av as se,a2 as Te,aw as oe,D as he,p as Fe,ax as je,g as ze,aj as Be,ak as Le}from"./index-Tc2OuKZg.js";import{I as Me}from"./ImagePickerDialog--SKaxBfx.js";const Ee={__name:"UsersEditUserRolse",props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},emits:["update:user"],setup(C,{emit:w}){const{xs:P}=ue(),y=C,N=w,m=i(y.roles),c=i(!1),v=i([]);F(()=>y.user.roles,p=>{v.value=p?p.map(u=>u.name):[]},{immediate:!0});function f(){const p={user_id:y.user.id,roles:v.value};console.log(p),re("role/assignRole",p).then(u=>{N("update:user",u),c.value=!1})}return(p,u)=>(r(),g(A,null,[e(q,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-pencil-line",onClick:u[0]||(u[0]=V=>c.value=!0)},{default:l(()=>[b(D(m.value.length?"تعديل الادوار":"تعيين الادوار"),1)]),_:1}),e(Y,{fullscreen:x(P),modelValue:c.value,"onUpdate:modelValue":u[3]||(u[3]=V=>c.value=V),"max-width":"500",persistent:""},{default:l(()=>[e(T,{class:"pa-4"},{default:l(()=>[e(L,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>u[4]||(u[4]=[b("تعديل ادوار المستخدم ")])),_:1}),e(q,{class:"ma-4 text-center btn-add",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:"/roles"},{default:l(()=>u[5]||(u[5]=[b(" اضافة دور جديد ")])),_:1}),e(E,{class:"mb-7"},{default:l(()=>[e(k,{cols:"12"},{default:l(()=>[e(G,{class:"elevation-5 pa-5 ma-2"},{default:l(()=>[m.value.length?(r(),I(E,{key:0},{default:l(()=>[(r(!0),g(A,null,j(m.value,(V,_)=>(r(),I(k,{class:"pa-0",cols:"12",xs:"6",sm:"6",md:"4",lg:"3",key:_},{default:l(()=>[V?(r(),I(ye,{key:0,modelValue:v.value,"onUpdate:modelValue":u[1]||(u[1]=a=>v.value=a),label:V.name,value:V.name,density:"comfortable",color:"primary",class:"permission-checkbox"},null,8,["modelValue","label","value"])):h("",!0)]),_:2},1024))),128))]),_:1})):(r(),I(Ve,{key:1,type:"info",color:"info",variant:"tonal",class:"ma-2",density:"comfortable"},{default:l(()=>u[6]||(u[6]=[b(" لا يوجد أي أدوار على السيستم ")])),_:1}))]),_:1})]),_:1})]),_:1}),e(X,{style:{position:"fixed",bottom:"35px",left:"50%",transform:"translate(-50%, 50%)","min-width":"200px"},class:"pa-4 mt-10 mx-auto"},{default:l(()=>[e(q,{"append-icon":"ri-close-line",style:{"background-color":"#dc3545",color:"white !important"},variant:"text",onClick:u[2]||(u[2]=V=>c.value=!1)},{default:l(()=>u[7]||(u[7]=[b(" إلغاء ")])),_:1}),e(ne),e(q,{"append-icon":"ri-save-line",style:{"background-color":"#007bff",color:"white !important"},onClick:f},{default:l(()=>u[8]||(u[8]=[b(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["fullscreen","modelValue"])],64))}},Ke={key:0},Oe={__name:"RoleDetails",props:{userRole:{type:Object,required:!0}},setup(C,{expose:w}){const P=C,y=i(null),N=i([]);ke(()=>{});const m=i(!1);function c(){m.value=!0}return F(()=>P.userRole,async v=>{v&&v.permissions&&(N.value=v.permissions,y.value=await xe(N.value))},{immediate:!0}),w({openDialog:c}),(v,f)=>(r(),I(Y,{modelValue:m.value,"onUpdate:modelValue":f[1]||(f[1]=p=>m.value=p),"max-width":"500px"},{default:l(()=>[e(T,null,{default:l(()=>[e(L,null,{default:l(()=>[O("span",null," صلاحيات الدور "+D(C.userRole.name),1)]),_:1}),y.value?(r(),g("div",Ke,[(r(!0),g(A,null,j(y.value,(p,u)=>(r(),g("div",{key:u},[f[2]||(f[2]=O("hr",{style:{width:"70%",margin:"10px"}},null,-1)),e(L,null,{default:l(()=>[O("span",null,D(p.name),1)]),_:2},1024),(r(!0),g(A,null,j(p.permissions,(V,_)=>(r(),I(ie,{class:"ma-1",key:_,color:"blue","text-color":"white"},{default:l(()=>[b(D(V.name),1)]),_:2},1024))),128))]))),128))])):h("",!0),e(X,null,{default:l(()=>[e(q,{text:"",onClick:f[0]||(f[0]=p=>m.value=!1)},{default:l(()=>f[3]||(f[3]=[b("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},We={class:"phone-input-wrapper"},Ge={key:0},He={key:1},Xe={key:0},Ye={__name:"PhoneNumberInput",props:{label:{type:String,default:"رقم الهاتف"},placeholder:{type:String,default:"أدخل رقم الهاتف"},rules:{type:Array,default:()=>[]},counter:{type:Number,default:15},initialPhoneNumber:{type:String,default:""}},emits:["update:phoneNumber"],setup(C,{emit:w}){const P=C,y=w,{initialPhoneNumber:N}=_e(P),m=i(N.value);F(m,a=>{y("update:phoneNumber",a)}),F(N,a=>{a!==m.value&&(m.value=a)});const c=i(!1),v=i([]),f=i("");function p(a){let n=a.replace(/\s+/g,"").replace(/^\+/,"");return n=n.replace(/^(2|966|971|962|965|968|973|974|21|212|218|249|963|90|1|44|33|49|7|380|39|34|351|355|357|358|359|36|420|421|43|45|46|47|48|52|53|54|55|56|57|58|60|61|62|63|64|65|66|81|82|84|86|7|27|234|237|254|255|256|260|263|264|265|266|267|268|20)/,""),n}async function u(){if(!("contacts"in navigator)||!("select"in navigator.contacts)){W.error("جهازك لا يدعم اختيار جهات الاتصال");return}try{const a=["tel","name"],n={multiple:!1},d=await navigator.contacts.select(a,n);d&&d.length&&d[0].tel&&d[0].tel.length?d[0].tel.length===1?m.value=p(d[0].tel[0]):(v.value=d[0].tel.map(p),f.value=d[0].name?d[0].name[0]:"",c.value=!0):W.error("لم يتم العثور على رقم هاتف في جهة الاتصال")}catch{W.error("تم إلغاء اختيار جهة الاتصال أو حدث خطأ")}}function V(a){m.value=p(a),c.value=!1}const _=typeof window<"u"&&"contacts"in navigator&&typeof navigator.contacts.select=="function";return(a,n)=>(r(),g("div",We,[e(x(S),{modelValue:x(m),"onUpdate:modelValue":n[2]||(n[2]=d=>Ne(m)?m.value=d:null),label:C.label,placeholder:C.placeholder,rules:C.rules,counter:C.counter,type:"number",class:"phone-input",clearable:"","onClick:prependInner":u,"prepend-inner-icon-cb":()=>{}},{"prepend-inner":l(()=>[e(x(we),{location:"top"},{activator:l(({props:d})=>[e(x(Ce),Ue(d,{class:"contact-picker-icon",color:x(_)?"primary":"grey",size:"24",style:x(_)?"cursor:pointer;":"cursor:not-allowed; opacity:0.5;",onClick:n[0]||(n[0]=te(z=>x(_)&&u(),["stop"])),tabindex:"0",onKeydown:n[1]||(n[1]=Ie(te(z=>x(_)&&u(),["prevent"]),["enter"])),"aria-disabled":!x(_)}),{default:l(()=>n[5]||(n[5]=[b(" ri-contacts-book-2-line ")])),_:2},1040,["color","style","aria-disabled"])]),default:l(()=>[x(_)?(r(),g("span",Ge,"اختيار من جهات الاتصال")):(r(),g("span",He,"جهازك لا يدعم اختيار جهات الاتصال"))]),_:1})]),_:1},8,["modelValue","label","placeholder","rules","counter"]),e(Y,{modelValue:c.value,"onUpdate:modelValue":n[4]||(n[4]=d=>c.value=d),"max-width":"400",persistent:""},{default:l(()=>[e(T,null,{default:l(()=>[e(L,{class:"text-h6"},{default:l(()=>[n[6]||(n[6]=b("اختر رقم الهاتف ")),f.value?(r(),g("span",Xe,"("+D(f.value)+")",1)):h("",!0)]),_:1}),e(H),e(Re,null,{default:l(()=>[(r(!0),g(A,null,j(v.value,(d,z)=>(r(),I(De,{key:z,onClick:Z=>V(d),style:{cursor:"pointer"}},{default:l(()=>[e(Pe,null,{default:l(()=>[b(D(d),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),e(X,null,{default:l(()=>[e(ne),e(q,{text:"",onClick:n[3]||(n[3]=d=>c.value=!1)},{default:l(()=>n[7]||(n[7]=[b("إلغاء")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Ze=de(Ye,[["__scopeId","data-v-c018fda0"]]),Je={key:0},Qe={key:2,class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},el={__name:"edit",setup(C){ue();const w=qe(),P=ze(),y=i(!1),N=i(null),m=i([]),c=i([]),v=i([]),f=i([]),p=$e(),u=i(null),V=i(null);console.log("selectedCompanies init:",v.value);const _=[{title:"بيانات الحساب",icon:"ri-group-line",tab:"account"},{title:"الادوار و الصلاحيات",icon:"ri-lock-line",tab:"role"}],a=i({full_name:"",nickname:"",email:"",phone:"",username:"",roles:[],companies:[],company_id:null,company_ids:[],password:""}),n=i(w.params.tab||_[0].tab),d=i(!1),z=[s=>!!s||"اسم الشهرة مطلوب"],Z=[s=>!!s||"رقم الهاتف مطلوب"],me=[s=>!!s||"كلمة المرور مطلوبة",s=>s.length>=6||"كلمة المرور يجب أن لا تقل عن 6 أحرف"],J=i(null),M=i(null);F(()=>p.user,s=>{s&&Q()},{immediate:!0}),F(()=>w.params.id,s=>{s?(N.value=s,pe()):(a.value.password="12345678",y.value=!1,a.value.customer_type="retail")},{immediate:!0});function pe(){y.value=!0,Be("roles",{per_page:-1},!1,!1,!1).then(s=>{m.value=s,console.log("roles",m.value)}).catch(()=>{m.value=[]}),Le("user",N.value).then(s=>{a.value=s.data,console.log("user ",s),console.log("user.value.companies:",a.value),a.value.avatar_url&&(M.value=a.value.avatar_url),Q()}).finally(()=>{y.value=!1})}function Q(){var K,ae;const s=new Set((((K=p.user)==null?void 0:K.companies)||[]).map(U=>U.id)),t=(a.value.companies||[]).map(U=>({...U,disabled:!s.has(U.id)})),o=(((ae=p.user)==null?void 0:ae.companies)||[]).map(U=>({...U,disabled:!1})),R=[...t,...o],B=Array.from(new Map(R.map(U=>[U.id,U])).values());return f.value=B,v.value=B.filter(U=>(a.value.companies||[]).some(ge=>ge.id===U.id)),B}function ce(s){return console.log("itemProps →",s),{title:s.name,subtitle:s.field,disabled:s.disabled}}async function ve(){const{valid:s}=await V.value.validate();s&&(c.value=Array.from(v.value.map(t=>typeof t=="object"&&t.id!==void 0?t.id:t)),a.value.company_id=c.value.length<=0?p.user.company_id:c.value[0],a.value.company_ids=c.value.length>0?c.value:[],a.value.companies=null,delete a.value.roles,delete a.value.permissions,console.log("user to save:",a.value),console.log("selectedImageIds to save:",$.value),Array.isArray($.value)&&$.value.length>0?a.value.images_ids=$.value:delete a.value.images_ids,console.log("selectedImageIds to save:",$.value),console.log("user to save:",a.value),console.log("user to save:",a.value),re("user",a.value,w.params.id).then(()=>{setTimeout(()=>{P.go(-1)},1200)}))}const ee=i({});function fe(s){s&&(ee.value=s,u.value.openDialog())}const le=i(!1),$=i([]),be=s=>{s?(J.value=s,$.value=[s.id],M.value=s.url):(J.value=null,$.value=null)};return(s,t)=>(r(),I(T,null,{default:l(()=>[e(Se,{class:"ma-5",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),"align-tabs":"center",color:"deep-purple-accent-4"},{default:l(()=>[(r(),g(A,null,j(_,(o,R)=>e(Ae,{key:R,value:o.tab,"append-icon":o.icon},{default:l(()=>[b(D(o.title),1)]),_:2},1032,["value","append-icon"])),64))]),_:1},8,["modelValue"]),e(je,{modelValue:n.value,"onUpdate:modelValue":t[12]||(t[12]=o=>n.value=o)},{default:l(()=>[e(se,{value:"account"},{default:l(()=>[e(E,null,{default:l(()=>[e(k,{cols:"12"},{default:l(()=>[e(T,{elevation:"0",loading:y.value,title:x(w).params.id?"تعديل المستخدم":"اضافة مستخدم",class:"ma-4"},{default:l(()=>[e(H),e(G,null,{default:l(()=>[e(Te,{class:"mt-6",ref_key:"userForm",ref:V,modelValue:d.value,"onUpdate:modelValue":t[10]||(t[10]=o=>d.value=o)},{default:l(()=>[e(E,null,{default:l(()=>[e(k,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(S,{modelValue:a.value.full_name,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.full_name=o),label:"الاسم بالكامل"},null,8,["modelValue"])]),_:1}),e(k,{sm:"6",md:"4",cols:"12"},{default:l(()=>[e(S,{required:"",modelValue:a.value.nickname,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.nickname=o),label:" اسم الشهرة ",rules:z},null,8,["modelValue"])]),_:1}),e(k,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(S,{modelValue:a.value.email,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.email=o),label:"الايميل",placeholder:"johndoe@gmail.com",type:"email"},null,8,["modelValue"])]),_:1}),e(k,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(Ze,{label:"رقم الهاتف",placeholder:"0123456789",initialPhoneNumber:a.value.phone,"onUpdate:phoneNumber":t[4]||(t[4]=o=>a.value.phone=o),rules:Z,required:""},null,8,["initialPhoneNumber"])]),_:1}),e(k,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(S,{modelValue:a.value.username,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.username=o),label:"اسم المستخدم",placeholder:"اسم المستخدم"},null,8,["modelValue"])]),_:1}),e(k,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(oe,{modelValue:a.value.customer_type,"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.customer_type=o),items:[{value:"retail",title:"عميل قطاعي"},{value:"wholesale",title:"عميل جملة "}],label:"نوع العميل","item-title":"title","item-value":"value",clearable:""},null,8,["modelValue"])]),_:1}),e(k,{cols:"12"},{default:l(()=>[f.value?(r(),I(oe,{key:0,modelValue:v.value,"onUpdate:modelValue":t[7]||(t[7]=o=>v.value=o),items:f.value,label:"حدد شركة علي الاقل","item-title":"name","item-value":"id","item-color":"red",chips:"",multiple:"","closable-chips":"","item-props":ce,"return-object":"",required:""},null,8,["modelValue","items"])):h("",!0)]),_:1}),e(k,{cols:"12",sm:"6",md:"4"},{default:l(()=>[M.value?(r(),g("div",Je,[e(he,{src:M.value,class:"mb-2","aspect-ratio":"1",cover:""},null,8,["src"])])):h("",!0),e(k,{cols:"12"},{default:l(()=>[e(Me,{modelValue:le.value,"onUpdate:modelValue":t[8]||(t[8]=o=>le.value=o),onClose:be,"button-text":"الصورة الشخصية "},null,8,["modelValue"])]),_:1})]),_:1}),e(H,{style:{width:"50%"},thickness:2,class:"border-opacity-100",color:"warning"}),e(k,{cols:"12",sm:"6",md:"4"},{default:l(()=>[e(S,{required:!x(w).params.id,modelValue:a.value.password,"onUpdate:modelValue":t[9]||(t[9]=o=>a.value.password=o),label:" الباسورد ",rules:x(w).params.id?[]:me},null,8,["required","modelValue","rules"])]),_:1}),e(k,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(q,{disabled:!d.value,class:Fe({"forbidden-cursor":!d.value}),onClick:ve},{default:l(()=>t[13]||(t[13]=[b(" حفظ ")])),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["loading","title"])]),_:1})]),_:1})]),_:1}),e(se,{value:"role"},{default:l(()=>[e(T,{elevation:"0",class:"ma-4"},{default:l(()=>{var o;return[m.value&&a.value?(r(),I(Ee,{key:0,user:a.value,"onUpdate:user":t[11]||(t[11]=R=>a.value=R),roles:m.value},null,8,["user","roles"])):h("",!0),e(L,{class:"text-subtitle-1 py-1 px-4 bg-grey-lighten-4"},{default:l(()=>t[14]||(t[14]=[b(" ادوار المستخدم ")])),_:1}),((o=a.value)==null?void 0:o.roles.length)>0?(r(),I(G,{key:1},{default:l(()=>[(r(!0),g(A,null,j(a.value.roles,(R,B)=>(r(),g("span",{key:B},[e(ie,{onClick:K=>fe(R),class:"ma-2",variant:"outlined"},{default:l(()=>[b(D(R.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})):(r(),g("div",Qe,"لم يتم تعين اي ادوار للمستخدم"))]}),_:1}),e(Oe,{ref_key:"roleDetail",ref:u,userRole:ee.value},null,8,["userRole"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},tl=de(el,[["__scopeId","data-v-b82c6c42"]]);export{tl as default};
