import{r,H as we,x as k,J as ke,I as W,c as M,a as i,b as t,w as s,u as f,s as v,F as Z,o,N as de,l as A,C as E,at as Ae,h as Ve,d as ce,g as N,t as h,B as X,y as pe,i as Ee,j as Se,e as O,a8 as Be,f as De,z as ve,P as m,an as Le,au as Te,a7 as Ue,av as ze,a1 as Me}from"./index-CuR9-sbN.js";import{u as ae}from"./useApi-CjhFmPue.js";import{A as Oe}from"./AppDataTable-CnA5lOqV.js";import{_ as V}from"./AppButton-CREzoRf6.js";import{A as fe}from"./AppDialog-vLCI3uF9.js";import{_ as ee}from"./AppInput-06Y7zOXl.js";import{A as He}from"./AppSwitch-CXzOvU1j.js";import{_ as me}from"./AppCard-CXpBKc1t.js";import{_ as Ie}from"./LoadingSpinner-vBlED74H.js";import{_ as Pe}from"./EmptyState-FFeUUxeu.js";import{A as $e}from"./AppInfiniteScroll-616_I-vy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Ne(){const F=ae("/api/cash-boxes"),b=r([]),_=r(!1),x=r(0);return{cashBoxes:b,loading:_,total:x,fetchCashBoxes:async(S={},R={})=>{var B;const{append:j=!1}=R;_.value=!0;try{const c=await F.get(S,{showLoading:!1});let u=[],C=0;return c.data&&Array.isArray(c.data.data)?(u=c.data.data,C=((B=c.data.meta)==null?void 0:B.total)||c.data.data.length):(u=c.data||[],C=c.total||u.length),j?b.value=[...b.value,...u]:b.value=u,x.value=C,c}catch(c){throw b.value=[],x.value=0,c}finally{_.value=!1}},deleteCashBox:async S=>await F.remove(S,{successMessage:"تم حذف الخزينة بنجاح"})}}const Xe={class:"cashbox-page"},Fe={class:"px-6 pb-6"},Re={class:"px-6 pb-6"},je={class:"d-flex align-center flex-wrap gap-4"},qe={class:"d-flex align-center gap-3"},Ge={class:"cashbox-card-header d-flex align-center justify-center pa-4 bg-grey-lighten-4 position-relative"},Je={class:"d-flex align-center justify-space-between mt-2"},Ye={class:"d-flex align-center"},Ke={class:"font-weight-bold"},Qe={key:1,class:"text-grey-lighten-1 text-caption"},We={class:"d-flex justify-end gap-1"},Ze={class:"d-flex align-center justify-space-between"},ea={class:"text-center pa-4"},aa={class:"text-body-1 text-grey-darken-1"},la={class:"mt-2 text-error text-caption font-weight-bold"},ma={__name:"CashBoxList",setup(F){const b=(l,a)=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>l(...n),a)}},{cashBoxes:_,loading:x,total:H,fetchCashBoxes:le,deleteCashBox:S}=Ne(),R=l=>{g.value==="list"&&y()},j=()=>{x.value||_.value.length>=H.value||(u.value++,y(!0))},B=ae("/api/cash-boxes"),c=ae("/api/cash-box-types"),u=r(1),C=r(12),g=r("grid"),q=r(""),D=r(!1),I=r(!1),w=r(null),G=r(!1),J=r(!1),te=r(null),P=r([]),Y=r(!1),d=we(),L=k(()=>{var l,a;return(a=(l=d.user)==null?void 0:l.permissions)==null?void 0:a.includes(m.ADMIN_SUPER)}),T=k(()=>{var l,a;return(a=(l=d.user)==null?void 0:l.permissions)==null?void 0:a.includes(m.ADMIN_COMPANY)}),_e=k(()=>{var l,a;return L.value||T.value||((a=(l=d.user)==null?void 0:l.permissions)==null?void 0:a.includes(m.CASH_BOXES_CREATE))}),K=l=>{var a,e,n,U,z;return L.value||T.value?!0:((e=(a=d.user)==null?void 0:a.permissions)==null?void 0:e.includes(m.CASH_BOXES_UPDATE_ALL))||((U=(n=d.user)==null?void 0:n.permissions)==null?void 0:U.includes(m.CASH_BOXES_UPDATE_SELF))&&l.created_by===((z=d.user)==null?void 0:z.id)},Q=l=>{var a,e,n,U,z;return L.value||T.value?!0:((e=(a=d.user)==null?void 0:a.permissions)==null?void 0:e.includes(m.CASH_BOXES_DELETE_ALL))||((U=(n=d.user)==null?void 0:n.permissions)==null?void 0:U.includes(m.CASH_BOXES_DELETE_SELF))&&l.created_by===((z=d.user)==null?void 0:z.id)},ge=k(()=>{var l,a,e,n;return L.value||T.value||((a=(l=d.user)==null?void 0:l.permissions)==null?void 0:a.includes(m.CASH_BOXES_UPDATE_ALL))||((n=(e=d.user)==null?void 0:e.permissions)==null?void 0:n.includes(m.CASH_BOXES_UPDATE_SELF))}),ye=k(()=>{var l,a,e,n;return L.value||T.value||((a=(l=d.user)==null?void 0:l.permissions)==null?void 0:a.includes(m.CASH_BOXES_DELETE_ALL))||((n=(e=d.user)==null?void 0:e.permissions)==null?void 0:n.includes(m.CASH_BOXES_DELETE_SELF))}),p=r({name:"",cash_box_type_id:null,initial_balance:0,is_active:1}),$=k(()=>{var l;return!!((l=w.value)!=null&&l.id)}),he=k(()=>{const l=[{title:"الاسم",key:"name",sortable:!0},{title:"النوع",key:"type",sortable:!0},{title:"الرصيد",key:"balance",align:"end",sortable:!0},{title:"الحالة",key:"is_active",align:"center",sortable:!0}];return(ge.value||ye.value)&&l.push({title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}),l}),se={required:l=>!!l||"مطلوب"},ie=async()=>{Y.value=!0;try{const l=await c.get({per_page:100},{showLoading:!1,showError:!1});P.value=l.data||[]}finally{Y.value=!1}},xe=()=>{w.value=null,p.value={name:"",cash_box_type_id:null,initial_balance:0,is_active:1},D.value=!0,P.value.length||ie()},ne=l=>{w.value=l,p.value={...l},D.value=!0,P.value.length||ie()},oe=l=>{w.value=l,I.value=!0},re=async()=>{const{valid:l}=await te.value.validate();if(l){G.value=!0;try{$.value?await B.update(w.value.id,p.value,{successMessage:"تم التحديث بنجاح"}):await B.create(p.value,{successMessage:"تم الإضافة بنجاح"}),D.value=!1,y()}finally{G.value=!1}}},be=async()=>{J.value=!0;try{await S(w.value.id),I.value=!1,y()}finally{J.value=!1}},ue=l=>l==null?"0.00 ج.م":new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(l),Ce=b(()=>{u.value=1,y()},500),y=(l={})=>{const a=l===!0;return le({page:u.value,per_page:C.value,name:q.value},{append:a})};return ke(y),W(u,()=>{g.value==="list"&&y()}),W(C,()=>{g.value==="list"&&(u.value=1,y())}),W(g,()=>{u.value=1,y()}),(l,a)=>(o(),M("div",Xe,[a[13]||(a[13]=i("div",{class:"mb-6 px-6 pt-6"},[i("h1",{class:"text-h4 font-weight-bold"},"الخزائن"),i("p",{class:"text-body-1 text-grey"},"إدارة الخزائن النقدية والأرصدة المتاحة للعمليات")],-1)),i("div",Fe,[i("div",Re,[t(me,{class:"mb-6"},{default:s(()=>[i("div",je,[t(ee,{modelValue:q.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>q.value=e),f(Ce)],label:"بحث عن خزينة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t(de),i("div",qe,[_e.value?(o(),v(V,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:xe},{default:s(()=>a[9]||(a[9]=[A(" خزينة جديدة ")])),_:1})):E("",!0),t(Ae,{variant:"outlined",density:"comfortable",color:"primary",class:"bg-white"},{default:s(()=>[t(V,{active:g.value==="grid",icon:"ri-grid-fill",onClick:a[1]||(a[1]=e=>g.value="grid"),title:"عرض شبكي"},null,8,["active"]),t(V,{active:g.value==="list",icon:"ri-list-check",onClick:a[2]||(a[2]=e=>g.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])])]),_:1}),f(x)?(o(),v(Ie,{key:0})):(o(),M(Z,{key:1},[f(_).length===0?(o(),v(Pe,{key:0,icon:"ri-safe-2-line",title:"لا توجد خزائن",subtitle:"لم يتم العثور على أي خزائن مطابقة لبحثك."})):(o(),M(Z,{key:1},[g.value==="grid"?(o(),v($e,{key:0,loading:f(x)&&f(_).length>0,"has-more":f(_).length<f(H),"no-more-text":"لا يوجد المزيد من الخزائن",onLoad:j},{default:s(()=>[t(ce,null,{default:s(()=>[(o(!0),M(Z,null,Ve(f(_),e=>(o(),v(O,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[t(me,{class:"cashbox-card h-100","no-padding":""},Le({default:s(()=>[i("div",Ge,[t(ve,{size:"80",rounded:"lg",class:"elevation-1 bg-white"},{default:s(()=>[t(N,{icon:"ri-safe-2-line",size:"40",color:"warning"})]),_:1}),t(X,{color:e.is_active?"success":"error",size:"x-small",class:"position-absolute top-2 right-2 font-weight-bold",variant:"flat"},{default:s(()=>[A(h(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),t(Te,null,{default:s(()=>[t(Ue,{class:"text-h6 font-weight-bold"},{default:s(()=>[A(h(e.name),1)]),_:2},1024),t(ze,{class:"d-flex align-center mt-1"},{default:s(()=>[e.type?(o(),v(X,{key:0,size:"x-small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:s(()=>[A(h(e.type.name),1)]),_:2},1024)):E("",!0)]),_:2},1024)]),_:2},1024),t(Me,{class:"pt-0"},{default:s(()=>[i("div",Je,[a[10]||(a[10]=i("span",{class:"text-caption text-grey"},"الرصيد الحالي",-1)),i("span",{class:pe(["font-weight-black",e.balance>=0?"text-success":"text-error"])},h(ue(e.balance)),3)])]),_:2},1024)]),_:2},[K(e)||Q(e)?{name:"actions",fn:s(()=>[t(de),K(e)?(o(),v(V,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",tooltip:"تعديل",onClick:n=>ne(e)},null,8,["onClick"])):E("",!0),Q(e)?(o(),v(V,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",tooltip:"حذف",onClick:n=>oe(e)},null,8,["onClick"])):E("",!0)]),key:"0"}:void 0]),1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(o(),v(Oe,{key:1,headers:he.value,items:f(_),loading:f(x),"items-length":f(H),"items-per-page":C.value,page:u.value,title:"قائمة الخزائن",icon:"ri-safe-2-line","onUpdate:options":R},{"item.name":s(({item:e})=>[i("div",Ye,[t(N,{icon:"ri-money-dollar-box-line",size:"small",color:"warning",class:"me-2"}),i("span",Ke,h(e.name),1)])]),"item.type":s(({item:e})=>[e.type?(o(),v(X,{key:0,size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:s(()=>[A(h(e.type.name),1)]),_:2},1024)):(o(),M("span",Qe,"غير محدد"))]),"item.balance":s(({item:e})=>[i("div",{class:pe(["text-end font-weight-black",e.balance>=0?"text-success":"text-error"])},h(ue(e.balance)),3)]),"item.is_active":s(({item:e})=>[t(X,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold px-3"},{default:s(()=>[A(h(e.is_active?"نشط":"غير نشط"),1)]),_:2},1032,["color"])]),"item.actions":s(({item:e})=>[i("div",We,[K(e)?(o(),v(V,{key:0,icon:"ri-edit-line",size:"x-small",variant:"text",color:"primary",tooltip:"تعديل",onClick:n=>ne(e)},null,8,["onClick"])):E("",!0),Q(e)?(o(),v(V,{key:1,icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف",onClick:n=>oe(e)},null,8,["onClick"])):E("",!0)])]),_:1},8,["headers","items","loading","items-length","items-per-page","page"]))],64))],64))])]),t(fe,{modelValue:D.value,"onUpdate:modelValue":a[7]||(a[7]=e=>D.value=e),title:$.value?"تعديل الخزينة":"إضافة خزينة جديدة",icon:$.value?"ri-edit-line":"ri-safe-2-line",loading:G.value,"max-width":"650",onConfirm:re},{default:s(()=>[t(Ee,{ref_key:"formRef",ref:te,onSubmit:Se(re,["prevent"])},{default:s(()=>[t(ce,{dense:""},{default:s(()=>[t(O,{cols:"12"},{default:s(()=>[t(ee,{modelValue:p.value.name,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value.name=e),label:"اسم الخزينة *",placeholder:"مثال: الخزينة الرئيسية",rules:[se.required]},null,8,["modelValue","rules"])]),_:1}),t(O,{cols:"12"},{default:s(()=>[t(Be,{modelValue:p.value.cash_box_type_id,"onUpdate:modelValue":a[4]||(a[4]=e=>p.value.cash_box_type_id=e),items:P.value,loading:Y.value,"item-title":"name","item-value":"id",label:"نوع الخزينة *",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-list-settings-line",rules:[se.required],"hide-details":"",class:"mb-4"},null,8,["modelValue","items","loading","rules"])]),_:1}),t(O,{cols:"12"},{default:s(()=>[t(ee,{modelValue:p.value.initial_balance,"onUpdate:modelValue":a[5]||(a[5]=e=>p.value.initial_balance=e),modelModifiers:{number:!0},label:"الرصيد الافتتاحي",type:"number",step:"0.01","prepend-inner-icon":"ri-money-dollar-circle-line",disabled:$.value},null,8,["modelValue","disabled"])]),_:1}),t(O,{cols:"12"},{default:s(()=>[t(De,{variant:"tonal",color:"primary",class:"pa-4 rounded-lg"},{default:s(()=>[i("div",Ze,[a[11]||(a[11]=i("div",null,[i("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),i("div",{class:"text-caption"},"تحديد ما إذا كانت الخزينة متاحة حالياً للعمليات")],-1)),t(He,{modelValue:p.value.is_active,"onUpdate:modelValue":a[6]||(a[6]=e=>p.value.is_active=e),"true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),t(fe,{modelValue:I.value,"onUpdate:modelValue":a[8]||(a[8]=e=>I.value=e),title:"حذف الخزينة؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:J.value,onConfirm:be},{default:s(()=>{var e;return[i("div",ea,[t(ve,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:s(()=>[t(N,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),i("p",aa,'هل أنت متأكد من حذف "'+h((e=w.value)==null?void 0:e.name)+'"؟',1),i("div",la,[t(N,{icon:"ri-error-warning-line",size:"small",class:"me-1"}),a[12]||(a[12]=A(" هذا الإجراء قد يؤثر على السجلات المالية المرتبطة! "))])])]}),_:1},8,["modelValue","loading"])]))}};export{ma as default};
