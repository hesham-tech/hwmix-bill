import{u as H}from"./useApi-C9JqAxpT.js";import{r as o,a as X,z as Y,L as Z,c as V,b as i,d as l,w as s,u as $,x as y,F as M,e as ee,v as r,E as ae,s as N,o as d,P as E,az as te,j as le,i as z,B as F,n as g,D as L,f as se,aA as oe,a7 as ie,aB as ne,a3 as re}from"./index-B0c0aplS.js";import{_ as q}from"./AppCard-D6Bc5W2v.js";import{A as G}from"./AppSwitch-CESJPTjv.js";import{_ as R}from"./AppButton-CoaWq9vh.js";import{_ as ce}from"./AppInput-B9V4fNt_.js";import{A as de}from"./AppDataTable-DRQWa6GE.js";import{A as ue}from"./AppDialog-yMQfGMN-.js";import{_ as pe}from"./LoadingSpinner-DEhea3Ta.js";import{_ as ve}from"./EmptyState-C-yGKIfM.js";import"./usePermissions-D1W15K8H.js";function me(){const T=H("/api/invoice-types"),u=o([]),v=o(!1),_=o(0);return{invoiceTypes:u,loading:v,total:_,fetchInvoiceTypes:async(m={})=>{v.value=!0;try{const c=await T.get(m,{showLoading:!1});return u.value=c.data||[],_.value=c.total||0,c}catch(c){throw u.value=[],_.value=0,c}finally{v.value=!1}},deleteInvoiceType:async m=>await T.remove(m,{successMessage:"تم حذف نوع الفاتورة بنجاح"})}}const fe={class:"invoice-types-page"},ge={class:"d-flex align-center flex-wrap gap-4"},_e={class:"type-card-image d-flex align-center justify-center pa-4 bg-primary-lighten-5 position-relative"},ye={class:"text-body-2 text-grey-darken-1 text-truncate-3 height-60"},he={class:"d-flex align-center py-2"},xe={class:"font-weight-bold text-body-1"},be={class:"text-caption text-grey"},we={key:2,class:"mt-8 d-flex align-center justify-space-between flex-wrap gap-4 px-2"},Ve={class:"text-body-2 text-grey"},Te={__name:"InvoiceTypeList",setup(T){const{invoiceTypes:u,loading:v,fetchInvoiceTypes:_}=me(),D=H("/api/invoice-types"),h=o(1),m=o(12),c=o(""),f=o("grid"),x=o({}),b=o(!1),U=o(""),A=o(""),B=o("تأكيد"),w=o(null),J=[{title:"النوع",key:"name",sortable:!0},{title:"التصنيف",key:"type",sortable:!1},{title:"الحالة",key:"is_active",sortable:!1,align:"center"},{title:"الإجراءات",key:"actions",sortable:!1,align:"end"}],p=Y(()=>{if(!c.value)return u.value;const t=c.value.toLowerCase();return u.value.filter(a=>a.name.toLowerCase().includes(t)||C(a.type).toLowerCase().includes(t)||I(a.type).toLowerCase().includes(t))}),K=((t,a)=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>t(...n),a)}})(()=>{h.value=1},500),P=t=>({sale:"ri-shopping-cart-line",purchase:"ri-shopping-bag-line",return:"ri-arrow-go-back-line",installment:"ri-bank-card-line"})[t]||"ri-file-text-line",k=t=>({sale:"success",purchase:"info",return:"warning",installment:"purple"})[t]||"primary",C=t=>({sale:"بيع",purchase:"شراء",return:"مرتجع",installment:"تقسيط"})[t]||t,I=t=>({sale:"تؤثر على المخزون والإيرادات",purchase:"تزيد المخزون والمصروفات",return:"عكس عملية البيع أو الشراء",installment:"إنشاء جدول أقساط وتحصيلات"})[t]||"نوع فاتورة مخصص",S=(t,a)=>{const e=a?"تفعيل":"تعطيل";U.value=`${e} نوع الفاتورة`,A.value=`هل أنت متأكد من ${e} نوع الفاتورة "${t.name}"؟`,B.value=e,w.value={type:t,newStatus:a},b.value=!0},O=async()=>{if(!w.value)return;const{type:t,newStatus:a}=w.value;b.value=!1,await Q(t,a),w.value=null},Q=async(t,a)=>{x.value[t.id]=!0;try{await D.update(t.id,{is_active:a},{showSuccess:!1});const e=u.value.findIndex(W=>W.id===t.id);e!==-1&&(u.value[e].is_active=a);const n=a?"تم تفعيل":"تم تعطيل";N.success(`${n} نوع الفاتورة "${t.name}" بنجاح`)}catch(e){console.error("Error toggling invoice type status:",e),N.error("حدث خطأ أثناء تغيير الحالة")}finally{x.value[t.id]=!1}},j=()=>_({per_page:-1});return Z(j),(t,a)=>(d(),V("div",fe,[a[6]||(a[6]=i("div",{class:"page-header d-flex align-center justify-space-between mb-6"},[i("div",null,[i("h1",{class:"text-h4 font-weight-bold ml-2"},"أنواع الفواتير"),i("p",{class:"text-body-1 text-grey"},"تفعيل وتعطيل أنواع الفواتير المتاحة في النظام")])],-1)),l(q,{class:"mb-6"},{default:s(()=>[i("div",ge,[l(ce,{modelValue:c.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>c.value=e),$(K)],label:"بحث عن نوع...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(E),l(te,{variant:"outlined",density:"comfortable",color:"primary"},{default:s(()=>[l(R,{active:f.value==="grid",icon:"ri-grid-fill",onClick:a[1]||(a[1]=e=>f.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(R,{active:f.value==="list",icon:"ri-list-check",onClick:a[2]||(a[2]=e=>f.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),$(v)&&!p.value.length?(d(),y(pe,{key:0,size:"64",text:"جاري تحميل الأنواع..."})):p.value.length?(d(),V(M,{key:2},[f.value==="grid"?(d(),y(ee,{key:0},{default:s(()=>[(d(!0),V(M,null,le(p.value,e=>(d(),y(se,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[l(q,{class:"type-card h-100","no-padding":""},{actions:s(()=>[l(E),l(G,{modelValue:e.is_active,"onUpdate:modelValue":[n=>e.is_active=n,n=>S(e,n)],"hide-details":"",loading:x.value[e.id],density:"compact"},null,8,["modelValue","onUpdate:modelValue","loading"])]),default:s(()=>[i("div",_e,[l(F,{size:"100",rounded:"lg",class:"elevation-1 bg-white"},{default:s(()=>[l(z,{icon:P(e.type),size:"48",color:k(e.type)},null,8,["icon","color"])]),_:2},1024),l(L,{color:e.is_active?"success":"error",size:"x-small",class:"position-absolute top-2 right-2 font-weight-bold",variant:"flat"},{default:s(()=>[g(r(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),l(oe,null,{default:s(()=>[l(ie,{class:"text-h6 font-weight-bold"},{default:s(()=>[g(r(e.name),1)]),_:2},1024),l(ne,{class:"d-flex align-center mt-1"},{default:s(()=>[l(z,{icon:"ri-information-line",size:"14",class:"me-1"}),g(" "+r(C(e.type)),1)]),_:2},1024)]),_:2},1024),l(re,{class:"pt-0"},{default:s(()=>[i("p",ye,r(I(e.type)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(d(),y(de,{key:1,headers:J,items:p.value,"total-items":p.value.length,loading:$(v),page:h.value,"onUpdate:page":a[3]||(a[3]=e=>h.value=e),"items-per-page":m.value,"onUpdate:itemsPerPage":a[4]||(a[4]=e=>m.value=e),searchable:!1,"can-edit":!1,"can-delete":!1,"can-view":!1,"onUpdate:options":j},{"item.name":s(({item:e})=>[i("div",he,[l(F,{color:"primary-lighten-5",size:"40",class:"me-3 border"},{default:s(()=>[l(z,{icon:P(e.type),color:k(e.type),size:"small"},null,8,["icon","color"])]),_:2},1024),i("div",null,[i("div",xe,r(e.name),1),i("div",be,r(I(e.type)),1)])])]),"item.type":s(({item:e})=>[l(L,{color:k(e.type),size:"small",variant:"tonal"},{default:s(()=>[g(r(C(e.type)),1)]),_:2},1032,["color"])]),"item.is_active":s(({item:e})=>[l(L,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:s(()=>[g(r(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),"extra-actions":s(({item:e})=>[l(G,{modelValue:e.is_active,"onUpdate:modelValue":[n=>e.is_active=n,n=>S(e,n)],"hide-details":"",loading:x.value[e.id],density:"compact"},null,8,["modelValue","onUpdate:modelValue","loading"])]),_:1},8,["items","total-items","loading","page","items-per-page"])),f.value==="grid"?(d(),V("div",we,[i("div",Ve,"عرض "+r(p.value.length)+" من إجمالي "+r(p.value.length)+" نوع",1)])):ae("",!0)],64)):(d(),y(ve,{key:1,icon:"ri-file-list-line",title:"لا توجد أنواع فواتير",message:"لم يتم العثور على أنواع مطابقة"})),l(ue,{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=e=>b.value=e),title:U.value,icon:"ri-question-line","confirm-color":"primary","confirm-text":B.value,onConfirm:O},{default:s(()=>[g(r(A.value),1)]),_:1},8,["modelValue","title","confirm-text"])]))}},je=X(Te,[["__scopeId","data-v-ba76319c"]]);export{je as default};
