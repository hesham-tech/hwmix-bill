import{u as x}from"./useApi-CjhFmPue.js";import{u as T}from"./usePrintExport-DBoRVp2V.js";import{_ as z}from"./AppCard-CXpBKc1t.js";import{_ as k}from"./AppButton-CREzoRf6.js";import{A as D}from"./AppDataTable-CnA5lOqV.js";import{r,J as G,c as I,a as o,b as e,w as a,d as w,o as L,l as _,e as n,f,a1 as p,t as d,a8 as y,B as P,g as U}from"./index-CuR9-sbN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"stock-report-page"},$={class:"mb-6 px-6 pt-6 d-flex align-center justify-space-between"},j={class:"d-flex gap-2"},F={class:"text-h4 font-weight-black text-primary"},J={class:"text-h4 font-weight-black text-success"},M={class:"text-h4 font-weight-black text-warning"},H={class:"text-h4 font-weight-black text-error"},K={class:"px-6 mb-4"},O={class:"px-6 pb-6"},Q={class:"font-weight-black text-body-1 text-success"},X={class:"text-center pa-10"},it={__name:"StockReport",setup(Y){const V=x("/api/products"),C=x("/api/warehouses"),{exportToCSV:q}=T(),m=r(!1),v=r(!1),b=r([]),c=r({warehouse_id:null,stock_status:null}),u=r({total_products:0,total_value:0,low_stock:0,out_of_stock:0}),i=r([]),S=[{title:"متوفر",value:"in_stock"},{title:"مخزون منخفض",value:"low_stock"},{title:"نفذ المخزون",value:"out_of_stock"}],A=[{title:"المنتج",key:"name"},{title:"المخزن",key:"warehouse.name"},{title:"الكمية",key:"stock_quantity",align:"center"},{title:"قيمة المخزون",key:"stock_value",align:"end"}],h=l=>l?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(l):"0.00 ج.م",E=(l,t)=>!l||l===0?"error":l<(t||10)?"warning":"success",B=async()=>{v.value=!0;try{const l=await C.get({per_page:100},{showLoading:!1,showError:!1});b.value=l.data||[]}finally{v.value=!1}},N=()=>{const l=i.value.map(t=>{var s;return{المنتج:t.name,المخزن:((s=t.warehouse)==null?void 0:s.name)||"-",الكمية:t.stock_quantity,القيمة:t.stock_value}});q(l,"تقرير_المخزون.csv",["المنتج","المخزن","الكمية","القيمة"])},g=async()=>{m.value=!0;try{const l=await V.get({...c.value,per_page:100},{showLoading:!1});i.value=(l.data||[]).map(s=>({...s,stock_value:(s.stock_quantity||0)*(s.cost_price||0)}));const t=i.value.reduce((s,R)=>s+R.stock_value,0);u.value={total_products:i.value.length,total_value:t,low_stock:i.value.filter(s=>s.stock_quantity<(s.min_stock_level||10)&&s.stock_quantity>0).length,out_of_stock:i.value.filter(s=>!s.stock_quantity||s.stock_quantity===0).length}}finally{m.value=!1}};return G(()=>{B(),g()}),(l,t)=>(L(),I("div",W,[o("div",$,[t[4]||(t[4]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold"},"تقرير تفصيلي لحالة المخزون"),o("p",{class:"text-body-1 text-grey"},"متابعة الكميات المتوفرة والقيم المالية للمخزون في المستودعات")],-1)),o("div",j,[e(k,{variant:"tonal",color:"success","prepend-icon":"ri-download-line",onClick:N,disabled:!i.value.length},{default:a(()=>t[2]||(t[2]=[_(" تصدير CSV ")])),_:1},8,["disabled"]),e(k,{color:"primary","prepend-icon":"ri-refresh-line",onClick:g},{default:a(()=>t[3]||(t[3]=[_(" تحديث ")])),_:1})])]),e(w,{class:"px-6 mx-0 mb-6",dense:""},{default:a(()=>[e(n,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(f,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1"},{default:a(()=>[e(p,{class:"pa-4 bg-primary-lighten-5"},{default:a(()=>[t[5]||(t[5]=o("div",{class:"text-caption font-weight-bold text-primary mb-1"},"إجمالي المنتجات",-1)),o("div",F,d(u.value.total_products),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(f,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-success"},{default:a(()=>[e(p,{class:"pa-4 bg-success-lighten-5"},{default:a(()=>[t[6]||(t[6]=o("div",{class:"text-caption font-weight-bold text-success mb-1"},"القيمة الإجمالية",-1)),o("div",J,d(h(u.value.total_value)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(f,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-warning"},{default:a(()=>[e(p,{class:"pa-4 bg-warning-lighten-5"},{default:a(()=>[t[7]||(t[7]=o("div",{class:"text-caption font-weight-bold text-warning mb-1"},"مخزون منخفض",-1)),o("div",M,d(u.value.low_stock),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(f,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-error"},{default:a(()=>[e(p,{class:"pa-4 bg-error-lighten-5"},{default:a(()=>[t[8]||(t[8]=o("div",{class:"text-caption font-weight-bold text-error mb-1"},"نفذ المخزون",-1)),o("div",H,d(u.value.out_of_stock),1)]),_:1})]),_:1})]),_:1})]),_:1}),o("div",K,[e(z,{title:"خيارات التصفية",icon:"ri-filter-3-line"},{default:a(()=>[e(w,{dense:""},{default:a(()=>[e(n,{cols:"12",sm:"6",md:"5"},{default:a(()=>[e(y,{modelValue:c.value.warehouse_id,"onUpdate:modelValue":t[0]||(t[0]=s=>c.value.warehouse_id=s),items:b.value,loading:v.value,"item-title":"name","item-value":"id",label:"تصفية حسب المخزن",clearable:"",variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"ri-building-4-line"},null,8,["modelValue","items","loading"])]),_:1}),e(n,{cols:"12",sm:"6",md:"5"},{default:a(()=>[e(y,{modelValue:c.value.stock_status,"onUpdate:modelValue":t[1]||(t[1]=s=>c.value.stock_status=s),items:S,label:"تصفية حسب الحالة",clearable:"",variant:"outlined",density:"compact","hide-details":"","prepend-inner-icon":"ri-list-check-2"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",md:"2",class:"d-flex align-center"},{default:a(()=>[e(k,{color:"secondary",block:"","prepend-icon":"ri-refresh-line",onClick:g,variant:"tonal"},{default:a(()=>t[9]||(t[9]=[_(" عرض ")])),_:1})]),_:1})]),_:1})]),_:1})]),o("div",O,[e(D,{headers:A,items:i.value,loading:m.value,title:"كشف الأصناف التفصيلي",icon:"ri-search-eye-line"},{"item.stock_quantity":a(({item:s})=>[e(P,{color:E(s.stock_quantity,s.min_stock_level),size:"small",variant:"flat",class:"font-weight-black px-3"},{default:a(()=>[_(d(s.stock_quantity||0)+" وحدة ",1)]),_:2},1032,["color"])]),"item.stock_value":a(({item:s})=>[o("div",Q,d(h(s.stock_value)),1)]),"no-data":a(()=>[o("div",X,[e(U,{icon:"ri-inbox-archive-line",size:"64",color:"grey-lighten-2",class:"mb-4"}),t[10]||(t[10]=o("div",{class:"text-h6 text-grey font-weight-medium"},"لا توجد منتجات مطابقة لخيارات البحث",-1))])]),_:1},8,["items","loading"])])]))}};export{it as default};
