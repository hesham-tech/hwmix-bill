import{u as k}from"./useApi-CTBDEoea.js";import{u as L}from"./usePrintExport-BD2QUCTi.js";import{R as $}from"./ReportLayout-D5K90SqV.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{y as V,s as B,o as h,v as w,w as t,b as e,a1 as N,a as o,c as P,E as T,f as v,r as c,K as j,ad as F,m as C,e as _,t as d,u as f,d as E,Q as G,P as S,C as O}from"./index-DPR0tjT6.js";import{A}from"./AppDataTable-CV9gFKLg.js";import{_ as D}from"./AppInput-CYR4AaBJ.js";import{_ as z}from"./AppButton-DiF3_7lr.js";import{f as m}from"./formatters-CKQiR5Fb.js";import"./usePermissions-BOh6stgy.js";const U={class:"chart-wrapper d-flex justify-center"},K={key:1,class:"d-flex align-center justify-center height-300"},M={__name:"StockValuationChart",props:{summary:{type:Object,default:()=>({total_cost_value:0,potential_profit:0})},loading:{type:Boolean,default:!1}},setup(g){const y=g,n=V(()=>[y.summary.total_cost_value||0,y.summary.potential_profit||0]),i=V(()=>({chart:{type:"donut",fontFamily:"Inter, sans-serif"},labels:["إجمالي التكلفة","الربح المتوقع"],colors:["#3b82f6","#10b981"],plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,total:{show:!0,label:"إجمالي القيمة البيعية",formatter:r=>{const s=r.globals.seriesTotals.reduce((u,b)=>u+b,0);return new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s)}}}}}},legend:{position:"bottom",fontFamily:"Inter, sans-serif"},dataLabels:{enabled:!1},tooltip:{y:{formatter:r=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(r)}}}));return(r,s)=>{const u=B("apexchart");return h(),w(v,{variant:"flat",border:"",class:"chart-card rounded-xl overflow-hidden pa-1"},{default:t(()=>[e(N,{class:"pa-4"},{default:t(()=>[s[0]||(s[0]=o("div",{class:"d-flex align-center justify-space-between mb-4"},[o("div",null,[o("div",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1"},"توزيع القيمة"),o("h3",{class:"text-h6 font-weight-black"},"قيمة التكلفة مقابل الربح التقديري")])],-1)),o("div",U,[g.loading?(h(),P("div",K,[e(T,{indeterminate:"",color:"primary"})])):(h(),w(u,{key:0,type:"donut",width:"380",options:i.value,series:n.value},null,8,["options","series"]))])]),_:1})]),_:1})}}},Q=I(M,[["__scopeId","data-v-20711aeb"]]),H={class:"d-flex flex-column gap-4"},J={class:"text-h4 font-weight-black text-primary"},W={class:"text-h4 font-weight-black text-success"},X={class:"text-h4 font-weight-black text-info"},Y={class:"text-grey-darken-2"},Z={class:"font-weight-bold text-success"},ct={__name:"StockReport",setup(g){k("/api/reports/stock");const{exportToCSV:y}=L(),n=c(!1),i=c({stock_status:"",threshold:10}),r=c([]),s=c({total_cost_value:0,total_sale_value:0,potential_profit:0}),u=c(0),b=c(0),R=[{title:"المنتج",key:"product_name"},{title:"الكمية المتوفرة",key:"total_quantity",align:"center"},{title:"قيمة التكلفة",key:"total_cost_value",align:"end"},{title:"القيمة البيعية",key:"total_sale_value",align:"end"}],x=async()=>{n.value=!0;try{const p=await k("/api/reports/stock/valuation").get({},{showLoading:!1});r.value=p.valuation||[],s.value=p.summary||{total_cost_value:0,total_sale_value:0,potential_profit:0};const a=await k("/api/reports/stock/low-stock").get({threshold:i.value.threshold},{showLoading:!1});u.value=a.count||0,b.value=r.value.filter(l=>l.total_quantity<=0).length}finally{n.value=!1}},q=()=>{const p=r.value.map(a=>({المنتج:a.product_name,الكمية:a.total_quantity,"قيمة التكلفة":a.total_cost_value,"القيمة البيعية":a.total_sale_value}));y(p,"تقرير_تقييم_المخزون.csv")};return j(x),(p,a)=>(h(),w($,{title:"تقرير تقييم المخزون",description:"تحليل قيمة البضاعة المتوفرة، هوامش الربح المتوقعة، وتنبيهات النواقص",loading:n.value,onRefresh:x,onExport:q},{filters:t(()=>[o("div",H,[e(F,{modelValue:i.value.stock_status,"onUpdate:modelValue":a[0]||(a[0]=l=>i.value.stock_status=l),label:"حالة المخزون",items:[{title:"الكل",value:""},{title:"متوفر",value:"in_stock"},{title:"منخفض",value:"low_stock"},{title:"نافذ",value:"out_of_stock"}],variant:"outlined",density:"compact"},null,8,["modelValue"]),e(D,{modelValue:i.value.threshold,"onUpdate:modelValue":a[1]||(a[1]=l=>i.value.threshold=l),label:"حد التنبيه (Low Stock)",type:"number"},null,8,["modelValue"]),e(z,{color:"primary",block:"",onClick:x},{default:t(()=>a[2]||(a[2]=[C("تحديث التقرير")])),_:1})])]),summary:t(()=>[e(E,{dense:""},{default:t(()=>[e(_,{cols:"12",sm:"4"},{default:t(()=>[e(v,{border:"",flat:"",class:"rounded-xl pa-4 bg-primary-lighten-5 border-primary"},{default:t(()=>[a[3]||(a[3]=o("div",{class:"text-caption font-weight-bold text-primary"},"إجمالي قيمة التكلفة",-1)),o("div",J,d(f(m)(s.value.total_cost_value)),1)]),_:1})]),_:1}),e(_,{cols:"12",sm:"4"},{default:t(()=>[e(v,{border:"",flat:"",class:"rounded-xl pa-4 bg-success-lighten-5 border-success"},{default:t(()=>[a[4]||(a[4]=o("div",{class:"text-caption font-weight-bold text-success"},"القيمة البيعية المتوقعة",-1)),o("div",W,d(f(m)(s.value.total_sale_value)),1)]),_:1})]),_:1}),e(_,{cols:"12",sm:"4"},{default:t(()=>[e(v,{border:"",flat:"",class:"rounded-xl pa-4 bg-info-lighten-5 border-info"},{default:t(()=>[a[5]||(a[5]=o("div",{class:"text-caption font-weight-bold text-info"},"الربح التقديري المحتمل",-1)),o("div",X,d(f(m)(s.value.potential_profit)),1)]),_:1})]),_:1})]),_:1})]),charts:t(()=>[e(E,null,{default:t(()=>[e(_,{cols:"12",md:"6"},{default:t(()=>[e(Q,{summary:s.value,loading:n.value},null,8,["summary","loading"])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[e(v,{border:"",flat:"",class:"rounded-xl pa-4 fill-height"},{default:t(()=>[a[6]||(a[6]=o("h3",{class:"text-h6 font-weight-black mb-4"},"تنبيهات حالة المخزون",-1)),e(G,{density:"compact"},{default:t(()=>[e(S,{"prepend-icon":"ri-error-warning-line",title:"أصناف قاربت على النفاذ",subtitle:`${u.value} منتج وصل للحد الأدنى`,"base-color":"warning"},null,8,["subtitle"]),e(S,{"prepend-icon":"ri-close-circle-line",title:"أصناف نفذت تماماً",subtitle:`${b.value} منتج بدون رصيد`,"base-color":"error"},null,8,["subtitle"])]),_:1})]),_:1})]),_:1})]),_:1})]),table:t(()=>[e(A,{headers:R,items:r.value,loading:n.value,title:"تقييم المنتجات التفصيلي",icon:"ri-barcode-line"},{"item.total_quantity":t(({item:l})=>[e(O,{color:l.total_quantity<=0?"error":l.total_quantity<=10?"warning":"success",size:"small",variant:"flat",class:"font-weight-bold"},{default:t(()=>[C(d(l.total_quantity),1)]),_:2},1032,["color"])]),"item.total_cost_value":t(({item:l})=>[o("span",Y,d(f(m)(l.total_cost_value)),1)]),"item.total_sale_value":t(({item:l})=>[o("span",Z,d(f(m)(l.total_sale_value)),1)]),_:1},8,["items","loading"])]),_:1},8,["loading"]))}};export{ct as default};
