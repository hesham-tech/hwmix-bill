import{u as G}from"./useApi-C-2zrNsN.js";import{_ as K}from"./AppAutocomplete-UF3wj85B.js";import{r as i,z as w,o as f,x as y,w as t,d as r,Q as S,al as T,am as j,B as R,b as c,v as m,c as z,i as B,n as N,E as k,K as Q,C as O,af as H,f as $,e as J}from"./index-98ieInin.js";import{_ as C}from"./AppInput-CufQk24k.js";import{_ as W}from"./AppButton-Dj4u5ybH.js";const X={class:"text-primary font-weight-bold"},Y={class:"font-weight-bold"},Z={class:"d-flex flex-column gap-1 mt-1"},ee={key:0,class:"text-caption"},ae={key:1,class:"text-caption"},ve={__name:"CustomerSelector",props:{modelValue:{type:Object,default:null}},emits:["update:modelValue"],setup(I,{emit:U}){const E=I,P=U,x=G("/api/users"),V=i([]),g=i(!1),l=i(""),o=w({get:()=>E.modelValue,set:u=>P("update:modelValue",u)});let n;const d=u=>{l.value=u,clearTimeout(n),n=setTimeout(()=>{_(u)},300)},_=async(u="")=>{g.value=!0;try{const h=u?{search:u}:{},b=await x.get(h,{showLoading:!1,showError:!1});V.value=b.data||[]}catch(h){console.error("Error loading users (customers):",h)}finally{g.value=!1}};return _(),(u,h)=>(f(),y(K,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=b=>o.value=b),items:V.value,loading:g.value,search:l.value,"item-title":"name","item-value":"id",label:"اختر العميل *",placeholder:"ابحث بالاسم أو الهاتف...","prepend-inner-icon":"ri-user-search-line",clearable:"","return-object":"","onUpdate:search":d},{item:t(({props:b,item:p})=>[r(S,T(j(b)),{prepend:t(()=>[r(R,{color:"primary-lighten-5",class:"me-3 border",size:"40"},{default:t(()=>[c("span",X,m(p.raw.name.charAt(0).toUpperCase()),1)]),_:2},1024)]),title:t(()=>[c("span",Y,m(p.raw.name),1)]),subtitle:t(()=>[c("div",Z,[p.raw.phone?(f(),z("span",ee,[r(B,{icon:"ri-phone-line",size:"14",class:"me-1"}),N(" "+m(p.raw.phone),1)])):k("",!0),p.raw.email?(f(),z("span",ae,[r(B,{icon:"ri-mail-line",size:"14",class:"me-1"}),N(" "+m(p.raw.email),1)])):k("",!0)])]),_:2},1040)]),_:1},8,["modelValue","items","loading","search"]))}},le={class:"font-weight-bold"},te={class:"d-flex justify-space-between mt-1"},se={class:"text-caption"},oe={class:"text-success font-weight-bold"},re={class:"font-weight-medium"},ne={class:"d-flex justify-space-between mt-1"},ue={class:"text-success font-weight-bold"},fe={__name:"ProductSelector",emits:["add"],setup(I,{emit:U}){const E=U,P=G("/api/products"),x=i([]),V=i(!1),g=i(""),l=i(null),o=i(null),n=i(1),d=i(0),_=i(0),u=w(()=>{var e;return((e=l.value)==null?void 0:e.variants)&&l.value.variants.length>0}),h=w(()=>{var e;return o.value?o.value.price:((e=l.value)==null?void 0:e.sell_price)||0}),b=w(()=>{const e=n.value*d.value,a=e*(_.value/100);return(e-a).toFixed(2)}),p=w(()=>n.value<1?"الكمية يجب أن تكون 1 على الأقل":o.value&&n.value>o.value.stock?`المخزون المتاح: ${o.value.stock}`:l.value&&!u.value&&n.value>l.value.stock?`المخزون المتاح: ${l.value.stock}`:null),F=w(()=>l.value&&n.value>=1&&d.value>0&&!p.value&&(!u.value||o.value));let L;const q=e=>{g.value=e,clearTimeout(L),L=setTimeout(()=>{M(e)},300)},M=async(e="")=>{V.value=!0;try{const a=e?{search:e}:{},s=await P.get(a,{showLoading:!1,showError:!1});x.value=s.data||[]}catch(a){console.error("Error loading products:",a)}finally{V.value=!1}},D=()=>{var a,s;if(!F.value)return;const e={product_id:l.value.id,product_name:l.value.name,variant_id:((a=o.value)==null?void 0:a.id)||null,variant_name:((s=o.value)==null?void 0:s.name)||null,quantity:n.value,unit_price:d.value,discount_percentage:_.value,total:parseFloat(b.value)};E("add",e),l.value=null,o.value=null,n.value=1,d.value=0,_.value=0},A=e=>e?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(e):"0.00 ج.م";return Q(l,e=>{e&&(d.value=e.sell_price,o.value=null)}),Q(o,e=>{e&&(d.value=e.price)}),M(),(e,a)=>(f(),z("div",null,[r(K,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),items:x.value,loading:V.value,search:g.value,"item-title":"name","item-value":"id",label:"اختر المنتج *",placeholder:"ابحث عن المنتج...","prepend-inner-icon":"ri-search-line",clearable:"","return-object":"","onUpdate:search":q},{item:t(({props:s,item:v})=>[r(S,T(j(s)),{prepend:t(()=>[r(R,{rounded:"lg",color:"primary-lighten-5",class:"border"},{default:t(()=>[v.raw.image?(f(),y(O,{key:0,src:v.raw.image,cover:""},null,8,["src"])):(f(),y(B,{key:1,icon:"ri-product-hunt-line",color:"primary"}))]),_:2},1024)]),title:t(()=>[c("span",le,m(v.raw.name),1)]),subtitle:t(()=>[c("div",te,[c("span",se,"SKU: "+m(v.raw.sku),1),c("span",oe,m(A(v.raw.sell_price)),1)])]),_:2},1040)]),_:1},8,["modelValue","items","loading","search"]),l.value&&u.value?(f(),y(H,{key:0,modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=s=>o.value=s),items:l.value.variants||[],"item-title":"name","item-value":"id",label:"اختر الشكل",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-stack-line","return-object":"",class:"mt-4"},{item:t(({props:s,item:v})=>[r(S,T(j(s)),{title:t(()=>[c("span",re,m(v.raw.name),1)]),subtitle:t(()=>[c("div",ne,[c("span",null,"المخزون: "+m(v.raw.stock),1),c("span",ue,m(A(v.raw.price)),1)])]),_:2},1040)]),_:1},8,["modelValue","items"])):k("",!0),l.value?(f(),y(J,{key:1,class:"mt-2"},{default:t(()=>[r($,{cols:"12",md:"3"},{default:t(()=>[r(C,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value=s),modelModifiers:{number:!0},label:"الكمية *",type:"number",min:"1","prepend-inner-icon":"ri-add-box-line","error-messages":p.value},null,8,["modelValue","error-messages"])]),_:1}),r($,{cols:"12",md:"3"},{default:t(()=>[r(C,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=s=>d.value=s),modelModifiers:{number:!0},label:"سعر الوحدة",type:"number","prepend-inner-icon":"ri-money-dollar-circle-line",hint:`السعر الأصلي: ${A(h.value)}`,"persistent-hint":""},null,8,["modelValue","hint"])]),_:1}),r($,{cols:"12",md:"3"},{default:t(()=>[r(C,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=s=>_.value=s),modelModifiers:{number:!0},label:"الخصم %",type:"number",min:"0",max:"100","prepend-inner-icon":"ri-percent-line"},null,8,["modelValue"])]),_:1}),r($,{cols:"12",md:"3"},{default:t(()=>[r(C,{"model-value":b.value,label:"المجموع",readonly:"","prepend-inner-icon":"ri-calculator-line",class:"font-weight-bold"},null,8,["model-value"])]),_:1})]),_:1})):k("",!0),l.value?(f(),y(W,{key:2,block:"","prepend-icon":"ri-add-line",disabled:!F.value,onClick:D,class:"mt-4"},{default:t(()=>a[5]||(a[5]=[N(" إضافة المنتج للفاتورة ")])),_:1},8,["disabled"])):k("",!0)]))}};export{ve as _,fe as a};
