import{v as A,r as p,ag as D,J as N,c as R,a as o,b as e,w as t,d as U,p as E,o as y,e as d,a1 as F,z as G,s as z,A as L,g as M,E as P,j as S,t as v,u as m,B as T,l as B,M as C,i as J,Q as O,O as $}from"./index-CuR9-sbN.js";import{u as Q}from"./useApi-CjhFmPue.js";import{_ as h}from"./AppCard-CXpBKc1t.js";import{_}from"./AppInput-06Y7zOXl.js";import{_ as H}from"./AppButton-CREzoRf6.js";import{M as K}from"./MediaGallery-DgiLIKzw.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"profile-page"},Y={class:"change-overlay d-flex flex-column align-center justify-center"},Z={class:"text-h6 font-weight-bold mb-1"},ee={class:"d-flex justify-space-around"},le={class:"text-center"},se={class:"text-body-1 font-weight-bold"},ae={class:"text-center"},te={class:"text-body-1 font-weight-bold text-success"},re={class:"d-flex justify-end gap-3 mt-6"},oe={__name:"Profile",setup(ie){const i=A(),I=Q("/api/users"),V=p(null),g=p(!1),c=p(!1),u=p({}),s=D({id:null,full_name:"",nickname:"",email:"",phone:"",avatar_url:"",images_ids:[]}),b={required:r=>!!r||"هذا الحقل مطلوب",email:r=>/.+@.+\..+/.test(r)||"يرجى إدخال بريد إلكتروني صحيح"},j=r=>{s.avatar_url=r.url,s.images_ids=[r.id],E.success("تم اختيار الصورة بنجاح")},x=()=>{const r=i.currentUser;r&&(s.id=r.id,s.full_name=r.full_name||"",s.nickname=r.nickname||"",s.email=r.email||"",s.phone=r.phone||"",s.avatar_url=r.avatar_url||"",s.images_ids=[])},q=async()=>{var l,a;const{valid:r}=await V.value.validate();if(r){g.value=!0,u.value={};try{const n={...s};n.images_ids.length===0&&delete n.images_ids,await I.update(s.id,n,{successMessage:"تم تحديث بيانات ملفك الشخصي بنجاح"}),await i.fetchUser()}catch(n){(a=(l=n.response)==null?void 0:l.data)!=null&&a.errors&&(u.value=n.response.data.errors)}finally{g.value=!1}}};return N(()=>{i.currentUser?x():i.fetchUser().then(x)}),(r,l)=>(y(),R("div",X,[l[11]||(l[11]=o("div",{class:"page-header mb-8"},[o("h1",{class:"text-h3 font-weight-bold primary--text mb-2"},"الملف الشخصي"),o("p",{class:"text-subtitle-1 text-grey-darken-1"},"إدارة بياناتك الشخصية وإعدادات الحساب")],-1)),e(U,{class:"pb-16 mb-16"},{default:t(()=>[e(d,{cols:"12",lg:"4"},{default:t(()=>[e(h,{title:"الصورة الشخصية",icon:"ri-user-smile-line",class:"mb-6","no-padding":""},{default:t(()=>[e(F,{class:"pa-8 text-center bg-grey-lighten-5"},{default:t(()=>{var a,n,w,k;return[o("div",{class:"avatar-preview-zone mx-auto mb-6 cursor-pointer",onClick:l[1]||(l[1]=f=>c.value=!0)},[e(G,{size:"180",rounded:"circle",color:"white",class:"border-2 border-dashed elevation-3 hover-scale overflow-hidden"},{default:t(()=>[s.avatar_url?(y(),z(L,{key:0,src:s.avatar_url,cover:""},null,8,["src"])):(y(),z(M,{key:1,icon:"ri-user-line",size:"64",color:"grey-lighten-2"})),o("div",Y,[e(M,{icon:"ri-camera-switch-line",color:"white",size:"32"}),l[7]||(l[7]=o("span",{class:"text-white text-subtitle-2 mt-2 font-weight-bold"},"تغيير الصورة",-1))])]),_:1}),e(P,{icon:"ri-gallery-upload-line",size:"small",color:"primary",class:"position-absolute bottom-0 right-0 elevation-6",onClick:l[0]||(l[0]=S(f=>c.value=!0,["stop"]))})]),o("h3",Z,v(((a=m(i).currentUser)==null?void 0:a.nickname)||((n=m(i).currentUser)==null?void 0:n.full_name)),1),e(T,{color:"primary",variant:"tonal",size:"small",class:"mb-4"},{default:t(()=>{var f;return[B(v(((f=m(i).currentUser)==null?void 0:f.role)||"مستخدم"),1)]}),_:1}),e(C,{class:"mb-4"}),o("div",ee,[o("div",le,[l[8]||(l[8]=o("div",{class:"text-caption text-grey"},"كود المستخدم",-1)),o("div",se,"#"+v((w=m(i).currentUser)==null?void 0:w.id),1)]),e(C,{vertical:"",inset:""}),o("div",ae,[l[9]||(l[9]=o("div",{class:"text-caption text-grey"},"الرصيد الحالي",-1)),o("div",te,v(((k=m(i).currentUser)==null?void 0:k.balance)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(d,{cols:"12",lg:"8"},{default:t(()=>[e(J,{ref_key:"formRef",ref:V,onSubmit:S(q,["prevent"])},{default:t(()=>[e(h,{title:"البيانات الشخصية",icon:"ri-profile-line",class:"mb-6"},{default:t(()=>[e(U,null,{default:t(()=>[e(d,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:s.full_name,"onUpdate:modelValue":l[2]||(l[2]=a=>s.full_name=a),label:"الاسم الكامل *","prepend-inner-icon":"ri-user-line",rules:[b.required],"error-messages":u.value.full_name},null,8,["modelValue","rules","error-messages"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:s.nickname,"onUpdate:modelValue":l[3]||(l[3]=a=>s.nickname=a),label:"الاسم المستعار / اللقب","prepend-inner-icon":"ri-user-heart-line","error-messages":u.value.nickname},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:s.email,"onUpdate:modelValue":l[4]||(l[4]=a=>s.email=a),label:"البريد الإلكتروني *","prepend-inner-icon":"ri-mail-line",type:"email",dir:"ltr",rules:[b.required,b.email],"error-messages":u.value.email},null,8,["modelValue","rules","error-messages"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:s.phone,"onUpdate:modelValue":l[5]||(l[5]=a=>s.phone=a),label:"رقم الهاتف","prepend-inner-icon":"ri-phone-line",dir:"ltr","error-messages":u.value.phone},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),o("div",re,[e(H,{size:"large","prepend-icon":"ri-save-fill",loading:g.value,class:"px-8 font-weight-bold",type:"submit"},{default:t(()=>l[10]||(l[10]=[B(" حفظ التغييرات ")])),_:1},8,["loading"])])]),_:1},512)]),_:1}),e(d,{cols:"12",lg:"4"},{default:t(()=>[e(h,{title:"إجراءات سريعة",icon:"ri-flashlight-line"},{default:t(()=>[e(O,{density:"compact",nav:""},{default:t(()=>{var a;return[e($,{"prepend-icon":"ri-lock-password-line",title:"تغيير كلمة المرور",to:"/forgot-password"}),e($,{"prepend-icon":"ri-history-line",title:"سجل نشاطاتي",to:`/activity-logs?user_id=${(a=m(i).currentUser)==null?void 0:a.id}`},null,8,["to"])]}),_:1})]),_:1})]),_:1})]),_:1}),e(K,{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=a=>c.value=a),type:"avatar",onSelect:j},null,8,["modelValue"])]))}},ve=W(oe,[["__scopeId","data-v-f02a5005"]]);export{ve as default};
