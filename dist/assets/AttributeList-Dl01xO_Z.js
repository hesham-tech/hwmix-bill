import{r as c,a as pe,z as me,L as ge,K as R,c as y,b as r,u as o,x as u,w as s,E as k,d as a,F as I,o as i,n as _,P as q,ay as _e,j as P,e as G,i as J,B as ae,v as h,A as ye,D as L,k as he,l as be,f as $,O as xe,az as ke,a6 as Ve}from"./index-Flp88uEA.js";import{u as ie}from"./useApi-Dl4iYKvS.js";import{u as we}from"./usePermissions-BSwY7w5L.js";import{A as Ae}from"./AppDataTable-anW7O1Lb.js";import{A as te}from"./AppDialog-D7GtG_Rp.js";import{_ as V}from"./AppButton-DMkx3xLA.js";import{_ as K}from"./AppInput-CHj3RTxZ.js";import{A as H}from"./AppSwitch-Dd82MwLv.js";import{_ as se}from"./AppCard-D6xOpfLS.js";import{_ as Ce}from"./LoadingSpinner-CLb8EfiO.js";import{_ as ze}from"./EmptyState-CJo31Aib.js";import{A as Ue}from"./AppInfiniteScroll-Cr88ibrJ.js";function $e(){const N=ie("/api/attributes"),A=c([]),p=c(!1),w=c(0);return{attributes:A,loading:p,total:w,fetchAttributes:async(D={},m={})=>{var g;const{append:S=!1}=m;p.value=!0;try{const d=await N.get(D,{showLoading:!1});let b=[],f=0;return d.data&&Array.isArray(d.data.data)?(b=d.data.data,f=((g=d.data.meta)==null?void 0:g.total)||d.data.data.length):(b=d.data||[],f=d.total||b.length),S?A.value=[...A.value,...b]:A.value=b,w.value=f,d}catch(d){throw A.value=[],w.value=0,d}finally{p.value=!1}},deleteAttribute:async D=>await N.remove(D,{successMessage:"تم حذف الخاصية بنجاح"})}}const De={class:"attributes-page"},Se={class:"page-header d-flex align-center justify-space-between mb-6"},Te={class:"d-flex align-center flex-wrap gap-4"},Ie={class:"attribute-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Le={class:"d-flex align-center justify-center mb-3"},Me={class:"d-flex flex-wrap gap-1 justify-center min-height-40 overflow-hidden"},je={class:"d-flex align-center py-2"},Be={class:"d-flex flex-column"},Pe={class:"font-weight-bold text-subtitle-1"},Ne={class:"text-caption text-grey"},Ee={class:"d-flex flex-wrap gap-1 py-1 max-width-300"},Fe={key:0,class:"text-grey text-caption"},Oe={class:"d-flex align-center justify-center"},Re={class:"d-flex align-center mb-2"},qe={key:0,class:"values-list pa-1"},Ge={key:1,class:"text-center pa-4 text-grey bg-grey-lighten-4 rounded-lg"},Je={__name:"AttributeList",setup(N){const A=(t,l)=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>t(...n),l)}},{attributes:p,loading:w,total:M,fetchAttributes:Q,deleteAttribute:D}=$e(),{can:m}=we(),S=ie("/api/attributes"),g=c(1),d=c(12),b=c(""),f=c("list"),T=c(!1),j=c(!1),C=c(null),E=c(!1),F=c(!1),W=c(null),B=c(null),v=c({name:"",values:[],is_active:1}),O=me(()=>{var t;return!!((t=C.value)!=null&&t.id)}),oe=[{title:"الخاصية",key:"name",sortable:!0},{title:"القيم",key:"values",sortable:!1},{title:"الحالة",key:"is_active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],ne={required:t=>!!t||"مطلوب"},z=t=>{if(!t.values)return[];if(Array.isArray(t.values))return t.values;try{return JSON.parse(t.values)}catch{return[]}},re=()=>{v.value.values.push("")},ue=t=>{v.value.values.splice(t,1)},X=()=>{C.value=null,v.value={name:"",values:[""],is_active:1},T.value=!0},Y=t=>{C.value=t;const l=z(t);v.value={name:t.name,values:l.map(e=>typeof e=="string"?e:e.name),is_active:t.is_active??1},T.value=!0},Z=async t=>{B.value=t.id;try{await S.update(t.id,{is_active:t.is_active?0:1}),t.is_active=t.is_active?0:1}finally{B.value=null}},de=A(()=>{g.value=1,x()},500),ce=()=>{w.value||p.value.length>=M.value||(g.value++,x(!0))},ve=t=>{f.value==="list"&&x()},ee=t=>{C.value=t,j.value=!0},le=async()=>{const{valid:t}=await W.value.validate();if(!t)return;const l=v.value.values.filter(e=>e.trim()!=="");if(l.length===0){alert("يجب إضافة قيمة واحدة على الأقل");return}E.value=!0;try{const e={...v.value,values:l};O.value?await S.update(C.value.id,e,{successMessage:"تم التحديث بنجاح"}):await S.create(e,{successMessage:"تم الإضافة بنجاح"}),T.value=!1,x()}finally{E.value=!1}},fe=async()=>{F.value=!0;try{await D(C.value.id),j.value=!1,x()}finally{F.value=!1}},x=(t={})=>{const l=t===!0;Q({page:g.value,per_page:d.value,search:b.value},{append:l})};return ge(x),R(g,()=>{f.value==="list"&&x()}),R(d,()=>{f.value==="list"&&(g.value=1,x())}),R(f,()=>{g.value=1,x()}),(t,l)=>(i(),y("div",De,[r("div",Se,[l[10]||(l[10]=r("div",null,[r("h1",{class:"text-h4 font-weight-bold ml-2"},"خصائص المنتجات"),r("p",{class:"text-body-1 text-grey"},"إدارة وتحليل خصائص ومواصفات المنتجات")],-1)),o(m)("attributes.create")?(i(),u(V,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:X},{default:s(()=>l[9]||(l[9]=[_(" خاصية جديدة ")])),_:1})):k("",!0)]),a(se,{class:"mb-6"},{default:s(()=>[r("div",Te,[a(K,{modelValue:b.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>b.value=e),o(de)],label:"بحث عن خاصية...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),a(q),a(_e,{variant:"outlined",density:"comfortable",color:"primary"},{default:s(()=>[a(V,{active:f.value==="grid",icon:"ri-grid-fill",onClick:l[1]||(l[1]=e=>f.value="grid"),title:"عرض شبكي"},null,8,["active"]),a(V,{active:f.value==="list",icon:"ri-list-check",onClick:l[2]||(l[2]=e=>f.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),o(w)&&!o(p).length?(i(),u(Ce,{key:0,size:"64",text:"جاري تحميل الخصائص..."})):o(p).length?(i(),y(I,{key:2},[f.value==="grid"?(i(),u(Ue,{key:0,loading:o(w)&&o(p).length>0,"has-more":o(p).length<o(M),"no-more-text":"لا يوجد المزيد من الخصائص",onLoad:ce},{default:s(()=>[a(G,null,{default:s(()=>[(i(!0),y(I,null,P(o(p),e=>(i(),u($,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[a(se,{class:"attribute-card h-100","no-padding":""},{actions:s(()=>[a(q),o(m)("attributes.update_all",{resource:e})?(i(),u(V,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",onClick:n=>Y(e)},null,8,["onClick"])):k("",!0),o(m)("attributes.delete_all",{resource:e})?(i(),u(V,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:n=>ee(e)},null,8,["onClick"])):k("",!0)]),default:s(()=>[r("div",Ie,[a(ae,{size:"100",rounded:"circle",color:e.is_active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white"},{default:s(()=>[a(J,{icon:"ri-list-settings-line",size:"60",color:e.is_active?"primary":"grey"},null,8,["color"])]),_:2},1032,["color"])]),a(ke,{class:"position-relative pt-4 text-center"},{default:s(()=>[a(Ve,{class:"text-h6 font-weight-bold pa-0 mb-2"},{default:s(()=>[_(h(e.name),1)]),_:2},1024),r("div",Le,[a(L,{color:e.is_active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:s(()=>[_(h(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"]),o(m)("attributes.update_all",{resource:e})?(i(),u(H,{key:0,"model-value":!!e.is_active,loading:B.value===e.id,class:"ms-3","onUpdate:modelValue":n=>Z(e)},null,8,["model-value","loading","onUpdate:modelValue"])):k("",!0)]),r("div",Me,[(i(!0),y(I,null,P(z(e).slice(0,5),(n,U)=>(i(),u(L,{key:U,size:"x-small",variant:"tonal",color:"info"},{default:s(()=>[_(h(n.name||n),1)]),_:2},1024))),128)),z(e).length>5?(i(),u(L,{key:0,size:"x-small",variant:"tonal"},{default:s(()=>[_(" +"+h(z(e).length-5),1)]),_:2},1024)):k("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(i(),u(Ae,{key:1,headers:oe,items:o(p),"total-items":o(M),loading:o(w),page:g.value,"onUpdate:page":l[3]||(l[3]=e=>g.value=e),"items-per-page":d.value,"onUpdate:itemsPerPage":l[4]||(l[4]=e=>d.value=e),searchable:!1,"can-view":!1,"can-edit":!1,"can-delete":!1,"permission-module":"attributes","onUpdate:options":ve},{"item.name":s(({item:e})=>[r("div",je,[a(ae,{size:"48",rounded:"circle",color:e.is_active?"bg-white":"grey-lighten-4",class:"me-3 border"},{default:s(()=>[a(J,{icon:"ri-list-settings-line",size:"24",color:e.is_active?"primary":"grey"},null,8,["color"])]),_:2},1032,["color"]),r("div",Be,[r("span",Pe,h(e.name),1),r("span",Ne,"كود: "+h(e.id),1)])])]),"item.values":s(({item:e})=>[r("div",Ee,[(i(!0),y(I,null,P(z(e),(n,U)=>(i(),u(L,{key:U,size:"x-small",variant:"tonal",color:"info"},{default:s(()=>[_(h(n.name||n),1)]),_:2},1024))),128)),z(e).length?k("",!0):(i(),y("span",Fe,"-"))])]),"item.is_active":s(({item:e})=>[r("div",Oe,[o(m)("attributes.update_all",{resource:e})?(i(),y("span",{key:0,class:ye(["text-caption me-2 font-weight-bold",e.is_active?"text-success":"text-error"])},h(e.is_active?"نشط":"معطل"),3)):k("",!0),o(m)("attributes.update_all",{resource:e})?(i(),u(H,{key:1,"model-value":!!e.is_active,loading:B.value===e.id,"onUpdate:modelValue":n=>Z(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(i(),u(L,{key:2,color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:s(()=>[_(h(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":s(({item:e})=>[o(m)("attributes.update_all",{resource:e})?(i(),u(V,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:n=>Y(e)},null,8,["onClick"])):k("",!0),o(m)("attributes.delete_all",{resource:e})?(i(),u(V,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:n=>ee(e)},null,8,["onClick"])):k("",!0)]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(i(),u(ze,{key:1,icon:"ri-paint-brush-line",title:"لا توجد خصائص حالياً",message:"ابدأ بإضافة أول خاصية لنظامك (مثل: اللون، المقاس)","show-action":o(m)("attributes.create"),"action-text":"إضافة خاصية",onAction:X},null,8,["show-action"])),a(te,{modelValue:T.value,"onUpdate:modelValue":l[7]||(l[7]=e=>T.value=e),title:O.value?"تعديل الخاصية":"خاصية جديدة",icon:O.value?"ri-edit-line":"ri-add-line",loading:E.value,"max-width":"700",onConfirm:le},{default:s(()=>[a(he,{ref_key:"formRef",ref:W,onSubmit:be(le,["prevent"])},{default:s(()=>[a(G,null,{default:s(()=>[a($,{cols:"12"},{default:s(()=>[a(K,{modelValue:v.value.name,"onUpdate:modelValue":l[5]||(l[5]=e=>v.value.name=e),label:"اسم الخاصية *",placeholder:"مثال: اللون، المقاس",rules:[ne.required]},null,8,["modelValue","rules"])]),_:1}),a($,{cols:"12"},{default:s(()=>[a(xe,{class:"mb-2"}),r("div",Re,[l[12]||(l[12]=r("span",{class:"text-subtitle-2"},"القيم المتاحة",-1)),a(q),a(V,{size:"small",color:"primary",variant:"tonal","prepend-icon":"ri-add-line",onClick:re},{default:s(()=>l[11]||(l[11]=[_(" إضافة قيمة ")])),_:1})]),v.value.values.length?(i(),y("div",qe,[(i(!0),y(I,null,P(v.value.values,(e,n)=>(i(),u(G,{key:n,dense:""},{default:s(()=>[a($,{cols:"10"},{default:s(()=>[a(K,{modelValue:v.value.values[n],"onUpdate:modelValue":U=>v.value.values[n]=U,label:`القيمة ${n+1}`,placeholder:"مثال: أحمر، أزرق","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),a($,{cols:"2",class:"d-flex align-center mt-2"},{default:s(()=>[a(V,{icon:"ri-delete-bin-line",size:"small",variant:"text",color:"error",onClick:U=>ue(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))])):(i(),y("div",Ge,[a(J,{icon:"ri-information-line",class:"me-1"}),l[13]||(l[13]=_(" لم يتم إضافة قيم بعد "))]))]),_:1}),a($,{cols:"12"},{default:s(()=>[a(H,{modelValue:v.value.is_active,"onUpdate:modelValue":l[6]||(l[6]=e=>v.value.is_active=e),label:"نشط","true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),a(te,{modelValue:j.value,"onUpdate:modelValue":l[8]||(l[8]=e=>j.value=e),title:"تأكيد الحذف",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف",loading:F.value,onConfirm:fe},{default:s(()=>{var e;return[l[14]||(l[14]=_(' هل أنت متأكد من حذف الخاصية "')),r("strong",null,h((e=C.value)==null?void 0:e.name),1),l[15]||(l[15]=_('"؟ '))]}),_:1},8,["modelValue","loading"])]))}},il=pe(Je,[["__scopeId","data-v-004d4f16"]]);export{il as default};
