import{u as T}from"./useApi-CjhFmPue.js";import{u as E}from"./usePrintExport-DBoRVp2V.js";import{_ as I}from"./AppCard-CXpBKc1t.js";import{_}from"./AppButton-CREzoRf6.js";import{_ as h}from"./AppInput-06Y7zOXl.js";import{A as N}from"./AppDataTable-CnA5lOqV.js";import{r as u,J as R,c as A,a as o,b as t,w as a,d as y,o as B,l as x,e as n,f as v,a1 as b,t as i,y as V,g as F}from"./index-CuR9-sbN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"cash-flow-report-page"},$={class:"mb-6 px-6 pt-6 d-flex align-center justify-space-between"},z={class:"d-flex gap-2"},G={class:"text-h4 font-weight-black text-success"},O={class:"text-h4 font-weight-black text-error"},P={class:"px-6 mb-4"},U={class:"px-6 pb-6"},j={class:"font-weight-medium"},J={class:"text-center pa-10"},ee={__name:"CashFlowReport",setup(L){const k=T("/api/transactions"),{exportToCSV:C}=E(),p=u(!1),r=u({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),d=u({total_inflow:0,total_outflow:0,net_flow:0}),c=u([]),S=[{title:"التاريخ",key:"transaction_date"},{title:"الخزينة",key:"cash_box.name"},{title:"المبلغ",key:"amount",align:"end"},{title:"البيان",key:"description"}],f=s=>s==null?"0.00 ج.م":new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s),D=()=>{const s=c.value.map(e=>{var l;return{التاريخ:e.transaction_date,الخزينة:((l=e.cash_box)==null?void 0:l.name)||"-",المقدار:e.amount,البيان:e.description}});C(s,"تقرير_التدفق_النقدي.csv",["التاريخ","الخزينة","المقدار","البيان"])},m=async()=>{p.value=!0;try{const s=await k.get({...r.value,per_page:100},{showLoading:!1});c.value=s.data||[];let e=0,l=0;c.value.forEach(w=>{const g=parseFloat(w.amount||0);w.type==="income"?e+=g:l+=Math.abs(g)}),d.value={total_inflow:e,total_outflow:l,net_flow:e-l}}finally{p.value=!1}};return R(m),(s,e)=>(B(),A("div",M,[o("div",$,[e[4]||(e[4]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold"},"تحليل التدفقات النقدية"),o("p",{class:"text-body-1 text-grey"},"عرض تفصيلي للسيولة الداخلة والخارجة وحركات الصناديق")],-1)),o("div",z,[t(_,{variant:"tonal",color:"success","prepend-icon":"ri-download-line",onClick:D,disabled:!c.value.length},{default:a(()=>e[2]||(e[2]=[x(" تصدير CSV ")])),_:1},8,["disabled"]),t(_,{color:"primary","prepend-icon":"ri-refresh-line",onClick:m},{default:a(()=>e[3]||(e[3]=[x(" تحديث البيانات ")])),_:1})])]),t(y,{class:"px-6 mx-0 mb-6",dense:""},{default:a(()=>[t(n,{cols:"12",md:"4"},{default:a(()=>[t(v,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-success"},{default:a(()=>[t(b,{class:"pa-4 bg-success-lighten-5"},{default:a(()=>[e[5]||(e[5]=o("div",{class:"text-caption font-weight-bold text-success mb-1"},"إجمالي المقبوضات (+)",-1)),o("div",G,i(f(d.value.total_inflow)),1)]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"4"},{default:a(()=>[t(v,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-error"},{default:a(()=>[t(b,{class:"pa-4 bg-error-lighten-5"},{default:a(()=>[e[6]||(e[6]=o("div",{class:"text-caption font-weight-bold text-error mb-1"},"إجمالي المدفوعات (-)",-1)),o("div",O,i(f(d.value.total_outflow)),1)]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"4"},{default:a(()=>[t(v,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-info"},{default:a(()=>[t(b,{class:"pa-4 bg-info-lighten-5"},{default:a(()=>[e[7]||(e[7]=o("div",{class:"text-caption font-weight-bold text-info mb-1"},"صافي التدفق النقدي",-1)),o("div",{class:V(["text-h4 font-weight-black",d.value.net_flow>=0?"text-info":"text-error"])},i(f(d.value.net_flow)),3)]),_:1})]),_:1})]),_:1})]),_:1}),o("div",P,[t(I,{title:"فترة التقرير",icon:"ri-calendar-event-line"},{default:a(()=>[t(y,{dense:""},{default:a(()=>[t(n,{cols:"12",sm:"4"},{default:a(()=>[t(h,{modelValue:r.value.date_from,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.date_from=l),label:"من تاريخ",type:"date","prepend-inner-icon":"ri-calendar-line"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",sm:"4"},{default:a(()=>[t(h,{modelValue:r.value.date_to,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.date_to=l),label:"إلى تاريخ",type:"date","prepend-inner-icon":"ri-calendar-check-line"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",sm:"4",class:"d-flex align-center pt-2"},{default:a(()=>[t(_,{color:"secondary",block:"","prepend-icon":"ri-search-eye-line",onClick:m,variant:"tonal"},{default:a(()=>e[8]||(e[8]=[x(" عرض حركات الصناديق ")])),_:1})]),_:1})]),_:1})]),_:1})]),o("div",U,[t(N,{headers:S,items:c.value,loading:p.value,title:"سجل حركات الخزينة",icon:"ri-history-line"},{"item.amount":a(({item:l})=>[o("div",{class:V([l.type==="income"?"text-success":"text-error","font-weight-black text-body-1"])},i(l.type==="income"?"+":"-")+" "+i(f(Math.abs(l.amount))),3)]),"item.transaction_date":a(({item:l})=>[o("div",j,i(l.transaction_date),1)]),"no-data":a(()=>[o("div",J,[t(F,{icon:"ri-hand-coin-line",size:"64",color:"grey-lighten-2",class:"mb-4"}),e[9]||(e[9]=o("div",{class:"text-h6 text-grey font-weight-medium"},"لا توجد حركات مالية مسجلة في هذه الفترة",-1))])]),_:1},8,["items","loading"])])]))}};export{ee as default};
