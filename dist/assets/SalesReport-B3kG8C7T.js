import{u as g}from"./useApi-CTBDEoea.js";import{u as V}from"./usePrintExport-BD2QUCTi.js";import{R as S}from"./ReportLayout-D5K90SqV.js";import{S as D}from"./SalesTrendChart-C6inuDNQ.js";import{A as C}from"./AppDataTable-CV9gFKLg.js";import{_ as y}from"./AppInput-CYR4AaBJ.js";import{_ as R}from"./AppButton-DiF3_7lr.js";import{f as b}from"./formatters-CKQiR5Fb.js";import{r as i,K as T,v as A,w as a,o as B,a as s,b as o,ad as E,m as L,e as _,f,t as d,u as x,d as N}from"./index-DPR0tjT6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./usePermissions-BOh6stgy.js";const U={class:"d-flex flex-column gap-4"},$={class:"text-h4 font-weight-black text-success"},I={class:"text-h4 font-weight-black text-primary"},O={class:"text-h4 font-weight-black text-info"},q={class:"font-weight-bold text-success"},K={class:"text-primary font-weight-bold"},Z={__name:"SalesReport",setup(M){const k=g("/api/reports/sales"),{exportToCSV:h}=V(),n=i(!1),l=i({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0],group_by:""}),p=i([]),v=i([]),u=i({total_sales:0,total_invoices:0,total_items_sold:0}),m=i([{title:"التاريخ",key:"invoice_date"},{title:"العميل",key:"user.name"},{title:"رقم الفاتورة",key:"invoice_number"},{title:"الإجمالي",key:"total",align:"end"}]),c=async()=>{var r;n.value=!0;try{const e=await k.get(l.value,{showLoading:!1});p.value=((r=e.report)==null?void 0:r.data)||e.report||[],u.value=e.summary||{total_sales:0,total_invoices:0},l.value.group_by==="product"?m.value=[{title:"المنتج",key:"name"},{title:"الكمية",key:"total_qty",align:"center"},{title:"إجمالي المبيعات",key:"total",align:"end"}]:l.value.group_by==="customer"?m.value=[{title:"العميل",key:"name"},{title:"عدد الفواتير",key:"invoice_count",align:"center"},{title:"إجمالي المشتريات",key:"total",align:"end"}]:m.value=[{title:"رقم الفاتورة",key:"invoice_number"},{title:"العميل",key:"user.name"},{title:"التاريخ",key:"invoice_date"},{title:"الإجمالي",key:"total",align:"end"}];const t=await g("/api/reports/sales/trend").get({period:"day",date_from:l.value.date_from,date_to:l.value.date_to},{showLoading:!1});v.value=t.trend||[]}finally{n.value=!1}},w=()=>{const r=p.value.map(e=>{var t;return{البيان:e.invoice_number||e.name||e.date,"الطرف الآخر":((t=e.user)==null?void 0:t.name)||"-",التاريخ:e.invoice_date||e.date||"-",الإجمالي:e.total||0}});h(r,`تقرير_المبيعات_${l.value.date_from}.csv`)};return T(c),(r,e)=>(B(),A(S,{title:"تقرير المبيعات التفصيلي",description:"تحليل أداء المبيعات، الإيرادات، والمنتجات الأكثر مبيعاً",loading:n.value,onRefresh:c,onExport:w},{filters:a(()=>[s("div",U,[o(y,{modelValue:l.value.date_from,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.date_from=t),label:"من تاريخ",type:"date"},null,8,["modelValue"]),o(y,{modelValue:l.value.date_to,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.date_to=t),label:"إلى تاريخ",type:"date"},null,8,["modelValue"]),o(E,{modelValue:l.value.group_by,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.group_by=t),label:"تجميع حسب",items:[{title:"بدون تجميع",value:""},{title:"باليوم",value:"day"},{title:"بالشهر",value:"month"},{title:"بالمنتج",value:"product"},{title:"بالعميل",value:"customer"}],variant:"outlined",density:"compact"},null,8,["modelValue"]),o(R,{color:"primary",block:"",onClick:c},{default:a(()=>e[3]||(e[3]=[L("تطبيق الفلاتر")])),_:1})])]),summary:a(()=>[o(N,{dense:""},{default:a(()=>[o(_,{cols:"12",sm:"4"},{default:a(()=>[o(f,{border:"",flat:"",class:"rounded-xl pa-4 bg-success-lighten-5 border-success"},{default:a(()=>[e[4]||(e[4]=s("div",{class:"text-caption font-weight-bold text-success"},"إجمالي المبيعات",-1)),s("div",$,d(x(b)(u.value.total_sales)),1)]),_:1})]),_:1}),o(_,{cols:"12",sm:"4"},{default:a(()=>[o(f,{border:"",flat:"",class:"rounded-xl pa-4 bg-primary-lighten-5 border-primary"},{default:a(()=>[e[5]||(e[5]=s("div",{class:"text-caption font-weight-bold text-primary"},"عدد الفواتير",-1)),s("div",I,d(u.value.total_invoices),1)]),_:1})]),_:1}),o(_,{cols:"12",sm:"4"},{default:a(()=>[o(f,{border:"",flat:"",class:"rounded-xl pa-4 bg-info-lighten-5 border-info"},{default:a(()=>[e[6]||(e[6]=s("div",{class:"text-caption font-weight-bold text-info"},"قطع مباعة",-1)),s("div",O,d(u.value.total_items_sold||0),1)]),_:1})]),_:1})]),_:1})]),charts:a(()=>[o(D,{data:v.value,loading:n.value},null,8,["data","loading"])]),table:a(()=>[o(C,{headers:m.value,items:p.value,loading:n.value,title:"نتائج التقرير",icon:"ri-table-line"},{"item.total":a(({item:t})=>[s("span",q,d(x(b)(t.total||t.net_amount)),1)]),"item.invoice_number":a(({item:t})=>[s("span",K,"#"+d(t.invoice_number),1)]),_:1},8,["headers","items","loading"])]),_:1},8,["loading"]))}};export{Z as default};
