import{r,a as pe,z as me,L as fe,K as q,c as M,b as s,u as n,x as d,w as o,E as k,d as l,F as ee,o as i,n as C,P as ae,ay as ge,j as ye,e as le,v as f,D as K,A as _e,k as xe,l as he,f as B,B as te,C as be,i as I,h as we,az as Ve,a6 as ke,aA as Ce,a3 as ze}from"./index-Flp88uEA.js";import{u as ie}from"./useApi-Dl4iYKvS.js";import{u as Ue}from"./usePermissions-BSwY7w5L.js";import{M as Ae}from"./MediaGallery-DegOZMgX.js";import{A as O}from"./AppSwitch-Dd82MwLv.js";import{_ as oe}from"./AppCard-D6xOpfLS.js";import{_ as b}from"./AppButton-DMkx3xLA.js";import{_ as H}from"./AppInput-CHj3RTxZ.js";import{A as se}from"./AppDialog-D7GtG_Rp.js";import{A as Be}from"./AppDataTable-anW7O1Lb.js";import{_ as $e}from"./LoadingSpinner-CLb8EfiO.js";import{_ as De}from"./EmptyState-CJo31Aib.js";import{A as Se}from"./AppInfiniteScroll-Cr88ibrJ.js";import{A as ne}from"./AppAvatar-BhNzqKmA.js";/* empty css                                                                  */function Me(){const T=ie("/api/brands"),w=r([]),p=r(!1),x=r(0);return{brands:w,loading:p,total:x,fetchBrands:async(z={},j={})=>{var v;const{append:L=!1}=j;p.value=!0;try{const u=await T.get(z,{showLoading:!1});let c=[],h=0;return u.data&&Array.isArray(u.data.data)?(c=u.data.data,h=((v=u.data.meta)==null?void 0:v.total)||u.data.data.length):(c=u.data||[],h=u.total||c.length),L?w.value=[...w.value,...c]:w.value=c,x.value=h,u}catch(u){throw w.value=[],x.value=0,u}finally{p.value=!1}},deleteBrand:async z=>await T.remove(z,{successMessage:"تم حذف العلامة التجارية بنجاح"})}}const Ie={class:"brands-page"},Te={class:"page-header d-flex align-center justify-space-between mb-6"},je={class:"d-flex align-center flex-wrap gap-4"},Le={class:"brand-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Pe={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},Ee={class:"d-flex align-center"},Ne={class:"text-body-2 text-grey-darken-1 text-truncate-2 height-40 mb-0"},Fe={class:"d-flex align-center py-2"},Ge={class:"d-flex flex-column"},Re={class:"font-weight-bold text-subtitle-1"},qe={class:"text-caption text-grey text-truncate max-width-200"},Ke={class:"d-flex align-center justify-center"},Oe={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},He={class:"d-flex align-center justify-space-between"},Je={class:"text-center pa-4"},Qe={class:"text-body-1 text-grey-darken-1"},We={__name:"BrandList",setup(T){const w=(t,a)=>{let e;return(..._)=>{e&&clearTimeout(e),e=setTimeout(()=>t(..._),a)}},{brands:p,loading:x,total:$,fetchBrands:J,deleteBrand:z}=Me(),j=t=>{g.value==="list"&&y()},L=()=>{x.value||p.value.length>=$.value||(c.value++,y(!0))},{can:v}=Ue(),u=ie("/api/brands"),c=r(1),h=r(12),P=r(""),g=r("list"),U=r(!1),D=r(!1),E=r(!1),V=r(null),N=r(!1),F=r(!1),G=r(null),A=r(null),m=r({name:"",active:!0,description:"",image_id:null}),R=me(()=>{var t;return!!((t=V.value)!=null&&t.id)}),S=r(null),Q=async t=>{S.value=t.id;try{await u.update(t.id,{active:!t.active}),t.active=!t.active}finally{S.value=null}},re=[{title:"الماركة",key:"name",sortable:!0},{title:"المنتجات",key:"products_count",align:"center"},{title:"الحالة",key:"active",align:"center"},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],de={required:t=>!!t||"هذا الحقل مطلوب"},ue=t=>{m.value.image_id=t.id,A.value=t.url},ce=w(()=>{c.value=1,y()},500),W=()=>{V.value=null,m.value={name:"",active:!0,description:"",image_id:null},A.value=null,U.value=!0},X=t=>{V.value=t,m.value={name:t.name,active:!!t.active,description:t.description,image_id:t.image_id},A.value=t.image_url,U.value=!0},Y=t=>{V.value=t,D.value=!0},Z=async()=>{if(!G.value)return;const{valid:t}=await G.value.validate();if(t){N.value=!0;try{R.value?await u.update(V.value.id,m.value,{successMessage:"تم تحديث الماركة"}):await u.create(m.value,{successMessage:"تم إضافة الماركة"}),U.value=!1,y()}finally{N.value=!1}}},ve=async()=>{F.value=!0;try{await z(V.value.id),D.value=!1,y()}finally{F.value=!1}},y=(t={})=>{const a=t===!0;J({page:c.value,per_page:h.value,search:P.value},{append:a})};return fe(y),q(c,()=>{g.value==="list"&&y()}),q(h,()=>{g.value==="list"&&(c.value=1,y())}),q(g,()=>{c.value=1,y()}),(t,a)=>(i(),M("div",Ie,[s("div",Te,[a[13]||(a[13]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold ml-2"},"العلامات التجارية"),s("p",{class:"text-body-1 text-grey"},"إدارة وتحليل العلامات التجارية للمنتجات")],-1)),n(v)("brands.create")?(i(),d(b,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:W},{default:o(()=>a[12]||(a[12]=[C(" علامة جديدة ")])),_:1})):k("",!0)]),l(oe,{class:"mb-6"},{default:o(()=>[s("div",je,[l(H,{modelValue:P.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>P.value=e),n(ce)],label:"بحث عن ماركة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(ae),l(ge,{variant:"outlined",density:"comfortable",color:"primary"},{default:o(()=>[l(b,{active:g.value==="grid",icon:"ri-grid-fill",onClick:a[1]||(a[1]=e=>g.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(b,{active:g.value==="list",icon:"ri-list-check",onClick:a[2]||(a[2]=e=>g.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),n(x)&&!n(p).length?(i(),d($e,{key:0,size:"64",text:"جاري تحميل العلامات التجارية..."})):n(p).length?(i(),M(ee,{key:2},[g.value==="grid"?(i(),d(Se,{key:0,loading:n(x)&&n(p).length>0,"has-more":n(p).length<n($),"no-more-text":"لا يوجد المزيد من العلامات التجارية",onLoad:L},{default:o(()=>[l(le,null,{default:o(()=>[(i(!0),M(ee,null,ye(n(p),e=>(i(),d(B,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[l(oe,{class:"brand-card h-100","no-padding":""},{actions:o(()=>[l(ae),n(v)("brands.update_all",{resource:e})?(i(),d(b,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",onClick:_=>X(e)},null,8,["onClick"])):k("",!0),n(v)("brands.delete_all",{resource:e})?(i(),d(b,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:_=>Y(e)},null,8,["onClick"])):k("",!0)]),default:o(()=>[s("div",Le,[l(ne,{"img-url":e.image_url,"onUpdate:imgUrl":_=>e.image_url=_,name:e.name,type:"brand",size:"120","custom-class":e.active?"bg-white":"grey-lighten-3",class:"elevation-1"},null,8,["img-url","onUpdate:imgUrl","name","custom-class"])]),l(Ve,{class:"position-relative pt-4"},{default:o(()=>[l(ke,{class:"text-h6 font-weight-bold pa-0 mb-1"},{default:o(()=>[C(f(e.name),1)]),_:2},1024),s("div",Pe,[s("div",Ee,[a[14]||(a[14]=s("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),l(K,{color:e.active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:o(()=>[C(f(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),n(v)("brands.update_all",{resource:e})?(i(),d(O,{key:0,"model-value":!!e.active,loading:S.value===e.id,"onUpdate:modelValue":_=>Q(e)},null,8,["model-value","loading","onUpdate:modelValue"])):k("",!0)]),l(Ce,{class:"pa-0 d-flex align-center"},{default:o(()=>[l(I,{icon:"ri-box-3-line",size:"14",class:"me-1"}),C(" "+f(e.products_count||0)+" منتج مربوط ",1)]),_:2},1024)]),_:2},1024),l(ze,{class:"pt-0 pb-2"},{default:o(()=>[s("p",Ne,f(e.description||"لا يوجد وصف متاح لهذه العلامة التجارية."),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(i(),d(Be,{key:1,headers:re,items:n(p),"total-items":n($),loading:n(x),page:c.value,"onUpdate:page":a[3]||(a[3]=e=>c.value=e),"items-per-page":h.value,"onUpdate:itemsPerPage":a[4]||(a[4]=e=>h.value=e),searchable:!1,"can-view":!1,"can-edit":!1,"can-delete":!1,"permission-module":"brands","onUpdate:options":j},{"item.name":o(({item:e})=>[s("div",Fe,[l(ne,{"img-url":e.image_url,name:e.name,type:"brand",size:"48",class:"me-3 border"},null,8,["img-url","name"]),s("div",Ge,[s("span",Re,f(e.name),1),s("span",qe,f(e.description||"بدون وصف"),1)])])]),"item.products_count":o(({item:e})=>[l(K,{size:"small",variant:"tonal","prepend-icon":"ri-box-3-line",color:"primary"},{default:o(()=>[C(f(e.products_count||0),1)]),_:2},1024)]),"item.active":o(({item:e})=>[s("div",Ke,[n(v)("brands.update_all",{resource:e})?(i(),M("span",{key:0,class:_e(["text-caption me-2 font-weight-bold",e.active?"text-success":"text-error"])},f(e.active?"نشط":"معطل"),3)):k("",!0),n(v)("brands.update_all",{resource:e})?(i(),d(O,{key:1,"model-value":!!e.active,loading:S.value===e.id,"onUpdate:modelValue":_=>Q(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(i(),d(K,{key:2,color:e.active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:o(()=>[C(f(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":o(({item:e})=>[n(v)("brands.update_all",{resource:e})?(i(),d(b,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:_=>X(e)},null,8,["onClick"])):k("",!0),n(v)("brands.delete_all",{resource:e})?(i(),d(b,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:_=>Y(e)},null,8,["onClick"])):k("",!0)]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(i(),d(De,{key:1,icon:"ri-award-line",title:"لا توجد علامات تجارية حالياً",message:"ابدأ بإضافة أول علامة تجارية لنظامك","show-action":n(v)("brands.create"),"action-text":"إضافة ماركة",onAction:W},null,8,["show-action"])),l(se,{modelValue:U.value,"onUpdate:modelValue":a[9]||(a[9]=e=>U.value=e),title:R.value?"تعديل العلامة التجارية":"إضافة علامة تجارية جديدة",icon:R.value?"ri-edit-line":"ri-award-line",loading:N.value,"max-width":"650",onConfirm:Z},{default:o(()=>[l(xe,{ref_key:"formRef",ref:G,onSubmit:he(Z,["prevent"])},{default:o(()=>[l(le,null,{default:o(()=>[l(B,{cols:"12",class:"d-flex justify-center mb-6"},{default:o(()=>[s("div",{class:"logo-preview-zone position-relative cursor-pointer",onClick:a[5]||(a[5]=e=>E.value=!0)},[l(te,{size:"140",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:o(()=>[A.value?(i(),d(be,{key:0,src:A.value,cover:""},null,8,["src"])):(i(),d(I,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),s("div",Oe,[l(I,{icon:"ri-exchange-line",color:"white",size:"24"}),a[15]||(a[15]=s("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الشعار",-1))])]),_:1}),l(b,{icon:"ri-gallery-line",size:"small",class:"position-absolute bottom-0 right-0 elevation-4"})])]),_:1}),l(B,{cols:"12"},{default:o(()=>[l(H,{modelValue:m.value.name,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value.name=e),label:"اسم العلامة التجارية *","prepend-inner-icon":"ri-award-line",rules:[de.required]},null,8,["modelValue","rules"])]),_:1}),l(B,{cols:"12"},{default:o(()=>[l(H,{modelValue:m.value.description,"onUpdate:modelValue":a[7]||(a[7]=e=>m.value.description=e),label:"وصف العلامة التجارية",type:"textarea","prepend-inner-icon":"ri-text-snippet",rows:"3",counter:"",maxlength:"500"},null,8,["modelValue"])]),_:1}),l(B,{cols:"12"},{default:o(()=>[l(we,{variant:"tonal",color:"primary",class:"pa-4 rounded-lg"},{default:o(()=>[s("div",He,[a[16]||(a[16]=s("div",null,[s("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),s("div",{class:"text-caption"},"تحديد ما إذا كانت الماركة تظهر في قائمة المنتجات")],-1)),l(O,{modelValue:m.value.active,"onUpdate:modelValue":a[8]||(a[8]=e=>m.value.active=e),"hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),l(se,{modelValue:D.value,"onUpdate:modelValue":a[10]||(a[10]=e=>D.value=e),title:"حذف الماركة؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:F.value,onConfirm:ve},{default:o(()=>{var e;return[s("div",Je,[l(te,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:o(()=>[l(I,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),s("p",Qe,'هل أنت متأكد من حذف "'+f((e=V.value)==null?void 0:e.name)+'"؟',1)])]}),_:1},8,["modelValue","loading"]),l(Ae,{modelValue:E.value,"onUpdate:modelValue":a[11]||(a[11]=e=>E.value=e),type:"logo",onSelect:ue},null,8,["modelValue"])]))}},va=pe(We,[["__scopeId","data-v-1b8748d6"]]);export{va as default};
