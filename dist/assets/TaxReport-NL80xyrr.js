import{u as S}from"./useApi-CjhFmPue.js";import{u as E}from"./usePrintExport-DBoRVp2V.js";import{_ as I}from"./AppCard-CXpBKc1t.js";import{_ as x}from"./AppButton-CREzoRf6.js";import{_ as y}from"./AppInput-06Y7zOXl.js";import{A as N}from"./AppDataTable-CnA5lOqV.js";import{r as p,J as R,c as A,a as o,b as e,w as a,d as k,o as B,l as v,e as i,f as b,a1 as g,t as c,g as $}from"./index-CuR9-sbN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"tax-report-page"},G={class:"mb-6 px-6 pt-6 d-flex align-center justify-space-between"},O={class:"d-flex gap-2"},P={class:"text-h4 font-weight-black text-success"},U={class:"text-h4 font-weight-black text-error"},j={class:"text-h4 font-weight-black text-info"},z={class:"px-6 mb-4"},J={class:"px-6 pb-6"},L={class:"font-weight-bold text-body-1"},M={class:"font-weight-black text-body-1 text-error"},q={class:"text-center pa-10"},at={__name:"TaxReport",setup(H){const V=S("/api/invoices"),{exportToCSV:C}=E(),f=p(!1),r=p({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),u=p({total_sales_tax:0,total_purchase_tax:0,net_tax:0}),_=p([]),T=[{title:"رقم الفاتورة",key:"invoice_number"},{title:"التاريخ",key:"invoice_date"},{title:"الإجمالي (شامل الضريبة)",key:"total",align:"end"},{title:"قيمة الضريبة (14%)",key:"tax_amount",align:"end"}],d=n=>n?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(n):"0.00 ج.م",D=()=>{const n=_.value.map(t=>({"رقم الفاتورة":t.invoice_number,التاريخ:t.invoice_date,الإجمالي:t.total,"قيمة الضريبة":t.tax_amount}));C(n,"تقرير_الضرائب.csv",["رقم الفاتورة","التاريخ","الإجمالي","قيمة الضريبة"])},m=async()=>{f.value=!0;try{const t=(await V.get({...r.value,per_page:100},{showLoading:!1})).data||[];let l=0;t.forEach(s=>{const h=parseFloat(s.total||0),w=h-h/1.14;l+=w,s.tax_amount=w}),_.value=t.map(s=>({invoice_number:s.invoice_number,invoice_date:s.invoice_date,total:s.total,tax_amount:s.tax_amount})),u.value={total_sales_tax:l,total_purchase_tax:l*.4,net_tax:l*.6}}finally{f.value=!1}};return R(m),(n,t)=>(B(),A("div",F,[o("div",G,[t[4]||(t[4]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold"},"تقرير ضريبة القيمة المضافة"),o("p",{class:"text-body-1 text-grey"},"تحليل الإقرارات الضريبية للمبيعات والمشتريات (14%)")],-1)),o("div",O,[e(x,{variant:"tonal",color:"success","prepend-icon":"ri-download-line",onClick:D,disabled:!_.value.length},{default:a(()=>t[2]||(t[2]=[v(" تصدير CSV ")])),_:1},8,["disabled"]),e(x,{color:"primary","prepend-icon":"ri-refresh-line",onClick:m},{default:a(()=>t[3]||(t[3]=[v(" تحديث البيانات ")])),_:1})])]),e(k,{class:"px-6 mx-0 mb-6",dense:""},{default:a(()=>[e(i,{cols:"12",md:"4"},{default:a(()=>[e(b,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-success"},{default:a(()=>[e(g,{class:"pa-4 bg-success-lighten-5"},{default:a(()=>[t[5]||(t[5]=o("div",{class:"text-caption font-weight-bold text-success mb-1"},"إجمالي ضريبة المبيعات (+)",-1)),o("div",P,c(d(u.value.total_sales_tax)),1)]),_:1})]),_:1})]),_:1}),e(i,{cols:"12",md:"4"},{default:a(()=>[e(b,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-error"},{default:a(()=>[e(g,{class:"pa-4 bg-error-lighten-5"},{default:a(()=>[t[6]||(t[6]=o("div",{class:"text-caption font-weight-bold text-error mb-1"},"ضريبة المشتريات (خصم)",-1)),o("div",U,c(d(u.value.total_purchase_tax)),1)]),_:1})]),_:1})]),_:1}),e(i,{cols:"12",md:"4"},{default:a(()=>[e(b,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-info"},{default:a(()=>[e(g,{class:"pa-4 bg-info-lighten-5"},{default:a(()=>[t[7]||(t[7]=o("div",{class:"text-caption font-weight-bold text-info mb-1"},"صافي الضريبة المستحقة",-1)),o("div",j,c(d(u.value.net_tax)),1)]),_:1})]),_:1})]),_:1})]),_:1}),o("div",z,[e(I,{title:"الموسم الضريبي",icon:"ri-calendar-check-line"},{default:a(()=>[e(k,{dense:""},{default:a(()=>[e(i,{cols:"12",sm:"4"},{default:a(()=>[e(y,{modelValue:r.value.date_from,"onUpdate:modelValue":t[0]||(t[0]=l=>r.value.date_from=l),label:"من تاريخ",type:"date","prepend-inner-icon":"ri-calendar-line"},null,8,["modelValue"])]),_:1}),e(i,{cols:"12",sm:"4"},{default:a(()=>[e(y,{modelValue:r.value.date_to,"onUpdate:modelValue":t[1]||(t[1]=l=>r.value.date_to=l),label:"إلى تاريخ",type:"date","prepend-inner-icon":"ri-calendar-check-line"},null,8,["modelValue"])]),_:1}),e(i,{cols:"12",sm:"4",class:"d-flex align-center pt-2"},{default:a(()=>[e(x,{color:"secondary",block:"","prepend-icon":"ri-file-chart-line",onClick:m,variant:"tonal"},{default:a(()=>t[8]||(t[8]=[v(" استخراج كشف الضرائب ")])),_:1})]),_:1})]),_:1})]),_:1})]),o("div",J,[e(N,{headers:T,items:_.value,loading:f.value,title:"كشف ضريبة القيمة المضافة التفصيلي",icon:"ri-percent-line"},{"item.total":a(({item:l})=>[o("div",L,c(d(l.total)),1)]),"item.tax_amount":a(({item:l})=>[o("div",M,c(d(l.tax_amount)),1)]),"no-data":a(()=>[o("div",q,[e($,{icon:"ri-file-shredder-line",size:"64",color:"grey-lighten-2",class:"mb-4"}),t[9]||(t[9]=o("div",{class:"text-h6 text-grey font-weight-medium"},"لا توجد بيانات ضريبية مسجلة لهذه الفترة",-1))])]),_:1},8,["items","loading"])])]))}};export{at as default};
