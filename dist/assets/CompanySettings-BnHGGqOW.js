import{a as q,y as H,J,z as C,r as c,L as X,c as f,b as m,d as a,w as i,e as U,E as S,aO as Y,s as A,o as u,f as d,a3 as K,B as Q,x as z,C as W,i as I,l as Z,A as ee,k as le,F as ae,j as oe,n as F,G as re,aH as y,ad as se}from"./index-Flp88uEA.js";import{u as ie}from"./useApi-Dl4iYKvS.js";import{M as te}from"./MediaGallery-DegOZMgX.js";/* empty css                                                                  */import{_ as g}from"./AppCard-D6xOpfLS.js";import{_ as n}from"./AppInput-CHj3RTxZ.js";import{_}from"./AppButton-DMkx3xLA.js";const ne={class:"company-settings-page"},de={key:2,class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},ue={key:0,style:{position:"sticky",bottom:"15px","z-index":"100"},class:"d-flex justify-center"},me={__name:"CompanySettings",setup(ce){const E=H(),b=J(),M=ie("/api/company"),N=C(()=>{var r,e;return(e=(r=b.user)==null?void 0:r.permissions)==null?void 0:e.includes(y.ADMIN_SUPER)}),B=C(()=>{var r,e;return(e=(r=b.user)==null?void 0:r.permissions)==null?void 0:e.includes(y.ADMIN_COMPANY)}),p=C(()=>{var r,e,l,s;return N.value||B.value||((e=(r=b.user)==null?void 0:r.permissions)==null?void 0:e.includes(y.COMPANIES_UPDATE_ALL))||((s=(l=b.user)==null?void 0:l.permissions)==null?void 0:s.includes(y.COMPANIES_UPDATE_SELF))}),x=c(!1),w=c(!1),V=c(!1),k=c(null),t=c({}),o=c({id:null,name:"",owner_name:"",field:"",tax_number:"",phone:"",email:"",address:"",description:"",website:"",logo:"",social_links:[],images_ids:[]}),h=[{title:"فيسبوك",value:"facebook",icon:"ri-facebook-fill",color:"#1877F2"},{title:"واتساب",value:"whatsapp",icon:"ri-whatsapp-line",color:"#25D366"},{title:"إنستجرام",value:"instagram",icon:"ri-instagram-line",color:"#E4405F"},{title:"تويتر (X)",value:"twitter",icon:"ri-twitter-x-fill",color:"#000000"},{title:"لينكد إن",value:"linkedin",icon:"ri-linkedin-box-line",color:"#0A66C2"},{title:"تيك توك",value:"tiktok",icon:"ri-tiktok-line",color:"#000000"},{title:"يوتيوب",value:"youtube",icon:"ri-youtube-line",color:"#FF0000"},{title:"سناب شات",value:"snapchat",icon:"ri-snapchat-line",color:"#FFFC00"},{title:"تليجرام",value:"telegram",icon:"ri-telegram-line",color:"#26A5E4"},{title:"أخرى",value:"other",icon:"ri-links-line",color:"#607D8B"}],$=r=>{const e=h.find(l=>l.value===r);return e?e.icon:"ri-links-line"},D=r=>{const e=h.find(l=>l.value===r);return e?e.color:void 0},L=()=>{o.value.social_links.push({platform:"facebook",url:""})},O=r=>{o.value.social_links.splice(r,1)},P=(r,e)=>{if(!r[e])return;const l=r[e].trim();l&&(/^https?:\/\//i.test(l)||(r[e]=`https://${l}`))},R={required:r=>!!r||"هذا الحقل مطلوب أساسي لاستكمال البيانات"},T=r=>{o.value.logo=r.url,o.value.images_ids=[r.id],A.success("تم اختيار الشعار بنجاح، يرجى الحفظ لاعتماد التغييرات")},G=async()=>{var e;const r=(e=E.currentUser)==null?void 0:e.company_id;if(r){x.value=!0;try{const l=await M.getById(r,{showLoading:!1});if(l.data){const s=l.data;o.value={id:s.id,name:s.name||"",owner_name:s.owner_name||"",field:s.field||"",tax_number:s.tax_number||"",phone:s.phone||"",email:s.email||"",address:s.address||"",description:s.description||"",website:s.website||"",logo:s.logo||"",social_links:Array.isArray(s.social_links)?s.social_links:[],images_ids:[]}}}catch(l){console.error("Error loading company data:",l),A.error("فشل في تحميل بيانات الشركة")}finally{x.value=!1}}},j=async()=>{var e,l;if(!k.value)return;const{valid:r}=await k.value.validate();if(!r){A.error("يرجى تصحيح الأخطاء في الحقول المطلوبة");return}w.value=!0,t.value={};try{const s={...o.value};s.images_ids.length===0&&delete s.images_ids,await M.update(o.value.id,s,{successMessage:"تم تحديث هوية الشركة وبياناتها بنجاح"}),await E.fetchUser()}catch(s){(l=(e=s.response)==null?void 0:e.data)!=null&&l.errors&&(t.value=s.response.data.errors),console.error("Save error:",s)}finally{w.value=!1}};return X(()=>{G()}),(r,e)=>(u(),f("div",ne,[e[18]||(e[18]=m("div",{class:"page-header mb-8"},[m("h1",{class:"text-h3 font-weight-bold primary--text mb-2"},"إعدادات الشركة"),m("p",{class:"text-subtitle-1 text-grey-darken-1"},"تخصيص الهوية البصرية وإدارة البيانات الأساسية للنظام")],-1)),a(U,{class:"pb-16 mb-16"},{default:i(()=>[a(d,{cols:"12",lg:"4"},{default:i(()=>[a(g,{title:"الهوية البصرية",icon:"ri-magic-line",class:"mb-6","no-padding":""},{default:i(()=>[a(K,{class:"pa-8 text-center bg-grey-lighten-5"},{default:i(()=>[m("div",{class:ee(["logo-preview-zone mx-auto mb-6",{"cursor-pointer":p.value}]),onClick:e[1]||(e[1]=l=>p.value&&(V.value=!0))},[a(Q,{size:"180",rounded:"xl",color:"white",class:"border-2 border-dashed elevation-3 hover-scale overflow-hidden"},{default:i(()=>[o.value.logo?(u(),z(W,{key:0,src:o.value.logo,cover:""},null,8,["src"])):(u(),z(I,{key:1,icon:"ri-building-line",size:"64",color:"grey-lighten-2"})),p.value?(u(),f("div",de,[a(I,{icon:"ri-camera-switch-line",color:"white",size:"32"}),e[13]||(e[13]=m("span",{class:"text-white text-subtitle-2 mt-2 font-weight-bold"},"تغيير الشعار",-1))])):S("",!0)]),_:1}),p.value?(u(),z(_,{key:0,icon:"ri-gallery-upload-line",size:"small",class:"position-absolute bottom-0 right-0 elevation-6",onClick:e[0]||(e[0]=Z(l=>V.value=!0,["stop"]))})):S("",!0)],2),e[14]||(e[14]=m("h3",{class:"text-h6 font-weight-bold mb-1"},"شعار الشركة",-1)),e[15]||(e[15]=m("p",{class:"text-caption text-grey-darken-1 px-4"}," سيظهر هذا الشعار في الفواتير، التقارير، وفي القائمة الجانبية للنظام. يُنصح باستخدام صورة بخلفية شفافة (PNG) وبأبعاد 512×512. ",-1))]),_:1})]),_:1}),a(g,{title:"سياق العمل",icon:"ri-briefcase-line",class:"mb-6"},{default:i(()=>[a(n,{modelValue:o.value.field,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.field=l),label:"مجال نشاط الشركة",placeholder:"مثال: تجارة الملابس، مواد بناء...","prepend-inner-icon":"ri-service-line",class:"mb-4","error-messages":t.value.field},null,8,["modelValue","error-messages"]),a(n,{modelValue:o.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.description=l),label:"نبذة عن الشركة",type:"textarea","prepend-inner-icon":"ri-article-line",placeholder:"وصف مختصر يظهر في بعض التقارير المخصصة...",rows:"3",counter:"",maxlength:"500","error-messages":t.value.description},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(d,{cols:"12",lg:"8"},{default:i(()=>[a(le,{ref_key:"formRef",ref:k},{default:i(()=>[a(g,{title:"البيانات الأساسية والقانونية",icon:"ri-information-line",class:"mb-6"},{default:i(()=>[a(U,null,{default:i(()=>[a(d,{cols:"12",md:"6"},{default:i(()=>[a(n,{modelValue:o.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.name=l),label:"الاسم التجاري للشركة *","prepend-inner-icon":"ri-building-2-fill",rules:[R.required],"error-messages":t.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),a(d,{cols:"12",md:"6"},{default:i(()=>[a(n,{modelValue:o.value.owner_name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.owner_name=l),label:"اسم صاحب المنشأة","prepend-inner-icon":"ri-user-star-line","error-messages":t.value.owner_name},null,8,["modelValue","error-messages"])]),_:1}),a(d,{cols:"12",md:"6"},{default:i(()=>[a(n,{modelValue:o.value.tax_number,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.tax_number=l),label:"الرقم الضريبي (VAT)","prepend-inner-icon":"ri-id-card-line",placeholder:"أدخل الرقم الضريبي المكون من 15 رقم","error-messages":t.value.tax_number},null,8,["modelValue","error-messages"])]),_:1}),a(d,{cols:"12",md:"6"},{default:i(()=>[a(n,{modelValue:o.value.address,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.address=l),label:"العنوان الرسمي","prepend-inner-icon":"ri-map-pin-2-line",placeholder:"المدينة، الحي، اسم الشارع","error-messages":t.value.address},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),a(g,{title:"قنوات الاتصال والتواصل",icon:"ri-customer-service-2-line","icon-color":"success"},{default:i(()=>[a(U,null,{default:i(()=>[a(d,{cols:"12",md:"6"},{default:i(()=>[a(n,{modelValue:o.value.phone,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.phone=l),label:"رقم التواصل الرئيسي","prepend-inner-icon":"ri-phone-fill",dir:"ltr","error-messages":t.value.phone},null,8,["modelValue","error-messages"])]),_:1}),a(d,{cols:"12",md:"6"},{default:i(()=>[a(n,{modelValue:o.value.email,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.email=l),label:"البريد الإلكتروني الرسمي","prepend-inner-icon":"ri-mail-send-line",type:"email",dir:"ltr","error-messages":t.value.email},null,8,["modelValue","error-messages"])]),_:1}),a(d,{cols:"12"},{default:i(()=>[a(n,{modelValue:o.value.website,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.website=l),label:"الموقع الإلكتروني","prepend-inner-icon":"ri-global-fill",placeholder:"https://example.com",dir:"ltr","error-messages":t.value.website,onBlur:e[11]||(e[11]=l=>P(o.value,"website"))},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(g,{title:"وسائل التواصل الاجتماعي",icon:"ri-share-line",class:"my-4"},{default:i(()=>[(u(!0),f(ae,null,oe(o.value.social_links,(l,s)=>(u(),f("div",{key:s,class:"d-flex align-center gap-3 mb-4"},[a(se,{modelValue:l.platform,"onUpdate:modelValue":v=>l.platform=v,items:h,"item-title":"title","item-value":"value",density:"comfortable",variant:"outlined","hide-details":"",style:{width:"140px","flex-shrink":"0"}},{"prepend-inner":i(()=>[a(I,{icon:$(l.platform),size:"20",color:D(l.platform)},null,8,["icon","color"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(n,{modelValue:l.url,"onUpdate:modelValue":v=>l.url=v,placeholder:"رابط الحساب...","hide-details":"",class:"flex-grow-1",dir:"ltr",onBlur:v=>P(l,"url")},null,8,["modelValue","onUpdate:modelValue","onBlur"]),a(_,{icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:v=>O(s)},null,8,["onClick"])]))),128)),a(_,{variant:"tonal",block:"","prepend-icon":"ri-add-line",class:"mt-2",onClick:L},{default:i(()=>e[16]||(e[16]=[F(" إضافة رابط تواصل ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),p.value?(u(),f("div",ue,[a(_,{size:"x-large",elevation:"8","prepend-icon":"ri-save-fill",loading:w.value,rounded:"pill",class:"px-12 font-weight-bold",onClick:j},{default:i(()=>e[17]||(e[17]=[F(" حفظ كافة التغييرات ")])),_:1},8,["loading"])])):S("",!0),a(Y,{"model-value":x.value,class:"align-center justify-center",persistent:""},{default:i(()=>[a(re,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),a(te,{modelValue:V.value,"onUpdate:modelValue":e[12]||(e[12]=l=>V.value=l),type:"logo",onSelect:T},null,8,["modelValue"])]))}},_e=q(me,[["__scopeId","data-v-57316f58"]]);export{_e as default};
