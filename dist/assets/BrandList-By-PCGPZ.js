import{r as d,H as xe,v as we,x as D,J as be,I as Q,c as $,a as i,s as r,w as s,C as S,b as l,u as c,F as de,o,l as C,N as ue,at as ke,h as Ve,d as ce,A as W,g as E,z as j,t as g,B as X,y as Ae,i as De,j as Se,e as N,f as Ce,P as p,au as Ee,a7 as Ue,av as Be,a1 as Pe}from"./index-CuR9-sbN.js";import{u as pe}from"./useApi-CjhFmPue.js";import{M as Le}from"./MediaGallery-DgiLIKzw.js";import{A as Z}from"./AppSwitch-CXzOvU1j.js";import{_ as ve}from"./AppCard-CXpBKc1t.js";import{_ as x}from"./AppButton-CREzoRf6.js";import{_ as ee}from"./AppInput-06Y7zOXl.js";import{A as me}from"./AppDialog-vLCI3uF9.js";import{A as ze}from"./AppDataTable-CnA5lOqV.js";import{_ as Ne}from"./LoadingSpinner-vBlED74H.js";import{_ as Te}from"./EmptyState-FFeUUxeu.js";import{A as Re}from"./AppInfiniteScroll-616_I-vy.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Me(){const F=pe("/api/brands"),w=d([]),v=d(!1),h=d(0);return{brands:w,loading:v,total:h,fetchBrands:async(U={},G={})=>{var A;const{append:O=!1}=G;v.value=!0;try{const n=await F.get(U,{showLoading:!1});let f=[],b=0;return n.data&&Array.isArray(n.data.data)?(f=n.data.data,b=((A=n.data.meta)==null?void 0:A.total)||n.data.data.length):(f=n.data||[],b=n.total||f.length),O?w.value=[...w.value,...f]:w.value=f,h.value=b,n}catch(n){throw w.value=[],h.value=0,n}finally{v.value=!1}},deleteBrand:async U=>await F.remove(U,{successMessage:"تم حذف العلامة التجارية بنجاح"})}}const $e={class:"brands-page"},je={class:"page-header d-flex align-center justify-space-between mb-6"},Fe={class:"d-flex align-center flex-wrap gap-4"},Ge={class:"brand-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Oe={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},qe={class:"d-flex align-center"},He={class:"text-body-2 text-grey-darken-1 text-truncate-2 height-40 mb-0"},Je={class:"d-flex align-center py-2"},Ye={class:"d-flex flex-column"},Ke={class:"font-weight-bold text-subtitle-1"},Qe={class:"text-caption text-grey text-truncate max-width-200"},We={class:"d-flex align-center justify-center"},Xe={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},Ze={class:"d-flex align-center justify-space-between"},ea={class:"text-center pa-4"},aa={class:"text-body-1 text-grey-darken-1"},la={__name:"BrandList",setup(F){const w=(t,a)=>{let e;return(...V)=>{e&&clearTimeout(e),e=setTimeout(()=>t(...V),a)}},{brands:v,loading:h,total:T,fetchBrands:ae,deleteBrand:U}=Me(),G=t=>{_.value==="list"&&y()},O=()=>{h.value||v.value.length>=T.value||(n.value++,y(!0))},A=pe("/api/brands"),n=d(1),f=d(12),b=d(""),_=d("list"),B=d(!1),R=d(!1),q=d(!1),k=d(null),H=d(!1),J=d(!1),Y=d(null),P=d(null);xe();const u=we(),L=D(()=>u.hasPermission(p.ADMIN_SUPER)),z=D(()=>u.hasPermission(p.ADMIN_COMPANY)),le=D(()=>L.value||z.value||u.hasPermission(p.BRANDS_CREATE)),I=t=>{var a;return L.value||z.value?!0:u.hasPermission(p.BRANDS_UPDATE_ALL)||u.hasPermission(p.BRANDS_UPDATE_SELF)&&t.created_by===((a=u.currentUser)==null?void 0:a.id)};D(()=>L.value||z.value||u.hasPermission(p.BRANDS_UPDATE_ALL)||u.hasPermission(p.BRANDS_UPDATE_SELF));const te=t=>{var a;return L.value||z.value?!0:u.hasPermission(p.BRANDS_DELETE_ALL)||u.hasPermission(p.BRANDS_DELETE_SELF)&&t.created_by===((a=u.currentUser)==null?void 0:a.id)};D(()=>L.value||z.value||u.hasPermission(p.BRANDS_DELETE_ALL)||u.hasPermission(p.BRANDS_DELETE_SELF));const m=d({name:"",active:!0,description:"",image_id:null}),K=D(()=>{var t;return!!((t=k.value)!=null&&t.id)}),M=d(null),se=async t=>{M.value=t.id;try{await A.update(t.id,{active:!t.active}),t.active=!t.active}finally{M.value=null}},fe=[{title:"الماركة",key:"name",sortable:!0},{title:"المنتجات",key:"products_count",align:"center"},{title:"الحالة",key:"active",align:"center"},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],ge={required:t=>!!t||"هذا الحقل مطلوب"},_e=t=>{m.value.image_id=t.id,P.value=t.url},ye=w(()=>{n.value=1,y()},500),ie=()=>{k.value=null,m.value={name:"",active:!0,description:"",image_id:null},P.value=null,B.value=!0},oe=t=>{k.value=t,m.value={name:t.name,active:!!t.active,description:t.description,image_id:t.image_id},P.value=t.image_url,B.value=!0},ne=t=>{k.value=t,R.value=!0},re=async()=>{if(!Y.value)return;const{valid:t}=await Y.value.validate();if(t){H.value=!0;try{K.value?await A.update(k.value.id,m.value,{successMessage:"تم تحديث الماركة"}):await A.create(m.value,{successMessage:"تم إضافة الماركة"}),B.value=!1,y()}finally{H.value=!1}}},he=async()=>{J.value=!0;try{await U(k.value.id),R.value=!1,y()}finally{J.value=!1}},y=(t={})=>{const a=t===!0;ae({page:n.value,per_page:f.value,search:b.value},{append:a})};return be(y),Q(n,()=>{_.value==="list"&&y()}),Q(f,()=>{_.value==="list"&&(n.value=1,y())}),Q(_,()=>{n.value=1,y()}),(t,a)=>(o(),$("div",$e,[i("div",je,[a[13]||(a[13]=i("div",null,[i("h1",{class:"text-h4 font-weight-bold ml-2"},"العلامات التجارية"),i("p",{class:"text-body-1 text-grey"},"إدارة وتحليل العلامات التجارية للمنتجات")],-1)),le.value?(o(),r(x,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:ie},{default:s(()=>a[12]||(a[12]=[C(" علامة جديدة ")])),_:1})):S("",!0)]),l(ve,{class:"mb-6"},{default:s(()=>[i("div",Fe,[l(ee,{modelValue:b.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>b.value=e),c(ye)],label:"بحث عن ماركة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(ue),l(ke,{variant:"outlined",density:"comfortable",color:"primary"},{default:s(()=>[l(x,{active:_.value==="grid",icon:"ri-grid-fill",onClick:a[1]||(a[1]=e=>_.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(x,{active:_.value==="list",icon:"ri-list-check",onClick:a[2]||(a[2]=e=>_.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),c(h)&&!c(v).length?(o(),r(Ne,{key:0,size:"64",text:"جاري تحميل العلامات التجارية..."})):c(v).length?(o(),$(de,{key:2},[_.value==="grid"?(o(),r(Re,{key:0,loading:c(h)&&c(v).length>0,"has-more":c(v).length<c(T),"no-more-text":"لا يوجد المزيد من العلامات التجارية",onLoad:O},{default:s(()=>[l(ce,null,{default:s(()=>[(o(!0),$(de,null,Ve(c(v),e=>(o(),r(N,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[l(ve,{class:"brand-card h-100","no-padding":""},{actions:s(()=>[l(ue),l(x,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:V=>oe(e)},null,8,["onClick"]),te(e)?(o(),r(x,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:V=>ne(e)},null,8,["onClick"])):S("",!0)]),default:s(()=>[i("div",Ge,[l(j,{size:"120",rounded:"circle",color:e.active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white"},{default:s(()=>[e.image_url?(o(),r(W,{key:0,src:e.image_url,cover:""},null,8,["src"])):(o(),r(E,{key:1,icon:"ri-award-line",size:"60",color:e.active?"primary":"grey"},null,8,["color"]))]),_:2},1032,["color"])]),l(Ee,{class:"position-relative pt-4"},{default:s(()=>[l(Ue,{class:"text-h6 font-weight-bold pa-0 mb-1"},{default:s(()=>[C(g(e.name),1)]),_:2},1024),i("div",Oe,[i("div",qe,[a[14]||(a[14]=i("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),l(X,{color:e.active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:s(()=>[C(g(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),I(e)?(o(),r(Z,{key:0,"model-value":!!e.active,loading:M.value===e.id,"onUpdate:modelValue":V=>se(e)},null,8,["model-value","loading","onUpdate:modelValue"])):S("",!0)]),l(Be,{class:"pa-0 d-flex align-center"},{default:s(()=>[l(E,{icon:"ri-box-3-line",size:"14",class:"me-1"}),C(" "+g(e.products_count||0)+" منتج مربوط ",1)]),_:2},1024)]),_:2},1024),l(Pe,{class:"pt-0 pb-2"},{default:s(()=>[i("p",He,g(e.description||"لا يوجد وصف متاح لهذه العلامة التجارية."),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(o(),r(ze,{key:1,headers:fe,items:c(v),"total-items":c(T),loading:c(h),page:n.value,"onUpdate:page":a[3]||(a[3]=e=>n.value=e),"items-per-page":f.value,"onUpdate:itemsPerPage":a[4]||(a[4]=e=>f.value=e),searchable:!1,"can-view":!1,"can-edit":!1,"can-delete":!1,"onUpdate:options":G},{"item.name":s(({item:e})=>[i("div",Je,[l(j,{size:"48",rounded:"circle",color:e.active?"bg-white":"grey-lighten-4",class:"me-3 border"},{default:s(()=>[e.image_url?(o(),r(W,{key:0,src:e.image_url,cover:""},null,8,["src"])):(o(),r(E,{key:1,icon:"ri-award-line",size:"24",color:"grey"}))]),_:2},1032,["color"]),i("div",Ye,[i("span",Ke,g(e.name),1),i("span",Qe,g(e.description||"بدون وصف"),1)])])]),"item.products_count":s(({item:e})=>[l(X,{size:"small",variant:"tonal","prepend-icon":"ri-box-3-line",color:"primary"},{default:s(()=>[C(g(e.products_count||0),1)]),_:2},1024)]),"item.active":s(({item:e})=>[i("div",We,[I(e)?(o(),$("span",{key:0,class:Ae(["text-caption me-2 font-weight-bold",e.active?"text-success":"text-error"])},g(e.active?"نشط":"معطل"),3)):S("",!0),I(e)?(o(),r(Z,{key:1,"model-value":!!e.active,loading:M.value===e.id,"onUpdate:modelValue":V=>se(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(o(),r(X,{key:2,color:e.active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:s(()=>[C(g(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":s(({item:e})=>[I(e)?(o(),r(x,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:V=>oe(e)},null,8,["onClick"])):S("",!0),te(e)?(o(),r(x,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:V=>ne(e)},null,8,["onClick"])):S("",!0)]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(o(),r(Te,{key:1,icon:"ri-award-line",title:"لا توجد علامات تجارية حالياً",message:"ابدأ بإضافة أول علامة تجارية لنظامك","show-action":le.value,"action-text":"إضافة ماركة",onAction:ie},null,8,["show-action"])),l(me,{modelValue:B.value,"onUpdate:modelValue":a[9]||(a[9]=e=>B.value=e),title:K.value?"تعديل العلامة التجارية":"إضافة علامة تجارية جديدة",icon:K.value?"ri-edit-line":"ri-award-line",loading:H.value,"max-width":"650",onConfirm:re},{default:s(()=>[l(De,{ref_key:"formRef",ref:Y,onSubmit:Se(re,["prevent"])},{default:s(()=>[l(ce,null,{default:s(()=>[l(N,{cols:"12",class:"d-flex justify-center mb-6"},{default:s(()=>[i("div",{class:"logo-preview-zone position-relative cursor-pointer",onClick:a[5]||(a[5]=e=>q.value=!0)},[l(j,{size:"140",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:s(()=>[P.value?(o(),r(W,{key:0,src:P.value,cover:""},null,8,["src"])):(o(),r(E,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),i("div",Xe,[l(E,{icon:"ri-exchange-line",color:"white",size:"24"}),a[15]||(a[15]=i("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الشعار",-1))])]),_:1}),l(x,{icon:"ri-gallery-line",size:"small",class:"position-absolute bottom-0 right-0 elevation-4"})])]),_:1}),l(N,{cols:"12"},{default:s(()=>[l(ee,{modelValue:m.value.name,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value.name=e),label:"اسم العلامة التجارية *","prepend-inner-icon":"ri-award-line",rules:[ge.required]},null,8,["modelValue","rules"])]),_:1}),l(N,{cols:"12"},{default:s(()=>[l(ee,{modelValue:m.value.description,"onUpdate:modelValue":a[7]||(a[7]=e=>m.value.description=e),label:"وصف العلامة التجارية",type:"textarea","prepend-inner-icon":"ri-text-snippet",rows:"3",counter:"",maxlength:"500"},null,8,["modelValue"])]),_:1}),l(N,{cols:"12"},{default:s(()=>[l(Ce,{variant:"tonal",color:"primary",class:"pa-4 rounded-lg"},{default:s(()=>[i("div",Ze,[a[16]||(a[16]=i("div",null,[i("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),i("div",{class:"text-caption"},"تحديد ما إذا كانت الماركة تظهر في قائمة المنتجات")],-1)),l(Z,{modelValue:m.value.active,"onUpdate:modelValue":a[8]||(a[8]=e=>m.value.active=e),"hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),l(me,{modelValue:R.value,"onUpdate:modelValue":a[10]||(a[10]=e=>R.value=e),title:"حذف الماركة؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:J.value,onConfirm:he},{default:s(()=>{var e;return[i("div",ea,[l(j,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:s(()=>[l(E,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),i("p",aa,'هل أنت متأكد من حذف "'+g((e=k.value)==null?void 0:e.name)+'"؟',1)])]}),_:1},8,["modelValue","loading"]),l(Le,{modelValue:q.value,"onUpdate:modelValue":a[11]||(a[11]=e=>q.value=e),type:"logo",onSelect:_e},null,8,["modelValue"])]))}},ga=Ie(la,[["__scopeId","data-v-48717b54"]]);export{ga as default};
