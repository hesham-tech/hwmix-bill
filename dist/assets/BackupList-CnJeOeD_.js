import{ap as X,aG as _,a as Y,r as c,L as Z,c as ee,b as v,d as t,w as l,H as p,h as C,as as z,o as te,n as r,a3 as h,aP as ae,v as S,D as le,N as D,M as U,u as se,a6 as E,k as ne,ad as oe,am as M,m as re,O as A,ar as L,P as F,i as ie,ah as ue,s as N}from"./index-Flp88uEA.js";class de extends X{constructor(){super("backups")}async runManual(i={}){const{showToast:o=!0,loading:d=!0}=i;try{const n=await _.post(`${this.resource}/run`);return this.handleSuccess(n,o)}catch(n){return this.handleError(n,o)}}async download(i){try{const o=await _.get(`${this.resource}/${i}/download`,{responseType:"blob"}),d=window.URL.createObjectURL(new Blob([o.data])),n=document.createElement("a");return n.href=d,n.setAttribute("download",`backup-${i}.zip`),document.body.appendChild(n),n.click(),n.remove(),o.data}catch(o){return this.handleError(o,!0)}}async getSettings(i={}){const{showToast:o=!1,loading:d=!0}=i;try{const n=await _.get(`${this.resource}/settings`);return this.handleSuccess(n,o)}catch(n){return this.handleError(n,o)}}async updateSettings(i,o={}){const{showToast:d=!0,loading:n=!0}=o;try{const m=await _.put(`${this.resource}/settings`,i);return this.handleSuccess(m,d)}catch(m){return this.handleError(m,d)}}async restore(i,o,d={}){const{showToast:n=!0,loading:m=!0}=d;try{const y=await _.post(`${this.resource}/${i}/restore`,{token:o});return this.handleSuccess(y,n)}catch(y){return this.handleError(y,n)}}}const g=new de,ce={class:"backup-page"},pe={class:"page-header mb-8 d-flex justify-space-between align-center"},fe={class:"d-flex gap-3"},ve={class:"font-weight-medium text-primary"},me={class:"d-flex justify-end gap-1"},ge={class:"text-body-1 mb-4"},ye={__name:"BackupList",setup(P){const i=c([]),o=c(!1),d=c(!1),n=[{title:"الملف",key:"filename",align:"start"},{title:"النوع",key:"type",align:"center"},{title:"الحجم",key:"size_bytes",align:"center"},{title:"الحالة",key:"status",align:"center"},{title:"التاريخ",key:"completed_at",align:"center"},{title:"إجراءات",key:"actions",align:"end",sortable:!1}],m=async()=>{o.value=!0;try{const s=await g.getAll();i.value=s.data}finally{o.value=!1}},y=async()=>{d.value=!0;try{await g.runManual(),m()}finally{d.value=!1}},k=c(!1),B=c(!1),u=c({backup_frequency:"daily",backup_time:"03:00",backup_retention_days:7,backup_include_files:!1}),R=[{title:"يومياً",value:"daily"},{title:"أسبوعياً",value:"weekly"},{title:"شهرياً",value:"monthly"},{title:"معطل",value:"none"}],j=async()=>{k.value=!0;try{const s=await g.getSettings();s.data&&s.data[0]&&s.data.forEach(a=>{a.key==="backup_include_files"?u.value[a.key]=a.value=="1":a.key==="backup_retention_days"?u.value[a.key]=parseInt(a.value):u.value.hasOwnProperty(a.key)&&(u.value[a.key]=a.value)})}catch(s){console.error(s)}},G=async()=>{B.value=!0;try{await g.updateSettings(u.value),k.value=!1}finally{B.value=!1}},b=c(!1),w=c(null),T=c(!1),I=s=>{w.value=s,b.value=!0},O=async()=>{T.value=!0;try{await g.delete(w.value.id),b.value=!1,m()}finally{T.value=!1}},V=c(!1),$=c(!1),x=c(""),H=s=>{w.value=s,x.value="",V.value=!0},K=async()=>{if(!x.value){N.error("يرجى إدخال رمز التأكيد");return}$.value=!0;try{await g.restore(w.value.id,x.value),V.value=!1,N.info("تمت العملية، جاري إعادة تشغيل النظام..."),setTimeout(()=>{window.location.reload()},2e3)}finally{$.value=!1}},J=s=>{if(s===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB"],f=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,f)).toFixed(2))+" "+a[f]},Q=s=>{switch(s){case"success":return"success";case"failed":return"error";case"running":return"info";default:return"grey"}},W=s=>{switch(s){case"success":return"ناجح";case"failed":return"فاشل";case"running":return"قيد التنفيذ";default:return s}};return Z(()=>{m()}),(s,e)=>(te(),ee("div",ce,[v("div",pe,[e[13]||(e[13]=v("div",null,[v("h1",{class:"text-h3 font-weight-bold primary--text mb-2"},"النسخ الاحتياطي"),v("p",{class:"text-subtitle-1 text-grey-darken-1"},"إدارة النسخ الاحتياطية واستعادة النظام")],-1)),v("div",fe,[t(p,{color:"warning",variant:"tonal","prepend-icon":"ri-settings-4-line",onClick:j},{default:l(()=>e[11]||(e[11]=[r(" الإعدادات ")])),_:1}),t(p,{color:"primary","prepend-icon":"ri-database-2-line",loading:d.value,onClick:y},{default:l(()=>e[12]||(e[12]=[r(" إنشاء نسخة الآن ")])),_:1},8,["loading"])])]),t(C,{rounded:"xl",elevation:"2"},{default:l(()=>[t(h,{class:"pa-0"},{default:l(()=>[t(ae,{headers:n,items:i.value,loading:o.value,hover:"","no-data-text":"لا يوجد نسخ احتياطية مسجلة","loading-text":"جاري تحميل البيانات..."},{"item.filename":l(({item:a})=>[v("div",ve,S(a.filename),1)]),"item.size_bytes":l(({item:a})=>[r(S(J(a.size_bytes)),1)]),"item.status":l(({item:a})=>[t(le,{color:Q(a.status),size:"small",class:"font-weight-bold"},{default:l(()=>[r(S(W(a.status)),1)]),_:2},1032,["color"])]),"item.completed_at":l(({item:a})=>[r(S(new Date(a.completed_at).toLocaleString("ar-EG")),1)]),"item.actions":l(({item:a})=>[v("div",me,[t(D,{text:"تحميل"},{activator:l(({props:f})=>[t(p,U(f,{icon:"ri-download-line",variant:"text",color:"primary",size:"small",onClick:q=>se(g).download(a.id)}),null,16,["onClick"])]),_:2},1024),t(D,{text:"استعادة"},{activator:l(({props:f})=>[t(p,U(f,{icon:"ri-history-line",variant:"text",color:"warning",size:"small",onClick:q=>H(a)}),null,16,["onClick"])]),_:2},1024),t(D,{text:"حذف"},{activator:l(({props:f})=>[t(p,U(f,{icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:q=>I(a)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["items","loading"])]),_:1})]),_:1}),t(z,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a),"max-width":"500",persistent:""},{default:l(()=>[t(C,{rounded:"xl"},{default:l(()=>[t(E,{class:"pa-6 pb-2"},{default:l(()=>e[14]||(e[14]=[v("h3",{class:"text-h5 font-weight-bold"},"إعدادات النسخ التلقائي",-1)])),_:1}),t(h,{class:"pa-6 pt-2"},{default:l(()=>[t(ne,{ref:"settingsForm"},{default:l(()=>[t(oe,{modelValue:u.value.backup_frequency,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.backup_frequency=a),label:"تكرار النسخ الاحتياطي",items:R,variant:"outlined",class:"mb-4"},null,8,["modelValue"]),t(M,{modelValue:u.value.backup_time,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.backup_time=a),label:"وقت التنفيذ",type:"time",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),t(M,{modelValue:u.value.backup_retention_days,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.backup_retention_days=a),label:"فترة الاحتفاظ (بالأيام)",type:"number",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),t(re,{modelValue:u.value.backup_include_files,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.backup_include_files=a),label:"تضمين ملفات المشروع (Storage)",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1},512)]),_:1}),t(A),t(L,{class:"pa-6"},{default:l(()=>[t(F),t(p,{color:"grey-darken-1",variant:"text",onClick:e[4]||(e[4]=a=>k.value=!1)},{default:l(()=>e[15]||(e[15]=[r("إلغاء")])),_:1}),t(p,{color:"primary",variant:"flat",loading:B.value,onClick:G},{default:l(()=>e[16]||(e[16]=[r("حفظ الإعدادات")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=a=>V.value=a),"max-width":"600"},{default:l(()=>[t(C,{border:"error md",rounded:"xl"},{default:l(()=>[t(E,{class:"pa-6 pb-2 text-error d-flex align-center"},{default:l(()=>[t(ie,{icon:"ri-error-warning-line",class:"me-2"}),e[17]||(e[17]=r(" تحذير: استعادة النظام "))]),_:1}),t(h,{class:"pa-6 pt-2"},{default:l(()=>{var a;return[v("p",ge,[e[18]||(e[18]=r(" أنت على وشك استعادة النظام من نسخة ")),v("strong",null,S((a=w.value)==null?void 0:a.filename),1),e[19]||(e[19]=r(". "))]),t(ue,{type:"error",variant:"tonal",class:"mb-4 text-body-2"},{default:l(()=>e[20]||(e[20]=[r(" هذه العملية ستقوم بمسح كافة البيانات الحالية واستبدالها بالبيانات الموجودة في النسخة الاحتياطية. لا يمكن التراجع عن هذا الإجراء. ")])),_:1}),t(M,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=f=>x.value=f),label:"رمز التأكيد (Secure Token)",variant:"outlined",placeholder:"أدخل رمز الاستعادة السري",type:"password"},null,8,["modelValue"])]}),_:1}),t(A),t(L,{class:"pa-6"},{default:l(()=>[t(F),t(p,{color:"grey-darken-1",variant:"text",onClick:e[7]||(e[7]=a=>V.value=!1)},{default:l(()=>e[21]||(e[21]=[r("إلغاء")])),_:1}),t(p,{color:"error",variant:"flat",loading:$.value,onClick:K},{default:l(()=>e[22]||(e[22]=[r(" تأكيد الاستعادة الآن ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a),"max-width":"400"},{default:l(()=>[t(C,{rounded:"xl"},{default:l(()=>[t(E,{class:"pa-6 pb-2"},{default:l(()=>e[23]||(e[23]=[r("حذف نسخة احتياطية")])),_:1}),t(h,{class:"pa-6 pt-2"},{default:l(()=>e[24]||(e[24]=[r(" هل أنت متأكد من حذف هذا الملف؟ لن تتمكن من استعادة البيانات منه لاحقاً. ")])),_:1}),t(L,{class:"pa-6"},{default:l(()=>[t(F),t(p,{color:"grey-darken-1",variant:"text",onClick:e[9]||(e[9]=a=>b.value=!1)},{default:l(()=>e[25]||(e[25]=[r("تراجع")])),_:1}),t(p,{color:"error",variant:"flat",loading:T.value,onClick:O},{default:l(()=>e[26]||(e[26]=[r("حذف نهائي")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},be=Y(ye,[["__scopeId","data-v-ff4ce963"]]);export{be as default};
