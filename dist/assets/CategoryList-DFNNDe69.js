import{r as d,I as ae,x as le,o as n,s as r,w as o,b as t,a7 as Ue,a as i,g as k,c as C,t as u,C as A,E as L,$ as Je,y as De,z as de,A as te,B as H,l as m,N as _e,at as Te,a1 as Qe,u as c,d as xe,F as be,h as Ie,f as We,i as Pe,j as O,e as G,aC as Ye,m as Le,S as Me,p as He,au as Re,v as Ke,J as Xe,ak as Ze,P as ee,av as el}from"./index-CuR9-sbN.js";import{u as Se}from"./useApi-CjhFmPue.js";import{A as qe}from"./AppDataTable-CnA5lOqV.js";import{A as ke}from"./AppDialog-vLCI3uF9.js";import{_ as S}from"./AppButton-CREzoRf6.js";import{_ as Ce}from"./AppInput-06Y7zOXl.js";import{A as ve}from"./AppSwitch-CXzOvU1j.js";import{_ as Ee}from"./AppCard-CXpBKc1t.js";import{_ as je}from"./LoadingSpinner-vBlED74H.js";import{_ as Be}from"./EmptyState-FFeUUxeu.js";import{A as Oe}from"./AppInfiniteScroll-616_I-vy.js";import{M as Ge}from"./MediaGallery-DgiLIKzw.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Fe(){const N=Se("/api/categories"),M=d([]),v=d(!1),w=d(0);return{categories:M,loading:v,total:w,fetchCategories:async(V={},D={})=>{var F;const{append:h=!1}=D;v.value=!0;try{const _=await N.get(V,{showLoading:!1});let p=[],f=0;return _.data&&Array.isArray(_.data.data)?(p=_.data.data,f=((F=_.data.meta)==null?void 0:F.total)||_.data.data.length):(p=_.data||[],f=_.total||p.length),h?M.value=[...M.value,...p]:M.value=p,w.value=f,_}catch(_){throw M.value=[],w.value=0,_}finally{v.value=!1}},deleteCategory:async V=>await N.remove(V,{successMessage:"تم حذف الفئة بنجاح"})}}const ll={class:"d-flex align-center gap-3"},al={class:"d-flex flex-column"},tl={key:0,class:"text-white text-caption opacity-80"},ol={class:"pa-4 bg-grey-lighten-4 border-b"},nl=["onClick"],il={key:0,class:"mb-4 bg-white rounded-xl border border-primary-lighten-4 overflow-hidden elevation-sm"},sl={class:"pa-4 d-flex align-sm-center flex-column flex-sm-row gap-4"},rl={class:"flex-grow-1"},dl={class:"d-flex align-center gap-2 mb-1"},ul={class:"text-h5 font-weight-bold text-primary"},cl={key:0,class:"text-body-2 text-grey-darken-1 mb-3"},vl={key:1,class:"text-body-2 text-grey-lighten-2 italic mb-3"},pl={class:"d-flex flex-column gap-3"},fl={class:"d-flex flex-wrap gap-4"},ml={class:"d-flex align-center gap-1"},gl={class:"text-caption font-weight-bold"},yl={class:"d-flex align-center gap-1"},hl={class:"text-caption font-weight-bold"},_l={class:"d-flex align-center gap-2 flex-wrap"},xl={class:"d-flex align-center gap-3 flex-wrap"},bl={class:"d-flex align-center gap-2"},kl={class:"categories-list-area"},Cl={class:"pa-4 d-flex align-center justify-center bg-grey-lighten-4 position-relative overflow-hidden",style:{height:"120px"}},wl={class:"d-flex align-center justify-space-between mt-1"},Vl={class:"d-flex gap-1"},$l=["onClick"],zl={class:"font-weight-bold"},Ul={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},El={__name:"CategoryExplorerDialog",props:{modelValue:Boolean,initialCategory:Object},emits:["update:modelValue","update-root"],setup(N,{emit:M}){const v=N,w=M,K=Le(),pe=Me(),{categories:V,loading:D,total:h,fetchCategories:F,deleteCategory:_}=Fe(),p=Se("/api/categories"),f=d(null);ae(f,l=>{v.modelValue&&l&&K.replace({query:{...pe.query,category_id:l}})});const J=d([]),g=d(1),R=d(12),T=d(""),x=d("grid"),X=d(null),y=d(null),Q=d(!1),q=d(!1),I=d(!1),j=d(null),U=d(null),B=d(!1),oe=d(null),W=d(null),E=d({name:"",active:1,parent_id:null,image_id:null}),Y=le(()=>{var l;return!!((l=U.value)!=null&&l.id)}),fe=[{title:"القسم",key:"name",sortable:!0},{title:"المنتجات",key:"products_count",align:"center"},{title:"الحالة",key:"active",align:"center"},{title:"الإجراءات",key:"actions",align:"end"}],b=le(()=>{var e,a,z;const l=[{title:(e=v.initialCategory)==null?void 0:e.name,value:(a=v.initialCategory)==null?void 0:a.id,disabled:f.value===((z=v.initialCategory)==null?void 0:z.id)}];return J.value.forEach((he,Yl)=>{var Ae;he.id!==((Ae=v.initialCategory)==null?void 0:Ae.id)&&l.push({title:he.name,value:he.id,disabled:he.id===f.value})}),l});let ne;const we=()=>{clearTimeout(ne),ne=setTimeout(()=>{g.value=1,P()},500)},P=(l={})=>{const e=l===!0;F({page:g.value,per_page:R.value,search:T.value,parent_id:f.value},{append:e})},ue=async()=>{try{const l=await p.request("get",`/${f.value}/breadcrumbs`);J.value=l.data||[]}catch(l){console.error("Error fetching breadcrumbs:",l)}},ie=async()=>{if(f.value)try{const l=await p.request("get",`/${f.value}`);y.value=l.data}catch(l){console.error("Error fetching current category:",l)}},se=l=>{f.value=l.id,g.value=1,P(),ue(),ie()},Ve=l=>{f.value=l.value,g.value=1,P(),ue(),ie()},re=l=>{l.products_count>0?(K.push({path:"/products",query:{category_id:l.id}}),w("update:modelValue",!1)):He.info("لا توجد منتجات في هذا القسم حالياً")},$e=()=>{D.value||V.value.length>=h.value||(g.value++,P(!0))},ze=()=>{x.value==="list"&&P()},Z=()=>{U.value=null,E.value={name:"",active:1,parent_id:f.value,image_id:null},j.value=null,Q.value=!0},ce=l=>{U.value=l,E.value={...l,active:l.active?1:0,image_id:l.image_id||null},j.value=l.image_url||null,Q.value=!0},me=l=>{E.value.image_id=l.id,j.value=l.url,I.value=!1},ge=l=>{U.value=l,q.value=!0},ye=async l=>{X.value=l.id;try{const e=l.active?0:1;await p.request("patch",`/${l.id}/toggle`),l.active=e,w("update-root")}finally{X.value=null}},$=async()=>{const{valid:l}=await oe.value.validate();if(l){B.value=!0;try{Y.value?await p.update(U.value.id,E.value):await p.create(E.value),Q.value=!1,P(),w("update-root")}finally{B.value=!1}}},s=async()=>{try{await _(U.value.id),q.value=!1,P(),w("update-root")}catch(l){console.error("Delete error:",l)}};return ae(()=>v.modelValue,l=>{l&&v.initialCategory&&(f.value=v.initialCategory.id,g.value=1,P(),ue(),ie())}),ae(b,()=>{setTimeout(()=>{W.value&&(W.value.scrollLeft=W.value.scrollWidth)},100)},{deep:!0}),(l,e)=>(n(),r(Ye,{"model-value":N.modelValue,"max-width":"1200","onUpdate:modelValue":e[14]||(e[14]=a=>l.$emit("update:modelValue",a)),scrollable:""},{default:o(()=>[t(We,{class:"explorer-dialog-card rounded-xl"},{default:o(()=>[t(Ue,{class:"pa-4 bg-primary d-flex align-center justify-space-between"},{default:o(()=>[i("div",ll,[t(k,{icon:"ri-folder-open-line",color:"white"}),i("div",al,[e[15]||(e[15]=i("span",{class:"text-white text-h6 line-height-1"},"تصفح الأقسام",-1)),N.initialCategory?(n(),C("span",tl,"مستكشف: "+u(N.initialCategory.name),1)):A("",!0)])]),t(L,{icon:"ri-close-line",variant:"text",color:"white",onClick:e[0]||(e[0]=a=>l.$emit("update:modelValue",!1))})]),_:1}),i("div",ol,[i("div",{ref_key:"breadcrumbsContainer",ref:W,class:"breadcrumbs-scroll-container mb-4"},[t(Je,{items:b.value,class:"pa-0"},{divider:o(()=>[t(k,{icon:"ri-arrow-left-s-line",size:"x-small",color:"grey-lighten-1"})]),item:o(({item:a})=>[i("span",{class:De(["text-subtitle-1 font-weight-bold cursor-pointer transition-all hover-primary no-wrap",{"text-primary":!a.disabled,"text-grey-darken-1":a.disabled}]),onClick:z=>!a.disabled&&Ve(a)},u(a.title),11,nl)]),_:1},8,["items"])],512),y.value&&!T.value?(n(),C("div",il,[i("div",sl,[t(de,{size:"100",rounded:"lg",color:"primary-lighten-5",class:"border"},{default:o(()=>[y.value.image_url?(n(),r(te,{key:0,src:y.value.image_url,cover:""},null,8,["src"])):(n(),r(k,{key:1,icon:"ri-folder-open-fill",size:"48",color:"primary"}))]),_:1}),i("div",rl,[i("div",dl,[i("h2",ul,u(y.value.name),1),t(H,{color:y.value.active?"success":"error",size:"x-small",variant:"flat",class:"font-weight-bold"},{default:o(()=>[m(u(y.value.active?"نشط":"معطل"),1)]),_:1},8,["color"])]),y.value.description?(n(),C("p",cl,u(y.value.description),1)):(n(),C("p",vl,"لا يوجد وصف لهذا القسم")),i("div",pl,[i("div",fl,[i("div",ml,[t(k,{icon:"ri-shopping-bag-3-fill",size:"small",color:"secondary"}),i("span",gl,u(y.value.products_count||0)+" منتج",1)]),i("div",yl,[t(k,{icon:"ri-folders-fill",size:"small",color:"info"}),i("span",hl,u(y.value.children_count||0)+" قسم فرعي",1)])]),i("div",_l,[y.value.products_count>0?(n(),r(S,{key:0,"prepend-icon":"ri-eye-line",color:"secondary",variant:"tonal",size:"small",class:"rounded-pill font-weight-bold",onClick:e[1]||(e[1]=a=>re(y.value))},{default:o(()=>e[16]||(e[16]=[m(" عرض المنتجات ")])),_:1})):A("",!0),t(S,{"prepend-icon":"ri-edit-line",color:"primary",variant:"tonal",size:"small",class:"rounded-pill font-weight-bold",onClick:e[2]||(e[2]=a=>ce(y.value))},{default:o(()=>e[17]||(e[17]=[m(" تعديل البيانات ")])),_:1})])])])])])):A("",!0),i("div",xl,[t(Ce,{modelValue:T.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>T.value=a),we],label:"بحث في هذا القسم...","prepend-inner-icon":"ri-search-line",density:"compact","hide-details":"",class:"max-width-300 flex-grow-1 flex-sm-grow-0"},null,8,["modelValue"]),t(_e,{class:"d-none d-sm-block"}),i("div",bl,[t(S,{"prepend-icon":"ri-add-line",color:"primary",variant:"flat",class:"font-weight-bold",onClick:Z},{default:o(()=>e[18]||(e[18]=[m(" إضافة قسم فرعي ")])),_:1}),t(Te,{variant:"outlined",density:"comfortable",color:"primary"},{default:o(()=>[t(L,{active:x.value==="grid",icon:"ri-grid-fill",onClick:e[4]||(e[4]=a=>x.value="grid")},null,8,["active"]),t(L,{active:x.value==="list",icon:"ri-list-check",onClick:e[5]||(e[5]=a=>x.value="list")},null,8,["active"])]),_:1})])])]),t(Qe,{class:"pa-4 explorer-content"},{default:o(()=>[i("div",kl,[c(D)&&!c(V).length?(n(),r(je,{key:0,size:"64",text:"جاري تحميل الأقسام..."})):c(V).length?(n(),C(be,{key:2},[x.value==="grid"?(n(),r(Oe,{key:0,loading:c(D)&&c(V).length>0,"has-more":c(V).length<c(h),onLoad:$e},{default:o(()=>[t(xe,null,{default:o(()=>[(n(!0),C(be,null,Ie(c(V),a=>(n(),r(G,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[t(Ee,{class:"category-card h-100","no-padding":"",onClick:z=>se(a)},{actions:o(()=>[t(H,{color:a.active?"success":"error",size:"x-small",variant:"flat",class:"font-weight-bold"},{default:o(()=>[m(u(a.active?"نشط":"معطل"),1)]),_:2},1032,["color"]),t(_e),i("div",Vl,[a.products_count>0?(n(),r(L,{key:0,icon:"ri-shopping-bag-3-line",variant:"text",color:"secondary",size:"x-small",title:"عرض المنتجات",onClick:O(z=>re(a),["stop"])},null,8,["onClick"])):A("",!0),t(L,{icon:"ri-edit-line",variant:"text",color:"primary",size:"x-small",onClick:O(z=>ce(a),["stop"])},null,8,["onClick"]),t(L,{icon:"ri-delete-bin-line",variant:"text",color:"error",size:"x-small",onClick:O(z=>ge(a),["stop"])},null,8,["onClick"])])]),default:o(()=>[i("div",Cl,[a.image_url?(n(),r(te,{key:0,src:a.image_url,cover:"",class:"position-absolute fill-height w-100"},null,8,["src"])):(n(),r(k,{key:1,icon:a.children_count>0?"ri-folder-fill":"ri-folder-line",size:"48",color:a.active?a.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),t(Re,{class:"pt-2"},{default:o(()=>[t(Ue,{class:"text-subtitle-1 font-weight-bold pa-0 text-truncate"},{default:o(()=>[m(u(a.name),1)]),_:2},1024),i("div",wl,[t(H,{color:a.active?"success":"error",size:"x-small",variant:"flat",class:"font-weight-bold"},{default:o(()=>[m(u(a.active?"نشط":"معطل"),1)]),_:2},1032,["color"]),t(H,{size:"x-small",variant:"text",class:"text-grey"},{default:o(()=>[m(u(a.products_count)+" منتج ",1)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),r(qe,{key:1,headers:fe,items:c(V),"total-items":c(h),loading:c(D),page:g.value,"onUpdate:page":e[6]||(e[6]=a=>g.value=a),"items-per-page":R.value,"onUpdate:itemsPerPage":e[7]||(e[7]=a=>R.value=a),"can-view":!1,"can-edit":!1,"can-delete":!1,"onUpdate:options":ze},{"item.name":o(({item:a})=>[i("div",{class:"d-flex align-center py-2 cursor-pointer",onClick:z=>se(a)},[t(de,{size:"32",rounded:"sm",color:"grey-lighten-4",class:"me-3 border overflow-hidden"},{default:o(()=>[a.image_url?(n(),r(te,{key:0,src:a.image_url,cover:""},null,8,["src"])):(n(),r(k,{key:1,icon:a.children_count>0?"ri-folder-fill":"ri-folder-line",size:"18",color:a.active?a.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),_:2},1024),i("span",zl,u(a.name),1)],8,$l)]),"item.active":o(({item:a})=>[t(ve,{"model-value":!!a.active,loading:X.value===a.id,"onUpdate:modelValue":z=>ye(a)},null,8,["model-value","loading","onUpdate:modelValue"])]),"extra-actions":o(({item:a})=>[a.products_count>0?(n(),r(L,{key:0,icon:"ri-shopping-bag-3-line",variant:"text",color:"secondary",size:"small",title:"عرض المنتجات",onClick:z=>re(a)},null,8,["onClick"])):A("",!0),t(L,{icon:"ri-arrow-right-up-line",variant:"text",color:"info",size:"small",onClick:z=>se(a)},null,8,["onClick"]),t(L,{icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:z=>ce(a)},null,8,["onClick"]),t(L,{icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:z=>ge(a)},null,8,["onClick"])]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(n(),r(Be,{key:1,icon:"ri-folder-open-line",title:"لا توجد أقسام فرعية",message:T.value?"لا توجد نتائج تطابق بحثك":"يمكنك البدء بإضافة أقسام فرعية لهذا القسم","show-action":!0,"action-text":"إضافة قسم فرعي",onAction:Z},null,8,["message"]))])]),_:1})]),_:1}),t(ke,{modelValue:Q.value,"onUpdate:modelValue":e[11]||(e[11]=a=>Q.value=a),title:Y.value?"تعديل القسم الفرعي":"قسم فرعي جديد",icon:Y.value?"ri-edit-line":"ri-add-line",loading:B.value,onConfirm:$},{default:o(()=>[t(Pe,{ref_key:"formRef",ref:oe,onSubmit:O($,["prevent"])},{default:o(()=>[t(xe,null,{default:o(()=>[t(G,{cols:"12",class:"d-flex justify-center mb-4"},{default:o(()=>[i("div",{class:"category-image-zone position-relative cursor-pointer",onClick:e[8]||(e[8]=a=>I.value=!0)},[t(de,{size:"100",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:o(()=>[j.value?(n(),r(te,{key:0,src:j.value,cover:""},null,8,["src"])):(n(),r(k,{key:1,icon:"ri-image-add-line",size:"32",color:"grey-lighten-1"})),i("div",Ul,[t(k,{icon:"ri-exchange-line",color:"white",size:"20"}),e[19]||(e[19]=i("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الصورة",-1))])]),_:1})])]),_:1}),t(G,{cols:"12"},{default:o(()=>[t(Ce,{modelValue:E.value.name,"onUpdate:modelValue":e[9]||(e[9]=a=>E.value.name=a),label:"اسم القسم *",rules:[a=>!!a||"مطلوب"]},null,8,["modelValue","rules"])]),_:1}),t(G,{cols:"12"},{default:o(()=>[t(ve,{modelValue:E.value.active,"onUpdate:modelValue":e[10]||(e[10]=a=>E.value.active=a),label:"نشط","true-value":1,"false-value":0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),t(ke,{modelValue:q.value,"onUpdate:modelValue":e[12]||(e[12]=a=>q.value=a),title:"تأكيد الحذف",icon:"ri-delete-bin-line","confirm-color":"error",onConfirm:s},{default:o(()=>{var a;return[e[20]||(e[20]=m(' هل أنت متأكد من حذف القسم الفرعي "')),i("strong",null,u((a=U.value)==null?void 0:a.name),1),e[21]||(e[21]=m('"؟ '))]}),_:1},8,["modelValue"]),t(Ge,{modelValue:I.value,"onUpdate:modelValue":e[13]||(e[13]=a=>I.value=a),type:"category",onSelect:me},null,8,["modelValue"])]),_:1},8,["model-value"]))}},Sl=Ne(El,[["__scopeId","data-v-7a71bad7"]]),Al={class:"categories-page"},Dl={class:"page-header d-flex align-center justify-space-between mb-6"},Tl={class:"d-flex align-center flex-wrap gap-4"},Il={key:1,class:"content-container"},Pl={class:"category-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Ll={class:"child-count-badge position-absolute",style:{top:"10px",left:"10px"}},Ml={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},Rl={class:"d-flex align-center"},ql={key:0,class:"text-truncate"},jl={key:1,class:"text-grey-darken-1"},Bl=["onClick"],Ol={class:"d-flex flex-column"},Gl={class:"font-weight-bold text-subtitle-1"},Nl={class:"text-caption text-grey"},Fl={key:1,class:"text-grey text-caption"},Jl={class:"d-flex align-center justify-center"},Ql={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},Wl={__name:"CategoryList",setup(N){const M=(s,l)=>{let e;return(...a)=>{e&&clearTimeout(e),e=setTimeout(()=>s(...a),l)}},{categories:v,loading:w,total:K,fetchCategories:pe,deleteCategory:V}=Fe(),D=Se("/api/categories"),h=Ke(),F=Me(),_=Le(),p=d(1),f=d(12),J=d(""),g=d("grid"),R=d(!1),T=d(!1),x=d(null),X=d(!1),y=d(!1),Q=d(null),q=d(null),I=d(!1),j=d(null),U=d(!1),B=d(null),oe=le(()=>h.hasPermission(ee.ADMIN_SUPER)),W=le(()=>h.hasPermission(ee.ADMIN_COMPANY)),E=le(()=>oe.value||W.value||h.hasPermission(ee.CATEGORIES_CREATE)),Y=s=>{var l;return oe.value||W.value?!0:h.hasPermission(ee.CATEGORIES_UPDATE_ALL)||h.hasPermission(ee.CATEGORIES_UPDATE_SELF)&&s.created_by===((l=h.currentUser)==null?void 0:l.id)},fe=s=>{var l;return oe.value||W.value?!0:h.hasPermission(ee.CATEGORIES_DELETE_ALL)||h.hasPermission(ee.CATEGORIES_DELETE_SELF)&&s.created_by===((l=h.currentUser)==null?void 0:l.id)},b=d({name:"",parent_id:null,active:1,image_id:null}),ne=le(()=>{var s;return!!((s=x.value)!=null&&s.id)}),we=le(()=>v.value.filter(s=>{var l;return s.id!==((l=x.value)==null?void 0:l.id)})),P=[{title:"الفئة",key:"name",sortable:!0},{title:"الفئة الرئيسية",key:"parent",sortable:!0},{title:"الحالة",key:"active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],ue={required:s=>!!s||"مطلوب"},ie=()=>{x.value=null,b.value={name:"",parent_id:null,active:1,image_id:null},B.value=null,R.value=!0},se=s=>{x.value=s,b.value={...s,active:s.active?1:0,parent_id:s.parent_id||null,image_id:s.image_id||null},B.value=s.image_url||null,R.value=!0},Ve=s=>{b.value.image_id=s.id,B.value=s.url,U.value=!1},re=async s=>{q.value=s.id;try{const l=s.active?0:1;await D.request("patch",`/${s.id}/toggle`),s.active=l}finally{q.value=null}},$e=M(()=>{p.value=1,$()},500),ze=()=>{w.value||v.value.length>=K.value||(p.value++,$(!0))},Z=s=>{j.value=s,I.value=!0},ce=s=>{g.value==="list"&&$()},me=async()=>{const{valid:s}=await Q.value.validate();if(s){X.value=!0;try{ne.value?await D.update(x.value.id,b.value,{successMessage:"تم التحديث بنجاح"}):await D.create(b.value,{successMessage:"تم الإضافة بنجاح"}),R.value=!1,$()}finally{X.value=!1}}},ge=async()=>{y.value=!0;try{await V(x.value.id),T.value=!1,$()}finally{y.value=!1}},ye=s=>{x.value=s,T.value=!0},$=(s={})=>{const l=s===!0;pe({page:p.value,per_page:f.value,search:J.value,parent_id:J.value?null:"null"},{append:l})};return Xe(async()=>{const s=F.query.category_id;if(s)try{const l=await D.request("get",`/${s}`);l.data&&(j.value=l.data,I.value=!0)}catch{_.replace({query:{...F.query,category_id:void 0}})}$()}),ae(I,s=>{if(!s){const{category_id:l,...e}=F.query;_.replace({query:e})}}),ae(p,()=>{g.value==="list"&&$()}),ae(f,()=>{g.value==="list"&&(p.value=1,$())}),ae(g,()=>{p.value=1,$()}),(s,l)=>(n(),C("div",Al,[i("div",Dl,[l[15]||(l[15]=i("div",null,[i("h1",{class:"text-h4 font-weight-bold ml-2"},"الفئات"),i("p",{class:"text-body-1 text-grey"},"إدارة وتحليل فئات المنتجات")],-1)),E.value?(n(),r(S,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:ie},{default:o(()=>l[14]||(l[14]=[m(" فئة جديدة ")])),_:1})):A("",!0)]),t(Ee,{class:"mb-6"},{default:o(()=>[i("div",Tl,[t(Ce,{modelValue:J.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>J.value=e),c($e)],label:"بحث عن فئة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t(_e),t(Te,{variant:"outlined",density:"comfortable",color:"primary"},{default:o(()=>[t(S,{active:g.value==="grid",icon:"ri-grid-fill",onClick:l[1]||(l[1]=e=>g.value="grid"),title:"عرض شبكي"},null,8,["active"]),t(S,{active:g.value==="list",icon:"ri-list-check",onClick:l[2]||(l[2]=e=>g.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),c(w)&&!c(v).length?(n(),r(je,{key:0,size:"64",text:"جاري تحميل الفئات..."})):(n(),C("div",Il,[c(v).length?(n(),C(be,{key:1},[g.value==="grid"?(n(),r(Oe,{key:0,loading:c(w)&&c(v).length>0,"has-more":c(v).length<c(K),"no-more-text":"لا يوجد المزيد من الفئات",onLoad:ze},{default:o(()=>[t(xe,null,{default:o(()=>[(n(!0),C(be,null,Ie(c(v),e=>(n(),r(G,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:o(()=>[t(Ee,{class:"category-card h-100","no-padding":"",onClick:a=>Z(e)},{actions:o(()=>[t(S,{"prepend-icon":"ri-arrow-right-up-line",variant:"text",color:"info",size:"small",onClick:O(a=>Z(e),["stop"])},{default:o(()=>l[17]||(l[17]=[m(" دخول ")])),_:2},1032,["onClick"]),t(_e),t(S,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:O(a=>se(e),["stop"])},null,8,["onClick"]),fe(e)?(n(),r(S,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:O(a=>ye(e),["stop"])},null,8,["onClick"])):A("",!0)]),default:o(()=>[i("div",Pl,[t(de,{size:"100",rounded:"circle",color:e.active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white overflow-hidden"},{default:o(()=>[e.image_url?(n(),r(te,{key:0,src:e.image_url,cover:""},null,8,["src"])):(n(),r(k,{key:1,icon:e.children_count>0?"ri-folder-fill":"ri-folder-line",size:"60",color:e.active?e.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),_:2},1032,["color"]),i("div",Ll,[e.products_count?(n(),r(H,{key:0,size:"x-small",color:"secondary",variant:"flat"},{default:o(()=>[m(u(e.products_count)+" منتج ",1)]),_:2},1024)):A("",!0)])]),t(Re,{class:"position-relative pt-4"},{default:o(()=>[t(Ue,{class:"text-h6 font-weight-bold pa-0 mb-1 text-truncate"},{default:o(()=>[m(u(e.name),1)]),_:2},1024),i("div",Ml,[i("div",Rl,[l[16]||(l[16]=i("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),t(H,{color:e.active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:o(()=>[m(u(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),Y(e)?(n(),r(ve,{key:0,"model-value":!!e.active,loading:q.value===e.id,onClick:l[3]||(l[3]=O(()=>{},["stop"])),"onUpdate:modelValue":a=>re(e)},null,8,["model-value","loading","onUpdate:modelValue"])):A("",!0)]),t(el,{class:"pa-0 d-flex align-center mt-1"},{default:o(()=>{var a;return[t(k,{icon:"ri-node-tree",size:"14",class:"me-1"}),(a=e.parent)!=null&&a.name?(n(),C("span",ql,"داخل "+u(e.parent.name),1)):(n(),C("span",jl,"قسم رئيسي"))]}),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),r(qe,{key:1,headers:P,items:c(v),"total-items":c(K),loading:c(w),page:p.value,"onUpdate:page":l[4]||(l[4]=e=>p.value=e),"items-per-page":f.value,"onUpdate:itemsPerPage":l[5]||(l[5]=e=>f.value=e),searchable:!1,"can-view":!1,"can-edit":!1,"can-delete":!1,"onUpdate:options":ce},{"item.name":o(({item:e})=>[i("div",{class:"d-flex align-center py-2 cursor-pointer",onClick:a=>Z(e)},[t(de,{size:"48",rounded:"circle",color:e.active?"bg-white":"grey-lighten-4",class:"me-3 border overflow-hidden"},{default:o(()=>[e.image_url?(n(),r(te,{key:0,src:e.image_url,cover:""},null,8,["src"])):(n(),r(k,{key:1,icon:e.children_count>0?"ri-folder-fill":"ri-folder-line",size:"24",color:e.active?e.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),_:2},1032,["color"]),i("div",Ol,[i("span",Gl,u(e.name),1),i("span",Nl,"كود: "+u(e.id),1)])],8,Bl)]),"item.parent":o(({item:e})=>{var a;return[(a=e.parent)!=null&&a.name?(n(),r(H,{key:0,size:"small",variant:"tonal",color:"info","prepend-icon":"ri-corner-down-right-line"},{default:o(()=>[m(u(e.parent.name),1)]),_:2},1024)):(n(),C("span",Fl,"قسم رئيسي"))]}),"item.active":o(({item:e})=>[i("div",Jl,[Y(e)?(n(),C("span",{key:0,class:De(["text-caption me-2 font-weight-bold",e.active?"text-success":"text-error"])},u(e.active?"نشط":"معطل"),3)):A("",!0),Y(e)?(n(),r(ve,{key:1,"model-value":!!e.active,loading:q.value===e.id,"onUpdate:modelValue":a=>re(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(n(),r(H,{key:2,color:e.active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:o(()=>[m(u(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":o(({item:e})=>[t(S,{icon:"ri-arrow-right-up-line",variant:"text",color:"info",size:"small",onClick:a=>Z(e),title:"دخول القسم"},null,8,["onClick"]),Y(e)?(n(),r(S,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:a=>se(e)},null,8,["onClick"])):A("",!0),fe(e)?(n(),r(S,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:a=>ye(e)},null,8,["onClick"])):A("",!0)]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(n(),r(Be,{key:0,icon:"ri-folder-line",title:"لا توجد فئات حالياً",message:J.value?"لا توجد نتائج تطابق بحثك":"ابدأ بإضافة أول فئة لنظامك","show-action":E.value,"action-text":"إضافة فئة",onAction:ie},null,8,["message","show-action"]))])),t(ke,{modelValue:R.value,"onUpdate:modelValue":l[10]||(l[10]=e=>R.value=e),title:ne.value?"تعديل الفئة":"فئة جديدة",icon:ne.value?"ri-edit-line":"ri-add-line",loading:X.value,onConfirm:me},{default:o(()=>[t(Pe,{ref_key:"formRef",ref:Q,onSubmit:O(me,["prevent"])},{default:o(()=>[t(xe,null,{default:o(()=>[t(G,{cols:"12",class:"d-flex justify-center mb-4"},{default:o(()=>[i("div",{class:"category-image-zone position-relative cursor-pointer",onClick:l[6]||(l[6]=e=>U.value=!0)},[t(de,{size:"120",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:o(()=>[B.value?(n(),r(te,{key:0,src:B.value,cover:""},null,8,["src"])):(n(),r(k,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),i("div",Ql,[t(k,{icon:"ri-exchange-line",color:"white",size:"24"}),l[18]||(l[18]=i("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الصورة",-1))])]),_:1})])]),_:1}),t(G,{cols:"12"},{default:o(()=>[t(Ce,{modelValue:b.value.name,"onUpdate:modelValue":l[7]||(l[7]=e=>b.value.name=e),label:"اسم الفئة *",rules:[ue.required]},null,8,["modelValue","rules"])]),_:1}),t(G,{cols:"12"},{default:o(()=>[t(Ze,{modelValue:b.value.parent_id,"onUpdate:modelValue":l[8]||(l[8]=e=>b.value.parent_id=e),items:we.value,"item-title":"name","item-value":"id",label:"الفئة الرئيسية",variant:"outlined",density:"comfortable",clearable:"",placeholder:"اختر الفئة الرئيسية (اختياري)"},null,8,["modelValue","items"])]),_:1}),t(G,{cols:"12"},{default:o(()=>[t(ve,{modelValue:b.value.active,"onUpdate:modelValue":l[9]||(l[9]=e=>b.value.active=e),label:"نشط","true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),t(ke,{modelValue:T.value,"onUpdate:modelValue":l[11]||(l[11]=e=>T.value=e),title:"تأكيد الحذف",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف",loading:y.value,onConfirm:ge},{default:o(()=>{var e;return[l[19]||(l[19]=m(' هل أنت متأكد من حذف "')),i("strong",null,u((e=x.value)==null?void 0:e.name),1),l[20]||(l[20]=m('"؟ '))]}),_:1},8,["modelValue","loading"]),t(Sl,{modelValue:I.value,"onUpdate:modelValue":l[12]||(l[12]=e=>I.value=e),"initial-category":j.value,onUpdateRoot:$},null,8,["modelValue","initial-category"]),t(Ge,{modelValue:U.value,"onUpdate:modelValue":l[13]||(l[13]=e=>U.value=e),type:"category",onSelect:Ve},null,8,["modelValue"])]))}},da=Ne(Wl,[["__scopeId","data-v-a36a4e3e"]]);export{da as default};
