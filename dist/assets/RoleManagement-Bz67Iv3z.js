import{u as K}from"./user.store-Dse4wz8q.js";import{_ as M}from"./AppButton-Dj4u5ybH.js";import{_ as B}from"./AppInput-CufQk24k.js";import{a as N,r as I,z as ee,o as d,c as _,b as a,d as e,w as t,f as z,x as O,H as S,i as w,n as c,v as y,E as $,e as T,F as L,j as A,P as W,R as X,Q as D,a8 as le,a4 as F,A as te,a5 as se,h as U,a3 as G,k as ae,D as q,O as Y,aJ as Z,an as H,L as ie,u as j,aI as J,B as Q,G as ne,a0 as oe,M as re}from"./index-98ieInin.js";const de={class:"permission-selector"},ue={class:"pa-4 bg-white border-b sticky-top z-10 rounded-t-lg"},ce={key:0,class:"mt-3 text-caption text-warning d-flex align-center gap-2"},me={class:"permissions-scroll-area pa-4 bg-grey-lighten-5"},fe={class:"d-flex align-center gap-2 mb-3 px-2"},pe={class:"font-weight-black text-subtitle-1"},ge={class:"font-weight-medium"},ve={key:0,class:"text-caption text-primary ms-2 italic"},be={key:0,class:"text-center pa-12"},ye={__name:"PermissionSelector",props:{modelValue:{type:Array,default:()=>[]},availablePermissions:{type:Object,required:!0},inheritedPermissions:{type:Array,default:()=>[]},showExpertToggle:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(x,{emit:v}){const i=x,m=v,h=I(""),V=I(!1),f=u=>i.modelValue.includes(u),k=u=>i.inheritedPermissions.includes(u),E=u=>{if(k(u))return;const n=[...i.modelValue],o=n.indexOf(u);o>-1?n.splice(o,1):n.push(u),m("update:modelValue",n)},r=ee(()=>{const u={},n=h.value.toLowerCase();return Object.entries(i.availablePermissions).forEach(([o,b])=>{const p={name:b.name};let g=!1;b.name.label.toLowerCase().includes(n)?(g=!0,Object.entries(b).forEach(([C,P])=>{C!=="name"&&(p[C]=P)})):Object.entries(b).forEach(([C,P])=>{C!=="name"&&(P.label.toLowerCase().includes(n)||P.key.toLowerCase().includes(n))&&(p[C]=P,g=!0)}),g&&(u[o]=p)}),u}),l=u=>({admin:"ri-admin-line",companies:"ri-community-line",users:"ri-user-settings-line",warehouses:"ri-home-gear-line",products:"ri-box-3-line",invoices:"ri-file-list-3-line",transactions:"ri-hand-coin-line",cash_boxes:"ri-safe-2-line"})[u]||"ri-folder-keyhole-line",s=u=>Object.entries(u).filter(([o])=>o!=="name").map(([,o])=>o.key).every(o=>f(o)||k(o)),R=u=>{const n=Object.entries(u).filter(([p])=>p!=="name").map(([,p])=>p.key),o=s(u);let b=[...i.modelValue];n.forEach(p=>{if(k(p))return;const g=b.indexOf(p);o?g>-1&&b.splice(b.indexOf(p),1):g===-1&&b.push(p)}),m("update:modelValue",b)};return(u,n)=>(d(),_("div",de,[a("div",ue,[e(T,{align:"center",dense:""},{default:t(()=>[e(z,{cols:"12",sm:x.showExpertToggle?8:12},{default:t(()=>[e(B,{modelValue:h.value,"onUpdate:modelValue":n[0]||(n[0]=o=>h.value=o),placeholder:"ابحث عن صلاحية محددة...","prepend-inner-icon":"ri-search-line","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1},8,["sm"]),x.showExpertToggle?(d(),O(z,{key:0,cols:"12",sm:"4",class:"text-end"},{default:t(()=>[e(S,{variant:"text",size:"small",color:"primary",onClick:n[1]||(n[1]=o=>V.value=!V.value)},{default:t(()=>[e(w,{icon:V.value?"ri-eye-line":"ri-settings-4-line",class:"me-1"},null,8,["icon"]),c(" "+y(V.value?"الوضع المبسط":"وضع الخبير"),1)]),_:1})]),_:1})):$("",!0)]),_:1}),V.value&&x.showExpertToggle?(d(),_("div",ce,[e(w,{icon:"ri-error-warning-line",size:"14"}),n[2]||(n[2]=c(" تنبيه: أنت تقوم بتعديل الصلاحيات المباشرة بدقة. "))])):$("",!0)]),a("div",me,[(d(!0),_(L,null,A(r.value,(o,b)=>{var p;return d(),_("div",{key:b,class:"mb-6"},[a("div",fe,[e(w,{icon:l(b),color:"primary",size:"20"},null,8,["icon"]),a("span",pe,y(((p=o.name)==null?void 0:p.label)||b),1),e(W),e(S,{variant:"text",size:"x-small",color:"grey",onClick:g=>R(o)},{default:t(()=>[c(y(s(o)?"إلغاء الكل":"تحديد الكل"),1)]),_:2},1032,["onClick"])]),e(U,{variant:"flat",border:"",class:"rounded-lg shadow-sm"},{default:t(()=>[e(X,{density:"compact",class:"py-0"},{default:t(()=>[(d(!0),_(L,null,A(o,(g,C)=>(d(),_(L,{key:C},[C!=="name"?(d(),O(D,{key:0,class:"perm-item border-b last-no-border"},{prepend:t(()=>[e(le,{"model-value":f(g.key),disabled:k(g.key),color:"primary","hide-details":"","onUpdate:modelValue":P=>E(g.key)},null,8,["model-value","disabled","onUpdate:modelValue"])]),default:t(()=>[e(F,{class:te({"text-grey":k(g.key)})},{default:t(()=>[a("span",ge,y(g.label),1),k(g.key)?(d(),_("span",ve," (موروثة) ")):$("",!0)]),_:2},1032,["class"]),e(se,{class:"text-caption text-grey-lighten-1"},{default:t(()=>[c(y(g.key),1)]),_:2},1024)]),_:2},1024)):$("",!0)],64))),128))]),_:2},1024)]),_:2},1024)])}),128)),Object.keys(r.value).length===0?(d(),_("div",be,[e(w,{icon:"ri-search-eye-line",size:"48",color:"grey-lighten-2"}),n[3]||(n[3]=a("div",{class:"text-body-1 text-grey mt-2"},"لا يوجد نتائج تطابق بحثك",-1))])):$("",!0)])]))}},xe=N(ye,[["__scopeId","data-v-2d214523"]]),Ve={class:"mt-8"},_e={class:"d-flex align-center justify-space-between mb-4"},he={__name:"RoleForm",props:{role:{type:Object,default:()=>({})},availablePermissions:{type:Object,required:!0},isEditMode:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["save","cancel"],setup(x,{emit:v}){var E;const i=x,m=v,h=I(null),V=I(!1),f=I({name:i.role.name||"",label:i.role.label||"",description:i.role.description||"",permissions:((E=i.role.permissions)==null?void 0:E.map(r=>r.name))||[]}),k=async()=>{const{valid:r}=await h.value.validate();r&&m("save",{...f.value})};return(r,l)=>(d(),O(U,{class:"role-form-card",flat:""},{default:t(()=>[e(G,{class:"pa-6"},{default:t(()=>[e(ae,{ref_key:"formRef",ref:h,modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=s=>V.value=s)},{default:t(()=>[e(T,null,{default:t(()=>[e(z,{cols:"12",md:"6"},{default:t(()=>[e(B,{modelValue:f.value.label,"onUpdate:modelValue":l[0]||(l[0]=s=>f.value.label=s),label:"اسم الدور (بالعربي)",placeholder:"مثال: محاسب، مدير مبيعات...",required:"",rules:[s=>!!s||"الاسم مطلوب"]},null,8,["modelValue","rules"])]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[e(B,{modelValue:f.value.name,"onUpdate:modelValue":l[1]||(l[1]=s=>f.value.name=s),label:"رمز الدور (English Key) - اختياري",placeholder:"سيتم التوليد تلقائياً إن لم يُملأ",disabled:x.isEditMode,hint:"سيتم التوليد تلقائياً من الاسم العربي"},null,8,["modelValue","disabled"])]),_:1}),e(z,{cols:"12"},{default:t(()=>[e(B,{modelValue:f.value.description,"onUpdate:modelValue":l[2]||(l[2]=s=>f.value.description=s),label:"الوصف",placeholder:"اشرح مهام هذا الدور باختصار...",textarea:""},null,8,["modelValue"])]),_:1})]),_:1}),a("div",Ve,[a("div",_e,[l[6]||(l[6]=a("div",null,[a("h3",{class:"text-h6 font-weight-bold"},"صلاحيات الدور"),a("p",{class:"text-caption text-grey"},"حدد العمليات التي يستطيع أصحاب هذا الدور القيام بها")],-1)),e(q,{color:"primary",size:"small"},{default:t(()=>[c(y(f.value.permissions.length)+" صلاحية مختارة",1)]),_:1})]),e(xe,{modelValue:f.value.permissions,"onUpdate:modelValue":l[3]||(l[3]=s=>f.value.permissions=s),"available-permissions":x.availablePermissions,"show-expert-toggle":!1},null,8,["modelValue","available-permissions"])])]),_:1},8,["modelValue"])]),_:1}),e(Y),e(Z,{class:"pa-6 bg-grey-lighten-5 rounded-b-xl"},{default:t(()=>[e(W),e(M,{variant:"tonal",color:"grey",onClick:l[5]||(l[5]=s=>r.$emit("cancel"))},{default:t(()=>l[7]||(l[7]=[c("إلغاء")])),_:1}),e(M,{color:"primary",loading:x.loading,disabled:!V.value,class:"px-8",onClick:k},{default:t(()=>[c(y(x.isEditMode?"تحديث الدور":"إنشاء الدور"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}))}},ke=N(he,[["__scopeId","data-v-4c05a04e"]]),we={class:"role-management-page pa-6"},Ce={class:"d-flex align-center justify-space-between mb-8"},Oe={class:"d-flex align-center gap-4"},$e={class:"text-h5 font-weight-black"},ze={class:"d-flex align-center justify-space-between mb-4"},Ee={class:"text-h6 font-weight-bold mb-1"},Pe={class:"text-caption text-grey-darken-1 mb-4 line-clamp-2",style:{height:"40px"}},Re={class:"d-flex align-center flex-wrap gap-2"},je={class:"text-center pa-12 bg-grey-lighten-5 rounded-xl border-dashed"},Ie={key:1,class:"text-center pa-12"},Se={class:"text-body-2 text-grey-darken-1"},Ue={class:"font-weight-bold text-error"},Be={__name:"RoleManagement",setup(x){const v=K(),i=H({isOpen:!1,isEdit:!1,data:null,loading:!1}),m=H({isOpen:!1,data:null,loading:!1});ie(async()=>{await Promise.all([v.fetchRoles(),v.fetchAvailablePermissions()])});const h=(r=null)=>{i.isEdit=!!r,i.data=r?{...r}:{permissions:[]},i.isOpen=!0},V=async r=>{i.loading=!0;try{i.isEdit?await v.updateRole(i.data.id,r):await v.createRole(r),i.isOpen=!1}finally{i.loading=!1}},f=r=>{m.data=r,m.isOpen=!0},k=async()=>{m.loading=!0;try{await v.deleteRole(m.data.id),m.isOpen=!1}finally{m.loading=!1}},E=r=>({admin:"ri-admin-line",manager:"ri-briefcase-line",sales:"ri-shopping-cart-2-line",accounting:"ri-calculator-line",warehouse:"ri-home-gear-line",customer:"ri-user-heart-line"})[r]||"ri-shield-line";return(r,l)=>(d(),_("div",we,[a("div",Ce,[l[7]||(l[7]=a("div",null,[a("h1",{class:"text-h4 font-weight-black text-primary mb-1"},"إدارة الأدوار الوظيفية"),a("p",{class:"text-body-1 text-grey-darken-1"},"عرّف المسميات الوظيفية وصلاحياتها لتنظيم فريق العمل")],-1)),e(M,{color:"primary","prepend-icon":"ri-add-line",size:"large",class:"px-6 rounded-xl shadow-lg",onClick:l[0]||(l[0]=s=>h())},{default:t(()=>l[6]||(l[6]=[c(" إضافة دور جديد ")])),_:1})]),e(T,{class:"mb-6"},{default:t(()=>[e(z,{cols:"12",sm:"4"},{default:t(()=>[e(U,{variant:"flat",border:"",class:"pa-4 rounded-xl bg-primary-lighten-5 border-primary"},{default:t(()=>[a("div",Oe,[e(Q,{color:"primary",variant:"tonal",size:"48"},{default:t(()=>[e(w,{icon:"ri-shield-user-line",color:"primary"})]),_:1}),a("div",null,[a("div",$e,y(j(v).roles.length),1),l[8]||(l[8]=a("div",{class:"text-caption text-primary"},"إجمالي الأدوار المعرفة",-1))])])]),_:1})]),_:1})]),_:1}),j(v).loading?(d(),_("div",Ie,[e(ne,{indeterminate:"",color:"primary",size:"64"}),l[14]||(l[14]=a("div",{class:"mt-4 text-grey"},"جاري تحميل الأدوار...",-1))])):(d(),O(T,{key:0},{default:t(()=>[(d(!0),_(L,null,A(j(v).roles,s=>(d(),O(z,{key:s.id,cols:"12",md:"4",lg:"3"},{default:t(()=>[e(U,{variant:"flat",border:"",class:"role-card h-100 transition-swing"},{default:t(()=>[e(G,{class:"pa-5"},{default:t(()=>[a("div",ze,[e(w,{icon:E(s.name),size:"32",color:"primary",class:"bg-grey-lighten-4 pa-4 rounded-lg"},null,8,["icon"]),e(oe,{location:"bottom end"},{activator:t(({props:R})=>[e(S,re({icon:"ri-more-2-fill",variant:"text",size:"small",ref_for:!0},R),null,16)]),default:t(()=>[e(X,{density:"compact",class:"rounded-lg"},{default:t(()=>[e(D,{onClick:R=>h(s)},{prepend:t(()=>[e(w,{icon:"ri-edit-line",size:"small"})]),default:t(()=>[e(F,null,{default:t(()=>l[9]||(l[9]=[c("تعديل الدور")])),_:1})]),_:2},1032,["onClick"]),e(Y),e(D,{color:"error",onClick:R=>f(s)},{prepend:t(()=>[e(w,{icon:"ri-delete-bin-line",size:"small"})]),default:t(()=>[e(F,null,{default:t(()=>l[10]||(l[10]=[c("حذف الدور")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),a("h3",Ee,y(s.label||s.name),1),a("p",Pe,y(s.description||"لا يوجد وصف متاح لهذا الدور الوظيفي."),1),a("div",Re,[e(q,{size:"x-small",color:"primary",variant:"tonal",class:"font-weight-bold"},{default:t(()=>[c(y(s.permissions_count||0)+" صلاحية ",1)]),_:2},1024),s.users_count!==void 0?(d(),O(q,{key:0,size:"x-small",color:"grey",variant:"flat"},{default:t(()=>[c(y(s.users_count)+" مستخدمين ",1)]),_:2},1024)):$("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),j(v).roles.length===0?(d(),O(z,{key:0,cols:"12"},{default:t(()=>[a("div",je,[e(w,{icon:"ri-shield-flash-line",size:"64",color:"grey-lighten-2"}),l[12]||(l[12]=a("div",{class:"text-h6 text-grey mt-4"},"لا يوجد أدوار مسجلة حالياً",-1)),l[13]||(l[13]=a("p",{class:"text-caption text-grey-darken-1 mb-6"},"ابدأ بإنشاء أول دور وظيفي لفريق عملك",-1)),e(M,{color:"primary",onClick:l[1]||(l[1]=s=>h())},{default:t(()=>l[11]||(l[11]=[c("إضافة أول دور")])),_:1})])]),_:1})):$("",!0)]),_:1})),e(J,{modelValue:i.isOpen,"onUpdate:modelValue":l[3]||(l[3]=s=>i.isOpen=s),"max-width":"800",persistent:"",scrollable:""},{default:t(()=>[i.isOpen?(d(),O(ke,{key:0,role:i.data,"is-edit-mode":i.isEdit,"available-permissions":j(v).availablePermissions,loading:i.loading,onSave:V,onCancel:l[2]||(l[2]=s=>i.isOpen=!1)},null,8,["role","is-edit-mode","available-permissions","loading"])):$("",!0)]),_:1},8,["modelValue"]),e(J,{modelValue:m.isOpen,"onUpdate:modelValue":l[5]||(l[5]=s=>m.isOpen=s),"max-width":"400"},{default:t(()=>[e(U,{class:"rounded-xl pa-4"},{default:t(()=>[e(G,{class:"text-center pt-6"},{default:t(()=>{var s;return[e(Q,{color:"error-lighten-5",size:"72",class:"mb-4"},{default:t(()=>[e(w,{icon:"ri-error-warning-line",color:"error",size:"40"})]),_:1}),l[17]||(l[17]=a("div",{class:"text-h6 font-weight-bold mb-2"},"هل أنت متأكد من الحذف؟",-1)),a("p",Se,[l[15]||(l[15]=c(" سيتم حذف الدور ")),a("span",Ue,'"'+y((s=m.data)==null?void 0:s.label)+'"',1),l[16]||(l[16]=c(" نهائياً. هذا الإجراء قد يؤثر على وصول المستخدمين المرتبطين بهذا الدور. "))])]}),_:1}),e(Z,{class:"gap-3 pt-4 px-4 pb-4"},{default:t(()=>[e(S,{variant:"tonal",block:"",class:"flex-grow-1",onClick:l[4]||(l[4]=s=>m.isOpen=!1)},{default:t(()=>l[18]||(l[18]=[c("إلغاء")])),_:1}),e(S,{color:"error",variant:"flat",block:"",class:"flex-grow-1",loading:m.loading,onClick:k},{default:t(()=>l[19]||(l[19]=[c(" تأكيد الحذف ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},De=N(Be,[["__scopeId","data-v-91fef44a"]]);export{De as default};
