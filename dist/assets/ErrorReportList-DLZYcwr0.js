import{a as K,r as c,K as q,L as Q,c as h,b as l,d as t,w as a,as as W,o as p,D as m,n as d,v as r,ad as X,l as Y,i as u,E as _,N as $,M as I,x as w,a6 as Z,H as ee,a3 as te,e as j,f,h as G,ah as se,aN as k,ar as ae,P as le,s as O}from"./index-Flp88uEA.js";import{u as oe}from"./useApi-Dl4iYKvS.js";import{A as re}from"./AppDataTable-anW7O1Lb.js";import{A as ie}from"./AppAvatar-BhNzqKmA.js";import{_ as R}from"./AppButton-DMkx3xLA.js";import"./usePermissions-BSwY7w5L.js";/* empty css                                                                  */const ne={class:"error-reports-page"},de={key:0,class:"d-flex align-center"},ce={class:"d-flex flex-column"},ue={class:"text-body-2 font-weight-medium"},pe={key:0,class:"text-caption text-grey"},fe={key:1,class:"text-grey text-caption"},ve={class:"d-flex flex-column max-width-300"},ge={class:"text-body-2 font-weight-bold text-truncate"},me={class:"text-caption text-primary"},_e={class:"d-flex align-center gap-2"},xe={class:"d-flex flex-column"},ye={class:"text-body-2"},be={class:"text-caption text-grey"},he={class:"d-flex align-center"},we={class:"font-weight-bold"},ke={class:"mb-4"},Ve={class:"text-h6 font-weight-bold text-error"},Ce={class:"mb-4"},ze={class:"d-flex align-center justify-space-between mb-2"},Se={class:"d-flex align-center justify-space-between mb-2"},Le={class:"d-flex align-center justify-space-between"},De={class:"text-caption"},Ee={class:"text-body-2"},Pe={class:"text-subtitle-1 font-weight-bold mb-3 d-flex align-center"},Ae={class:"text-caption mt-1"},Te={class:"text-caption mt-1"},Ue={class:"text-subtitle-1 font-weight-bold mb-3 d-flex align-center"},Ne={class:"text-caption text-white ltr"},Be={class:"text-subtitle-1 font-weight-bold mb-3 d-flex align-center"},$e={class:"text-caption pa-4 ltr"},Ie={__name:"ErrorReportList",setup(je){const S=oe("/api/error-reports"),L=c([]),V=c(!1),D=c(0),v=c(1),x=c(15),y=c(""),C=c(null),g=c(!1),i=c(null),M=[{title:"الأهمية",key:"severity",width:"100px"},{title:"المستخدم",key:"user"},{title:"الخطأ",key:"message"},{title:"البيئة",key:"tech",align:"center",width:"80px"},{title:"الحالة",key:"status",width:"150px"},{title:"التاريخ",key:"created_at",width:"120px"},{title:"إجراءات",key:"actions",align:"end",sortable:!1}],E=[{title:"قيد الانتظار",value:"pending"},{title:"قيد المراجعة",value:"in_review"},{title:"تم الإصلاح",value:"resolved"},{title:"تجاهل",value:"ignored"}],P=o=>({low:"success",medium:"warning",high:"error",critical:"deep-purple"})[o]||"grey",A=o=>({low:"منخفضة",medium:"متوسطة",high:"عالية",critical:"حرجة"})[o]||o,T=o=>({pending:"error",in_review:"warning",resolved:"success",ignored:"grey"})[o]||"grey",F=o=>{const e=E.find(s=>s.value===o);return e?e.title:o},U=o=>{if(!o)return"ri-global-line";const e=o.toLowerCase();return e.includes("chrome")?"ri-chrome-line":e.includes("firefox")?"ri-firefox-line":e.includes("safari")?"ri-safari-line":e.includes("edge")?"ri-edge-line":"ri-global-line"},N=o=>{if(!o)return"ri-computer-line";const e=o.toLowerCase();return e.includes("windows")?"ri-windows-fill":e.includes("mac")||e.includes("os x")?"ri-apple-fill":e.includes("linux")?"ri-ubuntu-fill":e.includes("android")?"ri-android-fill":e.includes("ios")?"ri-smartphone-line":"ri-computer-line"},z=o=>{if(!o)return{date:"-",time:"",full:"-"};const e=new Date(o);return{date:e.toLocaleDateString("ar-EG"),time:e.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"}),full:e.toLocaleString("ar-EG")}},H=o=>{v.value=o.page,x.value=o.itemsPerPage,b()};q(y,()=>{v.value=1,b()});const b=async()=>{V.value=!0;try{const o=await S.get({page:v.value,per_page:x.value,search:y.value,sort_by:"created_at",sort_order:"desc"},{showLoading:!1});L.value=o.data||[],D.value=o.total||0}catch(o){console.error("Error loading error reports:",o)}finally{V.value=!1}},J=async o=>{C.value=o.id;try{await S.patch(`/${o.id}`,{status:o.status}),O.success("تم تحديث حالة التقرير بنجاح")}catch(e){console.error("Failed to update status:",e),O.error("فشل في تحديث الحالة"),b()}finally{C.value=null}},B=o=>{i.value=o,g.value=!0};return Q(b),(o,e)=>(p(),h("div",ne,[e[17]||(e[17]=l("div",{class:"page-header mb-6"},[l("h1",{class:"text-h4 font-weight-bold ml-2"},"تقارير الأعطال"),l("p",{class:"text-body-1 text-grey"},"متابعة وتحليل المشاكل التقنية التي واجهها المستخدمون")],-1)),t(re,{title:"سجل الأعطال",icon:"ri-bug-line",headers:M,items:L.value,"total-items":D.value,loading:V.value,page:v.value,"onUpdate:page":e[1]||(e[1]=s=>v.value=s),"items-per-page":x.value,"onUpdate:itemsPerPage":e[2]||(e[2]=s=>x.value=s),search:y.value,"onUpdate:search":e[3]||(e[3]=s=>y.value=s),searchable:!0,"show-actions":!1,class:"text-no-wrap clickable-rows","onUpdate:options":H,"onClick:row":B},{"item.severity":a(({item:s})=>[t(m,{color:P(s.severity),size:"small",variant:"flat",class:"font-weight-bold"},{default:a(()=>[d(r(A(s.severity)),1)]),_:2},1032,["color"])]),"item.status":a(({item:s})=>[t(X,{modelValue:s.status,"onUpdate:modelValue":[n=>s.status=n,n=>J(s)],items:E,"item-title":"title","item-value":"value",density:"compact",variant:"plain","hide-details":"",class:"status-select",loading:C.value===s.id,onClick:e[0]||(e[0]=Y(()=>{},["stop"]))},{selection:a(({item:n})=>[t(m,{color:T(n.value),size:"x-small",variant:"tonal"},{default:a(()=>[d(r(n.title),1)]),_:2},1032,["color"])]),_:2},1032,["modelValue","onUpdate:modelValue","loading"])]),"item.user":a(({item:s})=>[s.user?(p(),h("div",de,[t(ie,{"img-url":s.user.avatar_url,name:s.user.name,type:"user",size:"28",class:"me-2 border"},null,8,["img-url","name"]),l("div",ce,[l("span",ue,r(s.user.name),1),s.company?(p(),h("span",pe,[t(u,{icon:"ri-building-line",size:"10"}),d(" "+r(s.company.name),1)])):_("",!0)])])):(p(),h("span",fe,"زائر (Guest)"))]),"item.message":a(({item:s})=>[l("div",ve,[l("span",ge,r(s.message),1),l("span",me,r(s.type),1)])]),"item.tech":a(({item:s})=>[l("div",_e,[t($,{bottom:""},{activator:a(({props:n})=>[t(u,I(n,{icon:U(s.browser),size:"18",color:"grey-darken-1"}),null,16,["icon"])]),default:a(()=>[l("span",null,r(s.browser),1)]),_:2},1024),t($,{bottom:""},{activator:a(({props:n})=>[t(u,I(n,{icon:N(s.os),size:"18",color:"grey-darken-1"}),null,16,["icon"])]),default:a(()=>[l("span",null,r(s.os),1)]),_:2},1024)])]),"item.created_at":a(({item:s})=>[l("div",xe,[l("span",ye,r(z(s.created_at).date),1),l("span",be,r(z(s.created_at).time),1)])]),"item.actions":a(({item:s})=>[t(R,{icon:"ri-eye-line",variant:"text",size:"small",color:"primary",onClick:n=>B(s)},null,8,["onClick"])]),_:2},1032,["items","total-items","loading","page","items-per-page","search"]),t(W,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),"max-width":"900px",scrollable:""},{default:a(()=>[i.value?(p(),w(G,{key:0,rounded:"xl"},{default:a(()=>[t(Z,{class:"d-flex justify-space-between align-center border-bottom pa-4"},{default:a(()=>[l("div",he,[t(u,{icon:"ri-bug-line",class:"me-2 text-error"}),l("span",we,"تفاصيل الخطأ #"+r(i.value.id),1)]),t(ee,{icon:"ri-close-line",variant:"text",size:"small",onClick:e[4]||(e[4]=s=>g.value=!1)})]),_:1}),t(te,{class:"pa-6"},{default:a(()=>[t(j,null,{default:a(()=>[t(f,{cols:"12",md:"8"},{default:a(()=>[l("div",ke,[e[7]||(e[7]=l("div",{class:"text-overline text-grey"},"رسالة الخطأ",-1)),l("div",Ve,r(i.value.message),1)]),l("div",Ce,[e[8]||(e[8]=l("div",{class:"text-overline text-grey"},"الرابط المتأثر",-1)),t(m,{size:"small",color:"primary",variant:"tonal",class:"mt-1",ltr:""},{default:a(()=>[d(r(i.value.url),1)]),_:1})])]),_:1}),t(f,{cols:"12",md:"4"},{default:a(()=>[t(G,{variant:"outlined",class:"pa-3 bg-grey-lighten-5"},{default:a(()=>[l("div",ze,[e[9]||(e[9]=l("span",{class:"text-caption text-grey"},"الأهمية:",-1)),t(m,{color:P(i.value.severity),size:"x-small"},{default:a(()=>[d(r(A(i.value.severity)),1)]),_:1},8,["color"])]),l("div",Se,[e[10]||(e[10]=l("span",{class:"text-caption text-grey"},"الحالة:",-1)),t(m,{color:T(i.value.status),size:"x-small"},{default:a(()=>[d(r(F(i.value.status)),1)]),_:1},8,["color"])]),l("div",Le,[e[11]||(e[11]=l("span",{class:"text-caption text-grey"},"الوقت:",-1)),l("span",De,r(z(i.value.created_at).full),1)])]),_:1})]),_:1}),i.value.user_notes?(p(),w(f,{key:0,cols:"12"},{default:a(()=>[t(se,{color:"info",variant:"tonal",icon:"ri-chat-voice-line",class:"mb-4 pa-3"},{default:a(()=>[e[12]||(e[12]=l("div",{class:"text-caption font-weight-bold"},"ملاحظات المستخدم:",-1)),l("div",Ee,r(i.value.user_notes),1)]),_:1})]),_:1})):_("",!0),t(f,{cols:"12"},{default:a(()=>[l("h3",Pe,[t(u,{icon:"ri-computer-line",class:"me-2",size:"20"}),e[13]||(e[13]=d(" معلومات البيئة (Environment) "))]),t(j,{dense:""},{default:a(()=>[t(f,{cols:"6",sm:"3"},{default:a(()=>[t(k,{border:"",rounded:"",class:"pa-2 text-center"},{default:a(()=>[t(u,{icon:U(i.value.browser),size:"24",color:"primary"},null,8,["icon"]),l("div",Ae,r(i.value.browser),1)]),_:1})]),_:1}),t(f,{cols:"6",sm:"3"},{default:a(()=>[t(k,{border:"",rounded:"",class:"pa-2 text-center"},{default:a(()=>[t(u,{icon:N(i.value.os),size:"24",color:"info"},null,8,["icon"]),l("div",Te,r(i.value.os),1)]),_:1})]),_:1})]),_:1})]),_:1}),i.value.stack_trace?(p(),w(f,{key:1,cols:"12"},{default:a(()=>[l("h3",Ue,[t(u,{icon:"ri-code-line",class:"me-2",size:"20"}),e[14]||(e[14]=d(" تتبع الخطأ (Stack Trace) "))]),t(k,{dark:"",class:"bg-grey-darken-4 pa-4 rounded-lg overflow-x-auto"},{default:a(()=>[l("pre",Ne,r(i.value.stack_trace),1)]),_:1})]),_:1})):_("",!0),i.value.payload?(p(),w(f,{key:2,cols:"12"},{default:a(()=>[l("h3",Be,[t(u,{icon:"ri-database-line",class:"me-2",size:"20"}),e[15]||(e[15]=d(" حمولة البيانات (Payload) "))]),t(k,{border:"",rounded:"",class:"pa-0 bg-grey-lighten-4 overflow-hidden"},{default:a(()=>[l("div",$e,[l("pre",null,r(JSON.stringify(i.value.payload,null,2)),1)])]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1}),t(ae,{class:"pa-4 border-top"},{default:a(()=>[t(le),t(R,{color:"grey-darken-1",variant:"text",onClick:e[5]||(e[5]=s=>g.value=!1)},{default:a(()=>e[16]||(e[16]=[d("إغلاق")])),_:1})]),_:1})]),_:1})):_("",!0)]),_:1},8,["modelValue"])]))}},Ke=K(Ie,[["__scopeId","data-v-a55981a1"]]);export{Ke as default};
