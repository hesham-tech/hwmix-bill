import{r as l,J as L,c as g,a as n,b as i,w as o,u as k,o as u,l as v,t as p,s as U,g as C,B as M,m as S}from"./index-CuR9-sbN.js";import{u as T}from"./useApi-CjhFmPue.js";import{A as $}from"./AppDataTable-CnA5lOqV.js";import{_ as V}from"./AppButton-CREzoRf6.js";import{A as j}from"./AppDialog-vLCI3uF9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function F(){const h=T("/api/payments"),r=l([]),c=l(!1),m=l(0);return{payments:r,loading:c,total:m,fetchPayments:async(d={})=>{c.value=!0;try{const a=await h.get(d,{showLoading:!1});return r.value=a.data||[],m.value=a.total||0,a}catch(a){throw r.value=[],m.value=0,a}finally{c.value=!1}},deletePayment:async d=>await h.remove(d,{successMessage:"تم حذف الدفعة بنجاح"})}}const J={class:"payments-page"},R={class:"px-6 pb-6"},q={key:0,class:"d-flex flex-column"},H={class:"font-weight-bold text-primary"},K={class:"text-caption text-grey"},O={key:1,class:"text-grey-lighten-1"},Q={class:"font-weight-black text-h6 text-success"},W={key:1,class:"text-grey-lighten-1"},X={class:"font-weight-medium text-body-1"},Y={class:"d-flex justify-end"},Z={class:"mt-2 text-error font-weight-medium"},le={__name:"PaymentList",setup(h){const r=S(),{payments:c,loading:m,total:b,fetchPayments:P,deletePayment:d}=F(),a=l(1),_=l(10),y=l(!1),D=l(null),x=l(!1),A=[{title:"الفاتورة",key:"invoice"},{title:"المبلغ",key:"amount",align:"end"},{title:"طريقة الدفع",key:"payment_method"},{title:"تاريخ الدفع",key:"payment_date"},{title:"الإجراءات",key:"actions",sortable:!1,align:"end"}],B=()=>{r.push("/payments/create")},z=s=>{D.value=s,y.value=!0},E=async()=>{x.value=!0;try{await d(D.value.id),y.value=!1,f()}finally{x.value=!1}},I=s=>{_.value=s,a.value=1,f()},N=s=>s?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s):"0.00 ج.م",G=s=>s?new Date(s).toLocaleDateString("ar-EG"):"-",f=()=>P({page:a.value,per_page:_.value});return L(f),(s,t)=>(u(),g("div",J,[t[5]||(t[5]=n("div",{class:"mb-6 px-6 pt-6"},[n("h1",{class:"text-h4 font-weight-bold"},"المدفوعات"),n("p",{class:"text-body-1 text-grey"},"تتبع وتحصيل المدفوعات النقدية والبنكية للفواتير")],-1)),n("div",R,[i($,{headers:A,items:k(c),loading:k(m),"items-length":k(b),"items-per-page":_.value,page:a.value,title:"سجل المدفوعات",icon:"ri-bank-card-2-line","onUpdate:page":t[0]||(t[0]=e=>{a.value=e,f()}),"onUpdate:itemsPerPage":I},{actions:o(()=>[i(V,{color:"primary","prepend-icon":"ri-add-line",onClick:B},{default:o(()=>t[2]||(t[2]=[v(" تسجيل تحصيل ")])),_:1})]),"item.invoice":o(({item:e})=>{var w;return[e.invoice?(u(),g("div",q,[n("span",H,"فاتورة #"+p(e.invoice.invoice_number),1),n("span",K,p(((w=e.invoice.customer)==null?void 0:w.name)||"بدون عميل"),1)])):(u(),g("span",O,"مدفوعات عامة"))]}),"item.amount":o(({item:e})=>[n("div",Q,p(N(e.amount)),1)]),"item.payment_method":o(({item:e})=>[e.payment_method?(u(),U(M,{key:0,size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold px-3"},{default:o(()=>[i(C,{icon:"ri-wallet-line",size:"14",class:"me-1"}),v(" "+p(e.payment_method.name),1)]),_:2},1024)):(u(),g("span",W,"غير محدد"))]),"item.payment_date":o(({item:e})=>[n("div",X,p(G(e.payment_date)),1)]),"item.actions":o(({item:e})=>[n("div",Y,[i(V,{icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف الدفعة",onClick:w=>z(e)},null,8,["onClick"])])]),_:1},8,["items","loading","items-length","items-per-page","page"])]),i(j,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),title:"تأكيد حذف الدفعة",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف",loading:x.value,onConfirm:E},{default:o(()=>[t[4]||(t[4]=v(" هل أنت متأكد من حذف هذه الدفعة نهائياً؟ ")),n("div",Z,[i(C,{icon:"ri-error-warning-line",size:"small",class:"me-1"}),t[3]||(t[3]=v(" سيتم تعديل رصيد الفاتورة المرتبطة وخصم المبلغ من الخزينة. "))])]),_:1},8,["modelValue","loading"])]))}};export{le as default};
