import{u as D}from"./useApi-C9JqAxpT.js";import{u as T}from"./usePrintExport-CFRwAj9b.js";import{R as C}from"./ReportLayout-zxSmuh_P.js";import{A as R}from"./AppDataTable-DRQWa6GE.js";import{_ as h}from"./AppInput-B9V4fNt_.js";import{_ as S}from"./AppButton-CoaWq9vh.js";import{f as i}from"./formatters-CKQiR5Fb.js";import{r as d,L as A,x as B,w as e,o as E,b as s,d as a,n as L,f,h as x,v as u,u as c,e as N}from"./index-B0c0aplS.js";import"./usePermissions-D1W15K8H.js";const I={class:"d-flex flex-column gap-4"},O={class:"text-h4 font-weight-black text-success"},U={class:"text-h4 font-weight-black text-error"},$={class:"text-h4 font-weight-black text-info"},F={class:"font-weight-bold text-error"},W={__name:"TaxReport",setup(M){const w=D("/api/invoices"),{exportToCSV:y}=T(),n=d(!1),l=d({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),r=d({total_sales_tax:0,total_purchase_tax:0,net_tax:0}),p=d([]),V=[{title:"رقم الفاتورة",key:"invoice_number"},{title:"التاريخ",key:"invoice_date"},{title:"الإجمالي (شامل)",key:"total",align:"end"},{title:"قيمة الضريبة (14%)",key:"tax_amount",align:"end"}],_=async()=>{n.value=!0;try{const t=(await w.get({...l.value,per_page:50},{showLoading:!1})).data||[];let o=0;p.value=t.map(v=>{const g=parseFloat(v.total||0),b=g-g/1.14;return o+=b,{...v,tax_amount:b}}),r.value={total_sales_tax:o,total_purchase_tax:o*.4,net_tax:o*.6}}finally{n.value=!1}},k=()=>{const m=p.value.map(t=>({"رقم الفاتورة":t.invoice_number,التاريخ:t.invoice_date,الإجمالي:t.total,"قيمة الضريبة":t.tax_amount}));y(m,"تقرير_الضرائب.csv")};return A(_),(m,t)=>(E(),B(C,{title:"تقرير ضريبة القيمة المضافة",description:"تحليل الإقرارات الضريبية للمبيعات والمشتريات (14%)",loading:n.value,onRefresh:_,onExport:k},{filters:e(()=>[s("div",I,[a(h,{modelValue:l.value.date_from,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.date_from=o),label:"من تاريخ",type:"date"},null,8,["modelValue"]),a(h,{modelValue:l.value.date_to,"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.date_to=o),label:"إلى تاريخ",type:"date"},null,8,["modelValue"]),a(S,{color:"primary",block:"",onClick:_},{default:e(()=>t[2]||(t[2]=[L("تحديث الكشف")])),_:1})])]),summary:e(()=>[a(N,{dense:""},{default:e(()=>[a(f,{cols:"12",md:"4"},{default:e(()=>[a(x,{border:"",flat:"",class:"rounded-xl pa-4 bg-success-lighten-5 border-success"},{default:e(()=>[t[3]||(t[3]=s("div",{class:"text-caption font-weight-bold text-success"},"ضريبة المبيعات (+)",-1)),s("div",O,u(c(i)(r.value.total_sales_tax)),1)]),_:1})]),_:1}),a(f,{cols:"12",md:"4"},{default:e(()=>[a(x,{border:"",flat:"",class:"rounded-xl pa-4 bg-error-lighten-5 border-error"},{default:e(()=>[t[4]||(t[4]=s("div",{class:"text-caption font-weight-bold text-error"},"ضريبة المشتريات (-)",-1)),s("div",U,u(c(i)(r.value.total_purchase_tax)),1)]),_:1})]),_:1}),a(f,{cols:"12",md:"4"},{default:e(()=>[a(x,{border:"",flat:"",class:"rounded-xl pa-4 bg-info-lighten-5 border-info"},{default:e(()=>[t[5]||(t[5]=s("div",{class:"text-caption font-weight-bold text-info"},"صافي الضريبة",-1)),s("div",$,u(c(i)(r.value.net_tax)),1)]),_:1})]),_:1})]),_:1})]),table:e(()=>[a(R,{headers:V,items:p.value,loading:n.value,title:"كشف الضريبة التفصيلي",icon:"ri-percent-line"},{"item.tax_amount":e(({item:o})=>[s("span",F,u(c(i)(o.tax_amount)),1)]),_:1},8,["items","loading"])]),_:1},8,["loading"]))}};export{W as default};
