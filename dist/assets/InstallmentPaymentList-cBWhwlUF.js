import{ap as ee,r as u,x as L,aq as C,p as k,ar as z,o as d,c as S,s as f,as as E,w as o,b as i,f as j,F as U,h as W,e as N,d as X,J as te,a as r,u as V,l as B,t as v,B as ae,g as F,C as q,M as ne,Q as le,O as se,y as oe,z as re,a2 as ie,a3 as ce}from"./index-CuR9-sbN.js";import{u as de,a as ue}from"./index-Jdh_M4Dc.js";import{A as ye}from"./AppDataTable-CnA5lOqV.js";import{_ as J}from"./AppButton-CREzoRf6.js";import{A as me}from"./AppDialog-vLCI3uF9.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as pe}from"./EmptyState-FFeUUxeu.js";const ge=ee("installment",()=>{const e=u([]),m=u(null),p=u([]),w=u([]),l=u(!1),A=u(0),D=u(1),b=u(10),y=u(""),g=u([]),P=u(null),_=u(null),I=L(()=>{var a,t;return{page:D.value,per_page:b.value,search:y.value,status:P.value,customer_id:_.value,sort_by:((a=g.value[0])==null?void 0:a.key)||"",order:((t=g.value[0])==null?void 0:t.order)||"desc"}});async function x(){l.value=!0;try{const a=await C.getPlans(I.value,{showToast:!1});return e.value=a.data,A.value=a.total,a}catch(a){throw console.error("Error fetching plans:",a),a}finally{l.value=!1}}async function h(a){l.value=!0;try{const t=await C.getOne(a,{full:!0});return m.value=t.data[0],t.data[0]}catch(t){throw console.error("Error fetching plan:",t),t}finally{l.value=!1}}async function s(a){l.value=!0;try{const t=await C.createPlan(a);return await x(),k.success("تم إنشاء خطة التقسيط بنجاح"),t.data[0]}catch(t){throw console.error("Error creating plan:",t),k.error("فشل إنشاء خطة التقسيط - يرجى التحقق من البيانات"),t}finally{l.value=!1}}async function c(a,t){l.value=!0;try{const n=await C.updatePlan(a,t);return await x(),k.success("تم تحديث خطة التقسيط بنجاح"),n.data[0]}catch(n){throw console.error("Error updating plan:",n),n}finally{l.value=!1}}async function T(a){l.value=!0;try{await C.delete(a),await x(),k.success("تم حذف خطة التقسيط بنجاح")}catch(t){throw console.error("Error deleting plan:",t),t}finally{l.value=!1}}async function H(a=null){l.value=!0;try{const t=a?{installment_plan_id:a}:{},n=await C.getPayments(t,{showToast:!1});return p.value=n.data,n}catch(t){throw console.error("Error fetching payments:",t),t}finally{l.value=!1}}async function O(a){l.value=!0;try{const t=await C.createPayment(a);return k.success("تم تسجيل الدفعة بنجاح"),t.data[0]}catch(t){throw console.error("Error creating payment:",t),t}finally{l.value=!1}}async function $(a){l.value=!0;try{const t=await z.getByPayment(a,{showToast:!1});return w.value=t.data,t}catch(t){throw console.error("Error fetching payment details:",t),t}finally{l.value=!1}}async function G(a){l.value=!0;try{const t=await z.createDetail(a);return k.success("تم تسجيل تفاصيل الدفعة بنجاح"),t.data[0]}catch(t){throw console.error("Error creating payment detail:",t),t}finally{l.value=!1}}async function K(a,t){l.value=!0;try{await z.replaceDetail(a,t),k.success("تم تحديث تفاصيل الدفعة بنجاح")}catch(n){throw console.error("Error updating payment detail:",n),k.error("فشل التحديث - استخدم حذف وإعادة إنشاء"),n}finally{l.value=!1}}function Y(){P.value=null,_.value=null,y.value="",D.value=1}return{plans:e,currentPlan:m,payments:p,paymentDetails:w,loading:l,totalItems:A,page:D,itemsPerPage:b,search:y,sortBy:g,statusFilter:P,customerFilter:_,params:I,fetchPlans:x,fetchPlan:h,createPlan:s,updatePlan:c,deletePlan:T,fetchPayments:H,createPayment:O,fetchPaymentDetails:$,createPaymentDetail:G,updatePaymentDetail:K,resetFilters:Y}});function he(){const e=ge(),{isOpen:m,formData:p,isEditMode:w,open:l,close:A}=de(),{showConfirm:D,confirmMessage:b,confirm:y,handleConfirm:g,handleCancel:P}=ue(),_=L(()=>e.plans),I=L(()=>e.payments),x=L(()=>e.loading),h=L(()=>e.totalItems),s=async()=>{await e.fetchPlans()};return{plans:_,payments:I,loading:x,totalItems:h,formData:p,isEditMode:w,isOpen:m,open:l,close:A,showConfirm:D,confirmMessage:b,handleConfirm:async()=>{await g(),await s()},handleCancel:P,loadPlans:s,loadPlan:async n=>await e.fetchPlan(n),savePlan:async n=>w.value?await e.updatePlan(p.value.id,n):await e.createPlan(n),handleDeletePlan:n=>{y("هل أنت متأكد من حذف خطة التقسيط؟",async()=>{await e.deletePlan(n.id)})},handleEditPlan:n=>{l(n)},handleCreatePlan:()=>{l({})},loadPayments:async(n=null)=>{await e.fetchPayments(n)},createPayment:async n=>await e.createPayment(n),loadPaymentDetails:async n=>await e.fetchPaymentDetails(n),createPaymentDetail:async n=>await e.createPaymentDetail(n),updatePaymentDetail:async(n,Z)=>await e.updatePaymentDetail(n,Z)}}const ve={class:"app-skeleton"},we={__name:"AppSkeleton",props:{type:{type:String,default:"card",validator:e=>["table","card","list","form","article","dashboard","custom"].includes(e)},loading:{type:Boolean,default:!0},count:{type:Number,default:4},skeletonType:{type:String,default:"card"}},setup(e){return(m,p)=>(d(),S("div",ve,[e.type==="table"?(d(),f(E,{key:0,type:"table-heading, table-row-divider@3",loading:e.loading},null,8,["loading"])):e.type==="card"?(d(),f(j,{key:1},{default:o(()=>[i(E,{type:"card",loading:e.loading},null,8,["loading"])]),_:1})):e.type==="list"?(d(),f(E,{key:2,type:"list-item-avatar-three-line@3",loading:e.loading},null,8,["loading"])):e.type==="form"?(d(),f(E,{key:3,type:"card-heading, list-item@3, actions",loading:e.loading},null,8,["loading"])):e.type==="article"?(d(),f(E,{key:4,type:"article, actions",loading:e.loading},null,8,["loading"])):e.type==="dashboard"?(d(),f(X,{key:5},{default:o(()=>[(d(!0),S(U,null,W(e.count,w=>(d(),f(N,{key:w,cols:"12",md:"6",lg:"3"},{default:o(()=>[i(j,null,{default:o(()=>[i(E,{type:"card"})]),_:1})]),_:2},1024))),128))]),_:1})):(d(),f(E,{key:6,type:e.skeletonType,loading:e.loading},null,8,["type","loading"]))]))}},Pe=fe(we,[["__scopeId","data-v-20871f58"]]),Q=(e,m={})=>{if(!e)return"-";const p={year:"numeric",month:"long",day:"numeric",...m};return new Date(e).toLocaleDateString("ar-EG",p)},R=(e,m="EGP")=>e==null?"-":new Intl.NumberFormat("ar-EG",{style:"currency",currency:m}).format(e),M={CASH:"cash",CARD:"card",TRANSFER:"transfer",CHECK:"check"},be={[M.CASH]:"نقدي",[M.CARD]:"بطاقة",[M.TRANSFER]:"تحويل",[M.CHECK]:"شيك"},_e={class:"installment-payments-page"},xe={class:"px-6 pb-6"},ke={class:"font-weight-black text-h6 text-success"},De={class:"font-weight-medium text-body-1"},Ce={class:"text-caption text-grey text-truncate d-inline-block",style:{"max-width":"200px"}},Ee={class:"d-flex justify-end"},Ve={key:0},Se={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-2"},Ae={class:"text-h5 font-weight-black text-success"},Ie={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-2"},Te={class:"text-h6 font-weight-bold"},Le={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-4"},Ne={class:"d-flex align-center"},Be={class:"font-weight-bold"},Me={class:"pa-3 border rounded-lg bg-grey-lighten-5 mb-4"},ze={class:"text-body-2"},Fe={class:"d-flex align-center mb-4"},Re={key:0,class:"py-12"},He={key:1},Oe={class:"text-primary text-caption font-weight-bold"},$e={class:"text-h6 font-weight-black text-primary"},Ue={__name:"InstallmentPaymentList",props:{planId:{type:[Number,String],default:null}},setup(e){const m=e,{payments:p,loading:w,loadPayments:l,loadPaymentDetails:A}=he(),D=[{title:"المبلغ",key:"amount",sortable:!0},{title:"التاريخ",key:"date",sortable:!0},{title:"الطريقة",key:"method",sortable:!1},{title:"ملاحظات",key:"notes",sortable:!1},{title:"الإجراءات",key:"actions",sortable:!1}],b=u(!1),y=u(null),g=u([]),P=u(!1),_=h=>be[h]||h,I=async h=>{y.value=h,b.value=!0,P.value=!0;try{const s=await A(h.id);g.value=s.data}finally{P.value=!1}},x=()=>{console.log("Add payment")};return te(()=>{l(m.planId)}),(h,s)=>(d(),S("div",_e,[r("div",xe,[i(ye,{headers:D,items:V(p),loading:V(w),title:`سجل دفعات الخطة #${e.planId||"العامة"}`,icon:"ri-money-dollar-box-line"},{actions:o(()=>[i(J,{color:"primary","prepend-icon":"ri-add-line",onClick:x},{default:o(()=>s[1]||(s[1]=[B(" تسجيل دفعة جديدة ")])),_:1})]),"item.amount":o(({item:c})=>[r("div",ke,v(V(R)(c.amount)),1)]),"item.date":o(({item:c})=>[r("div",De,v(V(Q)(c.date)),1)]),"item.method":o(({item:c})=>[i(ae,{size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold px-3"},{default:o(()=>[i(F,{icon:"ri-wallet-line",size:"14",class:"me-1"}),B(" "+v(_(c.method)),1)]),_:2},1024)]),"item.notes":o(({item:c})=>[r("span",Ce,v(c.notes||"---"),1)]),"item.actions":o(({item:c})=>[r("div",Ee,[i(J,{icon:"ri-eye-line",size:"x-small",variant:"text",color:"info",tooltip:"عرض التفاصيل الكاملة",onClick:T=>I(c)},null,8,["onClick"])])]),_:1},8,["items","loading","title"])]),i(me,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=c=>b.value=c),title:"تفاصيل دفعة القسط",icon:"ri-information-line","max-width":"600","hide-confirm":""},{default:o(()=>[y.value?(d(),S("div",Ve,[i(X,{dense:""},{default:o(()=>[i(N,{cols:"12",sm:"6"},{default:o(()=>[r("div",Se,[s[2]||(s[2]=r("div",{class:"text-caption text-grey mb-1"},"قيمة الدفعة",-1)),r("div",Ae,v(V(R)(y.value.amount)),1)])]),_:1}),i(N,{cols:"12",sm:"6"},{default:o(()=>[r("div",Ie,[s[3]||(s[3]=r("div",{class:"text-caption text-grey mb-1"},"تاريخ العملية",-1)),r("div",Te,v(V(Q)(y.value.date)),1)])]),_:1}),i(N,{cols:"12"},{default:o(()=>[r("div",Le,[s[4]||(s[4]=r("div",{class:"text-caption text-grey mb-1"},"طريقة الدفع",-1)),r("div",Ne,[i(F,{icon:"ri-wallet-line",size:"small",class:"me-2"}),r("span",Be,v(_(y.value.method)),1)])])]),_:1}),y.value.notes?(d(),f(N,{key:0,cols:"12"},{default:o(()=>[r("div",Me,[s[5]||(s[5]=r("div",{class:"text-caption text-grey mb-1"},"ملاحظات إضافية",-1)),r("div",ze,v(y.value.notes),1)])]),_:1})):q("",!0)]),_:1}),i(ne,{class:"my-4"}),r("div",Fe,[i(F,{icon:"ri-list-check-line",size:"small",color:"primary",class:"me-2"}),s[6]||(s[6]=r("h4",{class:"text-subtitle-1 font-weight-bold"},"توزيع الدفعة على الأقساط",-1))]),P.value?(d(),S("div",Re,[i(Pe,{type:"list"})])):g.value.length?(d(),S("div",He,[i(le,{border:"",class:"rounded-lg pa-0 overflow-hidden"},{default:o(()=>[(d(!0),S(U,null,W(g.value,(c,T)=>(d(),f(se,{key:c.id,class:oe({"border-b":T<g.value.length-1})},{prepend:o(()=>[i(re,{color:"primary-lighten-5",size:"32",class:"me-3"},{default:o(()=>[r("span",Oe,"#"+v(c.installment_id),1)]),_:2},1024)]),append:o(()=>[r("div",$e,v(V(R)(c.amount_paid)),1)]),default:o(()=>[i(ie,{class:"font-weight-bold"},{default:o(()=>s[7]||(s[7]=[B("قسط مستحق")])),_:1}),i(ce,{class:"text-grey"},{default:o(()=>s[8]||(s[8]=[B("تم سداد جزء من قيمة القسط")])),_:1})]),_:2},1032,["class"]))),128))]),_:1})])):(d(),f(pe,{key:2,title:"لا توجد تفاصيل لتوزيع هذه الدفعة",icon:"ri-error-warning-line"}))])):q("",!0)]),_:1},8,["modelValue"])]))}};export{Ue as default};
