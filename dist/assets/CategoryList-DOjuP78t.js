import{r as c,a as $e,K as X,z as ce,o as n,x as u,w as t,d as l,a7 as _e,b as d,i as C,c as V,v as p,E as D,H as M,a1 as Fe,A as ze,B as te,C as Y,D as K,n as _,P as ve,az as Ue,a3 as Ge,u as y,e as pe,F as fe,j as De,h as Ne,k as Ae,l as N,f as O,aI as Oe,p as He,U as Ke,s as Qe,aA as Se,L as We,ar as Je,aB as Xe}from"./index-98ieInin.js";import{u as be}from"./useApi-C-2zrNsN.js";import{u as Ye}from"./usePermissions-DCdnT4T8.js";import{A as Ie}from"./AppDataTable-DIGlqrRe.js";import{A as ge}from"./AppDialog-vdoPX15g.js";import{_ as S}from"./AppButton-Dj4u5ybH.js";import{_ as me}from"./AppInput-CufQk24k.js";import{A as se}from"./AppSwitch-CQy3Q7Sy.js";import{_ as xe}from"./AppCard-hKVlC0Jq.js";import{_ as Te}from"./LoadingSpinner-B4omEe0J.js";import{_ as qe}from"./EmptyState-DNQE5Qtz.js";import{A as Pe}from"./AppInfiniteScroll-DpAEHV3t.js";import{M as je}from"./MediaGallery-0pf_a0_o.js";function Ze(){const H=be("/api/categories"),B=c([]),f=c(!1),$=c(0);return{categories:B,loading:f,total:$,fetchCategories:async(x={},b={})=>{var E;const{append:I=!1}=b;f.value=!0;try{const g=await H.get(x,{showLoading:!1});let k=[],h=0;return g.data&&Array.isArray(g.data.data)?(k=g.data.data,h=((E=g.data.meta)==null?void 0:E.total)||g.data.data.length):(k=g.data||[],h=g.total||k.length),I?B.value=[...B.value,...k]:B.value=k,$.value=h,g}catch(g){throw B.value=[],$.value=0,g}finally{f.value=!1}},deleteCategory:async x=>await H.remove(x,{successMessage:"تم حذف الفئة بنجاح"})}}const el={class:"d-flex align-center gap-3"},ll={class:"d-flex flex-column"},al={key:0,class:"text-white text-caption opacity-80"},tl={class:"pa-4 bg-grey-lighten-4 border-b"},ol=["onClick"],il={key:0,class:"mb-4 bg-white rounded-xl border border-primary-lighten-4 overflow-hidden elevation-sm"},nl={class:"pa-4 d-flex align-sm-center flex-column flex-sm-row gap-4"},sl={class:"flex-grow-1"},rl={class:"d-flex align-center gap-2 mb-1"},dl={class:"text-h5 font-weight-bold text-primary"},ul={key:0,class:"text-body-2 text-grey-darken-1 mb-3"},cl={key:1,class:"text-body-2 text-grey-lighten-2 italic mb-3"},vl={class:"d-flex flex-column gap-3"},pl={class:"d-flex flex-wrap gap-4"},fl={class:"d-flex align-center gap-1"},gl={class:"text-caption font-weight-bold"},ml={class:"d-flex align-center gap-1"},yl={class:"text-caption font-weight-bold"},hl={class:"d-flex align-center gap-2 flex-wrap"},_l={class:"d-flex align-center gap-3 flex-wrap"},xl={class:"d-flex align-center gap-2"},bl={class:"categories-list-area"},kl={class:"pa-4 d-flex align-center justify-center bg-grey-lighten-4 position-relative overflow-hidden",style:{height:"120px"}},wl={class:"d-flex align-center justify-space-between mt-1"},Cl={class:"d-flex gap-1"},Vl=["onClick"],$l={class:"font-weight-bold"},zl={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},Ul={__name:"CategoryExplorerDialog",props:{modelValue:Boolean,initialCategory:Object},emits:["update:modelValue","update-root"],setup(H,{emit:B}){const f=H,$=B,A=He(),Q=Ke(),{categories:x,loading:b,total:I,fetchCategories:E,deleteCategory:g}=Ze(),k=be("/api/categories"),h=c(null);X(h,r=>{f.modelValue&&r&&A.replace({query:{...Q.query,category_id:r}})});const oe=c([]),z=c(1),L=c(12),R=c(""),T=c("grid"),F=c(null),v=c(null),G=c(!1),Z=c(!1),ee=c(!1),W=c(null),j=c(null),le=c(!1),re=c(null),J=c(null),q=c({name:"",active:1,parent_id:null,image_id:null}),ie=ce(()=>{var r;return!!((r=j.value)!=null&&r.id)}),ae=[{title:"القسم",key:"name",sortable:!0},{title:"المنتجات",key:"products_count",align:"center"},{title:"الحالة",key:"active",align:"center"},{title:"الإجراءات",key:"actions",align:"end"}],de=ce(()=>{var s,a,U;const r=[{title:(s=f.initialCategory)==null?void 0:s.name,value:(a=f.initialCategory)==null?void 0:a.id,disabled:h.value===((U=f.initialCategory)==null?void 0:U.id)}];return oe.value.forEach((ue,Ql)=>{var Ve;ue.id!==((Ve=f.initialCategory)==null?void 0:Ve.id)&&r.push({title:ue.name,value:ue.id,disabled:ue.id===h.value})}),r});let ne;const ye=()=>{clearTimeout(ne),ne=setTimeout(()=>{z.value=1,P()},500)},P=(r={})=>{const s=r===!0;E({page:z.value,per_page:L.value,search:R.value,parent_id:h.value},{append:s})},w=async()=>{try{const r=await k.request("get",`/${h.value}/breadcrumbs`);oe.value=r.data||[]}catch(r){console.error("Error fetching breadcrumbs:",r)}},i=async()=>{if(h.value)try{const r=await k.request("get",`/${h.value}`);v.value=r.data}catch(r){console.error("Error fetching current category:",r)}},o=r=>{h.value=r.id,z.value=1,P(),w(),i()},e=r=>{h.value=r.value,z.value=1,P(),w(),i()},m=r=>{r.products_count>0?(A.push({path:"/products",query:{category_id:r.id}}),$("update:modelValue",!1)):Qe.info("لا توجد منتجات في هذا القسم حالياً")},Me=()=>{b.value||x.value.length>=I.value||(z.value++,P(!0))},Be=()=>{T.value==="list"&&P()},ke=()=>{j.value=null,q.value={name:"",active:1,parent_id:h.value,image_id:null},W.value=null,G.value=!0},he=r=>{j.value=r,q.value={...r,active:r.active?1:0,image_id:r.image_id||null},W.value=r.image_url||null,G.value=!0},Ee=r=>{q.value.image_id=r.id,W.value=r.url,ee.value=!1},we=r=>{j.value=r,Z.value=!0},Le=async r=>{F.value=r.id;try{const s=r.active?0:1;await k.request("patch",`/${r.id}/toggle`),r.active=s,$("update-root")}finally{F.value=null}},Ce=async()=>{const{valid:r}=await re.value.validate();if(r){le.value=!0;try{ie.value?await k.update(j.value.id,q.value):await k.create(q.value),G.value=!1,P(),$("update-root")}finally{le.value=!1}}},Re=async()=>{try{await g(j.value.id),Z.value=!1,P(),$("update-root")}catch(r){console.error("Delete error:",r)}};return X(()=>f.modelValue,r=>{r&&f.initialCategory&&(h.value=f.initialCategory.id,z.value=1,P(),w(),i())}),X(de,()=>{setTimeout(()=>{J.value&&(J.value.scrollLeft=J.value.scrollWidth)},100)},{deep:!0}),(r,s)=>(n(),u(Oe,{"model-value":H.modelValue,"max-width":"1200","onUpdate:modelValue":s[14]||(s[14]=a=>r.$emit("update:modelValue",a)),scrollable:""},{default:t(()=>[l(Ne,{class:"explorer-dialog-card rounded-xl"},{default:t(()=>[l(_e,{class:"pa-4 bg-primary d-flex align-center justify-space-between"},{default:t(()=>[d("div",el,[l(C,{icon:"ri-folder-open-line",color:"white"}),d("div",ll,[s[15]||(s[15]=d("span",{class:"text-white text-h6 line-height-1"},"تصفح الأقسام",-1)),H.initialCategory?(n(),V("span",al,"مستكشف: "+p(H.initialCategory.name),1)):D("",!0)])]),l(M,{icon:"ri-close-line",variant:"text",color:"white",onClick:s[0]||(s[0]=a=>r.$emit("update:modelValue",!1))})]),_:1}),d("div",tl,[d("div",{ref_key:"breadcrumbsContainer",ref:J,class:"breadcrumbs-scroll-container mb-4"},[l(Fe,{items:de.value,class:"pa-0"},{divider:t(()=>[l(C,{icon:"ri-arrow-left-s-line",size:"x-small",color:"grey-lighten-1"})]),item:t(({item:a})=>[d("span",{class:ze(["text-subtitle-1 font-weight-bold cursor-pointer transition-all hover-primary no-wrap",{"text-primary":!a.disabled,"text-grey-darken-1":a.disabled}]),onClick:U=>!a.disabled&&e(a)},p(a.title),11,ol)]),_:1},8,["items"])],512),v.value&&!R.value?(n(),V("div",il,[d("div",nl,[l(te,{size:"100",rounded:"lg",color:"primary-lighten-5",class:"border"},{default:t(()=>[v.value.image_url?(n(),u(Y,{key:0,src:v.value.image_url,cover:""},null,8,["src"])):(n(),u(C,{key:1,icon:"ri-folder-open-fill",size:"48",color:"primary"}))]),_:1}),d("div",sl,[d("div",rl,[d("h2",dl,p(v.value.name),1),l(K,{color:v.value.active?"success":"error",size:"x-small",variant:"flat",class:"font-weight-bold"},{default:t(()=>[_(p(v.value.active?"نشط":"معطل"),1)]),_:1},8,["color"])]),v.value.description?(n(),V("p",ul,p(v.value.description),1)):(n(),V("p",cl,"لا يوجد وصف لهذا القسم")),d("div",vl,[d("div",pl,[d("div",fl,[l(C,{icon:"ri-shopping-bag-3-fill",size:"small",color:"secondary"}),d("span",gl,p(v.value.products_count||0)+" منتج",1)]),d("div",ml,[l(C,{icon:"ri-folders-fill",size:"small",color:"info"}),d("span",yl,p(v.value.children_count||0)+" قسم فرعي",1)])]),d("div",hl,[v.value.products_count>0?(n(),u(S,{key:0,"prepend-icon":"ri-eye-line",color:"secondary",variant:"tonal",size:"small",class:"rounded-pill font-weight-bold",onClick:s[1]||(s[1]=a=>m(v.value))},{default:t(()=>s[16]||(s[16]=[_(" عرض المنتجات ")])),_:1})):D("",!0),l(S,{"prepend-icon":"ri-edit-line",color:"primary",variant:"tonal",size:"small",class:"rounded-pill font-weight-bold",onClick:s[2]||(s[2]=a=>he(v.value))},{default:t(()=>s[17]||(s[17]=[_(" تعديل البيانات ")])),_:1})])])])])])):D("",!0),d("div",_l,[l(me,{modelValue:R.value,"onUpdate:modelValue":[s[3]||(s[3]=a=>R.value=a),ye],label:"بحث في هذا القسم...","prepend-inner-icon":"ri-search-line",density:"compact","hide-details":"",class:"max-width-300 flex-grow-1 flex-sm-grow-0"},null,8,["modelValue"]),l(ve,{class:"d-none d-sm-block"}),d("div",xl,[l(S,{"prepend-icon":"ri-add-line",color:"primary",variant:"flat",class:"font-weight-bold",onClick:ke},{default:t(()=>s[18]||(s[18]=[_(" إضافة قسم فرعي ")])),_:1}),l(Ue,{variant:"outlined",density:"comfortable",color:"primary"},{default:t(()=>[l(M,{active:T.value==="grid",icon:"ri-grid-fill",onClick:s[4]||(s[4]=a=>T.value="grid")},null,8,["active"]),l(M,{active:T.value==="list",icon:"ri-list-check",onClick:s[5]||(s[5]=a=>T.value="list")},null,8,["active"])]),_:1})])])]),l(Ge,{class:"pa-4 explorer-content"},{default:t(()=>[d("div",bl,[y(b)&&!y(x).length?(n(),u(Te,{key:0,size:"64",text:"جاري تحميل الأقسام..."})):y(x).length?(n(),V(fe,{key:2},[T.value==="grid"?(n(),u(Pe,{key:0,loading:y(b)&&y(x).length>0,"has-more":y(x).length<y(I),onLoad:Me},{default:t(()=>[l(pe,null,{default:t(()=>[(n(!0),V(fe,null,De(y(x),a=>(n(),u(O,{key:a.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[l(xe,{class:"category-card h-100","no-padding":"",onClick:U=>o(a)},{actions:t(()=>[l(K,{color:a.active?"success":"error",size:"x-small",variant:"flat",class:"font-weight-bold"},{default:t(()=>[_(p(a.active?"نشط":"معطل"),1)]),_:2},1032,["color"]),l(ve),d("div",Cl,[a.products_count>0?(n(),u(M,{key:0,icon:"ri-shopping-bag-3-line",variant:"text",color:"secondary",size:"x-small",title:"عرض المنتجات",onClick:N(U=>m(a),["stop"])},null,8,["onClick"])):D("",!0),l(M,{icon:"ri-edit-line",variant:"text",color:"primary",size:"x-small",onClick:N(U=>he(a),["stop"])},null,8,["onClick"]),l(M,{icon:"ri-delete-bin-line",variant:"text",color:"error",size:"x-small",onClick:N(U=>we(a),["stop"])},null,8,["onClick"])])]),default:t(()=>[d("div",kl,[a.image_url?(n(),u(Y,{key:0,src:a.image_url,cover:"",class:"position-absolute fill-height w-100"},null,8,["src"])):(n(),u(C,{key:1,icon:a.children_count>0?"ri-folder-fill":"ri-folder-line",size:"48",color:a.active?a.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),l(Se,{class:"pt-2"},{default:t(()=>[l(_e,{class:"text-subtitle-1 font-weight-bold pa-0 text-truncate"},{default:t(()=>[_(p(a.name),1)]),_:2},1024),d("div",wl,[l(K,{color:a.active?"success":"error",size:"x-small",variant:"flat",class:"font-weight-bold"},{default:t(()=>[_(p(a.active?"نشط":"معطل"),1)]),_:2},1032,["color"]),l(K,{size:"x-small",variant:"text",class:"text-grey"},{default:t(()=>[_(p(a.products_count)+" منتج ",1)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),u(Ie,{key:1,headers:ae,items:y(x),"total-items":y(I),loading:y(b),page:z.value,"onUpdate:page":s[6]||(s[6]=a=>z.value=a),"items-per-page":L.value,"onUpdate:itemsPerPage":s[7]||(s[7]=a=>L.value=a),"can-view":!1,"can-edit":!1,"can-delete":!1,"onUpdate:options":Be},{"item.name":t(({item:a})=>[d("div",{class:"d-flex align-center py-2 cursor-pointer",onClick:U=>o(a)},[l(te,{size:"32",rounded:"sm",color:"grey-lighten-4",class:"me-3 border overflow-hidden"},{default:t(()=>[a.image_url?(n(),u(Y,{key:0,src:a.image_url,cover:""},null,8,["src"])):(n(),u(C,{key:1,icon:a.children_count>0?"ri-folder-fill":"ri-folder-line",size:"18",color:a.active?a.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),_:2},1024),d("span",$l,p(a.name),1)],8,Vl)]),"item.active":t(({item:a})=>[l(se,{"model-value":!!a.active,loading:F.value===a.id,"onUpdate:modelValue":U=>Le(a)},null,8,["model-value","loading","onUpdate:modelValue"])]),"extra-actions":t(({item:a})=>[a.products_count>0?(n(),u(M,{key:0,icon:"ri-shopping-bag-3-line",variant:"text",color:"secondary",size:"small",title:"عرض المنتجات",onClick:U=>m(a)},null,8,["onClick"])):D("",!0),l(M,{icon:"ri-arrow-right-up-line",variant:"text",color:"info",size:"small",onClick:U=>o(a)},null,8,["onClick"]),l(M,{icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:U=>he(a)},null,8,["onClick"]),l(M,{icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:U=>we(a)},null,8,["onClick"])]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(n(),u(qe,{key:1,icon:"ri-folder-open-line",title:"لا توجد أقسام فرعية",message:R.value?"لا توجد نتائج تطابق بحثك":"يمكنك البدء بإضافة أقسام فرعية لهذا القسم","show-action":!0,"action-text":"إضافة قسم فرعي",onAction:ke},null,8,["message"]))])]),_:1})]),_:1}),l(ge,{modelValue:G.value,"onUpdate:modelValue":s[11]||(s[11]=a=>G.value=a),title:ie.value?"تعديل القسم الفرعي":"قسم فرعي جديد",icon:ie.value?"ri-edit-line":"ri-add-line",loading:le.value,onConfirm:Ce},{default:t(()=>[l(Ae,{ref_key:"formRef",ref:re,onSubmit:N(Ce,["prevent"])},{default:t(()=>[l(pe,null,{default:t(()=>[l(O,{cols:"12",class:"d-flex justify-center mb-4"},{default:t(()=>[d("div",{class:"category-image-zone position-relative cursor-pointer",onClick:s[8]||(s[8]=a=>ee.value=!0)},[l(te,{size:"100",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:t(()=>[W.value?(n(),u(Y,{key:0,src:W.value,cover:""},null,8,["src"])):(n(),u(C,{key:1,icon:"ri-image-add-line",size:"32",color:"grey-lighten-1"})),d("div",zl,[l(C,{icon:"ri-exchange-line",color:"white",size:"20"}),s[19]||(s[19]=d("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الصورة",-1))])]),_:1})])]),_:1}),l(O,{cols:"12"},{default:t(()=>[l(me,{modelValue:q.value.name,"onUpdate:modelValue":s[9]||(s[9]=a=>q.value.name=a),label:"اسم القسم *",rules:[a=>!!a||"مطلوب"]},null,8,["modelValue","rules"])]),_:1}),l(O,{cols:"12"},{default:t(()=>[l(se,{modelValue:q.value.active,"onUpdate:modelValue":s[10]||(s[10]=a=>q.value.active=a),label:"نشط","true-value":1,"false-value":0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),l(ge,{modelValue:Z.value,"onUpdate:modelValue":s[12]||(s[12]=a=>Z.value=a),title:"تأكيد الحذف",icon:"ri-delete-bin-line","confirm-color":"error",onConfirm:Re},{default:t(()=>{var a;return[s[20]||(s[20]=_(' هل أنت متأكد من حذف القسم الفرعي "')),d("strong",null,p((a=j.value)==null?void 0:a.name),1),s[21]||(s[21]=_('"؟ '))]}),_:1},8,["modelValue"]),l(je,{modelValue:ee.value,"onUpdate:modelValue":s[13]||(s[13]=a=>ee.value=a),type:"category",onSelect:Ee},null,8,["modelValue"])]),_:1},8,["model-value"]))}},Dl=$e(Ul,[["__scopeId","data-v-7a71bad7"]]),Al={class:"categories-page"},Sl={class:"page-header d-flex align-center justify-space-between mb-6"},Il={class:"d-flex align-center flex-wrap gap-4"},Tl={key:1,class:"content-container"},ql={class:"category-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Pl={class:"child-count-badge position-absolute",style:{top:"10px",left:"10px"}},jl={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},Ml={class:"d-flex align-center"},Bl={key:0,class:"text-truncate"},El={key:1,class:"text-grey-darken-1"},Ll=["onClick"],Rl={class:"d-flex flex-column"},Fl={class:"font-weight-bold text-subtitle-1"},Gl={class:"text-caption text-grey"},Nl={key:1,class:"text-grey text-caption"},Ol={class:"d-flex align-center justify-center"},Hl={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},Kl={__name:"CategoryList",setup(H){const B=(i,o)=>{let e;return(...m)=>{e&&clearTimeout(e),e=setTimeout(()=>i(...m),o)}},{can:f}=Ye(),$=be("/api/categories"),A=c(1),Q=c(12),x=c(""),b=c("grid"),I=c(!1),E=c(!1),g=c(null),k=c(!1),h=c(!1),oe=c(null),z=c(null),L=c(!1),R=c(null),T=c(!1),F=c(null),v=c({name:"",parent_id:null,active:1,image_id:null}),G=ce(()=>{var i;return!!((i=g.value)!=null&&i.id)}),Z=ce(()=>categories.value.filter(i=>{var o;return i.id!==((o=g.value)==null?void 0:o.id)})),ee=[{title:"الفئة",key:"name",sortable:!0},{title:"الفئة الرئيسية",key:"parent",sortable:!0},{title:"الحالة",key:"active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],W={required:i=>!!i||"مطلوب"},j=()=>{g.value=null,v.value={name:"",parent_id:null,active:1,image_id:null},F.value=null,I.value=!0},le=i=>{g.value=i,v.value={...i,active:i.active?1:0,parent_id:i.parent_id||null,image_id:i.image_id||null},F.value=i.image_url||null,I.value=!0},re=i=>{v.value.image_id=i.id,F.value=i.url,T.value=!1},J=async i=>{z.value=i.id;try{const o=i.active?0:1;await $.request("patch",`/${i.id}/toggle`),i.active=o}finally{z.value=null}},q=B(()=>{A.value=1,w()},500),ie=()=>{loading.value||categories.value.length>=total.value||(A.value++,w(!0))},ae=i=>{R.value=i,L.value=!0},de=i=>{b.value==="list"&&w()},ne=async()=>{const{valid:i}=await oe.value.validate();if(i){k.value=!0;try{G.value?await $.update(g.value.id,v.value,{successMessage:"تم التحديث بنجاح"}):await $.create(v.value,{successMessage:"تم الإضافة بنجاح"}),I.value=!1,w()}finally{k.value=!1}}},ye=async()=>{h.value=!0;try{await deleteCategory(g.value.id),E.value=!1,w()}finally{h.value=!1}},P=i=>{g.value=i,E.value=!0},w=(i={})=>{const o=i===!0;fetchCategories({page:A.value,per_page:Q.value,search:x.value,parent_id:x.value?null:"null"},{append:o})};return We(async()=>{const i=route.query.category_id;if(i)try{const o=await $.request("get",`/${i}`);o.data&&(R.value=o.data,L.value=!0)}catch{router.replace({query:{...route.query,category_id:void 0}})}w()}),X(L,i=>{if(!i){const{category_id:o,...e}=route.query;router.replace({query:e})}}),X(A,()=>{b.value==="list"&&w()}),X(Q,()=>{b.value==="list"&&(A.value=1,w())}),X(b,()=>{A.value=1,w()}),(i,o)=>(n(),V("div",Al,[d("div",Sl,[o[15]||(o[15]=d("div",null,[d("h1",{class:"text-h4 font-weight-bold ml-2"},"الفئات"),d("p",{class:"text-body-1 text-grey"},"إدارة وتحليل فئات المنتجات")],-1)),y(f)("categories.create")?(n(),u(S,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:j},{default:t(()=>o[14]||(o[14]=[_(" فئة جديدة ")])),_:1})):D("",!0)]),l(xe,{class:"mb-6"},{default:t(()=>[d("div",Il,[l(me,{modelValue:x.value,"onUpdate:modelValue":[o[0]||(o[0]=e=>x.value=e),y(q)],label:"بحث عن فئة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(ve),l(Ue,{variant:"outlined",density:"comfortable",color:"primary"},{default:t(()=>[l(S,{active:b.value==="grid",icon:"ri-grid-fill",onClick:o[1]||(o[1]=e=>b.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(S,{active:b.value==="list",icon:"ri-list-check",onClick:o[2]||(o[2]=e=>b.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),i.loading&&!i.categories.length?(n(),u(Te,{key:0,size:"64",text:"جاري تحميل الفئات..."})):(n(),V("div",Tl,[i.categories.length?(n(),V(fe,{key:1},[b.value==="grid"?(n(),u(Pe,{key:0,loading:i.loading&&i.categories.length>0,"has-more":i.categories.length<i.total,"no-more-text":"لا يوجد المزيد من الفئات",onLoad:ie},{default:t(()=>[l(pe,null,{default:t(()=>[(n(!0),V(fe,null,De(i.categories,e=>(n(),u(O,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[l(xe,{class:"category-card h-100","no-padding":"",onClick:m=>ae(e)},{actions:t(()=>[l(S,{"prepend-icon":"ri-arrow-right-up-line",variant:"text",color:"info",size:"small",onClick:N(m=>ae(e),["stop"])},{default:t(()=>o[17]||(o[17]=[_(" دخول ")])),_:2},1032,["onClick"]),l(ve),y(f)("categories.update_all",{resource:e})?(n(),u(S,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",onClick:N(m=>le(e),["stop"])},null,8,["onClick"])):D("",!0),y(f)("categories.delete_all",{resource:e})?(n(),u(S,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:N(m=>P(e),["stop"])},null,8,["onClick"])):D("",!0)]),default:t(()=>[d("div",ql,[l(te,{size:"100",rounded:"circle",color:e.active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white overflow-hidden"},{default:t(()=>[e.image_url?(n(),u(Y,{key:0,src:e.image_url,cover:""},null,8,["src"])):(n(),u(C,{key:1,icon:e.children_count>0?"ri-folder-fill":"ri-folder-line",size:"60",color:e.active?e.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),_:2},1032,["color"]),d("div",Pl,[e.products_count?(n(),u(K,{key:0,size:"x-small",color:"secondary",variant:"flat"},{default:t(()=>[_(p(e.products_count)+" منتج ",1)]),_:2},1024)):D("",!0)])]),l(Se,{class:"position-relative pt-4"},{default:t(()=>[l(_e,{class:"text-h6 font-weight-bold pa-0 mb-1 text-truncate"},{default:t(()=>[_(p(e.name),1)]),_:2},1024),d("div",jl,[d("div",Ml,[o[16]||(o[16]=d("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),l(K,{color:e.active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:t(()=>[_(p(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),y(f)("categories.update_all",{resource:e})?(n(),u(se,{key:0,"model-value":!!e.active,loading:z.value===e.id,onClick:o[3]||(o[3]=N(()=>{},["stop"])),"onUpdate:modelValue":m=>J(e)},null,8,["model-value","loading","onUpdate:modelValue"])):D("",!0)]),l(Xe,{class:"pa-0 d-flex align-center mt-1"},{default:t(()=>{var m;return[l(C,{icon:"ri-node-tree",size:"14",class:"me-1"}),(m=e.parent)!=null&&m.name?(n(),V("span",Bl,"داخل "+p(e.parent.name),1)):(n(),V("span",El,"قسم رئيسي"))]}),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),u(Ie,{key:1,headers:ee,items:i.categories,"total-items":i.total,loading:i.loading,page:A.value,"onUpdate:page":o[4]||(o[4]=e=>A.value=e),"items-per-page":Q.value,"onUpdate:itemsPerPage":o[5]||(o[5]=e=>Q.value=e),searchable:!1,"can-view":!1,"can-edit":!1,"can-delete":!1,"permission-module":"categories","onUpdate:options":de},{"item.name":t(({item:e})=>[d("div",{class:"d-flex align-center py-2 cursor-pointer",onClick:m=>ae(e)},[l(te,{size:"48",rounded:"circle",color:e.active?"bg-white":"grey-lighten-4",class:"me-3 border overflow-hidden"},{default:t(()=>[e.image_url?(n(),u(Y,{key:0,src:e.image_url,cover:""},null,8,["src"])):(n(),u(C,{key:1,icon:e.children_count>0?"ri-folder-fill":"ri-folder-line",size:"24",color:e.active?e.children_count>0?"primary":"info":"grey"},null,8,["icon","color"]))]),_:2},1032,["color"]),d("div",Rl,[d("span",Fl,p(e.name),1),d("span",Gl,"كود: "+p(e.id),1)])],8,Ll)]),"item.parent":t(({item:e})=>{var m;return[(m=e.parent)!=null&&m.name?(n(),u(K,{key:0,size:"small",variant:"tonal",color:"info","prepend-icon":"ri-corner-down-right-line"},{default:t(()=>[_(p(e.parent.name),1)]),_:2},1024)):(n(),V("span",Nl,"قسم رئيسي"))]}),"item.active":t(({item:e})=>[d("div",Ol,[i.canUpdate(e)?(n(),V("span",{key:0,class:ze(["text-caption me-2 font-weight-bold",e.active?"text-success":"text-error"])},p(e.active?"نشط":"معطل"),3)):D("",!0),y(f)("categories.update_all",{resource:e})?(n(),u(se,{key:1,"model-value":!!e.active,loading:z.value===e.id,"onUpdate:modelValue":m=>J(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(n(),u(K,{key:2,color:e.active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:t(()=>[_(p(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":t(({item:e})=>[l(S,{icon:"ri-arrow-right-up-line",variant:"text",color:"info",size:"small",onClick:m=>ae(e),title:"دخول القسم"},null,8,["onClick"]),y(f)("categories.update_all",{resource:e})?(n(),u(S,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:m=>le(e)},null,8,["onClick"])):D("",!0),y(f)("categories.delete_all",{resource:e})?(n(),u(S,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:m=>P(e)},null,8,["onClick"])):D("",!0)]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(n(),u(qe,{key:0,icon:"ri-folder-line",title:"لا توجد فئات حالياً",message:x.value?"لا توجد نتائج تطابق بحثك":"ابدأ بإضافة أول فئة لنظامك","show-action":y(f)("categories.create"),"action-text":"إضافة فئة",onAction:j},null,8,["message","show-action"]))])),l(ge,{modelValue:I.value,"onUpdate:modelValue":o[10]||(o[10]=e=>I.value=e),title:G.value?"تعديل الفئة":"فئة جديدة",icon:G.value?"ri-edit-line":"ri-add-line",loading:k.value,onConfirm:ne},{default:t(()=>[l(Ae,{ref_key:"formRef",ref:oe,onSubmit:N(ne,["prevent"])},{default:t(()=>[l(pe,null,{default:t(()=>[l(O,{cols:"12",class:"d-flex justify-center mb-4"},{default:t(()=>[d("div",{class:"category-image-zone position-relative cursor-pointer",onClick:o[6]||(o[6]=e=>T.value=!0)},[l(te,{size:"120",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:t(()=>[F.value?(n(),u(Y,{key:0,src:F.value,cover:""},null,8,["src"])):(n(),u(C,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),d("div",Hl,[l(C,{icon:"ri-exchange-line",color:"white",size:"24"}),o[18]||(o[18]=d("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الصورة",-1))])]),_:1})])]),_:1}),l(O,{cols:"12"},{default:t(()=>[l(me,{modelValue:v.value.name,"onUpdate:modelValue":o[7]||(o[7]=e=>v.value.name=e),label:"اسم الفئة *",rules:[W.required]},null,8,["modelValue","rules"])]),_:1}),l(O,{cols:"12"},{default:t(()=>[l(Je,{modelValue:v.value.parent_id,"onUpdate:modelValue":o[8]||(o[8]=e=>v.value.parent_id=e),items:Z.value,"item-title":"name","item-value":"id",label:"الفئة الرئيسية",variant:"outlined",density:"comfortable",clearable:"",placeholder:"اختر الفئة الرئيسية (اختياري)"},null,8,["modelValue","items"])]),_:1}),l(O,{cols:"12"},{default:t(()=>[l(se,{modelValue:v.value.active,"onUpdate:modelValue":o[9]||(o[9]=e=>v.value.active=e),label:"نشط","true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),l(ge,{modelValue:E.value,"onUpdate:modelValue":o[11]||(o[11]=e=>E.value=e),title:"تأكيد الحذف",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف",loading:h.value,onConfirm:ye},{default:t(()=>{var e;return[o[19]||(o[19]=_(' هل أنت متأكد من حذف "')),d("strong",null,p((e=g.value)==null?void 0:e.name),1),o[20]||(o[20]=_('"؟ '))]}),_:1},8,["modelValue","loading"]),l(Dl,{modelValue:L.value,"onUpdate:modelValue":o[12]||(o[12]=e=>L.value=e),"initial-category":R.value,onUpdateRoot:w},null,8,["modelValue","initial-category"]),l(je,{modelValue:T.value,"onUpdate:modelValue":o[13]||(o[13]=e=>T.value=e),type:"category",onSelect:re},null,8,["modelValue"])]))}},ra=$e(Kl,[["__scopeId","data-v-747ebf75"]]);export{ra as default};
