import{_ as U,r,P as _,w as $,aj as q,o as u,c as y,d as a,j as s,a9 as f,b as m,t as M,a5 as S,U as j,ap as E,a as o,ay as L,M as B,a1 as X,k as x,az as Z,a4 as G,F as D,A as H,p as J,D as K,a8 as O,aq as Q,X as W,ao as Y,Z as ee}from"./index-Tc2OuKZg.js";const le={class:"d-flex justify-end pa-1"},ae={key:2,class:"d-flex flex-column justify-center align-center text-center text-grey-darken-1 flex-grow-1"},te={__name:"ImagePickerDialog",props:{modelValue:Boolean,buttonText:{type:String,default:"اختيار صورة"},multiple:{type:Boolean,default:!1}},emits:["update:modelValue","close"],setup(k,{emit:A}){const g=k,V=A,c=r(!1),d=r([]),t=r([]),i=r([]),v=r(!1),p=r(!1),b=r(null);_(()=>{C()}),$(()=>g.modelValue,e=>{c.value=e,e&&(C(),t.value=[])});const w=()=>{V("update:modelValue",!1),c.value=!1,i.value=[]},T=()=>{const e=g.multiple?t.value:t.value[0];console.log("Selected images:",e),V("close",e),w()},C=async()=>{v.value=!0;try{const e=await q("images",{is_temp:1});d.value=e.data}catch(e){console.error("خطأ في تحميل الصور:",e)}finally{v.value=!1}},z=async()=>{if(t.value.length)try{const e=t.value.map(l=>l.id);await Y("images/delete",{ids:e}),d.value=d.value.filter(l=>!e.includes(l.id)),t.value=[]}catch(e){console.error("خطأ في حذف الصور:",e)}},F=()=>{b.value.$el.querySelector('input[type="file"]').click()},N=()=>{i.value&&i.value.length>0&&P()},P=async()=>{if(i.value.length){p.value=!0;try{const{data:e}=await ee("image",{images:i.value});console.log("Upload response data:",e),e&&Array.isArray(e)?d.value.unshift(...e):e&&d.value.unshift(e),i.value=[]}catch(e){console.error("خطأ في رفع الصور:",e)}finally{p.value=!1}}},I=e=>t.value.some(l=>l.id===e),R=e=>{var l;if(g.multiple){const n=t.value.findIndex(h=>h.id===e.id);n>-1?t.value.splice(n,1):t.value.push(e)}else t.value=((l=t.value[0])==null?void 0:l.id)===e.id?[]:[e]};return _(()=>{}),(e,l)=>(u(),y(D,null,[a(S,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:s(()=>[a(f,{onClick:l[0]||(l[0]=n=>c.value=!0)},{default:s(()=>[m(M(k.buttonText),1)]),_:1})]),_:1}),a(W,{modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=n=>c.value=n),"max-width":"900",scrollable:"",persistent:""},{default:s(()=>[a(j,{rounded:"lg"},{default:s(()=>[a(E,{class:"d-flex justify-space-between align-center py-4 px-6 bg-blue-grey-lighten-5"},{default:s(()=>[l[4]||(l[4]=o("span",{class:"text-h6 font-weight-bold text-blue-grey-darken-3"},"مكتبة الصور",-1)),a(f,{color:"blue-grey-darken-2",variant:"flat",rounded:"pill",size:"small",class:"text-caption font-weight-bold",onClick:F,loading:p.value,disabled:p.value},{default:s(()=>l[3]||(l[3]=[o("i",{class:"ri-add-line mr-1"},null,-1),m(" إضافة صور من الجهاز ")])),_:1},8,["loading","disabled"]),a(L,{ref_key:"fileInputRef",ref:b,modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=n=>i.value=n),multiple:"",accept:"image/*",class:"d-none",onChange:N},null,8,["modelValue"])]),_:1}),a(B),a(X,{class:"pa-4 image-grid-container"},{default:s(()=>[v.value?(u(),x(Z,{key:0,indeterminate:"",color:"primary",class:"d-flex justify-center align-center w-100",size:"64",width:"6"})):d.value.length>0?(u(),x(G,{key:1,dense:""},{default:s(()=>[(u(!0),y(D,null,H(d.value,n=>(u(),x(S,{key:n.id,cols:"6",sm:"4",md:"3",lg:"2",class:"pa-"},{default:s(()=>[a(j,{outlined:"",class:J(["image-card d-flex flex-column",{"selected-card":I(n.id)}]),onClick:h=>R(n),rounded:"md",elevation:"2"},{default:s(()=>[a(K,{src:n.url,height:"100",cover:"",class:"rounded-t-md"},null,8,["src"]),o("div",le,[a(O,{"model-value":I(n.id),"hide-details":"",density:"compact",class:"ma-0 pa-0",color:"primary"},null,8,["model-value"])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})):(u(),y("div",ae,l[5]||(l[5]=[o("i",{class:"ri-image-line text-h1 mb-4"},null,-1),o("p",{class:"text-h6 font-weight-medium"},"لا توجد صور لعرضها بعد.",-1),o("p",{class:"text-body-2"},"يمكنك البدء بإضافة صور جديدة إلى مكتبتك.",-1)])))]),_:1}),a(B),a(Q,{class:"d-flex justify-end py-3 px-6 sticky-actions"},{default:s(()=>[a(f,{color:"red-darken-1",variant:"flat",rounded:"pill",onClick:z,disabled:!t.value.length,class:"mr-2"},{default:s(()=>l[6]||(l[6]=[o("i",{class:"ri-delete-bin-line mr-1"},null,-1),m(" حذف ")])),_:1},8,["disabled"]),a(f,{color:"primary",variant:"flat",rounded:"pill",onClick:T,disabled:!t.value.length,class:"mr-2"},{default:s(()=>l[7]||(l[7]=[o("i",{class:"ri-check-line mr-1"},null,-1),m(" تعيين ")])),_:1},8,["disabled"]),a(f,{color:"grey-darken-1",variant:"outlined",rounded:"pill",onClick:w},{default:s(()=>l[8]||(l[8]=[o("i",{class:"ri-close-line mr-1"},null,-1),m(" إلغاء ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ne=U(te,[["__scopeId","data-v-7afa80c1"]]);export{ne as I};
