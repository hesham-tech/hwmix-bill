import{u as D}from"./useApi-CjhFmPue.js";import{u as S}from"./usePrintExport-DBoRVp2V.js";import{_ as T}from"./AppCard-CXpBKc1t.js";import{_ as g}from"./AppButton-CREzoRf6.js";import{_ as b}from"./AppInput-06Y7zOXl.js";import{A as E}from"./AppDataTable-CnA5lOqV.js";import{r as p,J as R,c as q,a,b as e,w as o,d as h,o as B,l as u,e as n,f as v,a1 as x,t as i,B as I,g as N}from"./index-CuR9-sbN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"profit-report-page"},P={class:"mb-6 px-6 pt-6 d-flex align-center justify-space-between"},$={class:"d-flex gap-2"},z={class:"text-h4 font-weight-black text-success"},F={class:"text-h4 font-weight-black text-error"},G={class:"text-h4 font-weight-black text-info"},O={class:"px-6 mb-4"},U={class:"px-6 pb-6"},j={class:"font-weight-black text-body-1 text-success"},J={class:"text-center pa-10"},tt={__name:"ProfitReport",setup(L){const y=D("/api/invoices"),{exportToCSV:w}=S(),m=p(!1),r=p({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),d=p({total_revenue:0,total_cost:0,net_profit:0}),c=p([]),k=[{title:"المنتج",key:"product_name"},{title:"الكمية المباعة",key:"quantity_sold",align:"center"},{title:"إجمالي الربح",key:"profit",align:"end"},{title:"هامش الربح",key:"margin",align:"center"}],f=s=>s?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s):"0.00 ج.م",V=()=>{const s=c.value.map(t=>({المنتج:t.product_name,"الكمية المباعة":t.quantity_sold,الربح:t.profit,"الهامش %":t.margin}));w(s,"تقرير_الأرباح.csv",["المنتج","الكمية المباعة","الربح","الهامش %"])},_=async()=>{m.value=!0;try{const t=(await y.get({...r.value,per_page:100},{showLoading:!1})).data||[];let l=0;t.forEach(C=>l+=parseFloat(C.total||0)),d.value={total_revenue:l,total_cost:l*.7,net_profit:l*.3},c.value=[{product_name:"منتج عينة 1",quantity_sold:45,profit:l*.1,margin:22},{product_name:"منتج عينة 2",quantity_sold:22,profit:l*.05,margin:18}]}finally{m.value=!1}};return R(_),(s,t)=>(B(),q("div",A,[a("div",P,[t[4]||(t[4]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold"},"تحليل الأرباح والهوامش"),a("p",{class:"text-body-1 text-grey"},"نظرة شاملة على الربحية التشغيلية وهوامش الربح لكل منتج")],-1)),a("div",$,[e(g,{variant:"tonal",color:"success","prepend-icon":"ri-download-line",onClick:V,disabled:!c.value.length},{default:o(()=>t[2]||(t[2]=[u(" تصدير CSV ")])),_:1},8,["disabled"]),e(g,{color:"primary","prepend-icon":"ri-refresh-line",onClick:_},{default:o(()=>t[3]||(t[3]=[u(" تحديث البيانات ")])),_:1})])]),e(h,{class:"px-6 mx-0 mb-6",dense:""},{default:o(()=>[e(n,{cols:"12",md:"4"},{default:o(()=>[e(v,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-success"},{default:o(()=>[e(x,{class:"pa-4 bg-success-lighten-5"},{default:o(()=>[t[5]||(t[5]=a("div",{class:"text-caption font-weight-bold text-success mb-1"},"إجمالي الإيرادات",-1)),a("div",z,i(f(d.value.total_revenue)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:o(()=>[e(v,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-error"},{default:o(()=>[e(x,{class:"pa-4 bg-error-lighten-5"},{default:o(()=>[t[6]||(t[6]=a("div",{class:"text-caption font-weight-bold text-error mb-1"},"إجمالي التكاليف (تقديري)",-1)),a("div",F,i(f(d.value.total_cost)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:o(()=>[e(v,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-info"},{default:o(()=>[e(x,{class:"pa-4 bg-info-lighten-5"},{default:o(()=>[t[7]||(t[7]=a("div",{class:"text-caption font-weight-bold text-info mb-1"},"صافي الربح",-1)),a("div",G,i(f(d.value.net_profit)),1)]),_:1})]),_:1})]),_:1})]),_:1}),a("div",O,[e(T,{title:"فترة التحليل",icon:"ri-time-line"},{default:o(()=>[e(h,{dense:""},{default:o(()=>[e(n,{cols:"12",sm:"4"},{default:o(()=>[e(b,{modelValue:r.value.date_from,"onUpdate:modelValue":t[0]||(t[0]=l=>r.value.date_from=l),label:"من تاريخ",type:"date","prepend-inner-icon":"ri-calendar-line"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",sm:"4"},{default:o(()=>[e(b,{modelValue:r.value.date_to,"onUpdate:modelValue":t[1]||(t[1]=l=>r.value.date_to=l),label:"إلى تاريخ",type:"date","prepend-inner-icon":"ri-calendar-check-line"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",sm:"4",class:"d-flex align-center pt-2"},{default:o(()=>[e(g,{color:"secondary",block:"","prepend-icon":"ri-refresh-line",onClick:_,variant:"tonal"},{default:o(()=>t[8]||(t[8]=[u(" عرض تقرير الربحية ")])),_:1})]),_:1})]),_:1})]),_:1})]),a("div",U,[e(E,{headers:k,items:c.value,loading:m.value,title:"المنتجات الأكثر ربحية",icon:"ri-line-chart-line"},{"item.profit":o(({item:l})=>[a("div",j,i(f(l.profit)),1)]),"item.margin":o(({item:l})=>[e(I,{size:"small",variant:"flat",color:"info-lighten-5",class:"text-info font-weight-black px-3"},{default:o(()=>[u(i(l.margin)+"% ",1)]),_:2},1024)]),"no-data":o(()=>[a("div",J,[e(N,{icon:"ri-bar-chart-linked",size:"64",color:"grey-lighten-2",class:"mb-4"}),t[9]||(t[9]=a("div",{class:"text-h6 text-grey font-weight-medium"},"لا توجد سجلات أرباح للفترة المحددة",-1))])]),_:1},8,["items","loading"])])]))}};export{tt as default};
