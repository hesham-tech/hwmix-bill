import{u as R}from"./useApi-CTBDEoea.js";import{u as S}from"./usePrintExport-BD2QUCTi.js";import{R as T}from"./ReportLayout-D5K90SqV.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{y as w,s as A,o as x,v as k,w as o,b as l,a1 as B,a as n,c as I,E as M,f as h,r as f,K as O,m as j,e as y,t as u,u as m,z as D,d as z}from"./index-DPR0tjT6.js";import{A as N}from"./AppDataTable-CV9gFKLg.js";import{_ as E}from"./AppInput-CYR4AaBJ.js";import{_ as L}from"./AppButton-DiF3_7lr.js";import{f as _}from"./formatters-CKQiR5Fb.js";import"./usePermissions-BOh6stgy.js";const P={class:"chart-wrapper"},U={key:1,class:"d-flex align-center justify-center height-300"},K={__name:"CashFlowChart",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(g){const v=g,c=w(()=>{const t={};return v.data.forEach(a=>{const r=a.transaction_date;t[r]||(t[r]={income:0,expense:0}),a.type==="income"?t[r].income+=parseFloat(a.amount):t[r].expense+=Math.abs(parseFloat(a.amount))}),Object.keys(t).sort().map(a=>({date:a,income:t[a].income,expense:t[a].expense}))}),i=w(()=>[{name:"المقبوضات",data:c.value.map(t=>t.income)},{name:"المدفوعات",data:c.value.map(t=>t.expense)}]),d=w(()=>({chart:{type:"line",toolbar:{show:!1},fontFamily:"Inter, sans-serif"},stroke:{curve:"smooth",width:3},xaxis:{categories:c.value.map(t=>t.date),labels:{style:{colors:"#64748b"}}},yaxis:{labels:{formatter:t=>`${t} ج.م`,style:{colors:"#64748b"}}},colors:["#10b981","#ef4444"],grid:{borderColor:"#f1f5f9"},tooltip:{theme:"light"},legend:{position:"top",horizontalAlign:"right"}}));return(t,a)=>{const r=A("apexchart");return x(),k(h,{variant:"flat",border:"",class:"chart-card rounded-xl overflow-hidden pa-1"},{default:o(()=>[l(B,{class:"pa-4"},{default:o(()=>[a[0]||(a[0]=n("div",{class:"d-flex align-center justify-space-between mb-4"},[n("div",null,[n("div",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1"},"السيولة النقدية"),n("h3",{class:"text-h6 font-weight-black"},"حركة المقبوضات والمدفوعات")])],-1)),n("div",P,[g.loading?(x(),I("div",U,[l(M,{indeterminate:"",color:"primary"})])):(x(),k(r,{key:0,type:"line",height:"300",options:d.value,series:i.value},null,8,["options","series"]))])]),_:1})]),_:1})}}},q=$(K,[["__scopeId","data-v-0713f4c1"]]),G={class:"d-flex flex-column gap-4"},H={class:"text-h4 font-weight-black text-success"},J={class:"text-h4 font-weight-black text-error"},lt={__name:"CashFlowReport",setup(g){const v=R("/api/transactions"),{exportToCSV:c}=S(),i=f(!1),d=f({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),t=f({total_inflow:0,total_outflow:0,net_flow:0}),a=f([]),r=[{title:"التاريخ",key:"transaction_date"},{title:"الخزينة",key:"cash_box.name"},{title:"المبلغ",key:"amount",align:"end"},{title:"البيان",key:"description"}],b=async()=>{i.value=!0;try{const p=await v.get({...d.value,per_page:100},{showLoading:!1});a.value=p.data||[];let e=0,s=0;a.value.forEach(C=>{const V=parseFloat(C.amount||0);C.type==="income"?e+=V:s+=Math.abs(V)}),t.value={total_inflow:e,total_outflow:s,net_flow:e-s}}finally{i.value=!1}},F=()=>{const p=a.value.map(e=>{var s;return{التاريخ:e.transaction_date,الخزينة:((s=e.cash_box)==null?void 0:s.name)||"-",المقدار:e.amount,البيان:e.description}});c(p,"تقرير_التدفق_النقدي.csv")};return O(b),(p,e)=>(x(),k(T,{title:"تقرير التدفقات النقدية",description:"تحليل المقبوضات والمدفوعات وحركة السيولة في الصناديق",loading:i.value,onRefresh:b,onExport:F},{filters:o(()=>[n("div",G,[l(E,{modelValue:d.value.date_from,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.date_from=s),label:"من تاريخ",type:"date"},null,8,["modelValue"]),l(E,{modelValue:d.value.date_to,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.date_to=s),label:"إلى تاريخ",type:"date"},null,8,["modelValue"]),l(L,{color:"primary",block:"",onClick:b},{default:o(()=>e[2]||(e[2]=[j("تحديث البيانات")])),_:1})])]),summary:o(()=>[l(z,{dense:""},{default:o(()=>[l(y,{cols:"12",md:"4"},{default:o(()=>[l(h,{border:"",flat:"",class:"rounded-xl pa-4 bg-success-lighten-5 border-success"},{default:o(()=>[e[3]||(e[3]=n("div",{class:"text-caption font-weight-bold text-success"},"إجمالي المقبوضات (+)",-1)),n("div",H,u(m(_)(t.value.total_inflow)),1)]),_:1})]),_:1}),l(y,{cols:"12",md:"4"},{default:o(()=>[l(h,{border:"",flat:"",class:"rounded-xl pa-4 bg-error-lighten-5 border-error"},{default:o(()=>[e[4]||(e[4]=n("div",{class:"text-caption font-weight-bold text-error"},"إجمالي المدفوعات (-)",-1)),n("div",J,u(m(_)(t.value.total_outflow)),1)]),_:1})]),_:1}),l(y,{cols:"12",md:"4"},{default:o(()=>[l(h,{border:"",flat:"",class:"rounded-xl pa-4 bg-info-lighten-5 border-info"},{default:o(()=>[e[5]||(e[5]=n("div",{class:"text-caption font-weight-bold text-info"},"صافي التدفق",-1)),n("div",{class:D(["text-h4 font-weight-black",t.value.net_flow>=0?"text-info":"text-error"])},u(m(_)(t.value.net_flow)),3)]),_:1})]),_:1})]),_:1})]),charts:o(()=>[l(q,{data:a.value,loading:i.value},null,8,["data","loading"])]),table:o(()=>[l(N,{headers:r,items:a.value,loading:i.value,title:"سجل حركات الخزينة",icon:"ri-history-line"},{"item.amount":o(({item:s})=>[n("div",{class:D([s.type==="income"?"text-success":"text-error","font-weight-black pr-4"])},u(s.type==="income"?"+":"-")+" "+u(m(_)(Math.abs(s.amount))),3)]),_:1},8,["items","loading"])]),_:1},8,["loading"]))}};export{lt as default};
