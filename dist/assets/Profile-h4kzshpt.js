import{a as A,y as B,r as _,an as D,L as I,c as R,b as i,d as e,w as t,e as U,s as j,o as L,f as u,a3 as N,i as F,H as G,l as k,v as g,u as p,D as P,n as S,O as z,k as T,R as E,Q as C}from"./index-B0c0aplS.js";import{u as H}from"./useApi-C9JqAxpT.js";import{_ as b}from"./AppCard-D6Bc5W2v.js";import{_ as m}from"./AppInput-B9V4fNt_.js";import{_ as O}from"./AppButton-CoaWq9vh.js";import{M as Q}from"./MediaGallery-Cu0QDM2K.js";import{A as J}from"./AppAvatar-Cq13ChFd.js";/* empty css                                                                  */const K={class:"profile-page"},W={class:"change-overlay d-flex flex-column align-center justify-center"},X={class:"text-h6 font-weight-bold mb-1"},Y={class:"d-flex justify-space-around"},Z={class:"text-center"},ee={class:"text-body-1 font-weight-bold"},se={class:"text-center"},le={class:"text-body-1 font-weight-bold text-success"},ae={class:"d-flex justify-end gap-3 mt-6"},re={__name:"Profile",setup(te){const o=B(),M=H("/api/users"),y=_(null),V=_(!1),f=_(!1),n=_({}),l=D({id:null,first_name:"",last_name:"",nickname:"",username:"",position:"",email:"",phone:"",avatar_url:"",images_ids:[]}),c={required:r=>!!r||"هذا الحقل مطلوب",email:r=>/.+@.+\..+/.test(r)||"يرجى إدخال بريد إلكتروني صحيح"},$=r=>{l.avatar_url=r.url,l.images_ids=[r.id],j.success("تم اختيار الصورة بنجاح")},x=()=>{const r=o.currentUser;r&&(l.id=r.id,l.first_name=r.first_name||"",l.last_name=r.last_name||"",l.nickname=r.nickname||"",l.username=r.username||"",l.position=r.position||"",l.email=r.email||"",l.phone=r.phone||"",l.avatar_url=r.avatar_url||"",l.images_ids=[])},q=async()=>{var s,a;const{valid:r}=await y.value.validate();if(r){V.value=!0,n.value={};try{const d={...l};d.images_ids.length===0&&delete d.images_ids,await M.update(l.id,d,{successMessage:"تم تحديث بيانات ملفك الشخصي بنجاح"}),await o.fetchUser()}catch(d){(a=(s=d.response)==null?void 0:s.data)!=null&&a.errors&&(n.value=d.response.data.errors)}finally{V.value=!1}}};return I(()=>{o.currentUser?x():o.fetchUser().then(x)}),(r,s)=>(L(),R("div",K,[s[14]||(s[14]=i("div",{class:"page-header mb-8"},[i("h1",{class:"text-h3 font-weight-bold primary--text mb-2"},"الملف الشخصي"),i("p",{class:"text-subtitle-1 text-grey-darken-1"},"إدارة بياناتك الشخصية وإعدادات الحساب")],-1)),e(U,{class:"pb-16 mb-16"},{default:t(()=>[e(u,{cols:"12",lg:"4"},{default:t(()=>[e(b,{title:"الصورة الشخصية",icon:"ri-user-smile-line",class:"mb-6","no-padding":""},{default:t(()=>[e(N,{class:"pa-8 text-center bg-grey-lighten-5"},{default:t(()=>{var a,d,h,w;return[i("div",{class:"avatar-preview-zone mx-auto mb-6 cursor-pointer",onClick:s[1]||(s[1]=v=>f.value=!0)},[e(J,{"img-url":l.avatar_url,name:l.nickname||l.full_name,size:"180",type:"user",class:"border-2 border-dashed elevation-3 hover-scale overflow-hidden"},null,8,["img-url","name"]),i("div",W,[e(F,{icon:"ri-camera-switch-line",color:"white",size:"32"}),s[10]||(s[10]=i("span",{class:"text-white text-subtitle-2 mt-2 font-weight-bold"},"تغيير الصورة",-1))]),e(G,{icon:"ri-gallery-upload-line",size:"small",color:"primary",class:"position-absolute bottom-0 right-0 elevation-6",onClick:s[0]||(s[0]=k(v=>f.value=!0,["stop"]))})]),i("h3",X,g(((a=p(o).currentUser)==null?void 0:a.nickname)||((d=p(o).currentUser)==null?void 0:d.full_name)),1),e(P,{color:"primary",variant:"tonal",size:"small",class:"mb-4"},{default:t(()=>{var v;return[S(g(((v=p(o).currentUser)==null?void 0:v.role)||"مستخدم"),1)]}),_:1}),e(z,{class:"mb-4"}),i("div",Y,[i("div",Z,[s[11]||(s[11]=i("div",{class:"text-caption text-grey"},"كود المستخدم",-1)),i("div",ee,"#"+g((h=p(o).currentUser)==null?void 0:h.id),1)]),e(z,{vertical:"",inset:""}),i("div",se,[s[12]||(s[12]=i("div",{class:"text-caption text-grey"},"الرصيد الحالي",-1)),i("div",le,g(((w=p(o).currentUser)==null?void 0:w.balance)||0),1)])])]}),_:1})]),_:1}),e(b,{title:"معلومات الحساب",icon:"ri-key-line",class:"mb-6"},{default:t(()=>[e(m,{modelValue:l.username,"onUpdate:modelValue":s[2]||(s[2]=a=>l.username=a),label:"اسم المستخدم (Username)","prepend-inner-icon":"ri-at-line",dir:"ltr",placeholder:"مثال: hwmix_owner","error-messages":n.value.username},null,8,["modelValue","error-messages"]),e(m,{modelValue:l.position,"onUpdate:modelValue":s[3]||(s[3]=a=>l.position=a),label:"المسمى الوظيفي","prepend-inner-icon":"ri-briefcase-line",placeholder:"مثال: مدير مبيعات، عميل مميز...","error-messages":n.value.position},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(u,{cols:"12",lg:"8"},{default:t(()=>[e(T,{ref_key:"formRef",ref:y,onSubmit:k(q,["prevent"])},{default:t(()=>[e(b,{title:"البيانات الشخصية",icon:"ri-profile-line",class:"mb-6"},{default:t(()=>[e(U,null,{default:t(()=>[e(u,{cols:"12",md:"4"},{default:t(()=>[e(m,{modelValue:l.first_name,"onUpdate:modelValue":s[4]||(s[4]=a=>l.first_name=a),label:"الاسم الأول *","prepend-inner-icon":"ri-user-line",rules:[c.required],"error-messages":n.value.first_name},null,8,["modelValue","rules","error-messages"])]),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>[e(m,{modelValue:l.last_name,"onUpdate:modelValue":s[5]||(s[5]=a=>l.last_name=a),label:"الاسم الأخير *","prepend-inner-icon":"ri-user-line",rules:[c.required],"error-messages":n.value.last_name},null,8,["modelValue","rules","error-messages"])]),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>[e(m,{modelValue:l.nickname,"onUpdate:modelValue":s[6]||(s[6]=a=>l.nickname=a),label:"الاسم المستعار / اللقب *","prepend-inner-icon":"ri-user-heart-line",rules:[c.required],"error-messages":n.value.nickname},null,8,["modelValue","rules","error-messages"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:l.email,"onUpdate:modelValue":s[7]||(s[7]=a=>l.email=a),label:"البريد الإلكتروني","prepend-inner-icon":"ri-mail-line",type:"email",dir:"ltr",rules:l.email?[c.email]:[],"error-messages":n.value.email},null,8,["modelValue","rules","error-messages"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:l.phone,"onUpdate:modelValue":s[8]||(s[8]=a=>l.phone=a),label:"رقم الهاتف *","prepend-inner-icon":"ri-phone-line",dir:"ltr",rules:[c.required],"error-messages":n.value.phone},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1}),i("div",ae,[e(O,{size:"large","prepend-icon":"ri-save-fill",loading:V.value,class:"px-8 font-weight-bold",type:"submit"},{default:t(()=>s[13]||(s[13]=[S(" حفظ التغييرات ")])),_:1},8,["loading"])])]),_:1},512)]),_:1}),e(u,{cols:"12",lg:"4"},{default:t(()=>[e(b,{title:"إجراءات سريعة",icon:"ri-flashlight-line"},{default:t(()=>[e(E,{density:"compact",nav:""},{default:t(()=>{var a;return[e(C,{"prepend-icon":"ri-lock-password-line",title:"تغيير كلمة المرور",to:"/forgot-password"}),e(C,{"prepend-icon":"ri-history-line",title:"سجل نشاطاتي",to:`/activity-logs?user_id=${(a=p(o).currentUser)==null?void 0:a.id}`},null,8,["to"])]}),_:1})]),_:1})]),_:1})]),_:1}),e(Q,{modelValue:f.value,"onUpdate:modelValue":s[9]||(s[9]=a=>f.value=a),type:"avatar",onSelect:$},null,8,["modelValue"])]))}},fe=A(re,[["__scopeId","data-v-5e4e7319"]]);export{fe as default};
