import{r,z as ue,L as ce,K as q,c as B,b as o,d as l,w as s,u as i,x as c,F as G,o as n,P as ee,n as y,E as k,az as fe,j as pe,e as ae,i as E,v as g,D as S,A as le,k as me,l as ve,f as A,ae as ge,h as he,B as te,ax as be,aA as _e,a7 as ye,aB as xe,a3 as we}from"./index-a34Ydvtq.js";import{u as H}from"./useApi-DR0m7am6.js";import{u as ke}from"./usePermissions-CTYSXYZg.js";import{A as Ve}from"./AppDataTable-u95EW4-x.js";import{_ as x}from"./AppButton-CLlOdaZ_.js";import{A as se}from"./AppDialog-BCdceINl.js";import{_ as R}from"./AppInput-CvTgrXFc.js";import{A as Ce}from"./AppSwitch-CI7wxXXU.js";import{_ as oe}from"./AppCard-BUDroHe8.js";import{_ as De}from"./LoadingSpinner-DEybY_iO.js";import{_ as Be}from"./EmptyState-k7YPkZHl.js";import{A as Ae}from"./AppInfiniteScroll-B5WKy5zi.js";function ze(){const U=H("/api/cash-boxes"),b=r([]),p=r(!1),h=r(0);return{cashBoxes:b,loading:p,total:h,fetchCashBoxes:async(V={},M={})=>{var u;const{append:L=!1}=M;p.value=!0;try{const d=await U.get(V,{showLoading:!1});let _=[],f=0;return d.data&&Array.isArray(d.data.data)?(_=d.data.data,f=((u=d.data.meta)==null?void 0:u.total)||d.data.data.length):(_=d.data||[],f=d.total||_.length),L?b.value=[...b.value,..._]:b.value=_,h.value=f,d}catch(d){throw b.value=[],h.value=0,d}finally{p.value=!1}},deleteCashBox:async V=>await U.remove(V,{successMessage:"تم حذف الخزينة بنجاح"})}}const Te={class:"cashbox-page"},$e={class:"px-6 pb-6"},Ee={class:"px-6 pb-6"},Se={class:"d-flex align-center flex-wrap gap-4"},Ue={class:"d-flex align-center gap-3"},Me={class:"cashbox-card-header d-flex align-center justify-center pa-4 bg-grey-lighten-4 position-relative"},Le={class:"d-flex align-center justify-space-between mt-2"},Ie={class:"d-flex align-center"},je={class:"font-weight-bold"},Ne={key:1,class:"text-grey-lighten-1 text-caption"},Pe={class:"d-flex justify-end gap-1"},Fe={class:"d-flex align-center justify-space-between"},qe={class:"text-center pa-4"},Ge={class:"text-body-1 text-grey-darken-1"},Re={class:"mt-2 text-error text-caption font-weight-bold"},ta={__name:"CashBoxList",setup(U){const b=(a,t)=>{let e;return(...D)=>{e&&clearTimeout(e),e=setTimeout(()=>a(...D),t)}},{cashBoxes:p,loading:h,total:z,fetchCashBoxes:K,deleteCashBox:V}=ze(),M=a=>{m.value==="list"&&v()},L=()=>{h.value||p.value.length>=z.value||(f.value++,v(!0))},{can:u}=ke(),d=H("/api/cash-boxes"),_=H("/api/cash-box-types"),f=r(1),I=r(12),m=r("grid"),j=r(""),C=r(!1),T=r(!1),w=r(null),N=r(!1),P=r(!1),O=r(null),$=r([]),F=r(!1),ie=ue(()=>{const a=[{title:"الاسم",key:"name",sortable:!0},{title:"النوع",key:"type",sortable:!0},{title:"الرصيد",key:"balance",align:"end",sortable:!0},{title:"الحالة",key:"is_active",align:"center",sortable:!0}];return(u("cash_boxes.update_all")||u("cash_boxes.delete_all"))&&a.push({title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}),a}),J={required:a=>!!a||"مطلوب"},Q=async()=>{F.value=!0;try{const a=await _.get({per_page:100},{showLoading:!1,showError:!1});$.value=a.data||[]}finally{F.value=!1}},ne=()=>{w.value=null,formData.value={name:"",cash_box_type_id:null,initial_balance:0,is_active:1},C.value=!0,$.value.length||Q()},W=a=>{w.value=a,formData.value={...a},C.value=!0,$.value.length||Q()},X=a=>{w.value=a,T.value=!0},Y=async()=>{const{valid:a}=await O.value.validate();if(a){N.value=!0;try{isEdit.value?await d.update(w.value.id,formData.value,{successMessage:"تم التحديث بنجاح"}):await d.create(formData.value,{successMessage:"تم الإضافة بنجاح"}),C.value=!1,v()}finally{N.value=!1}}},re=async()=>{P.value=!0;try{await V(w.value.id),T.value=!1,v()}finally{P.value=!1}},Z=a=>a==null?"0.00 ج.م":new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(a),de=b(()=>{f.value=1,v()},500),v=(a={})=>{const t=a===!0;return K({page:f.value,per_page:I.value,name:j.value},{append:t})};return ce(v),q(f,()=>{m.value==="list"&&v()}),q(I,()=>{m.value==="list"&&(f.value=1,v())}),q(m,()=>{f.value=1,v()}),(a,t)=>(n(),B("div",Te,[t[13]||(t[13]=o("div",{class:"mb-6 px-6 pt-6"},[o("h1",{class:"text-h4 font-weight-bold"},"الخزائن"),o("p",{class:"text-body-1 text-grey"},"إدارة الخزائن النقدية والأرصدة المتاحة للعمليات")],-1)),o("div",$e,[o("div",Ee,[l(oe,{class:"mb-6"},{default:s(()=>[o("div",Se,[l(R,{modelValue:j.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>j.value=e),i(de)],label:"بحث عن خزينة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(ee),o("div",Ue,[i(u)("cash_boxes.create")?(n(),c(x,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:ne},{default:s(()=>t[9]||(t[9]=[y(" خزينة جديدة ")])),_:1})):k("",!0),l(fe,{variant:"outlined",density:"comfortable",color:"primary",class:"bg-white"},{default:s(()=>[l(x,{active:m.value==="grid",icon:"ri-grid-fill",onClick:t[1]||(t[1]=e=>m.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(x,{active:m.value==="list",icon:"ri-list-check",onClick:t[2]||(t[2]=e=>m.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])])]),_:1}),i(h)?(n(),c(De,{key:0})):(n(),B(G,{key:1},[i(p).length===0?(n(),c(Be,{key:0,icon:"ri-safe-2-line",title:"لا توجد خزائن",subtitle:"لم يتم العثور على أي خزائن مطابقة لبحثك."})):(n(),B(G,{key:1},[m.value==="grid"?(n(),c(Ae,{key:0,loading:i(h)&&i(p).length>0,"has-more":i(p).length<i(z),"no-more-text":"لا يوجد المزيد من الخزائن",onLoad:L},{default:s(()=>[l(ae,null,{default:s(()=>[(n(!0),B(G,null,pe(i(p),e=>(n(),c(A,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[l(oe,{class:"cashbox-card h-100","no-padding":""},be({default:s(()=>[o("div",Me,[l(te,{size:"80",rounded:"lg",class:"elevation-1 bg-white"},{default:s(()=>[l(E,{icon:"ri-safe-2-line",size:"40",color:"warning"})]),_:1}),l(S,{color:e.is_active?"success":"error",size:"x-small",class:"position-absolute top-2 right-2 font-weight-bold",variant:"flat"},{default:s(()=>[y(g(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),l(_e,null,{default:s(()=>[l(ye,{class:"text-h6 font-weight-bold"},{default:s(()=>[y(g(e.name),1)]),_:2},1024),l(xe,{class:"d-flex align-center mt-1"},{default:s(()=>[e.type?(n(),c(S,{key:0,size:"x-small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:s(()=>[y(g(e.type.name),1)]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024),l(we,{class:"pt-0"},{default:s(()=>[o("div",Le,[t[10]||(t[10]=o("span",{class:"text-caption text-grey"},"الرصيد الحالي",-1)),o("span",{class:le(["font-weight-black",e.balance>=0?"text-success":"text-error"])},g(Z(e.balance)),3)])]),_:2},1024)]),_:2},[i(u)("cash_boxes.update_all",{resource:e})||i(u)("cash_boxes.delete_all",{resource:e})?{name:"actions",fn:s(()=>[l(ee),i(u)("cash_boxes.update_all",{resource:e})?(n(),c(x,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",tooltip:"تعديل",onClick:D=>W(e)},null,8,["onClick"])):k("",!0),i(u)("cash_boxes.delete_all",{resource:e})?(n(),c(x,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",tooltip:"حذف",onClick:D=>X(e)},null,8,["onClick"])):k("",!0)]),key:"0"}:void 0]),1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),c(Ve,{key:1,headers:ie.value,items:i(p),loading:i(h),"items-length":i(z),"items-per-page":I.value,page:f.value,title:"قائمة الخزائن",icon:"ri-safe-2-line","permission-module":"cash_boxes","onUpdate:options":M},{"item.name":s(({item:e})=>[o("div",Ie,[l(E,{icon:"ri-money-dollar-box-line",size:"small",color:"warning",class:"me-2"}),o("span",je,g(e.name),1)])]),"item.type":s(({item:e})=>[e.type?(n(),c(S,{key:0,size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:s(()=>[y(g(e.type.name),1)]),_:2},1024)):(n(),B("span",Ne,"غير محدد"))]),"item.balance":s(({item:e})=>[o("div",{class:le(["text-end font-weight-black",e.balance>=0?"text-success":"text-error"])},g(Z(e.balance)),3)]),"item.is_active":s(({item:e})=>[l(S,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold px-3"},{default:s(()=>[y(g(e.is_active?"نشط":"غير نشط"),1)]),_:2},1032,["color"])]),"item.actions":s(({item:e})=>[o("div",Pe,[i(u)("cash_boxes.update_all",{resource:e})?(n(),c(x,{key:0,icon:"ri-edit-line",size:"x-small",variant:"text",color:"primary",tooltip:"تعديل",onClick:D=>W(e)},null,8,["onClick"])):k("",!0),i(u)("cash_boxes.delete_all",{resource:e})?(n(),c(x,{key:1,icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف",onClick:D=>X(e)},null,8,["onClick"])):k("",!0)])]),_:1},8,["headers","items","loading","items-length","items-per-page","page"]))],64))],64))])]),l(se,{modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=e=>C.value=e),title:a.isEdit?"تعديل الخزينة":"إضافة خزينة جديدة",icon:a.isEdit?"ri-edit-line":"ri-safe-2-line",loading:N.value,"max-width":"650",onConfirm:Y},{default:s(()=>[l(me,{ref_key:"formRef",ref:O,onSubmit:ve(Y,["prevent"])},{default:s(()=>[l(ae,{dense:""},{default:s(()=>[l(A,{cols:"12"},{default:s(()=>[l(R,{modelValue:a.formData.name,"onUpdate:modelValue":t[3]||(t[3]=e=>a.formData.name=e),label:"اسم الخزينة *",placeholder:"مثال: الخزينة الرئيسية",rules:[J.required]},null,8,["modelValue","rules"])]),_:1}),l(A,{cols:"12"},{default:s(()=>[l(ge,{modelValue:a.formData.cash_box_type_id,"onUpdate:modelValue":t[4]||(t[4]=e=>a.formData.cash_box_type_id=e),items:$.value,loading:F.value,"item-title":"name","item-value":"id",label:"نوع الخزينة *",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-list-settings-line",rules:[J.required],"hide-details":"",class:"mb-4"},null,8,["modelValue","items","loading","rules"])]),_:1}),l(A,{cols:"12"},{default:s(()=>[l(R,{modelValue:a.formData.initial_balance,"onUpdate:modelValue":t[5]||(t[5]=e=>a.formData.initial_balance=e),modelModifiers:{number:!0},label:"الرصيد الافتتاحي",type:"number",step:"0.01","prepend-inner-icon":"ri-money-dollar-circle-line",disabled:a.isEdit},null,8,["modelValue","disabled"])]),_:1}),l(A,{cols:"12"},{default:s(()=>[l(he,{variant:"tonal",color:"primary",class:"pa-4 rounded-lg"},{default:s(()=>[o("div",Fe,[t[11]||(t[11]=o("div",null,[o("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),o("div",{class:"text-caption"},"تحديد ما إذا كانت الخزينة متاحة حالياً للعمليات")],-1)),l(Ce,{modelValue:a.formData.is_active,"onUpdate:modelValue":t[6]||(t[6]=e=>a.formData.is_active=e),"true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),l(se,{modelValue:T.value,"onUpdate:modelValue":t[8]||(t[8]=e=>T.value=e),title:"حذف الخزينة؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:P.value,onConfirm:re},{default:s(()=>{var e;return[o("div",qe,[l(te,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:s(()=>[l(E,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),o("p",Ge,'هل أنت متأكد من حذف "'+g((e=w.value)==null?void 0:e.name)+'"؟',1),o("div",Re,[l(E,{icon:"ri-error-warning-line",size:"small",class:"me-1"}),t[12]||(t[12]=y(" هذا الإجراء قد يؤثر على السجلات المالية المرتبطة! "))])])]}),_:1},8,["modelValue","loading"])]))}};export{ta as default};
