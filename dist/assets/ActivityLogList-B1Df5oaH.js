import{u as M}from"./useApi-CjhFmPue.js";import{A as G}from"./AppDataTable-CnA5lOqV.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as c,I as Q,J as R,c as d,a,b as i,w as l,aC as W,o,z as q,s as w,A as H,t as n,g as p,l as g,y as X,C as x,L as Y,K as Z,f as ee,a7 as te,E as k,a1 as se,O as ae,a2 as ie,a3 as le,M as ne,ab as re,F as P,h as A,aO as oe,Q as de,aD as ce,N as ue}from"./index-CuR9-sbN.js";const pe={class:"activity-log-page"},ge={key:0,class:"d-flex align-center"},fe={key:1},me={class:"font-weight-medium text-body-2"},ye={key:1,class:"d-flex align-center text-grey"},ve={class:"text-body-2"},xe={class:"d-flex flex-column"},_e={class:"text-body-2 text-primary font-weight-bold"},be={key:0,class:"text-caption text-grey-darken-1"},he={class:"d-flex align-center text-body-2 text-grey-darken-1"},we={class:"d-flex align-center text-body-2 text-grey-darken-1 overflow-hidden",style:{"max-width":"150px","text-overflow":"ellipsis","white-space":"nowrap"}},ke={class:"d-flex flex-column text-no-wrap"},Ce={class:"text-body-2"},Ve={class:"text-caption text-grey"},Le={class:"d-flex align-center"},Se={key:0,class:"pa-4"},Ee={class:"font-weight-medium"},Ie={class:"text-error text-decoration-line-through"},Te={class:"text-success"},Pe={key:1,class:"pa-4"},Ae={class:"font-weight-bold me-2",style:{"min-width":"120px"}},De={__name:"ActivityLogList",setup(ze){const D=M("/api/activity-logs"),C=c([]),_=c(!1),V=c(0),f=c(1),y=c(15),v=c(""),m=c(!1),u=c(null),z=[{title:"المستخدم",key:"user"},{title:"الحدث",key:"action"},{title:"النوع",key:"subject_type"},{title:"الوصف",key:"description"},{title:"الـ IP",key:"ip_address"},{title:"المتصفح",key:"user_agent"},{title:"التاريخ",key:"created_at"}],B=e=>({created:"success",updated:"info",deleted:"error",restored:"success",login:"primary",logout:"grey",إضافة:"success",انشاء:"success",تعديل:"info",حذف:"error",دخول:"primary",خروج:"grey",تفعيل:"success",تعطيل:"warning",toggled:"warning"})[e]||"grey",N=e=>({created:"ri-add-circle-line",updated:"ri-edit-circle-line",deleted:"ri-delete-bin-line",restored:"ri-refresh-line",login:"ri-login-circle-line",logout:"ri-logout-circle-line",إضافة:"ri-add-circle-line",انشاء:"ri-add-box-line",تعديل:"ri-edit-2-line",حذف:"ri-delete-bin-7-line",دخول:"ri-login-box-line",خروج:"ri-logout-box-line",تفعيل:"ri-checkbox-circle-line",تعطيل:"ri-close-circle-line",toggled:"ri-switch-line"})[e]||"ri-information-line",U=e=>({created:"إضافة",updated:"تعديل",deleted:"حذف",login:"دخول",logout:"خروج",restored:"استرجاع",toggled:"تبديل"})[e]||e,j=e=>{if(!e)return"-";const s=e.split("\\"),t=s[s.length-1];return{Product:"منتج",Category:"فئة",Brand:"ماركة",User:"مستخدم",Invoice:"فاتورة",Payment:"عملية دفع",Company:"شركة",CashBox:"خزينة",Stock:"مخزون",PaymentMethod:"طريقة دفع",Transaction:"عملية مالية",Attribute:"سمة منتج",AttributeValue:"قيمة سمة",Expense:"مصروف",ExpenseCategory:"تصنيف مصروفات",Client:"عميل",Supplier:"مورد",Installment:"قسط",Warehouse:"مخزن",CashBoxType:"نوع خزينة",InvoiceType:"نوع فاتورة",Role:"دور",Permission:"صلاحية"}[t]||t},F=e=>e?e.includes("Chrome")?"ri-chrome-line":e.includes("Firefox")?"ri-firefox-line":e.includes("Safari")&&!e.includes("Chrome")?"ri-safari-line":e.includes("Edge")?"ri-edge-line":"ri-global-line":"ri-global-line",O=e=>e?e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edge")?"Edge":"متصفح":"غير معروف",L=e=>{if(!e)return{date:"-",time:""};const s=new Date(e);return{date:s.toLocaleDateString("ar-EG"),time:s.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}},J=e=>{f.value=e.page,y.value=e.itemsPerPage,b()};Q(v,()=>{f.value=1,b()});const b=async()=>{_.value=!0;try{const e=await D.get({page:f.value,per_page:y.value,search:v.value},{showLoading:!1});C.value=e.data||[],V.value=e.total||0}catch(e){console.error("Error loading activity logs:",e)}finally{_.value=!1}},S=e=>{u.value=e,m.value=!0},E=e=>(e==null?void 0:e.action)==="updated"&&(e==null?void 0:e.old_values)&&(e==null?void 0:e.new_values),$=e=>{if(!E(e))return[];const s=[],t={name:"الاسم",price:"السعر",status:"الحالة",active:"نشط",description:"الوصف",email:"البريد الإلكتروني",phone:"رقم الهاتف",balance:"الرصيد",amount:"المبلغ",social_links:"روابط التواصل"};for(const r in e.new_values){const I=e.old_values[r],T=e.new_values[r];JSON.stringify(I)!==JSON.stringify(T)&&s.push({field:r,field_label:t[r]||r,old:h(I),new:h(T)})}return s},h=e=>e==null?"-":typeof e=="boolean"?e?"نعم":"لا":typeof e=="object"?JSON.stringify(e):e;return R(b),(e,s)=>(o(),d("div",pe,[s[13]||(s[13]=a("div",{class:"page-header mb-6"},[a("h1",{class:"text-h4 font-weight-bold"},"سجل النشاطات"),a("p",{class:"text-body-1 text-grey"},"تتبع التغييرات والعمليات المنفذة في النظام")],-1)),i(G,{title:"سجل النشاطات",icon:"ri-history-line",headers:z,items:C.value,"total-items":V.value,loading:_.value,page:f.value,"onUpdate:page":s[0]||(s[0]=t=>f.value=t),"items-per-page":y.value,"onUpdate:itemsPerPage":s[1]||(s[1]=t=>y.value=t),search:v.value,"onUpdate:search":s[2]||(s[2]=t=>v.value=t),searchable:!0,"show-actions":!1,"empty-subtext":"لا توجد نشاطات",class:"text-no-wrap clickable-rows","onUpdate:options":J,"onClick:row":S},{"item.user":l(({item:t})=>[t.user?(o(),d("div",ge,[i(q,{size:"28",color:"primary-lighten-5",class:"me-2 text-primary font-weight-bold border"},{default:l(()=>{var r;return[t.user.avatar_url?(o(),w(H,{key:0,src:t.user.avatar_url,cover:""},null,8,["src"])):(o(),d("span",fe,n((r=t.user.nickname||t.user.name)==null?void 0:r.charAt(0).toUpperCase()),1))]}),_:2},1024),a("span",me,n(t.user.nickname||t.user.name),1)])):(o(),d("div",ye,[i(p,{icon:"ri-robot-line",size:"small",class:"me-2"}),s[6]||(s[6]=a("span",null,"النظام",-1))]))]),"item.action":l(({item:t})=>[a("div",{class:X([`text-${B(t.action)}`,"font-weight-bold d-flex align-center"])},[i(p,{icon:N(t.action),size:"16",class:"me-1"},null,8,["icon"]),g(" "+n(U(t.action)),1)],2)]),"item.description":l(({item:t})=>[a("div",ve,n(t.description),1)]),"item.subject_type":l(({item:t})=>[a("div",xe,[a("span",_e,n(j(t.subject_type)),1),t.company?(o(),d("span",be,[i(p,{icon:"ri-building-line",size:"10",class:"me-1"}),g(" "+n(t.company.name),1)])):x("",!0)])]),"item.ip_address":l(({item:t})=>[a("div",he,[i(p,{icon:"ri-map-pin-user-line",size:"small",color:"grey",class:"me-1"}),g(" "+n(t.ip_address||"-"),1)])]),"item.user_agent":l(({item:t})=>[a("div",we,[i(Y,{text:t.user_agent,location:"top"},{activator:l(({props:r})=>[a("div",Z(r,{class:"d-flex align-center"}),[i(p,{icon:F(t.user_agent),size:"small",class:"me-1"},null,8,["icon"]),a("span",null,n(O(t.user_agent)),1)],16)]),_:2},1032,["text"])])]),"item.created_at":l(({item:t})=>[a("div",ke,[a("span",Ce,n(L(t.created_at).date),1),a("span",Ve,n(L(t.created_at).time),1)])]),"item.actions":l(({item:t})=>[t.old_values||t.new_values?(o(),w(k,{key:0,icon:"ri-information-line",variant:"text",color:"primary",size:"small",onClick:r=>S(t)},null,8,["onClick"])):x("",!0)]),_:1},8,["items","total-items","loading","page","items-per-page","search"]),i(W,{modelValue:m.value,"onUpdate:modelValue":s[5]||(s[5]=t=>m.value=t),"max-width":"800px",scrollable:""},{default:l(()=>[i(ee,null,{default:l(()=>[i(te,{class:"d-flex justify-space-between align-center border-bottom pa-4"},{default:l(()=>[a("div",Le,[i(p,{icon:"ri-history-line",class:"me-2 text-primary"}),s[7]||(s[7]=a("span",null,"تفاصيل التغييرات",-1))]),i(k,{icon:"ri-close-line",variant:"text",size:"small",onClick:s[3]||(s[3]=t=>m.value=!1)})]),_:1}),i(se,{class:"pa-0"},{default:l(()=>[u.value?(o(),w(de,{key:0,lines:"two"},{default:l(()=>[i(ae,null,{prepend:l(()=>[i(p,{icon:"ri-sticky-note-line"})]),default:l(()=>[i(ie,{class:"font-weight-bold"},{default:l(()=>s[8]||(s[8]=[g("الوصف")])),_:1}),i(le,null,{default:l(()=>[g(n(u.value.description),1)]),_:1})]),_:1}),i(ne),E(u.value)?(o(),d("div",Se,[s[10]||(s[10]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"الحقول المعدلة",-1)),i(re,{density:"compact",class:"border rounded"},{default:l(()=>[s[9]||(s[9]=a("thead",{class:"bg-grey-lighten-4"},[a("tr",null,[a("th",{class:"text-right"},"الحقل"),a("th",{class:"text-right"},"القيمة السابقة"),a("th",{class:"text-right"},"القيمة الجديدة")])],-1)),a("tbody",null,[(o(!0),d(P,null,A($(u.value),t=>(o(),d("tr",{key:t.field},[a("td",Ee,n(t.field_label||t.field),1),a("td",Ie,n(t.old),1),a("td",Te,n(t.new),1)]))),128))])]),_:1})])):u.value.action==="created"?(o(),d("div",Pe,[s[11]||(s[11]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"البيانات المضافة",-1)),i(oe,{border:"",rounded:"",class:"pa-3 bg-grey-lighten-4"},{default:l(()=>[(o(!0),d(P,null,A(u.value.new_values,(t,r)=>(o(),d("div",{key:r,class:"mb-1 d-flex"},[a("span",Ae,n(r)+":",1),a("span",null,n(h(t)),1)]))),128))]),_:1})])):x("",!0)]),_:1})):x("",!0)]),_:1}),i(ce,{class:"pa-4 border-top"},{default:l(()=>[i(ue),i(k,{color:"grey-darken-1",variant:"text",onClick:s[4]||(s[4]=t=>m.value=!1)},{default:l(()=>s[12]||(s[12]=[g("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Fe=K(De,[["__scopeId","data-v-1e98dab9"]]);export{Fe as default};
