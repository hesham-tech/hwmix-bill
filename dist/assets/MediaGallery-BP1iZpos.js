import{r as n,y as F,K,J as R,o as u,v as B,w as o,b as a,ab as Q,h as I,ac as W,m as r,O as V,G as c,a1 as M,a as f,am as X,t as $,c as b,E as L,d as N,i as Y,F as Z,N as ee,aH as U,f as S,a5 as le,aG as G,e as ae,z as j,D as te,B as oe,k as se}from"./index-DPR0tjT6.js";import{u as ie}from"./useApi-CTBDEoea.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"pa-4 bg-grey-lighten-4 border-b d-flex align-center flex-wrap gap-4"},de=["multiple"],ue={class:"flex-grow-1 overflow-y-auto pa-4 custom-scrollbar"},ce={key:0,class:"d-flex flex-column align-center justify-center py-12"},fe={key:1,class:"d-flex flex-column align-center justify-center py-12 opacity-60"},ve={key:0,class:"selection-overlay"},pe={__name:"MediaGallery",props:{modelValue:Boolean,multiple:{type:Boolean,default:!1},type:{type:String,default:"logo"}},emits:["update:modelValue","select"],setup(y,{emit:O}){const v=y,w=O,h=ie("/api/images"),i=n([]),k=n(!1),C=n(!1),D=n(!1),m=n(""),s=n([]),g=n(!1),p=n(null),z=F({get:()=>v.modelValue,set:l=>w("update:modelValue",l)}),A=F(()=>m.value?i.value.filter(l=>{var e,t;return((e=l.file_name)==null?void 0:e.toLowerCase().includes(m.value.toLowerCase()))||((t=l.type)==null?void 0:t.toLowerCase().includes(m.value.toLowerCase()))}):i.value),_=async()=>{k.value=!0;try{const l=await h.get({linked:"0"});i.value=l.data||[]}catch(l){console.error("Failed to fetch images:",l)}finally{k.value=!1}},E=async l=>{const e=l.target.files;if(!e.length)return;C.value=!0;const t=new FormData;for(let d=0;d<e.length;d++)t.append("images[]",e[d]);t.append("type",v.type);try{await h.create(t,{showSuccessMessage:!0}),await _()}catch(d){console.error("Upload failed:",d)}finally{C.value=!1,l.target.value=""}},P=l=>{p.value=l,g.value=!0},q=async()=>{if(p.value){D.value=!0;try{await h.request("POST","delete",{ids:[p.value.id]}),i.value=i.value.filter(l=>l.id!==p.value.id),s.value=s.value.filter(l=>l!==p.value.id),g.value=!1}catch(l){console.error("Delete failed:",l)}finally{D.value=!1,p.value=null}}},H=l=>{if(v.multiple){const e=s.value.indexOf(l);e>-1?s.value.splice(e,1):s.value.push(l)}else s.value=s.value[0]===l?[]:[l]},x=l=>s.value.includes(l),T=()=>{w("update:modelValue",!1)},J=()=>{const l=i.value.filter(e=>s.value.includes(e.id));l.length&&(w("select",v.multiple?l:l[0]),T())};return K(()=>{v.modelValue&&_()}),R(()=>v.modelValue,l=>{l&&(s.value=[],_())}),(l,e)=>(u(),B(G,{modelValue:z.value,"onUpdate:modelValue":e[4]||(e[4]=t=>z.value=t),"max-width":"900",scrollable:"",persistent:"",transition:"dialog-bottom-transition",class:"media-gallery-dialog"},{default:o(()=>[a(S,{class:"rounded-xl overflow-hidden"},{default:o(()=>[a(Q,{color:"primary",density:"comfortable",flat:""},{default:o(()=>[a(I,{icon:"ri-gallery-line",class:"ms-4 me-2"}),a(W,{class:"text-h6 font-weight-bold"},{default:o(()=>e[5]||(e[5]=[r("معرض الصور")])),_:1}),a(V),a(c,{icon:"ri-close-line",onClick:T})]),_:1}),a(M,{class:"pa-0 flex-grow-1 overflow-hidden d-flex flex-column"},{default:o(()=>[f("div",re,[a(X,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),label:"بحث في الصور...","prepend-inner-icon":"ri-search-line",variant:"solo",density:"compact","hide-details":"",class:"max-width-300 elevation-0 border rounded-lg"},null,8,["modelValue"]),a(V),a(c,{color:"success","prepend-icon":"ri-upload-cloud-2-line",elevation:"1",loading:C.value,onClick:e[1]||(e[1]=t=>l.$refs.fileInput.click())},{default:o(()=>[r($(y.multiple?"رفع مجموعة صور":"رفع صورة جديدة"),1)]),_:1},8,["loading"]),f("input",{ref:"fileInput",type:"file",accept:"image/*",multiple:y.multiple,class:"d-none",onChange:E},null,40,de)]),f("div",ue,[k.value&&!i.value.length?(u(),b("div",ce,[a(L,{indeterminate:"",color:"primary",size:"64"}),e[6]||(e[6]=f("div",{class:"mt-4 text-grey"},"جاري تحميل الصور...",-1))])):i.value.length?(u(),B(N,{key:2},{default:o(()=>[(u(!0),b(Z,null,Y(A.value,t=>(u(),B(ae,{key:t.id,cols:"6",sm:"4",md:"3"},{default:o(()=>[a(S,{class:j(["image-item-card overflow-hidden position-relative",{"selected-border":x(t.id)}]),elevation:"1",onClick:d=>H(t.id)},{default:o(()=>[f("div",{class:j(["selection-checkbox",{"is-checked":x(t.id)}])},[a(I,{icon:x(t.id)?"ri-checkbox-fill":"ri-checkbox-blank-line"},null,8,["icon"])],2),x(t.id)?(u(),b("div",ve)):te("",!0),a(oe,{src:t.url,"aspect-ratio":"1",cover:"",class:"bg-grey-lighten-3"},{placeholder:o(()=>[a(N,{class:"fill-height ma-0",align:"center",justify:"center"},{default:o(()=>[a(L,{indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:2},1032,["src"]),a(c,{icon:"ri-delete-bin-7-fill",color:"error",size:"x-small",variant:"elevated",class:"delete-btn position-absolute",onClick:se(d=>P(t),["stop"])},null,8,["onClick"])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1})):(u(),b("div",fe,[a(I,{icon:"ri-image-2-line",size:"80",color:"grey-lighten-1"}),e[7]||(e[7]=f("div",{class:"text-h6 mt-4"},"المعرض فارغ حالياً",-1)),e[8]||(e[8]=f("p",{class:"text-body-2"},"لم يتم العثور على أي صور غير مستخدمة",-1))]))])]),_:1}),a(ee),a(U,{class:"pa-4 bg-grey-lighten-5"},{default:o(()=>[a(c,{variant:"text",color:"grey-darken-1","prepend-icon":"ri-close-line",onClick:T},{default:o(()=>e[9]||(e[9]=[r(" إلغاء ")])),_:1}),a(V),a(c,{color:"primary",size:"large",elevation:"2",class:"px-8 font-weight-bold",disabled:!s.value.length,onClick:J},{default:o(()=>[r($(y.multiple?`تعيين الصور المختارة (${s.value.length})`:"تعيين الصورة المختارة"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),a(G,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),"max-width":"400"},{default:o(()=>[a(S,{class:"rounded-xl"},{default:o(()=>[a(le,{class:"text-h6 font-weight-bold pt-4 text-center"},{default:o(()=>e[10]||(e[10]=[r("حذف الصورة نهائياً؟")])),_:1}),a(M,{class:"text-center"},{default:o(()=>e[11]||(e[11]=[r("سيتم حذف الملف من السيرفر ولا يمكن التراجع عن هذا الإجراء.")])),_:1}),a(U,{class:"pa-4"},{default:o(()=>[a(c,{variant:"text",onClick:e[2]||(e[2]=t=>g.value=!1)},{default:o(()=>e[12]||(e[12]=[r("إلغاء")])),_:1}),a(V),a(c,{color:"error",loading:D.value,class:"px-6",onClick:q},{default:o(()=>e[13]||(e[13]=[r("نعم، حذف")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}},xe=ne(pe,[["__scopeId","data-v-2cf08e40"]]);export{xe as M};
