import{u as C}from"./useApi-CTBDEoea.js";import{u as A}from"./usePrintExport-BD2QUCTi.js";import{R as T}from"./ReportLayout-D5K90SqV.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{y as V,s as E,o as _,v as k,w as e,b as o,a1 as I,a as r,c as P,E as L,f as g,r as m,K as O,m as y,e as w,t as i,u as f,d as M,C as S}from"./index-DPR0tjT6.js";import{A as N}from"./AppDataTable-CV9gFKLg.js";import{_ as D}from"./AppInput-CYR4AaBJ.js";import{_ as j}from"./AppButton-DiF3_7lr.js";import{f as p}from"./formatters-CKQiR5Fb.js";import"./usePermissions-BOh6stgy.js";const F={class:"chart-wrapper"},U={key:1,class:"d-flex align-center justify-center height-350"},K={__name:"ProfitComparisonChart",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(h){const d=h,v=V(()=>[{name:"الإيرادات",data:d.data.map(a=>a.revenue)},{name:"التكاليف",data:d.data.map(a=>a.costs)},{name:"الربح",data:d.data.map(a=>a.profit)}]),l=V(()=>({chart:{type:"bar",height:350,toolbar:{show:!1},fontFamily:"Inter, sans-serif"},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:d.data.map(a=>a.month),labels:{style:{colors:"#64748b",fontSize:"12px"}}},yaxis:{labels:{style:{colors:"#64748b",fontSize:"12px"},formatter:a=>`${a} ج.م`}},fill:{opacity:1},tooltip:{theme:"light",y:{formatter:a=>`${a} ج.م`}},legend:{position:"top",horizontalAlign:"right",fontFamily:"Inter, sans-serif"},colors:["#3b82f6","#ef4444","#10b981"],grid:{borderColor:"#f1f5f9",strokeDashArray:4}}));return(a,n)=>{const c=E("apexchart");return _(),k(g,{variant:"flat",border:"",class:"chart-card rounded-xl overflow-hidden pa-1"},{default:e(()=>[o(I,{class:"pa-4"},{default:e(()=>[n[0]||(n[0]=r("div",{class:"d-flex align-center justify-space-between mb-4"},[r("div",null,[r("div",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1"},"تحليل الربحية"),r("h3",{class:"text-h6 font-weight-black"},"مقارنة الإيرادات والتكاليف والأرباح")])],-1)),r("div",F,[h.loading?(_(),P("div",U,[o(L,{indeterminate:"",color:"primary"})])):(_(),k(c,{key:0,type:"bar",height:"350",options:l.value,series:v.value},null,8,["options","series"]))])]),_:1})]),_:1})}}},W=B(K,[["__scopeId","data-v-2548113f"]]),q={class:"d-flex flex-column gap-4"},G={class:"text-h4 font-weight-black text-success"},H={class:"text-h4 font-weight-black text-error"},J={class:"text-h4 font-weight-black text-info"},Q={class:"text-primary font-weight-bold"},X={class:"text-error"},it={__name:"ProfitReport",setup(h){const d=C("/api/reports/profit-loss"),{exportToCSV:v}=A(),l=m(!1),a=m({date_from:new Date(new Date().setMonth(new Date().getMonth()-5)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),n=m([]),c=m({total_revenue:0,total_costs:0,net_profit:0}),R=[{title:"الشهر",key:"month"},{title:"الإيرادات",key:"revenue",align:"end"},{title:"التكاليف",key:"costs",align:"end"},{title:"صافي الربح",key:"profit",align:"end"},{title:"الهامش",key:"margin",align:"center"}],x=async()=>{var u,t,s;l.value=!0;try{const b=await d.get(a.value,{showLoading:!1});c.value={total_revenue:((u=b.revenues)==null?void 0:u.total)||0,total_costs:((t=b.costs)==null?void 0:t.total)||0,net_profit:((s=b.result)==null?void 0:s.net_profit)||0};const z=await C("/api/reports/profit-loss/monthly-comparison").get({months:6},{showLoading:!1});n.value=z.comparison||[]}finally{l.value=!1}},$=()=>{const u=n.value.map(t=>({الشهر:t.month,الإيرادات:t.revenue,التكاليف:t.costs,الربح:t.profit,"الهامش %":t.margin}));v(u,"تقرير_الأرباح_والخسائر.csv")};return O(x),(u,t)=>(_(),k(T,{title:"تحليل الأرباح والخسائر",description:"نظرة شاملة على الربحية، الهوامش، ومقارنة الأداء المالي",loading:l.value,onRefresh:x,onExport:$},{filters:e(()=>[r("div",q,[o(D,{modelValue:a.value.date_from,"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.date_from=s),label:"من تاريخ",type:"date"},null,8,["modelValue"]),o(D,{modelValue:a.value.date_to,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.date_to=s),label:"إلى تاريخ",type:"date"},null,8,["modelValue"]),o(j,{color:"primary",block:"",onClick:x},{default:e(()=>t[2]||(t[2]=[y("تحديث البيانات")])),_:1})])]),summary:e(()=>[o(M,{dense:""},{default:e(()=>[o(w,{cols:"12",md:"4"},{default:e(()=>[o(g,{border:"",flat:"",class:"rounded-xl pa-4 bg-success-lighten-5 border-success"},{default:e(()=>[t[3]||(t[3]=r("div",{class:"text-caption font-weight-bold text-success"},"إجمالي الإيرادات",-1)),r("div",G,i(f(p)(c.value.total_revenue)),1)]),_:1})]),_:1}),o(w,{cols:"12",md:"4"},{default:e(()=>[o(g,{border:"",flat:"",class:"rounded-xl pa-4 bg-error-lighten-5 border-error"},{default:e(()=>[t[4]||(t[4]=r("div",{class:"text-caption font-weight-bold text-error"},"إجمالي التكاليف",-1)),r("div",H,i(f(p)(c.value.total_costs)),1)]),_:1})]),_:1}),o(w,{cols:"12",md:"4"},{default:e(()=>[o(g,{border:"",flat:"",class:"rounded-xl pa-4 bg-info-lighten-5 border-info"},{default:e(()=>[t[5]||(t[5]=r("div",{class:"text-caption font-weight-bold text-info"},"صافي الربح",-1)),r("div",J,i(f(p)(c.value.net_profit)),1)]),_:1})]),_:1})]),_:1})]),charts:e(()=>[o(W,{data:n.value,loading:l.value},null,8,["data","loading"])]),table:e(()=>[o(N,{headers:R,items:n.value,loading:l.value,title:"مقارنة الأداء الشهري",icon:"ri-calendar-todo-line"},{"item.revenue":e(({item:s})=>[r("span",Q,i(f(p)(s.revenue)),1)]),"item.costs":e(({item:s})=>[r("span",X,i(f(p)(s.costs)),1)]),"item.profit":e(({item:s})=>[o(S,{color:s.profit>=0?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:e(()=>[y(i(f(p)(s.profit)),1)]),_:2},1032,["color"])]),"item.margin":e(({item:s})=>[o(S,{size:"x-small",variant:"tonal",color:"info"},{default:e(()=>[y(i(s.margin)+"% ",1)]),_:2},1024)]),_:1},8,["items","loading"])]),_:1},8,["loading"]))}};export{it as default};
