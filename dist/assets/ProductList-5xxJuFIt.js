import{r as b,K as F,o as m,v,w as a,b as l,m as g,e as A,ad as S,d as G,u as w,D as E,B as O,h as D,A as R,a as u,t as y,N as q,C as I,c as L,al as M,n as W}from"./index-DPR0tjT6.js";import{u as H}from"./useProductsData-Dex-UGjI.js";import{u as T}from"./useApi-CTBDEoea.js";import{_ as J}from"./AppCard-DxtAeMMp.js";import{_ as U}from"./AppButton-DiF3_7lr.js";import{_ as Q}from"./AppInput-CYR4AaBJ.js";import{u as X}from"./usePermissions-BOh6stgy.js";import{A as Y}from"./AppDataTable-CV9gFKLg.js";import{A as Z}from"./AppDialog-CVbZwWX_.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={__name:"ProductFilters",props:{filters:{type:Object,required:!0}},emits:["filter-change","update:filters"],setup(n,{emit:p}){const V=n,k=p,C=T("/api/categories"),$=T("/api/brands"),t=b([]),s=b([]),e=b(!1),d=b(!1),x=[{title:"متوفر",value:"in_stock"},{title:"مخزون منخفض",value:"low_stock"},{title:"نفذ المخزون",value:"out_of_stock"}];let _;const P=c=>{clearTimeout(_),_=setTimeout(()=>{k("update:filters",{...V.filters,search:c}),k("filter-change")},300)},N=async()=>{e.value=!0;try{const c=await C.get({per_page:100},{showLoading:!1,showError:!1});t.value=c.data||[]}finally{e.value=!1}},B=async()=>{d.value=!0;try{const c=await $.get({per_page:100},{showLoading:!1,showError:!1});s.value=c.data||[]}finally{d.value=!1}};return F(()=>{N(),B()}),(c,o)=>(m(),v(J,{title:"تصفية المنتجات",icon:"ri-filter-3-line",class:"mb-4"},{actions:a(()=>[l(U,{variant:"text",color:"secondary",size:"small","prepend-icon":"ri-refresh-line",onClick:c.resetFilters},{default:a(()=>o[6]||(o[6]=[g(" مسح الكل ")])),_:1},8,["onClick"])]),default:a(()=>[l(G,{dense:""},{default:a(()=>[l(A,{cols:"12",md:"4"},{default:a(()=>[l(Q,{"model-value":n.filters.search,label:"البحث السريع",placeholder:"اسم المنتج، SKU، أو باركود","prepend-inner-icon":"ri-search-line","onUpdate:modelValue":P},null,8,["model-value"])]),_:1}),l(A,{cols:"12",md:"3"},{default:a(()=>[l(S,{modelValue:n.filters.category_id,"onUpdate:modelValue":[o[0]||(o[0]=f=>n.filters.category_id=f),o[1]||(o[1]=f=>c.$emit("filter-change"))],items:t.value,loading:e.value,"item-title":"name","item-value":"id",label:"الفئة",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-folder-line",clearable:"","hide-details":""},null,8,["modelValue","items","loading"])]),_:1}),l(A,{cols:"12",md:"3"},{default:a(()=>[l(S,{modelValue:n.filters.brand_id,"onUpdate:modelValue":[o[2]||(o[2]=f=>n.filters.brand_id=f),o[3]||(o[3]=f=>c.$emit("filter-change"))],items:s.value,loading:d.value,"item-title":"name","item-value":"id",label:"العلامة التجارية",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-award-line",clearable:"","hide-details":""},null,8,["modelValue","items","loading"])]),_:1}),l(A,{cols:"12",md:"2"},{default:a(()=>[l(S,{modelValue:n.filters.stock_status,"onUpdate:modelValue":[o[4]||(o[4]=f=>n.filters.stock_status=f),o[5]||(o[5]=f=>c.$emit("filter-change"))],items:x,label:"حالة المخزون",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-archive-line",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},ae={class:"d-flex flex-column"},le={class:"font-weight-bold text-body-1"},ie={class:"text-caption text-grey d-flex align-center mt-1"},se={key:1,class:"text-grey-lighten-1 text-caption"},oe={class:"d-flex flex-column text-right"},re={class:"font-weight-black text-success"},ne={class:"text-caption text-grey"},de={class:"d-flex justify-end gap-1"},ce={__name:"ProductDataTable",props:{items:{type:Array,required:!0},loading:{type:Boolean,default:!1},page:{type:Number,default:1},itemsPerPage:{type:Number,default:10},total:{type:Number,default:0}},emits:["create","view","edit","delete","update:page","update:items-per-page"],setup(n){const{can:p}=X(),V=[{title:"صورة",key:"image",width:"80px",sortable:!1},{title:"المنتج وتفاصيله",key:"name",minWidth:"250px"},{title:"العلامة التجارية",key:"brand",width:"150px"},{title:"سعر البيع",key:"price",align:"end",width:"150px"},{title:"المخزون",key:"stock",align:"center",width:"100px"},{title:"الحالة",key:"is_active",align:"center",width:"120px"},{title:"",key:"actions",sortable:!1,align:"end",width:"120px"}],k=t=>t?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(t):"0.00 ج.م",C=t=>!t||t===0?"error":t<10?"warning":"success",$=t=>!t||t===0?"ri-close-circle-line":t<10?"ri-error-warning-line":"ri-checkbox-circle-line";return(t,s)=>(m(),v(Y,{headers:V,items:n.items,loading:n.loading,"items-length":n.total,"items-per-page":n.itemsPerPage,page:n.page,title:"قائمة المنتجات",icon:"ri-shopping-bag-3-line","onUpdate:page":s[1]||(s[1]=e=>t.$emit("update:page",e)),"onUpdate:itemsPerPage":s[2]||(s[2]=e=>t.$emit("update:items-per-page",e))},{actions:a(()=>[w(p)("products.create")?(m(),v(U,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:s[0]||(s[0]=e=>t.$emit("create"))},{default:a(()=>s[3]||(s[3]=[g(" منتج جديد ")])),_:1})):E("",!0)]),"item.image":a(({item:e})=>[l(R,{size:"48",rounded:"lg",border:"",class:"bg-grey-lighten-4"},{default:a(()=>[e.image?(m(),v(O,{key:0,src:e.image,cover:""},null,8,["src"])):(m(),v(D,{key:1,icon:"ri-image-line",size:"20",color:"grey-lighten-1"}))]),_:2},1024)]),"item.name":a(({item:e})=>{var d;return[u("div",ae,[u("span",le,y(e.name),1),u("span",ie,[l(D,{icon:"ri-barcode-line",size:"14",class:"me-1"}),g(" "+y(e.sku||"بدون SKU")+" ",1),l(q,{vertical:"",class:"mx-2"}),l(D,{icon:"ri-folder-line",size:"14",class:"me-1"}),g(" "+y(((d=e.category)==null?void 0:d.name)||"غير مصنف"),1)])])]}),"item.brand":a(({item:e})=>[e.brand?(m(),v(I,{key:0,size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:a(()=>[g(y(e.brand.name),1)]),_:2},1024)):(m(),L("span",se,"لا توجد ماركة"))]),"item.price":a(({item:e})=>[u("div",oe,[u("span",re,y(k(e.selling_price)),1),u("span",ne,"التكلفة: "+y(k(e.cost_price)),1)])]),"item.stock":a(({item:e})=>[l(I,{color:C(e.stock_quantity),size:"small",variant:"tonal",class:"font-weight-bold"},{default:a(()=>[l(D,{icon:$(e.stock_quantity),size:"14",class:"me-1"},null,8,["icon"]),g(" "+y(e.stock_quantity||0),1)]),_:2},1032,["color"])]),"item.is_active":a(({item:e})=>[l(I,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold px-3"},{default:a(()=>[g(y(e.is_active?"نشط":"غير نشط"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:e})=>[u("div",de,[w(p)("products.view_all",{resource:e})?(m(),v(U,{key:0,icon:"ri-eye-line",size:"x-small",variant:"text",color:"info",tooltip:"عرض",onClick:d=>t.$emit("view",e)},null,8,["onClick"])):E("",!0),w(p)("products.update_all",{resource:e})?(m(),v(U,{key:1,icon:"ri-edit-line",size:"x-small",variant:"text",color:"primary",tooltip:"تعديل",onClick:d=>t.$emit("edit",e)},null,8,["onClick"])):E("",!0),w(p)("products.delete_all",{resource:e})?(m(),v(U,{key:2,icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف",onClick:d=>t.$emit("delete",e)},null,8,["onClick"])):E("",!0)])]),_:1},8,["items","loading","items-length","items-per-page","page"]))}},ue={class:"pa-6"},me={class:"mt-2 text-error font-weight-medium"},pe={__name:"ProductList",setup(n){const p=W(),{products:V,loading:k,total:C,fetchProducts:$,deleteProduct:t}=H(),s=b(1),e=b(10),d=M({search:"",category_id:null,brand_id:null,stock_status:null}),x=b(!1),_=b(null),P=b(!1),N=()=>{p.push("/products/create")},B=r=>{p.push(`/products/${r.id}`)},c=r=>{p.push(`/products/${r.id}/edit`)},o=r=>{_.value=r,x.value=!0},f=async()=>{P.value=!0;try{await t(_.value.id),x.value=!1,await z()}catch(r){console.error("Error deleting product:",r)}finally{P.value=!1}},j=()=>{s.value=1,z()},K=r=>{e.value=r,s.value=1,z()},z=async()=>{const r={page:s.value,per_page:e.value,...d};Object.keys(r).forEach(i=>{(r[i]===null||r[i]==="")&&delete r[i]}),await $(r)};return F(()=>{z()}),(r,i)=>(m(),L("div",ue,[i[6]||(i[6]=u("div",{class:"mb-6"},[u("h1",{class:"text-h4 font-weight-bold"},"المنتجات"),u("p",{class:"text-body-1 text-grey"},"إدارة منتجات المخزون والأسعار والمستويات")],-1)),l(te,{filters:d,"onUpdate:filters":i[0]||(i[0]=h=>d=h),onFilterChange:j},null,8,["filters"]),l(ce,{items:w(V),loading:w(k),page:s.value,"items-per-page":e.value,total:w(C),onCreate:N,onView:B,onEdit:c,onDelete:o,"onUpdate:page":i[1]||(i[1]=h=>{s.value=h,z()}),"onUpdate:itemsPerPage":K},null,8,["items","loading","page","items-per-page","total"]),l(Z,{modelValue:x.value,"onUpdate:modelValue":i[2]||(i[2]=h=>x.value=h),title:"تأكيد حذف المنتج",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف المنتج",loading:P.value,onConfirm:f},{default:a(()=>{var h;return[i[4]||(i[4]=g(' هل أنت متأكد من حذف المنتج "')),u("strong",null,y((h=_.value)==null?void 0:h.name),1),i[5]||(i[5]=g('"؟ ')),u("div",me,[l(D,{icon:"ri-error-warning-line",size:"small",class:"me-1"}),i[3]||(i[3]=g(" سيتم حذف جميع البيانات المتعلقة بهذا المنتج نهائياً. "))])]}),_:1},8,["modelValue","loading"])]))}},Ve=ee(pe,[["__scopeId","data-v-320d271b"]]);export{Ve as default};
