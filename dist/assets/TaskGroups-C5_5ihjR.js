import{r as d,K as F,v,w as t,V as M,aX as V,aI as P,o as r,a as s,b as a,h as G,O as T,m as c,G as f,d as R,c as k,i as D,F as A,a8 as $,B as E,D as j,f as B,a5 as q,t as p,a1 as z,am as H,ai as K,ap as O,aH as Q,aG as X,q as x,e as J,A as I,_ as W,L as Y,Q as Z,P as L,M as ee}from"./index-DPR0tjT6.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"d-flex align-center gap-3 mb-6"},le={class:"d-flex align-center justify-space-between mb-4"},se={class:"d-flex align-center gap-3"},oe={class:"text-h6 font-weight-bold mb-0"},ie={class:"text-caption text-grey"},ne={class:"text-body-2 text-grey-darken-1 mb-4 line-clamp-2 h-40"},re={class:"d-flex align-center flex-wrap gap-1"},de={class:"text-overline"},ue={key:2,class:"text-center pa-12"},ce={__name:"TaskGroups",setup(pe){const _=d([]),w=d([]),g=d(!0),u=d(!1),m=d(null),y=d(!1),i=d({name:"",description:"",user_ids:[]}),b=async()=>{g.value=!0;try{const[o,e]=await Promise.all([V.getAll(),P.getAll({per_page:100})]);_.value=o.data,w.value=e.data}catch(o){console.error("Error fetching groups data",o)}finally{g.value=!1}},C=()=>{m.value=null,i.value={name:"",description:"",user_ids:[]},u.value=!0},S=o=>{m.value=o,i.value={name:o.name,description:o.description,user_ids:o.users.map(e=>e.id)},u.value=!0},U=async()=>{y.value=!0;try{m.value?await V.update(m.value.id,i.value):await V.create(i.value),x.success("تم الحفظ بنجاح"),u.value=!1,b()}catch{x.error("فشل حفظ المجموعة")}finally{y.value=!1}},N=async o=>{if(confirm("هل أنت متأكد من حذف هذه المجموعة؟"))try{await V.delete(o.id),x.success("تم الحذف"),b()}catch{x.error("فشل الحذف")}};return F(b),(o,e)=>(r(),v(M,{fluid:"",class:"pa-6"},{default:t(()=>[s("div",te,[a(G,{icon:"ri-team-line",color:"primary",size:"32"}),e[6]||(e[6]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold"},"مجموعات العمل"),s("p",{class:"text-subtitle-1 text-grey-darken-1 mb-0"},"أنشئ فرق عمل لتسهيل إسناد المهام")],-1)),a(T),a(f,{color:"primary","prepend-icon":"ri-group-line",class:"px-6 rounded-lg",onClick:C},{default:t(()=>e[5]||(e[5]=[c(" مجموعة جديدة ")])),_:1})]),g.value?(r(),v($,{key:1,type:"card@3",class:"bg-transparent"})):(r(),v(R,{key:0},{default:t(()=>[(r(!0),k(A,null,D(_.value,l=>(r(),v(J,{key:l.id,cols:"12",md:"4"},{default:t(()=>[a(B,{class:"group-card rounded-xl border-grey-lighten-4",variant:"flat",border:""},{default:t(()=>[a(z,{class:"pa-5"},{default:t(()=>[s("div",le,[s("div",se,[a(I,{color:l.color||"primary",size:"40"},{default:t(()=>[a(G,{icon:"ri-team-fill",color:"white",size:"20"})]),_:2},1032,["color"]),s("div",null,[s("h3",oe,p(l.name),1),s("span",ie,p(l.users_count)+" موظف",1)])]),a(W,{location:"bottom end"},{activator:t(({props:n})=>[a(f,Y({icon:"ri-more-2-fill",variant:"text",size:"small",ref_for:!0},n),null,16)]),default:t(()=>[a(Z,{density:"compact",class:"rounded-lg"},{default:t(()=>[a(L,{"prepend-icon":"ri-edit-line",title:"تعديل",onClick:n=>S(l)},null,8,["onClick"]),a(L,{"prepend-icon":"ri-delete-bin-line",title:"حذف",color:"error",onClick:n=>N(l)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),s("p",ne,p(l.description||"لا يوجد وصف..."),1),s("div",re,[(r(!0),k(A,null,D(l.users,n=>(r(),v(I,{key:n.id,size:"24",color:n.color||"grey-lighten-3",class:"border border-white"},{default:t(()=>{var h;return[a(ee,{activator:"parent",location:"top"},{default:t(()=>[c(p(n.nickname||n.name),1)]),_:2},1024),s("span",de,p(((h=n.nickname)==null?void 0:h[0])||"U"),1)]}),_:2},1032,["color"]))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})),!g.value&&_.value.length===0?(r(),k("div",ue,[a(E,{src:"/images/empty-groups.png",width:"180",class:"mx-auto mb-4 opacity-50"}),e[8]||(e[8]=s("h3",{class:"text-h6 text-grey"},"لا يوجد مجموعات حالياً",-1)),a(f,{color:"primary",variant:"text",onClick:C},{default:t(()=>e[7]||(e[7]=[c("أنشئ أول مجموعة")])),_:1})])):j("",!0),a(X,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value=l),"max-width":"500px"},{default:t(()=>[a(B,{class:"rounded-xl overflow-hidden"},{default:t(()=>[a(q,{class:"pa-6 bg-primary text-white font-weight-bold"},{default:t(()=>[c(p(m.value?"تعديل مجموعة":"مجموعة عمل جديدة"),1)]),_:1}),a(z,{class:"pa-6"},{default:t(()=>[a(H,{modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.name=l),label:"اسم المجموعة",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),a(K,{modelValue:i.value.description,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.description=l),label:"الوصف",variant:"outlined",rows:"2",class:"mb-4"},null,8,["modelValue"]),e[9]||(e[9]=s("h4",{class:"text-subtitle-2 mb-2"},"أعضاء المجموعة:",-1)),a(O,{modelValue:i.value.user_ids,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.user_ids=l),items:w.value,label:"اختر الموظفين","item-title":"nickname","item-value":"id",multiple:"",chips:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),a(Q,{class:"pa-6 pt-0"},{default:t(()=>[a(T),a(f,{variant:"text",onClick:e[3]||(e[3]=l=>u.value=!1)},{default:t(()=>e[10]||(e[10]=[c("إلغاء")])),_:1}),a(f,{color:"primary",variant:"flat",class:"px-8 rounded-lg",loading:y.value,onClick:U},{default:t(()=>e[11]||(e[11]=[c("حفظ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},fe=ae(ce,[["__scopeId","data-v-25cecaa4"]]);export{fe as default};
