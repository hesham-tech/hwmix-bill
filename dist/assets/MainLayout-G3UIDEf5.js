import{a as J,y as K,r as I,z as M,o as t,x as d,w as s,b as v,d as e,e as re,c as g,F as U,j as P,f as ue,h as ce,u as n,A as j,B as F,C as ee,i as C,v as $,D as de,n as T,E as V,G as pe,H as te,s as L,I as se,J as me,K as O,L as ve,T as ae,M as S,l as fe,N as B,O as H,P as le,Q as h,R as oe,S as ge,p as ne,U as ie,W as _e,X as ye,Y as xe,Z as be,$ as ke,a0 as he,V as Y,a1 as we,q as Ve,t as Ce,a2 as Se}from"./index-B0c0aplS.js";import{n as $e,C as ze}from"./navigation-Bi0sk9Vp.js";import{A as Ue}from"./AppDialog-yMQfGMN-.js";import{_ as Z}from"./AppButton-CoaWq9vh.js";import{A as Le}from"./AppAvatar-Cq13ChFd.js";/* empty css                                                                  */const Ae={class:"pa-0 dialog-content"},Be={class:"pa-4 pt-2 overflow-y-auto",style:{"max-height":"500px"}},Ie={class:"d-flex pa-3 align-start"},Me={class:"flex-grow-1"},De={class:"d-flex align-center justify-space-between mb-1"},Ne={class:"text-h6 font-weight-bold company-name"},Te={class:"d-flex flex-wrap gap-2 mb-2 align-center"},Ee={key:0,class:"text-caption text-grey-darken-1 d-flex align-center"},Re={key:1,class:"text-caption text-grey-darken-1 d-flex align-center"},qe={key:0,class:"text-caption text-grey mb-2 line-clamp-1"},Ge={class:"ms-2 align-self-center"},Pe={key:0,class:"text-center py-10"},je={__name:"CompanySwitchDialog",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(E,{emit:A}){const b=A,i=K(),y=I(null),z=I(""),w=M(()=>{if(!i.companies)return[];const p=z.value.toLowerCase();return i.companies.filter(c=>{var l,m,r,u;return((l=c.name)==null?void 0:l.toLowerCase().includes(p))||((m=c.field)==null?void 0:m.toLowerCase().includes(p))||((r=c.owner_name)==null?void 0:r.toLowerCase().includes(p))||((u=c.address)==null?void 0:u.toLowerCase().includes(p))})}),x=async p=>{var c;if(p.id===((c=i.currentUser)==null?void 0:c.company_id)){b("update:modelValue",!1);return}try{y.value=p.id,await i.switchCompany(p.id),L.success(`تم الانتقال إلى ${p.name} بنجاح`),b("update:modelValue",!1)}catch{L.error("فشل في تبديل الشركة، يرجى المحاولة مرة أخرى")}finally{y.value=null}};return(p,c)=>(t(),d(Ue,{"model-value":E.modelValue,title:"تبديل المتجر / الشركة",icon:"ri-exchange-funds-line","max-width":"700","hide-actions":!0,"onUpdate:modelValue":c[0]||(c[0]=l=>p.$emit("update:modelValue",l))},{default:s(()=>[v("div",Ae,[v("div",Be,[c[3]||(c[3]=v("div",{class:"text-subtitle-2 mb-3 text-grey-darken-1 px-1"},"الشركات التي يمكنك ادارتها:",-1)),e(re,{dense:""},{default:s(()=>[(t(!0),g(U,null,P(w.value,l=>(t(),d(ue,{key:l.id,cols:"12"},{default:s(()=>{var m,r;return[e(ce,{active:l.id===((m=n(i).currentUser)==null?void 0:m.company_id),class:j(["company-card mb-2",{"active-card":l.id===((r=n(i).currentUser)==null?void 0:r.company_id)}]),variant:"outlined",onClick:u=>x(l),disabled:y.value===l.id},{default:s(()=>{var u;return[v("div",Ie,[e(F,{size:"64",rounded:"lg",color:"grey-lighten-4",class:"me-4 border-thin"},{default:s(()=>[l.logo?(t(),d(ee,{key:0,src:l.logo,contain:""},null,8,["src"])):(t(),d(C,{key:1,icon:"ri-building-line",color:"primary",size:"32"}))]),_:2},1024),v("div",Me,[v("div",De,[v("h3",Ne,$(l.name),1),l.id===((u=n(i).currentUser)==null?void 0:u.company_id)?(t(),d(de,{key:0,size:"x-small",color:"success",class:"text-caption font-weight-bold",variant:"flat"},{default:s(()=>c[1]||(c[1]=[T(" النشطة حالياً ")])),_:1})):V("",!0)]),v("div",Te,[l.field?(t(),g("span",Ee,[e(C,{icon:"ri-apps-2-line",start:"",size:"14",class:"me-1"}),T(" "+$(l.field),1)])):V("",!0),l.owner_name?(t(),g("span",Re,[e(C,{icon:"ri-user-star-line",start:"",size:"14",class:"me-1"}),T(" "+$(l.owner_name),1)])):V("",!0)]),l.description?(t(),g("div",qe,$(l.description),1)):V("",!0)]),v("div",Ge,[y.value===l.id?(t(),d(pe,{key:0,indeterminate:"",size:"24",width:"3",color:"primary"})):(t(),d(te,{key:1,icon:"ri-arrow-left-line",variant:"text",color:"primary",size:"small"}))])])]}),_:2},1032,["active","onClick","disabled","class"])]}),_:2},1024))),128))]),_:1}),w.value.length===0?(t(),g("div",Pe,[e(C,{icon:"ri-building-2-line",size:"64",color:"grey-lighten-2",class:"mb-3"}),c[2]||(c[2]=v("div",{class:"text-h6 text-grey"},"لا توجد شركات تطابق بحثك",-1))])):V("",!0)])])]),_:1},8,["model-value"]))}},Fe=J(je,[["__scopeId","data-v-f9602698"]]),Oe={class:"logo-container"},He={key:0,class:"logo-text-wrapper ms-3"},Je={class:"logo-text"},Ke={key:0,class:"company-field text-caption text-primary font-weight-medium"},Qe={key:1,class:"text-caption text-grey-darken-1 d-flex align-center mt-0 switch-hint"},We={key:0,class:"header-rail-toggle"},Xe={class:"sidebar-menu-wrapper"},Ye={__name:"Sidebar",props:{modelValue:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(E,{emit:A}){const b=I(!1),{xs:i,smAndUp:y}=se(),z=ne(),w=ie(),x=K(),p=M(()=>x.companies.find(_=>{var o;return _.id===((o=x.currentUser)==null?void 0:o.company_id)})),c=me(),l=E,m=A,r=M({get:()=>l.modelValue,set:_=>m("update:modelValue",_)}),u=I(!1),k=I([]);O(i,_=>{_?r.value=!1:(r.value=!0,u.value=!1)},{immediate:!0});const D=()=>{setTimeout(()=>{const _=document.querySelector(".sidebar .active-link");_&&_.scrollIntoView({behavior:"smooth",block:"center"})},300)};ve(D),O(()=>w.path,D);const R=M(()=>(x.isStaff?$e:ze).filter(o=>Q(o.permission))),Q=_=>_?x.hasPermission(_):!0,W=async()=>{try{await c.logout(),L.success("تم تسجيل الخروج بنجاح"),z.push("/login")}catch{L.error("حدث خطأ أثناء تسجيل الخروج")}};return(_,o)=>(t(),d(ge,{modelValue:r.value,"onUpdate:modelValue":o[8]||(o[8]=q=>r.value=q),rail:u.value,permanent:n(y),persistent:n(y),temporary:n(i),touchless:n(y),scrim:n(i)?"rgba(0,0,0,0.1)":!1,width:"280",class:"sidebar",color:"background"},{default:s(()=>{var q;return[v("div",{class:j(["sidebar-sidebar-header-wrapper",{"collapsible-header":n(x).companies.length>1}])},[v("div",{class:j(["sidebar-header flex-grow-1",{clickable:n(x).companies.length>1}]),onClick:o[0]||(o[0]=a=>n(x).companies.length>1?b.value=!0:null)},[v("div",Oe,[(q=p.value)!=null&&q.logo?(t(),d(F,{key:0,size:"50",rounded:"lg",class:"logo-avatar"},{default:s(()=>[e(ee,{src:p.value.logo,contain:""},null,8,["src"])]),_:1})):(t(),d(F,{key:1,size:"50",rounded:"lg",color:"primary",variant:"tonal",class:"logo-avatar"},{default:s(()=>[e(C,{icon:"ri-building-line",size:"28"})]),_:1})),e(ae,{name:"fade"},{default:s(()=>{var a,N;return[!u.value||n(i)?(t(),g("div",He,[v("h2",Je,$(((a=p.value)==null?void 0:a.name)||"hwmix-bill"),1),(N=p.value)!=null&&N.field&&!u.value?(t(),g("div",Ke,$(p.value.field),1)):V("",!0),n(x).companies.length>1?(t(),g("div",Qe,[o[9]||(o[9]=v("span",null,"تبديل الشركة",-1)),e(C,{icon:"ri-arrow-up-down-line",size:"10",class:"ms-1"})])):V("",!0)])):V("",!0)]}),_:1})])],2),n(i)?V("",!0):(t(),g("div",We,[e(B,{text:u.value?"توسيع القائمة":"تقليص القائمة",location:"right"},{activator:s(({props:a})=>[e(te,S(a,{icon:u.value?"ri-arrow-left-s-line":"ri-arrow-right-s-line",color:"primary",size:"40",class:"rail-floating-btn",elevation:"4",onClick:o[1]||(o[1]=fe(N=>u.value=!u.value,["stop"]))}),null,16,["icon"])]),_:1},8,["text"])]))],2),e(H),v("div",Xe,[e(oe,{opened:k.value,"onUpdate:opened":o[6]||(o[6]=a=>k.value=a),"open-strategy":"single",density:"compact",nav:"",class:"sidebar-menu"},{default:s(()=>[(t(!0),g(U,null,P(R.value,(a,N)=>(t(),g(U,{key:N},[a.children&&a.children.length>0?(t(),d(_e,{key:0,value:a.title},{activator:s(({props:f})=>[u.value&&!n(i)?(t(),d(B,{key:0,text:a.title,location:"end"},{activator:s(({props:G})=>[e(h,S({ref_for:!0},{...f,...G},{"prepend-icon":a.icon,title:a.title,class:"menu-item group-header"}),null,16,["prepend-icon","title"])]),_:2},1032,["text"])):(t(),d(h,S({key:1,ref_for:!0},f,{"prepend-icon":a.icon,title:a.title,class:"menu-item group-header"}),null,16,["prepend-icon","title"]))]),default:s(()=>[(t(!0),g(U,null,P(a.children.filter(f=>Q(f.permission)),(f,G)=>(t(),g(U,{key:G},[u.value&&!n(i)?(t(),d(B,{key:0,text:f.title,location:"end"},{activator:s(({props:X})=>[e(h,S({ref_for:!0},X,{to:f.to,title:f.title,"prepend-icon":f.icon||"ri-subtract-line",class:"menu-sub-item","selected-class":"active-link",onClick:o[2]||(o[2]=at=>n(i)?r.value=!1:null)}),null,16,["to","title","prepend-icon"])]),_:2},1032,["text"])):(t(),d(h,{key:1,to:f.to,title:f.title,"prepend-icon":f.icon||"ri-subtract-line",class:"menu-sub-item","selected-class":"active-link",onClick:o[3]||(o[3]=X=>n(i)?r.value=!1:null)},null,8,["to","title","prepend-icon"]))],64))),128))]),_:2},1032,["value"])):(t(),g(U,{key:1},[u.value&&!n(i)?(t(),d(B,{key:0,text:a.title,location:"end"},{activator:s(({props:f})=>[e(h,S({ref_for:!0},f,{to:a.to,"prepend-icon":a.icon,title:a.title,class:"menu-item","selected-class":"active-link",onClick:o[4]||(o[4]=G=>n(i)?r.value=!1:null)}),null,16,["to","prepend-icon","title"])]),_:2},1032,["text"])):(t(),d(h,{key:1,to:a.to,"prepend-icon":a.icon,title:a.title,class:"menu-item","selected-class":"active-link",onClick:o[5]||(o[5]=f=>n(i)?r.value=!1:null)},null,8,["to","prepend-icon","title"]))],64))],64))),128)),e(le),e(H,{class:"my-2"}),u.value&&!n(i)?(t(),d(B,{key:0,text:"تسجيل الخروج",location:"end"},{activator:s(({props:a})=>[e(h,S(a,{"prepend-icon":"ri-logout-box-line",title:"تسجيل الخروج",onClick:W,class:"logout-item"}),null,16)]),_:1})):(t(),d(h,{key:1,"prepend-icon":"ri-logout-box-line",title:"تسجيل الخروج",onClick:W,class:"logout-item"}))]),_:1},8,["opened"])]),e(Fe,{modelValue:b.value,"onUpdate:modelValue":o[7]||(o[7]=a=>b.value=a)},null,8,["modelValue"])]}),_:1},8,["modelValue","rail","permanent","persistent","temporary","touchless","scrim"]))}},Ze=J(Ye,[["__scopeId","data-v-50e9bc52"]]),et={class:"d-none d-sm-inline"},tt={class:"sticky-breadcrumbs-container border-b"},st={__name:"MainLayout",setup(E){const{xs:A}=se(),b=ie(),i=ne(),y=K(),z=ye(),w=I(!A.value);O(A,m=>{w.value=!m},{immediate:!0});const x=M(()=>{var m;return((m=y.currentUser)==null?void 0:m.full_name)||"المستخدم"}),p=M(()=>{const m=[{title:"الرئيسية",to:"/dashboard",disabled:!1}];return b.meta.breadcrumbs?m.push(...b.meta.breadcrumbs):b.meta.title&&m.push({title:b.meta.title,disabled:!0}),m}),c=()=>{z.toggleLocale(),L.success(z.locale==="ar"?"تم التبديل للعربية":"Switched to English")},l=async()=>{try{await Ve.logout(),L.success("تم تسجيل الخروج بنجاح"),i.push("/login")}catch{L.error("فشل تسجيل الخروج")}};return(m,r)=>{const u=Ce("router-view");return t(),g(U,null,[e(Ze,{modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=k=>w.value=k)},null,8,["modelValue"]),e(xe,{color:"surface",elevation:"0",class:"border-b"},{default:s(()=>[e(ke,{color:"primary",onClick:r[1]||(r[1]=k=>w.value=!w.value),class:"d-flex d-sm-none"}),e(le),e(B,{location:"bottom"},{activator:s(({props:k})=>[e(Z,S(k,{icon:"",variant:"text",onClick:c,class:"mx-2"}),{default:s(()=>[e(C,null,{default:s(()=>r[2]||(r[2]=[T("ri-translate-2")])),_:1})]),_:2},1040)]),default:s(()=>[T(" "+$(n(z).locale==="ar"?"English":"عربي"),1)]),_:1}),e(he,null,{activator:s(({props:k})=>[e(Z,S(k,{variant:"text",class:"user-menu-btn px-2"}),{default:s(()=>{var D,R;return[e(Le,{"img-url":(D=n(y).currentUser)==null?void 0:D.avatar_url,name:(R=n(y).currentUser)==null?void 0:R.full_name,size:"30",class:"ml-2"},null,8,["img-url","name"]),v("span",et,$(x.value),1),e(C,{icon:"ri-arrow-down-s-line",size:"x-small",class:"ms-1"})]}),_:2},1040)]),default:s(()=>[e(oe,{density:"compact"},{default:s(()=>[e(h,{"prepend-icon":"ri-user-settings-line",title:"الملف الشخصي",to:"/profile"}),e(h,{"prepend-icon":"ri-settings-3-line",title:"الإعدادات",to:"/settings"}),e(H,{class:"my-1"}),e(h,{"prepend-icon":"ri-logout-box-line",title:"تسجيل الخروج",onClick:l,class:"text-error"})]),_:1})]),_:1})]),_:1}),e(be,{class:"main-content"},{default:s(()=>[v("div",tt,[e(Y,{fluid:"",class:"py-1 px-1"},{default:s(()=>[e(we,{items:p.value,class:"pa-0 text-caption"},{divider:s(()=>[e(C,{icon:"ri-arrow-left-s-line",size:"small"})]),_:1},8,["items"])]),_:1})]),e(Y,{fluid:"",class:"pa-6"},{default:s(()=>[e(u,null,{default:s(({Component:k})=>[e(ae,{name:"page",mode:"out-in"},{default:s(()=>[(t(),d(Se(k)))]),_:2},1024)]),_:1})]),_:1})]),_:1})],64)}}},ct=J(st,[["__scopeId","data-v-bef67301"]]);export{ct as default};
