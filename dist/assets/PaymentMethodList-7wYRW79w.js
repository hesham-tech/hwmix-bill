import{u as Z}from"./useApi-CjhFmPue.js";import{r as m,v as re,x as $,J as de,I as R,o as n,s as d,w as t,b as l,g as H,d as ue,e as B,a as i,z as J,A as W,f as se,C as k,j as ye,i as he,P as j,H as _e,c as G,u as y,F as oe,l as U,N as ne,at as be,h as xe,t as E,B as K,y as ke,ac as Ve,au as we,a7 as Me,av as Ae}from"./index-CuR9-sbN.js";import{A as ce}from"./AppDialog-vLCI3uF9.js";import{_ as X}from"./AppInput-06Y7zOXl.js";import{M as Pe}from"./MediaGallery-DgiLIKzw.js";import{A as F}from"./AppSwitch-CXzOvU1j.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ie}from"./AppCard-CXpBKc1t.js";import{_ as L}from"./AppButton-CREzoRf6.js";import{A as Ce}from"./AppDataTable-CnA5lOqV.js";import{_ as Se}from"./LoadingSpinner-vBlED74H.js";import{_ as Ue}from"./EmptyState-FFeUUxeu.js";import{A as Ee}from"./AppInfiniteScroll-616_I-vy.js";function De(){const D=Z("/api/payment-methods"),A=m([]),p=m(!1),h=m(0);return{paymentMethods:A,loading:p,total:h,fetchPaymentMethods:async(g={},V={})=>{var P;const{append:w=!1}=V;p.value=!0;try{const v=await D.get(g,{showLoading:!1});let f=[],_=0;return v.data&&Array.isArray(v.data.data)?(f=v.data.data,_=((P=v.data.meta)==null?void 0:P.total)||v.data.data.length):(f=v.data||[],_=v.total||f.length),w?A.value=[...A.value,...f]:A.value=f,h.value=_,v}catch(v){throw A.value=[],h.value=0,v}finally{p.value=!1}},deletePaymentMethod:async g=>await D.remove(g,{successMessage:"تم حذف طريقة الدفع بنجاح"}),togglePaymentMethodStatus:async g=>await D.update(`${g}/toggle`,{},{successMessage:"تم تغيير حالة طريقة الدفع بنجاح"})}}const Te={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},ze={class:"d-flex align-center justify-space-between"},$e={class:"d-flex align-center justify-space-between"},Ie={__name:"PaymentMethodForm",props:{modelValue:{type:Boolean,required:!0},paymentMethod:{type:Object,default:null}},emits:["update:modelValue","saved"],setup(D,{emit:A}){const p=re(),h=$(()=>p.isAdmin),I=$(()=>p.isCompanyAdmin);de(()=>{});const Y=$(()=>{var a;return h.value?!0:(a=T.paymentMethod)!=null&&a.is_system?!1:I.value||p.hasPermission(j.PAYMENT_METHODS_UPDATE_ALL)}),T=D,g=A,V=Z("/api/payment-methods"),w=m(null),P=m(!1),v=m(!1),f=m(null),_=m({}),u=m({name:"",code:"",active:!0,is_system:!1,image_id:null}),S=$(()=>{var a;return!!((a=T.paymentMethod)!=null&&a.id)}),q={required:a=>!!a||"هذا الحقل مطلوب"},b=a=>{u.value.image_id=a.id,f.value=a.url},z=()=>{var a;u.value={name:"",code:"",active:!0,is_system:!1,image_id:null},f.value=null,_.value={},(a=w.value)==null||a.resetValidation()};R(()=>T.paymentMethod,a=>{a?(u.value={name:a.name||"",code:a.code||"",active:!!(a.active??!0),is_system:!!a.is_system,image_id:a.image_id||null},console.log("Payment Method Loaded:",a.name,"is_system:",a.is_system,"cast:",u.value.is_system),f.value=a.image_url||null):z()},{immediate:!0});const N=async()=>{var o,c;if(!w.value)return;const{valid:a}=await w.value.validate();if(a){P.value=!0,_.value={};try{S.value?await V.update(T.paymentMethod.id,u.value,{successMessage:"تم تحديث طريقة الدفع بنجاح"}):await V.create(u.value,{successMessage:"تم إضافة طريقة الدفع بنجاح"}),g("saved"),g("update:modelValue",!1),z()}catch(x){(c=(o=x.response)==null?void 0:o.data)!=null&&c.errors&&(_.value=x.response.data.errors)}finally{P.value=!1}}};return(a,o)=>(n(),d(ce,{"model-value":D.modelValue,title:S.value?"تعديل طريقة الدفع":"طريقة دفع جديدة",icon:S.value?"ri-edit-line":"ri-bank-card-line",loading:P.value,"max-width":"600","onUpdate:modelValue":o[6]||(o[6]=c=>a.$emit("update:modelValue",c)),onConfirm:N},{"prepend-title":t(()=>[l(H,{icon:S.value?"ri-edit-line":"ri-bank-card-line",class:"me-2"},null,8,["icon"])]),default:t(()=>[l(he,{ref_key:"formRef",ref:w,onSubmit:ye(N,["prevent"])},{default:t(()=>[l(ue,null,{default:t(()=>[l(B,{cols:"12",class:"d-flex justify-center mb-4"},{default:t(()=>[i("div",{class:"logo-preview-zone position-relative cursor-pointer",onClick:o[0]||(o[0]=c=>v.value=!0)},[l(J,{size:"120",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:t(()=>[f.value?(n(),d(W,{key:0,src:f.value,cover:""},null,8,["src"])):(n(),d(H,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),i("div",Te,[l(H,{icon:"ri-exchange-line",color:"white",size:"24"}),o[7]||(o[7]=i("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الشعار",-1))])]),_:1})])]),_:1}),l(B,{cols:"12"},{default:t(()=>[l(X,{modelValue:u.value.name,"onUpdate:modelValue":o[1]||(o[1]=c=>u.value.name=c),label:"اسم طريقة الدفع *","prepend-inner-icon":"ri-bank-card-line",rules:[q.required],"error-messages":_.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),l(B,{cols:"12"},{default:t(()=>[l(X,{modelValue:u.value.code,"onUpdate:modelValue":o[2]||(o[2]=c=>u.value.code=c),label:"الكود *","prepend-inner-icon":"ri-key-line",rules:[q.required],"error-messages":_.value.code,disabled:S.value,hint:"كود فريد للتعريف بالنظام (مثل: CASH, BANK)","persistent-hint":""},null,8,["modelValue","rules","error-messages","disabled"])]),_:1}),Y.value?(n(),d(B,{key:0,cols:"12"},{default:t(()=>[l(se,{variant:"tonal",color:u.value.active?"primary":"grey",class:"pa-4 rounded-lg mt-4"},{default:t(()=>[i("div",ze,[o[8]||(o[8]=i("div",null,[i("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),i("div",{class:"text-caption"},"تفعيل أو تعطيل هذه الطريقة في شاشات الدفع")],-1)),l(F,{modelValue:u.value.active,"onUpdate:modelValue":o[3]||(o[3]=c=>u.value.active=c),label:"نشط","hide-details":""},null,8,["modelValue"])])]),_:1},8,["color"])]),_:1})):k("",!0),h.value?(n(),d(B,{key:1,cols:"12"},{default:t(()=>[l(se,{variant:"tonal",color:u.value.is_system?"info":"grey",class:"pa-4 rounded-lg"},{default:t(()=>[i("div",$e,[o[9]||(o[9]=i("div",null,[i("div",{class:"text-subtitle-1 font-weight-bold"},"طريقة أساسية (System)"),i("div",{class:"text-caption"},"إذا تم تفعيلها، ستظهر لجميع الشركات كنظام افتراضي")],-1)),l(F,{modelValue:u.value.is_system,"onUpdate:modelValue":o[4]||(o[4]=c=>u.value.is_system=c),color:"info","hide-details":""},null,8,["modelValue"])])]),_:1},8,["color"])]),_:1})):k("",!0)]),_:1})]),_:1},512),l(Pe,{modelValue:v.value,"onUpdate:modelValue":o[5]||(o[5]=c=>v.value=c),type:"logo",onSelect:b},null,8,["modelValue"])]),_:1},8,["model-value","title","icon","loading"]))}},Ne=me(Ie,[["__scopeId","data-v-9f700043"]]),Le={class:"payment-methods-page"},Be={class:"page-header d-flex align-center justify-space-between mb-6"},je={class:"d-flex align-center flex-wrap gap-4"},He={class:"method-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Oe={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},Re={class:"d-flex align-center"},Fe={class:"d-flex align-center py-2"},Ye={class:"d-flex flex-column"},qe={class:"font-weight-bold"},Ge={class:"d-flex align-center justify-center"},Ke={class:"text-center pa-4"},Je={class:"text-body-1 text-grey-darken-1"},Qe={__name:"PaymentMethodList",setup(D){const A=(r,s)=>{let e;return(...C)=>{e&&clearTimeout(e),e=setTimeout(()=>r(...C),s)}},{paymentMethods:p,loading:h,total:I,fetchPaymentMethods:Y,deletePaymentMethod:T}=De();_e();const g=re(),V=$(()=>g.hasPermission(j.ADMIN_SUPER)),w=$(()=>g.hasPermission(j.ADMIN_COMPANY)),P=$(()=>V.value||w.value||g.hasPermission(j.PAYMENT_METHODS_CREATE)),v=r=>V.value?!0:r.is_system?!1:w.value||g.hasPermission(j.PAYMENT_METHODS_DELETE),f=r=>V.value?!0:r.is_system?!1:w.value||g.hasPermission(j.PAYMENT_METHODS_UPDATE_ALL),_=Z("/api/payment-methods"),u=m(null),S=async r=>{u.value=r.id;try{await _.update(r.id,{active:!r.active}),r.active=!r.active}finally{u.value=null}},q=()=>{h.value||p.value.length>=I.value||(b.value++,M(!0))},b=m(1),z=m(12),N=m(""),a=m("grid"),o=m(!1),c=m(!1),x=m(null),Q=m(!1),O=m(!1),ve=[{title:"طريقة الدفع",key:"name",sortable:!0},{title:"الكود",key:"code",sortable:!0},{title:"الحالة",key:"active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],ee=r=>({CASH:"ri-money-dollar-circle-line",BANK:"ri-bank-line",CARD:"ri-bank-card-line",WALLET:"ri-wallet-3-line",CHEQUE:"ri-coupon-3-line"})[r==null?void 0:r.toUpperCase()]||"ri-bank-card-line",pe=A(()=>{b.value=1,M()},500),ae=()=>{x.value=null,o.value=!0},te=r=>{x.value=r,o.value=!0},le=r=>{x.value=r,c.value=!0},fe=async()=>{Q.value=!0;try{await T(x.value.id),c.value=!1,M()}finally{Q.value=!1}},ge=r=>{a.value==="list"&&M()},M=(r={})=>{const s=r===!0,e={page:b.value,per_page:z.value,search:N.value};V.value&&(e.is_system=O.value?1:0),Y(e,{append:s})};return de(M),R(b,(r,s)=>{a.value==="list"&&M()}),R(z,()=>{a.value==="list"&&(b.value=1,M())}),R(a,()=>{b.value=1,M()}),R(O,()=>{b.value=1,M()}),(r,s)=>(n(),G("div",Le,[i("div",Be,[s[9]||(s[9]=i("div",null,[i("h1",{class:"text-h4 font-weight-bold ml-2"},"طرق الدفع"),i("p",{class:"text-body-1 text-grey"},"إدارة طرق الدفع المتاحة في النظام")],-1)),P.value?(n(),d(L,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:ae},{default:t(()=>s[8]||(s[8]=[U(" طريقة جديدة ")])),_:1})):k("",!0)]),l(ie,{class:"mb-6"},{default:t(()=>[i("div",je,[l(X,{modelValue:N.value,"onUpdate:modelValue":[s[0]||(s[0]=e=>N.value=e),y(pe)],label:"بحث عن طريقة دفع...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(ne),V.value?(n(),d(F,{key:0,modelValue:O.value,"onUpdate:modelValue":s[1]||(s[1]=e=>O.value=e),label:O.value?"مشاهدة الأنواع الأساسية (System)":"مشاهدة الأنواع المخصصة (Custom)","hide-details":""},null,8,["modelValue","label"])):k("",!0),l(be,{variant:"outlined",density:"comfortable",color:"primary"},{default:t(()=>[l(L,{active:a.value==="grid",icon:"ri-grid-fill",onClick:s[2]||(s[2]=e=>a.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(L,{active:a.value==="list",icon:"ri-list-check",onClick:s[3]||(s[3]=e=>a.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),y(h)&&!y(p).length?(n(),d(Se,{key:0,size:"64",text:"جاري تحميل طرق الدفع..."})):y(p).length?(n(),G(oe,{key:2},[a.value==="grid"?(n(),d(Ee,{key:0,loading:y(h)&&y(p).length>0,"has-more":y(p).length<y(I),"no-more-text":"لا يوجد المزيد من طرق الدفع",onLoad:q},{default:t(()=>[l(ue,null,{default:t(()=>[(n(!0),G(oe,null,xe(y(p),e=>(n(),d(B,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:t(()=>[l(ie,{class:"method-card h-100","no-padding":""},{actions:t(()=>[l(ne),l(L,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:C=>te(e)},null,8,["onClick"]),v(e)?(n(),d(L,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:C=>le(e)},null,8,["onClick"])):k("",!0)]),default:t(()=>[i("div",He,[l(J,{size:"120",rounded:"circle",color:e.active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white"},{default:t(()=>[e.image_url?(n(),d(W,{key:0,src:e.image_url,cover:""},null,8,["src"])):(n(),d(H,{key:1,icon:ee(e.code),size:"60",color:e.active?"success":"grey"},null,8,["icon","color"]))]),_:2},1032,["color"])]),l(we,{class:"position-relative pt-4"},{default:t(()=>[l(Me,{class:"text-h6 font-weight-bold pa-0 mb-1"},{default:t(()=>[U(E(e.name),1)]),_:2},1024),i("div",Oe,[i("div",Re,[s[10]||(s[10]=i("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),l(K,{color:e.active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:t(()=>[U(E(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),f(e)?(n(),d(F,{key:0,"model-value":e.active,loading:u.value===e.id,"onUpdate:modelValue":C=>S(e)},null,8,["model-value","loading","onUpdate:modelValue"])):k("",!0)]),l(Ae,{class:"pa-0"},{default:t(()=>[U("كود: "+E(e.code),1)]),_:2},1024),e.is_system?(n(),d(K,{key:0,color:"info",size:"x-small",class:"position-absolute",style:{top:"16px",left:"16px"},variant:"tonal"},{default:t(()=>s[11]||(s[11]=[U(" اساسي ")])),_:1})):k("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),d(Ce,{key:1,headers:ve,items:y(p),"total-items":y(I),loading:y(h),page:b.value,"onUpdate:page":s[4]||(s[4]=e=>b.value=e),"items-per-page":z.value,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>z.value=e),searchable:!1,"can-view":!1,"can-delete":!1,"onUpdate:options":ge,onEdit:te},{"item.name":t(({item:e})=>[i("div",Fe,[l(J,{size:"48",rounded:"circle",color:e.active?"bg-white":"grey-lighten-4",class:"me-3 border"},{default:t(()=>[e.image_url?(n(),d(W,{key:0,src:e.image_url,cover:""},null,8,["src"])):(n(),d(H,{key:1,icon:ee(e.code),size:"24",color:e.active?"success":"grey"},null,8,["icon","color"]))]),_:2},1032,["color"]),i("div",Ye,[i("span",qe,E(e.name),1),e.is_system?(n(),d(K,{key:0,size:"x-small",color:"info",variant:"tonal",class:"mt-1",style:{width:"fit-content"}},{default:t(()=>s[12]||(s[12]=[U("أساسي")])),_:1})):k("",!0)])])]),"item.active":t(({item:e})=>[i("div",Ge,[f(e)?(n(),G("span",{key:0,class:ke(["text-caption me-2 font-weight-bold",e.active?"text-success":"text-error"])},E(e.active?"نشط":"معطل"),3)):k("",!0),f(e)?(n(),d(F,{key:1,"model-value":e.active,loading:u.value===e.id,"onUpdate:modelValue":C=>S(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(n(),d(K,{key:2,color:e.active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:t(()=>[U(E(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":t(({item:e})=>[v(e)?(n(),d(L,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:C=>le(e)},null,8,["onClick"])):k("",!0)]),_:1},8,["items","total-items","loading","page","items-per-page"]))],64)):(n(),d(Ue,{key:1,icon:"ri-bank-card-line",title:"لا توجد طرق دفع حالياً",message:"ابدأ بإضافة أول طريقة دفع لنظامك","show-action":P.value,"action-text":"إضافة طريقة دفع",onAction:ae},null,8,["show-action"])),l(Ne,{modelValue:o.value,"onUpdate:modelValue":s[6]||(s[6]=e=>o.value=e),"payment-method":x.value,onSaved:M},null,8,["modelValue","payment-method"]),l(ce,{modelValue:c.value,"onUpdate:modelValue":s[7]||(s[7]=e=>c.value=e),title:"حذف طريقة الدفع؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:Q.value,onConfirm:fe},{default:t(()=>{var e,C;return[i("div",Ke,[l(J,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:t(()=>[l(H,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),i("p",Je,'هل أنت متأكد من حذف "'+E((e=x.value)==null?void 0:e.name)+'"؟',1),((C=x.value)==null?void 0:C.payments_count)>0?(n(),d(Ve,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-4 text-right"},{default:t(()=>[U(" هذه الطريقة مرتبطة بـ "+E(x.value.payments_count)+" عملية دفع. لا ينصح بحذفها. ",1)]),_:1})):k("",!0)])]}),_:1},8,["modelValue","loading"])]))}},ua=me(Qe,[["__scopeId","data-v-e6016c6b"]]);export{ua as default};
