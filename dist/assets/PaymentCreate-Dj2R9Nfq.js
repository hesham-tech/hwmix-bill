import{r as i,z,L,c as N,b as s,d as e,w as t,l as B,k as D,o as T,n as I,P as F,e as G,f as r,Q as O,al as Q,am as j,i as M,v as k,af as H,ak as J,p as K}from"./index-98ieInin.js";import{u as f}from"./useApi-C-2zrNsN.js";import{_}from"./AppButton-Dj4u5ybH.js";import{_ as W}from"./AppCard-hKVlC0Jq.js";import{_ as S}from"./AppInput-CufQk24k.js";import{_ as X}from"./AppAutocomplete-UF3wj85B.js";const Y={class:"payment-create-page"},Z={class:"mb-6 px-6 pt-6 d-flex align-center"},ee={class:"px-6 pb-6"},ae={class:"d-flex align-center mt-1"},le={class:"me-3"},te={class:"text-error font-weight-bold"},ne={class:"d-flex w-100 align-center gap-3"},ce={__name:"PaymentCreate",setup(oe){const y=K(),P=f("/api/invoices"),q=f("/api/payment-methods"),A=f("/api/payments"),g=i(null),m=i(!1),c=i([]),V=i([]),p=i(!1),v=i(!1),d=i(null),n=i({invoice_id:null,amount:0,payment_method_id:null,payment_date:new Date().toISOString().split("T")[0],notes:""}),u={required:l=>!!l||"مطلوب"},h=z(()=>{var l;return((l=d.value)==null?void 0:l.remaining_amount)||0}),E=l=>{d.value=c.value.find(a=>a.id===l),d.value&&(n.value.amount=d.value.remaining_amount||0)},R=async()=>{p.value=!0;try{const l=await P.get({payment_status:"unpaid,partial",per_page:100},{showLoading:!1,showError:!1});c.value=l.data||[]}finally{p.value=!1}},U=async()=>{v.value=!0;try{const l=await q.get({per_page:100},{showLoading:!1,showError:!1});V.value=l.data||[]}finally{v.value=!1}},$=async()=>{const{valid:l}=await g.value.validate();if(l){m.value=!0;try{await A.create(n.value,{successMessage:"تم تسجيل الدفعة بنجاح"}),y.push("/payments")}finally{m.value=!1}}},b=()=>{y.push("/payments")},w=l=>l?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(l):"0.00 ج.م";return L(()=>{R(),U()}),(l,a)=>(T(),N("div",Y,[s("div",Z,[e(_,{icon:"ri-large-arrow-right-line",variant:"text",color:"secondary",class:"me-3",onClick:b}),a[5]||(a[5]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold"},"تسجيل معاملة تحصيل"),s("p",{class:"text-body-1 text-grey"},"إضافة رصيد جديد لفاتورة غير مسددة أو مسددة جزئياً")],-1))]),s("div",ee,[e(D,{ref_key:"formRef",ref:g,onSubmit:B($,["prevent"])},{default:t(()=>[e(W,{title:"تفاصيل العملية المالية",icon:"ri-money-dollar-box-line",class:"mb-6"},{actions:t(()=>[s("div",ne,[e(_,{variant:"text",color:"secondary",onClick:b},{default:t(()=>a[6]||(a[6]=[I(" تراجع ")])),_:1}),e(F),e(_,{color:"primary",type:"submit",loading:m.value,"prepend-icon":"ri-save-line",class:"px-8"},{default:t(()=>a[7]||(a[7]=[I(" تأكيد وتسجيل الدفعة ")])),_:1},8,["loading"])])]),default:t(()=>[e(G,{dense:""},{default:t(()=>[e(r,{cols:"12",md:"6"},{default:t(()=>[e(X,{modelValue:n.value.invoice_id,"onUpdate:modelValue":[a[0]||(a[0]=o=>n.value.invoice_id=o),E],items:c.value,loading:p.value,"item-title":"invoice_number","item-value":"id",label:"الفاتورة المستهدفة *",placeholder:"ابحث برقم الفاتورة","prepend-inner-icon":"ri-file-list-3-line",rules:[u.required]},{item:t(({props:o,item:x})=>[e(O,Q(j(o)),{subtitle:t(()=>{var C;return[s("div",ae,[e(M,{icon:"ri-user-line",size:"14",class:"me-1"}),s("span",le,k((C=x.raw.customer)==null?void 0:C.name),1),e(M,{icon:"ri-money-dollar-circle-line",size:"14",color:"error",class:"me-1"}),s("span",te,"متبقي: "+k(w(x.raw.remaining_amount)),1)])]}),_:2},1040)]),_:1},8,["modelValue","items","loading","rules"])]),_:1}),e(r,{cols:"12",md:"6"},{default:t(()=>[e(S,{modelValue:n.value.amount,"onUpdate:modelValue":a[1]||(a[1]=o=>n.value.amount=o),modelModifiers:{number:!0},label:"القيمة المحصلة *",type:"number",step:"0.01",placeholder:"ادخل المبلغ","prepend-inner-icon":"ri-money-dollar-circle-line",rules:[u.required],hint:h.value?`الحد الأقصى المتبقي لهذه الفاتورة: ${w(h.value)}`:"سيتم خصم هذا المبلغ من رصيد الفاتورة","persistent-hint":""},null,8,["modelValue","rules","hint"])]),_:1}),e(r,{cols:"12",md:"6"},{default:t(()=>[e(H,{modelValue:n.value.payment_method_id,"onUpdate:modelValue":a[2]||(a[2]=o=>n.value.payment_method_id=o),items:V.value,loading:v.value,"item-title":"name","item-value":"id",label:"طريقة التحصيل *",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-wallet-line",rules:[u.required],"hide-details":"",class:"mb-4"},null,8,["modelValue","items","loading","rules"])]),_:1}),e(r,{cols:"12",md:"6"},{default:t(()=>[e(S,{modelValue:n.value.payment_date,"onUpdate:modelValue":a[3]||(a[3]=o=>n.value.payment_date=o),label:"تاريخ التحصيل *",type:"date","prepend-inner-icon":"ri-calendar-line",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),e(r,{cols:"12"},{default:t(()=>[e(J,{modelValue:n.value.notes,"onUpdate:modelValue":a[4]||(a[4]=o=>n.value.notes=o),label:"ملاحظات وسند الصرف",placeholder:"أدخل أي ملاحظات إضافية هنا...",rows:"3",variant:"outlined","prepend-inner-icon":"ri-article-line","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},512)])]))}};export{ce as default};
