import{r as d,v as be,x as N,J as ke,I as H,c as y,a as o,s as r,w as s,C as A,b as t,u as f,F as P,o as i,l as _,N as K,at as Ve,h as j,d as Q,g as W,z as ue,t as h,y as Ae,B as $,i as we,j as Ce,e as E,M as Te,P as T,au as Ue,a7 as Se}from"./index-CuR9-sbN.js";import{u as ve}from"./useApi-CjhFmPue.js";import{A as Ee}from"./AppDataTable-CnA5lOqV.js";import{A as de}from"./AppDialog-vLCI3uF9.js";import{_ as k}from"./AppButton-CREzoRf6.js";import{_ as X}from"./AppInput-06Y7zOXl.js";import{A as Z}from"./AppSwitch-CXzOvU1j.js";import{_ as ce}from"./AppCard-CXpBKc1t.js";import{_ as De}from"./LoadingSpinner-vBlED74H.js";import{_ as ze}from"./EmptyState-FFeUUxeu.js";import{A as Ie}from"./AppInfiniteScroll-616_I-vy.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";function $e(){const F=ve("/api/attributes"),w=d([]),m=d(!1),V=d(0);return{attributes:w,loading:m,total:V,fetchAttributes:async(D={},z={})=>{var g;const{append:p=!1}=z;m.value=!0;try{const u=await F.get(D,{showLoading:!1});let x=[],v=0;return u.data&&Array.isArray(u.data.data)?(x=u.data.data,v=((g=u.data.meta)==null?void 0:g.total)||u.data.data.length):(x=u.data||[],v=u.total||x.length),p?w.value=[...w.value,...x]:w.value=x,V.value=v,u}catch(u){throw w.value=[],V.value=0,u}finally{m.value=!1}},deleteAttribute:async D=>await F.remove(D,{successMessage:"تم حذف الخاصية بنجاح"})}}const Le={class:"attributes-page"},Me={class:"page-header d-flex align-center justify-space-between mb-6"},Be={class:"d-flex align-center flex-wrap gap-4"},Re={class:"attribute-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Ne={class:"d-flex align-center justify-center mb-3"},je={class:"d-flex flex-wrap gap-1 justify-center min-height-40 overflow-hidden"},Fe={class:"d-flex align-center py-2"},Oe={class:"d-flex flex-column"},qe={class:"font-weight-bold text-subtitle-1"},Je={class:"text-caption text-grey"},Ge={class:"d-flex flex-wrap gap-1 py-1 max-width-300"},Ye={key:0,class:"text-grey text-caption"},He={class:"d-flex align-center justify-center"},Ke={class:"d-flex align-center mb-2"},Qe={key:0,class:"values-list pa-1"},We={key:1,class:"text-center pa-4 text-grey bg-grey-lighten-4 rounded-lg"},Xe={__name:"AttributeList",setup(F){const w=(l,a)=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>l(...n),a)}},{attributes:m,loading:V,total:L,fetchAttributes:ee,deleteAttribute:D}=$e(),z=ve("/api/attributes"),p=be(),g=d(1),u=d(12),x=d(""),v=d("list"),I=d(!1),M=d(!1),C=d(null),O=d(!1),q=d(!1),ae=d(null),B=d(null),J=N(()=>p.hasPermission(T.ADMIN_SUPER)),G=N(()=>p.hasPermission(T.ADMIN_COMPANY)),le=N(()=>J.value||G.value||p.hasPermission(T.ATTRIBUTES_CREATE)),R=l=>{var a;return J.value||G.value?!0:p.hasPermission(T.ATTRIBUTES_UPDATE_ALL)||p.hasPermission(T.ATTRIBUTES_UPDATE_SELF)&&l.created_by===((a=p.currentUser)==null?void 0:a.id)},te=l=>{var a;return J.value||G.value?!0:p.hasPermission(T.ATTRIBUTES_DELETE_ALL)||p.hasPermission(T.ATTRIBUTES_DELETE_SELF)&&l.created_by===((a=p.currentUser)==null?void 0:a.id)},c=d({name:"",values:[],is_active:1}),Y=N(()=>{var l;return!!((l=C.value)!=null&&l.id)}),fe=[{title:"الخاصية",key:"name",sortable:!0},{title:"القيم",key:"values",sortable:!1},{title:"الحالة",key:"is_active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],me={required:l=>!!l||"مطلوب"},U=l=>{if(!l.values)return[];if(Array.isArray(l.values))return l.values;try{return JSON.parse(l.values)}catch{return[]}},pe=()=>{c.value.values.push("")},ge=l=>{c.value.values.splice(l,1)},se=()=>{C.value=null,c.value={name:"",values:[""],is_active:1},I.value=!0},ie=l=>{C.value=l;const a=U(l);c.value={name:l.name,values:a.map(e=>typeof e=="string"?e:e.name),is_active:l.is_active??1},I.value=!0},ne=async l=>{B.value=l.id;try{await z.update(l.id,{is_active:l.is_active?0:1}),l.is_active=l.is_active?0:1}finally{B.value=null}},_e=w(()=>{g.value=1,b()},500),ye=()=>{V.value||m.value.length>=L.value||(g.value++,b(!0))},he=l=>{v.value==="list"&&b()},oe=l=>{C.value=l,M.value=!0},re=async()=>{const{valid:l}=await ae.value.validate();if(!l)return;const a=c.value.values.filter(e=>e.trim()!=="");if(a.length===0){alert("يجب إضافة قيمة واحدة على الأقل");return}O.value=!0;try{const e={...c.value,values:a};Y.value?await z.update(C.value.id,e,{successMessage:"تم التحديث بنجاح"}):await z.create(e,{successMessage:"تم الإضافة بنجاح"}),I.value=!1,b()}finally{O.value=!1}},xe=async()=>{q.value=!0;try{await D(C.value.id),M.value=!1,b()}finally{q.value=!1}},b=(l={})=>{const a=l===!0;ee({page:g.value,per_page:u.value,search:x.value},{append:a})};return ke(b),H(g,()=>{v.value==="list"&&b()}),H(u,()=>{v.value==="list"&&(g.value=1,b())}),H(v,()=>{g.value=1,b()}),(l,a)=>(i(),y("div",Le,[o("div",Me,[a[10]||(a[10]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold ml-2"},"خصائص المنتجات"),o("p",{class:"text-body-1 text-grey"},"إدارة وتحليل خصائص ومواصفات المنتجات")],-1)),le.value?(i(),r(k,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:se},{default:s(()=>a[9]||(a[9]=[_(" خاصية جديدة ")])),_:1})):A("",!0)]),t(ce,{class:"mb-6"},{default:s(()=>[o("div",Be,[t(X,{modelValue:x.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>x.value=e),f(_e)],label:"بحث عن خاصية...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t(K),t(Ve,{variant:"outlined",density:"comfortable",color:"primary"},{default:s(()=>[t(k,{active:v.value==="grid",icon:"ri-grid-fill",onClick:a[1]||(a[1]=e=>v.value="grid"),title:"عرض شبكي"},null,8,["active"]),t(k,{active:v.value==="list",icon:"ri-list-check",onClick:a[2]||(a[2]=e=>v.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),f(V)&&!f(m).length?(i(),r(De,{key:0,size:"64",text:"جاري تحميل الخصائص..."})):f(m).length?(i(),y(P,{key:2},[v.value==="grid"?(i(),r(Ie,{key:0,loading:f(V)&&f(m).length>0,"has-more":f(m).length<f(L),"no-more-text":"لا يوجد المزيد من الخصائص",onLoad:ye},{default:s(()=>[t(Q,null,{default:s(()=>[(i(!0),y(P,null,j(f(m),e=>(i(),r(E,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[t(ce,{class:"attribute-card h-100","no-padding":""},{actions:s(()=>[t(K),t(k,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:n=>ie(e)},null,8,["onClick"]),te(e)?(i(),r(k,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:n=>oe(e)},null,8,["onClick"])):A("",!0)]),default:s(()=>[o("div",Re,[t(ue,{size:"100",rounded:"circle",color:e.is_active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white"},{default:s(()=>[t(W,{icon:"ri-list-settings-line",size:"60",color:e.is_active?"primary":"grey"},null,8,["color"])]),_:2},1032,["color"])]),t(Ue,{class:"position-relative pt-4 text-center"},{default:s(()=>[t(Se,{class:"text-h6 font-weight-bold pa-0 mb-2"},{default:s(()=>[_(h(e.name),1)]),_:2},1024),o("div",Ne,[t($,{color:e.is_active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:s(()=>[_(h(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"]),R(e)?(i(),r(Z,{key:0,"model-value":!!e.is_active,loading:B.value===e.id,class:"ms-3","onUpdate:modelValue":n=>ne(e)},null,8,["model-value","loading","onUpdate:modelValue"])):A("",!0)]),o("div",je,[(i(!0),y(P,null,j(U(e).slice(0,5),(n,S)=>(i(),r($,{key:S,size:"x-small",variant:"tonal",color:"info"},{default:s(()=>[_(h(n.name||n),1)]),_:2},1024))),128)),U(e).length>5?(i(),r($,{key:0,size:"x-small",variant:"tonal"},{default:s(()=>[_(" +"+h(U(e).length-5),1)]),_:2},1024)):A("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(i(),r(Ee,{key:1,headers:fe,items:f(m),"total-items":f(L),loading:f(V),page:g.value,"onUpdate:page":a[3]||(a[3]=e=>g.value=e),"items-per-page":u.value,"onUpdate:itemsPerPage":a[4]||(a[4]=e=>u.value=e),searchable:!1,"can-view":!1,"can-edit":!1,"can-delete":!1,"onUpdate:options":he},{"item.name":s(({item:e})=>[o("div",Fe,[t(ue,{size:"48",rounded:"circle",color:e.is_active?"bg-white":"grey-lighten-4",class:"me-3 border"},{default:s(()=>[t(W,{icon:"ri-list-settings-line",size:"24",color:e.is_active?"primary":"grey"},null,8,["color"])]),_:2},1032,["color"]),o("div",Oe,[o("span",qe,h(e.name),1),o("span",Je,"كود: "+h(e.id),1)])])]),"item.values":s(({item:e})=>[o("div",Ge,[(i(!0),y(P,null,j(U(e),(n,S)=>(i(),r($,{key:S,size:"x-small",variant:"tonal",color:"info"},{default:s(()=>[_(h(n.name||n),1)]),_:2},1024))),128)),U(e).length?A("",!0):(i(),y("span",Ye,"-"))])]),"item.is_active":s(({item:e})=>[o("div",He,[R(e)?(i(),y("span",{key:0,class:Ae(["text-caption me-2 font-weight-bold",e.is_active?"text-success":"text-error"])},h(e.is_active?"نشط":"معطل"),3)):A("",!0),R(e)?(i(),r(Z,{key:1,"model-value":!!e.is_active,loading:B.value===e.id,"onUpdate:modelValue":n=>ne(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(i(),r($,{key:2,color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:s(()=>[_(h(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":s(({item:e})=>[R(e)?(i(),r(k,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",size:"small",onClick:n=>ie(e)},null,8,["onClick"])):A("",!0),te(e)?(i(),r(k,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:n=>oe(e)},null,8,["onClick"])):A("",!0)]),_:2},1032,["items","total-items","loading","page","items-per-page"]))],64)):(i(),r(ze,{key:1,icon:"ri-paint-brush-line",title:"لا توجد خصائص حالياً",message:"ابدأ بإضافة أول خاصية لنظامك (مثل: اللون، المقاس)","show-action":le.value,"action-text":"إضافة خاصية",onAction:se},null,8,["show-action"])),t(de,{modelValue:I.value,"onUpdate:modelValue":a[7]||(a[7]=e=>I.value=e),title:Y.value?"تعديل الخاصية":"خاصية جديدة",icon:Y.value?"ri-edit-line":"ri-add-line",loading:O.value,"max-width":"700",onConfirm:re},{default:s(()=>[t(we,{ref_key:"formRef",ref:ae,onSubmit:Ce(re,["prevent"])},{default:s(()=>[t(Q,null,{default:s(()=>[t(E,{cols:"12"},{default:s(()=>[t(X,{modelValue:c.value.name,"onUpdate:modelValue":a[5]||(a[5]=e=>c.value.name=e),label:"اسم الخاصية *",placeholder:"مثال: اللون، المقاس",rules:[me.required]},null,8,["modelValue","rules"])]),_:1}),t(E,{cols:"12"},{default:s(()=>[t(Te,{class:"mb-2"}),o("div",Ke,[a[12]||(a[12]=o("span",{class:"text-subtitle-2"},"القيم المتاحة",-1)),t(K),t(k,{size:"small",color:"primary",variant:"tonal","prepend-icon":"ri-add-line",onClick:pe},{default:s(()=>a[11]||(a[11]=[_(" إضافة قيمة ")])),_:1})]),c.value.values.length?(i(),y("div",Qe,[(i(!0),y(P,null,j(c.value.values,(e,n)=>(i(),r(Q,{key:n,dense:""},{default:s(()=>[t(E,{cols:"10"},{default:s(()=>[t(X,{modelValue:c.value.values[n],"onUpdate:modelValue":S=>c.value.values[n]=S,label:`القيمة ${n+1}`,placeholder:"مثال: أحمر، أزرق","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),t(E,{cols:"2",class:"d-flex align-center mt-2"},{default:s(()=>[t(k,{icon:"ri-delete-bin-line",size:"small",variant:"text",color:"error",onClick:S=>ge(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))])):(i(),y("div",We,[t(W,{icon:"ri-information-line",class:"me-1"}),a[13]||(a[13]=_(" لم يتم إضافة قيم بعد "))]))]),_:1}),t(E,{cols:"12"},{default:s(()=>[t(Z,{modelValue:c.value.is_active,"onUpdate:modelValue":a[6]||(a[6]=e=>c.value.is_active=e),label:"نشط","true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),t(de,{modelValue:M.value,"onUpdate:modelValue":a[8]||(a[8]=e=>M.value=e),title:"تأكيد الحذف",icon:"ri-delete-bin-line","confirm-color":"error","confirm-text":"حذف",loading:q.value,onConfirm:xe},{default:s(()=>{var e;return[a[14]||(a[14]=_(' هل أنت متأكد من حذف الخاصية "')),o("strong",null,h((e=C.value)==null?void 0:e.name),1),a[15]||(a[15]=_('"؟ '))]}),_:1},8,["modelValue","loading"])]))}},ca=Pe(Xe,[["__scopeId","data-v-59132f81"]]);export{ca as default};
