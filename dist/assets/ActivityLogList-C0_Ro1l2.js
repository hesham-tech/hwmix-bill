import{A as G}from"./AppAvatar-BhNzqKmA.js";import{u as R}from"./useApi-Dl4iYKvS.js";import{A as H}from"./AppDataTable-anW7O1Lb.js";import{a as K,r as c,K as Q,L as W,c as d,b as a,d as i,w as n,as as q,o as r,v as l,i as p,n as f,A as X,E as b,N as Y,M as Z,x as T,h as ee,a6 as te,H as V,a3 as se,Q as ae,a4 as ie,a5 as ne,O as le,ag as re,F as I,j as B,aN as oe,R as de,ar as ce,P as ue}from"./index-Flp88uEA.js";/* empty css                                                                  */import"./usePermissions-BSwY7w5L.js";const pe={class:"activity-log-page"},ge={key:0,class:"d-flex align-center"},fe={class:"font-weight-medium text-body-2"},me={key:1,class:"d-flex align-center text-grey"},ye={class:"text-body-2"},ve={class:"d-flex flex-column"},xe={class:"text-body-2 text-primary font-weight-bold"},_e={key:0,class:"text-caption text-grey-darken-1"},be={class:"d-flex align-center text-body-2 text-grey-darken-1"},he={class:"d-flex align-center text-body-2 text-grey-darken-1 overflow-hidden",style:{"max-width":"150px","text-overflow":"ellipsis","white-space":"nowrap"}},we={class:"d-flex flex-column text-no-wrap"},ke={class:"text-body-2"},Ve={class:"text-caption text-grey"},Ce={class:"d-flex align-center"},Le={key:0,class:"pa-4"},Se={class:"font-weight-medium"},Ae={class:"text-error text-decoration-line-through"},Ee={class:"text-success"},Pe={key:1,class:"pa-4"},Te={class:"font-weight-bold me-2",style:{"min-width":"120px"}},Ie={__name:"ActivityLogList",setup(Be){const D=R("/api/activity-logs"),C=c([]),h=c(!1),L=c(0),m=c(1),x=c(15),_=c(""),y=c(!1),u=c(null),z=[{title:"المستخدم",key:"user"},{title:"الحدث",key:"action"},{title:"النوع",key:"subject_type"},{title:"الوصف",key:"description"},{title:"الـ IP",key:"ip_address"},{title:"المتصفح",key:"user_agent"},{title:"التاريخ",key:"created_at"}],N=e=>({created:"success",updated:"info",deleted:"error",restored:"success",login:"primary",logout:"grey",إضافة:"success",انشاء:"success",تعديل:"info",حذف:"error",دخول:"primary",خروج:"grey",تفعيل:"success",تعطيل:"warning",toggled:"warning"})[e]||"grey",j=e=>({created:"ri-add-circle-line",updated:"ri-edit-circle-line",deleted:"ri-delete-bin-line",restored:"ri-refresh-line",login:"ri-login-circle-line",logout:"ri-logout-circle-line",إضافة:"ri-add-circle-line",انشاء:"ri-add-box-line",تعديل:"ri-edit-2-line",حذف:"ri-delete-bin-7-line",دخول:"ri-login-box-line",خروج:"ri-logout-box-line",تفعيل:"ri-checkbox-circle-line",تعطيل:"ri-close-circle-line",toggled:"ri-switch-line"})[e]||"ri-information-line",U=e=>({created:"إضافة",updated:"تعديل",deleted:"حذف",login:"دخول",logout:"خروج",restored:"استرجاع",toggled:"تبديل"})[e]||e,F=e=>{if(!e)return"-";const s=e.split("\\"),g=s[s.length-1];return{Product:"منتج",Category:"فئة",Brand:"ماركة",User:"مستخدم",Invoice:"فاتورة",Payment:"عملية دفع",Company:"شركة",CashBox:"خزينة",Stock:"مخزون",PaymentMethod:"طريقة دفع",Transaction:"عملية مالية",Attribute:"سمة منتج",AttributeValue:"قيمة سمة",Expense:"مصروف",ExpenseCategory:"تصنيف مصروفات",Client:"عميل",Supplier:"مورد",Installment:"قسط",Warehouse:"مخزن",CashBoxType:"نوع خزينة",InvoiceType:"نوع فاتورة",Role:"دور",Permission:"صلاحية"}[g]||g},O=e=>e?e.includes("Chrome")?"ri-chrome-line":e.includes("Firefox")?"ri-firefox-line":e.includes("Safari")&&!e.includes("Chrome")?"ri-safari-line":e.includes("Edge")?"ri-edge-line":"ri-global-line":"ri-global-line",$=e=>e?e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edge")?"Edge":"متصفح":"غير معروف",S=e=>{if(!e)return{date:"-",time:""};const s=new Date(e);return{date:s.toLocaleDateString("ar-EG"),time:s.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}},J=e=>{m.value=e.page,x.value=e.itemsPerPage,w()};Q(_,()=>{m.value=1,w()});const w=async()=>{h.value=!0;try{const e=await D.get({page:m.value,per_page:x.value,search:_.value},{showLoading:!1});C.value=e.data||[],L.value=e.total||0}catch(e){console.error("Error loading activity logs:",e)}finally{h.value=!1}},A=e=>{u.value=e,y.value=!0},E=e=>(e==null?void 0:e.action)==="updated"&&(e==null?void 0:e.old_values)&&(e==null?void 0:e.new_values),M=e=>{if(!E(e))return[];const s=[],g={name:"الاسم",price:"السعر",status:"الحالة",active:"نشط",description:"الوصف",email:"البريد الإلكتروني",phone:"رقم الهاتف",balance:"الرصيد",amount:"المبلغ",social_links:"روابط التواصل"};for(const t in e.new_values){const o=e.old_values[t],v=e.new_values[t];JSON.stringify(o)!==JSON.stringify(v)&&s.push({field:t,field_label:g[t]||t,old:k(o),new:k(v)})}return s},k=e=>e==null?"-":typeof e=="boolean"?e?"نعم":"لا":typeof e=="object"?JSON.stringify(e):e;return W(w),(e,s)=>{const g=G;return r(),d("div",pe,[s[13]||(s[13]=a("div",{class:"page-header mb-6"},[a("h1",{class:"text-h4 font-weight-bold"},"سجل النشاطات"),a("p",{class:"text-body-1 text-grey"},"تتبع التغييرات والعمليات المنفذة في النظام")],-1)),i(H,{title:"سجل النشاطات",icon:"ri-history-line",headers:z,items:C.value,"total-items":L.value,loading:h.value,page:m.value,"onUpdate:page":s[0]||(s[0]=t=>m.value=t),"items-per-page":x.value,"onUpdate:itemsPerPage":s[1]||(s[1]=t=>x.value=t),search:_.value,"onUpdate:search":s[2]||(s[2]=t=>_.value=t),searchable:!0,"show-actions":!1,"empty-subtext":"لا توجد نشاطات",class:"text-no-wrap clickable-rows","onUpdate:options":J,"onClick:row":A},{"item.user":n(({item:t})=>{var o,v,P;return[t.user?(r(),d("div",ge,[i(g,{"img-url":(o=t.user)==null?void 0:o.avatar_url,name:((v=t.user)==null?void 0:v.nickname)||((P=t.user)==null?void 0:P.name),type:"user",size:"28",class:"me-2 border"},null,8,["img-url","name"]),a("span",fe,l(t.user.nickname||t.user.name),1)])):(r(),d("div",me,[i(p,{icon:"ri-robot-line",size:"small",class:"me-2"}),s[6]||(s[6]=a("span",null,"النظام",-1))]))]}),"item.action":n(({item:t})=>[a("div",{class:X([`text-${N(t.action)}`,"font-weight-bold d-flex align-center"])},[i(p,{icon:j(t.action),size:"16",class:"me-1"},null,8,["icon"]),f(" "+l(U(t.action)),1)],2)]),"item.description":n(({item:t})=>[a("div",ye,l(t.description),1)]),"item.subject_type":n(({item:t})=>[a("div",ve,[a("span",xe,l(F(t.subject_type)),1),t.company?(r(),d("span",_e,[i(p,{icon:"ri-building-line",size:"10",class:"me-1"}),f(" "+l(t.company.name),1)])):b("",!0)])]),"item.ip_address":n(({item:t})=>[a("div",be,[i(p,{icon:"ri-map-pin-user-line",size:"small",color:"grey",class:"me-1"}),f(" "+l(t.ip_address||"-"),1)])]),"item.user_agent":n(({item:t})=>[a("div",he,[i(Y,{text:t.user_agent,location:"top"},{activator:n(({props:o})=>[a("div",Z(o,{class:"d-flex align-center"}),[i(p,{icon:O(t.user_agent),size:"small",class:"me-1"},null,8,["icon"]),a("span",null,l($(t.user_agent)),1)],16)]),_:2},1032,["text"])])]),"item.created_at":n(({item:t})=>[a("div",we,[a("span",ke,l(S(t.created_at).date),1),a("span",Ve,l(S(t.created_at).time),1)])]),"item.actions":n(({item:t})=>[t.old_values||t.new_values?(r(),T(V,{key:0,icon:"ri-information-line",variant:"text",color:"primary",size:"small",onClick:o=>A(t)},null,8,["onClick"])):b("",!0)]),_:1},8,["items","total-items","loading","page","items-per-page","search"]),i(q,{modelValue:y.value,"onUpdate:modelValue":s[5]||(s[5]=t=>y.value=t),"max-width":"800px",scrollable:""},{default:n(()=>[i(ee,null,{default:n(()=>[i(te,{class:"d-flex justify-space-between align-center border-bottom pa-4"},{default:n(()=>[a("div",Ce,[i(p,{icon:"ri-history-line",class:"me-2 text-primary"}),s[7]||(s[7]=a("span",null,"تفاصيل التغييرات",-1))]),i(V,{icon:"ri-close-line",variant:"text",size:"small",onClick:s[3]||(s[3]=t=>y.value=!1)})]),_:1}),i(se,{class:"pa-0"},{default:n(()=>[u.value?(r(),T(de,{key:0,lines:"two"},{default:n(()=>[i(ae,null,{prepend:n(()=>[i(p,{icon:"ri-sticky-note-line"})]),default:n(()=>[i(ie,{class:"font-weight-bold"},{default:n(()=>s[8]||(s[8]=[f("الوصف")])),_:1}),i(ne,null,{default:n(()=>[f(l(u.value.description),1)]),_:1})]),_:1}),i(le),E(u.value)?(r(),d("div",Le,[s[10]||(s[10]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"الحقول المعدلة",-1)),i(re,{density:"compact",class:"border rounded"},{default:n(()=>[s[9]||(s[9]=a("thead",{class:"bg-grey-lighten-4"},[a("tr",null,[a("th",{class:"text-right"},"الحقل"),a("th",{class:"text-right"},"القيمة السابقة"),a("th",{class:"text-right"},"القيمة الجديدة")])],-1)),a("tbody",null,[(r(!0),d(I,null,B(M(u.value),t=>(r(),d("tr",{key:t.field},[a("td",Se,l(t.field_label||t.field),1),a("td",Ae,l(t.old),1),a("td",Ee,l(t.new),1)]))),128))])]),_:1})])):u.value.action==="created"?(r(),d("div",Pe,[s[11]||(s[11]=a("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"البيانات المضافة",-1)),i(oe,{border:"",rounded:"",class:"pa-3 bg-grey-lighten-4"},{default:n(()=>[(r(!0),d(I,null,B(u.value.new_values,(t,o)=>(r(),d("div",{key:o,class:"mb-1 d-flex"},[a("span",Te,l(o)+":",1),a("span",null,l(k(t)),1)]))),128))]),_:1})])):b("",!0)]),_:1})):b("",!0)]),_:1}),i(ce,{class:"pa-4 border-top"},{default:n(()=>[i(ue),i(V,{color:"grey-darken-1",variant:"text",onClick:s[4]||(s[4]=t=>y.value=!1)},{default:n(()=>s[12]||(s[12]=[f("إغلاق")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Oe=K(Ie,[["__scopeId","data-v-5e03e40d"]]);export{Oe as default};
