import{u as W}from"./useApi-CTBDEoea.js";import{r as m,x as ne,y as z,K as ie,J as F,o as i,v as c,w as l,b as t,h as K,d as re,e as j,a as n,A as de,B as ge,f as ae,D as V,k as ye,j as he,aO as B,I as _e,c as q,u as y,F as te,m as D,O as le,ax as xe,i as be,t as U,C as G,z as Ve,ah as ke,ay as Me,a5 as we,az as Ae}from"./index-DPR0tjT6.js";import{A as ue}from"./AppDialog-CVbZwWX_.js";import{_ as Q}from"./AppInput-CYR4AaBJ.js";import{M as Pe}from"./MediaGallery-BP1iZpos.js";import{A as R}from"./AppSwitch-D-YUIM8I.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as se}from"./AppCard-DxtAeMMp.js";import{_ as L}from"./AppButton-DiF3_7lr.js";import{A as Se}from"./AppDataTable-CV9gFKLg.js";import{_ as Ce}from"./LoadingSpinner-BZRbwFnn.js";import{_ as De}from"./EmptyState-Cza6ENNq.js";import{A as Ue}from"./AppInfiniteScroll-DU-_Srv_.js";import{A as oe}from"./AppAvatar-BthR-4vQ.js";import"./usePermissions-BOh6stgy.js";/* empty css                                                                  */function Te(){const T=W("/api/payment-methods"),A=m([]),p=m(!1),h=m(0);return{paymentMethods:A,loading:p,total:h,fetchPaymentMethods:async(g={},k={})=>{var P;const{append:M=!1}=k;p.value=!0;try{const v=await T.get(g,{showLoading:!1});let f=[],_=0;return v.data&&Array.isArray(v.data.data)?(f=v.data.data,_=((P=v.data.meta)==null?void 0:P.total)||v.data.data.length):(f=v.data||[],_=v.total||f.length),M?A.value=[...A.value,...f]:A.value=f,h.value=_,v}catch(v){throw A.value=[],h.value=0,v}finally{p.value=!1}},deletePaymentMethod:async g=>await T.remove(g,{successMessage:"تم حذف طريقة الدفع بنجاح"}),togglePaymentMethodStatus:async g=>await T.update(`${g}/toggle`,{},{successMessage:"تم تغيير حالة طريقة الدفع بنجاح"})}}const Ee={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},$e={class:"d-flex align-center justify-space-between"},ze={class:"d-flex align-center justify-space-between"},Ie={__name:"PaymentMethodForm",props:{modelValue:{type:Boolean,required:!0},paymentMethod:{type:Object,default:null}},emits:["update:modelValue","saved"],setup(T,{emit:A}){const p=ne(),h=z(()=>p.isAdmin),I=z(()=>p.isCompanyAdmin);ie(()=>{});const H=z(()=>{var a;return h.value?!0:(a=E.paymentMethod)!=null&&a.is_system?!1:I.value||p.hasPermission(B.PAYMENT_METHODS_UPDATE_ALL)}),E=T,g=A,k=W("/api/payment-methods"),M=m(null),P=m(!1),v=m(!1),f=m(null),_=m({}),r=m({name:"",code:"",active:!0,is_system:!1,image_id:null}),C=z(()=>{var a;return!!((a=E.paymentMethod)!=null&&a.id)}),Y={required:a=>!!a||"هذا الحقل مطلوب"},x=a=>{r.value.image_id=a.id,f.value=a.url},$=()=>{var a;r.value={name:"",code:"",active:!0,is_system:!1,image_id:null},f.value=null,_.value={},(a=M.value)==null||a.resetValidation()};F(()=>E.paymentMethod,a=>{a?(r.value={name:a.name||"",code:a.code||"",active:!!(a.active??!0),is_system:!!a.is_system,image_id:a.image_id||null},console.log("Payment Method Loaded:",a.name,"is_system:",a.is_system,"cast:",r.value.is_system),f.value=a.image_url||null):$()},{immediate:!0});const N=async()=>{var o,d;if(!M.value)return;const{valid:a}=await M.value.validate();if(a){P.value=!0,_.value={};try{C.value?await k.update(E.paymentMethod.id,r.value,{successMessage:"تم تحديث طريقة الدفع بنجاح"}):await k.create(r.value,{successMessage:"تم إضافة طريقة الدفع بنجاح"}),g("saved"),g("update:modelValue",!1),$()}catch(b){(d=(o=b.response)==null?void 0:o.data)!=null&&d.errors&&(_.value=b.response.data.errors)}finally{P.value=!1}}};return(a,o)=>(i(),c(ue,{"model-value":T.modelValue,title:C.value?"تعديل طريقة الدفع":"طريقة دفع جديدة",icon:C.value?"ri-edit-line":"ri-bank-card-line",loading:P.value,"max-width":"600","onUpdate:modelValue":o[6]||(o[6]=d=>a.$emit("update:modelValue",d)),onConfirm:N},{"prepend-title":l(()=>[t(K,{icon:C.value?"ri-edit-line":"ri-bank-card-line",class:"me-2"},null,8,["icon"])]),default:l(()=>[t(he,{ref_key:"formRef",ref:M,onSubmit:ye(N,["prevent"])},{default:l(()=>[t(re,null,{default:l(()=>[t(j,{cols:"12",class:"d-flex justify-center mb-4"},{default:l(()=>[n("div",{class:"logo-preview-zone position-relative cursor-pointer",onClick:o[0]||(o[0]=d=>v.value=!0)},[t(de,{size:"120",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:l(()=>[f.value?(i(),c(ge,{key:0,src:f.value,cover:""},null,8,["src"])):(i(),c(K,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),n("div",Ee,[t(K,{icon:"ri-exchange-line",color:"white",size:"24"}),o[7]||(o[7]=n("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الشعار",-1))])]),_:1})])]),_:1}),t(j,{cols:"12"},{default:l(()=>[t(Q,{modelValue:r.value.name,"onUpdate:modelValue":o[1]||(o[1]=d=>r.value.name=d),label:"اسم طريقة الدفع *","prepend-inner-icon":"ri-bank-card-line",rules:[Y.required],"error-messages":_.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),t(j,{cols:"12"},{default:l(()=>[t(Q,{modelValue:r.value.code,"onUpdate:modelValue":o[2]||(o[2]=d=>r.value.code=d),label:"الكود *","prepend-inner-icon":"ri-key-line",rules:[Y.required],"error-messages":_.value.code,disabled:C.value,hint:"كود فريد للتعريف بالنظام (مثل: CASH, BANK)","persistent-hint":""},null,8,["modelValue","rules","error-messages","disabled"])]),_:1}),H.value?(i(),c(j,{key:0,cols:"12"},{default:l(()=>[t(ae,{variant:"tonal",color:r.value.active?"primary":"grey",class:"pa-4 rounded-lg mt-4"},{default:l(()=>[n("div",$e,[o[8]||(o[8]=n("div",null,[n("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),n("div",{class:"text-caption"},"تفعيل أو تعطيل هذه الطريقة في شاشات الدفع")],-1)),t(R,{modelValue:r.value.active,"onUpdate:modelValue":o[3]||(o[3]=d=>r.value.active=d),label:"نشط","hide-details":""},null,8,["modelValue"])])]),_:1},8,["color"])]),_:1})):V("",!0),h.value?(i(),c(j,{key:1,cols:"12"},{default:l(()=>[t(ae,{variant:"tonal",color:r.value.is_system?"info":"grey",class:"pa-4 rounded-lg"},{default:l(()=>[n("div",ze,[o[9]||(o[9]=n("div",null,[n("div",{class:"text-subtitle-1 font-weight-bold"},"طريقة أساسية (System)"),n("div",{class:"text-caption"},"إذا تم تفعيلها، ستظهر لجميع الشركات كنظام افتراضي")],-1)),t(R,{modelValue:r.value.is_system,"onUpdate:modelValue":o[4]||(o[4]=d=>r.value.is_system=d),color:"info","hide-details":""},null,8,["modelValue"])])]),_:1},8,["color"])]),_:1})):V("",!0)]),_:1})]),_:1},512),t(Pe,{modelValue:v.value,"onUpdate:modelValue":o[5]||(o[5]=d=>v.value=d),type:"logo",onSelect:x},null,8,["modelValue"])]),_:1},8,["model-value","title","icon","loading"]))}},Ne=ce(Ie,[["__scopeId","data-v-9f700043"]]),Le={class:"payment-methods-page"},je={class:"page-header d-flex align-center justify-space-between mb-6"},Be={class:"d-flex align-center flex-wrap gap-4"},Oe={class:"method-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Fe={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},Re={class:"d-flex align-center"},He={class:"d-flex align-center py-2"},Ye={class:"d-flex flex-column"},qe={class:"font-weight-bold"},Ge={class:"d-flex align-center justify-center"},Ke={class:"text-center pa-4"},Je={class:"text-body-1 text-grey-darken-1"},Qe={__name:"PaymentMethodList",setup(T){const A=(u,s)=>{let e;return(...S)=>{e&&clearTimeout(e),e=setTimeout(()=>u(...S),s)}},{paymentMethods:p,loading:h,total:I,fetchPaymentMethods:H,deletePaymentMethod:E}=Te();_e();const g=ne(),k=z(()=>g.hasPermission(B.ADMIN_SUPER)),M=z(()=>g.hasPermission(B.ADMIN_COMPANY)),P=z(()=>k.value||M.value||g.hasPermission(B.PAYMENT_METHODS_CREATE)),v=u=>k.value?!0:u.is_system?!1:M.value||g.hasPermission(B.PAYMENT_METHODS_DELETE),f=u=>k.value?!0:u.is_system?!1:M.value||g.hasPermission(B.PAYMENT_METHODS_UPDATE_ALL),_=W("/api/payment-methods"),r=m(null),C=async u=>{r.value=u.id;try{await _.update(u.id,{active:!u.active}),u.active=!u.active}finally{r.value=null}},Y=()=>{h.value||p.value.length>=I.value||(x.value++,w(!0))},x=m(1),$=m(12),N=m(""),a=m("grid"),o=m(!1),d=m(!1),b=m(null),J=m(!1),O=m(!1),me=[{title:"طريقة الدفع",key:"name",sortable:!0},{title:"الكود",key:"code",sortable:!0},{title:"الحالة",key:"active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],ve=A(()=>{x.value=1,w()},500),X=()=>{b.value=null,o.value=!0},Z=u=>{b.value=u,o.value=!0},ee=u=>{b.value=u,d.value=!0},pe=async()=>{J.value=!0;try{await E(b.value.id),d.value=!1,w()}finally{J.value=!1}},fe=u=>{a.value==="list"&&w()},w=(u={})=>{const s=u===!0,e={page:x.value,per_page:$.value,search:N.value};k.value&&(e.is_system=O.value?1:0),H(e,{append:s})};return ie(w),F(x,(u,s)=>{a.value==="list"&&w()}),F($,()=>{a.value==="list"&&(x.value=1,w())}),F(a,()=>{x.value=1,w()}),F(O,()=>{x.value=1,w()}),(u,s)=>(i(),q("div",Le,[n("div",je,[s[9]||(s[9]=n("div",null,[n("h1",{class:"text-h4 font-weight-bold ml-2"},"طرق الدفع"),n("p",{class:"text-body-1 text-grey"},"إدارة طرق الدفع المتاحة في النظام")],-1)),P.value?(i(),c(L,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:X},{default:l(()=>s[8]||(s[8]=[D(" طريقة جديدة ")])),_:1})):V("",!0)]),t(se,{class:"mb-6"},{default:l(()=>[n("div",Be,[t(Q,{modelValue:N.value,"onUpdate:modelValue":[s[0]||(s[0]=e=>N.value=e),y(ve)],label:"بحث عن طريقة دفع...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t(le),k.value?(i(),c(R,{key:0,modelValue:O.value,"onUpdate:modelValue":s[1]||(s[1]=e=>O.value=e),label:O.value?"مشاهدة الأنواع الأساسية (System)":"مشاهدة الأنواع المخصصة (Custom)","hide-details":""},null,8,["modelValue","label"])):V("",!0),t(xe,{variant:"outlined",density:"comfortable",color:"primary"},{default:l(()=>[t(L,{active:a.value==="grid",icon:"ri-grid-fill",onClick:s[2]||(s[2]=e=>a.value="grid"),title:"عرض شبكي"},null,8,["active"]),t(L,{active:a.value==="list",icon:"ri-list-check",onClick:s[3]||(s[3]=e=>a.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),y(h)&&!y(p).length?(i(),c(Ce,{key:0,size:"64",text:"جاري تحميل طرق الدفع..."})):y(p).length?(i(),q(te,{key:2},[a.value==="grid"?(i(),c(Ue,{key:0,loading:y(h)&&y(p).length>0,"has-more":y(p).length<y(I),"no-more-text":"لا يوجد المزيد من طرق الدفع",onLoad:Y},{default:l(()=>[t(re,null,{default:l(()=>[(i(!0),q(te,null,be(y(p),e=>(i(),c(j,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[t(se,{class:"method-card h-100","no-padding":""},{actions:l(()=>[t(le),t(L,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:S=>Z(e)},null,8,["onClick"]),v(e)?(i(),c(L,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:S=>ee(e)},null,8,["onClick"])):V("",!0)]),default:l(()=>[n("div",Oe,[t(oe,{"img-url":e.image_url,name:e.name,type:"payment",size:"120","custom-class":e.active?"bg-white":"grey-lighten-3",class:"elevation-1"},null,8,["img-url","name","custom-class"])]),t(Me,{class:"position-relative pt-4"},{default:l(()=>[t(we,{class:"text-h6 font-weight-bold pa-0 mb-1"},{default:l(()=>[D(U(e.name),1)]),_:2},1024),n("div",Fe,[n("div",Re,[s[10]||(s[10]=n("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),t(G,{color:e.active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:l(()=>[D(U(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),f(e)?(i(),c(R,{key:0,"model-value":e.active,loading:r.value===e.id,"onUpdate:modelValue":S=>C(e)},null,8,["model-value","loading","onUpdate:modelValue"])):V("",!0)]),t(Ae,{class:"pa-0"},{default:l(()=>[D("كود: "+U(e.code),1)]),_:2},1024),e.is_system?(i(),c(G,{key:0,color:"info",size:"x-small",class:"position-absolute",style:{top:"16px",left:"16px"},variant:"tonal"},{default:l(()=>s[11]||(s[11]=[D(" اساسي ")])),_:1})):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(i(),c(Se,{key:1,headers:me,items:y(p),"total-items":y(I),loading:y(h),page:x.value,"onUpdate:page":s[4]||(s[4]=e=>x.value=e),"items-per-page":$.value,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>$.value=e),searchable:!1,"can-view":!1,"can-delete":!1,"onUpdate:options":fe,onEdit:Z},{"item.name":l(({item:e})=>[n("div",He,[t(oe,{"img-url":e.image_url,name:e.name,type:"payment",size:"48",class:"me-3 border"},null,8,["img-url","name"]),n("div",Ye,[n("span",qe,U(e.name),1),e.is_system?(i(),c(G,{key:0,size:"x-small",color:"info",variant:"tonal",class:"mt-1",style:{width:"fit-content"}},{default:l(()=>s[12]||(s[12]=[D("أساسي")])),_:1})):V("",!0)])])]),"item.active":l(({item:e})=>[n("div",Ge,[f(e)?(i(),q("span",{key:0,class:Ve(["text-caption me-2 font-weight-bold",e.active?"text-success":"text-error"])},U(e.active?"نشط":"معطل"),3)):V("",!0),f(e)?(i(),c(R,{key:1,"model-value":e.active,loading:r.value===e.id,"onUpdate:modelValue":S=>C(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(i(),c(G,{key:2,color:e.active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:l(()=>[D(U(e.active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":l(({item:e})=>[v(e)?(i(),c(L,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:S=>ee(e)},null,8,["onClick"])):V("",!0)]),_:1},8,["items","total-items","loading","page","items-per-page"]))],64)):(i(),c(De,{key:1,icon:"ri-bank-card-line",title:"لا توجد طرق دفع حالياً",message:"ابدأ بإضافة أول طريقة دفع لنظامك","show-action":P.value,"action-text":"إضافة طريقة دفع",onAction:X},null,8,["show-action"])),t(Ne,{modelValue:o.value,"onUpdate:modelValue":s[6]||(s[6]=e=>o.value=e),"payment-method":b.value,onSaved:w},null,8,["modelValue","payment-method"]),t(ue,{modelValue:d.value,"onUpdate:modelValue":s[7]||(s[7]=e=>d.value=e),title:"حذف طريقة الدفع؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:J.value,onConfirm:pe},{default:l(()=>{var e,S;return[n("div",Ke,[t(de,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:l(()=>[t(K,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),n("p",Je,'هل أنت متأكد من حذف "'+U((e=b.value)==null?void 0:e.name)+'"؟',1),((S=b.value)==null?void 0:S.payments_count)>0?(i(),c(ke,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-4 text-right"},{default:l(()=>[D(" هذه الطريقة مرتبطة بـ "+U(b.value.payments_count)+" عملية دفع. لا ينصح بحذفها. ",1)]),_:1})):V("",!0)])]}),_:1},8,["modelValue","loading"])]))}},va=ce(Qe,[["__scopeId","data-v-12cc791b"]]);export{va as default};
