import{u as S}from"./useApi-CjhFmPue.js";import{u as D}from"./usePrintExport-DBoRVp2V.js";import{_ as T}from"./AppCard-CXpBKc1t.js";import{_ as g}from"./AppButton-CREzoRf6.js";import{_ as b}from"./AppInput-06Y7zOXl.js";import{A as $}from"./AppDataTable-CnA5lOqV.js";import{r as f,J as E,c as I,a as l,b as t,w as a,d as x,o as N,e as r,l as h,f as m,a1 as p,t as d,g as R}from"./index-CuR9-sbN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"sales-report-page"},B={class:"px-6 mb-4"},F={class:"text-h4 font-weight-black text-success"},G={class:"text-h4 font-weight-black"},O={class:"text-h4 font-weight-black"},P={class:"text-h4 font-weight-black text-info"},U={class:"px-6 pb-6"},z={class:"font-weight-black text-primary"},J={class:"font-weight-black text-h6 text-success"},L={class:"text-center pa-10"},Z={__name:"SalesReport",setup(M){const y=S("/api/invoices"),{exportToCSV:w}=D(),_=f(!1),i=f({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),c=f({total_sales:0,total_invoices:0,average_invoice:0,profit:0}),s=f([]),k=[{title:"رقم الفاتورة",key:"invoice_number"},{title:"العميل",key:"customer.name"},{title:"التاريخ",key:"invoice_date"},{title:"الإجمالي",key:"total",align:"end"}],u=n=>n?new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(n):"0.00 ج.م",V=()=>{const n=s.value.map(e=>{var o;return{"رقم الفاتورة":e.invoice_number,العميل:((o=e.customer)==null?void 0:o.name)||"-",التاريخ:e.invoice_date,الإجمالي:e.total}});w(n,`تقرير_المبيعات_${i.value.date_from}_إلى_${i.value.date_to}.csv`,["رقم الفاتورة","العميل","التاريخ","الإجمالي"])},v=async()=>{_.value=!0;try{const n=await y.get({...i.value,per_page:100},{showLoading:!1});s.value=n.data||[];const e=s.value.reduce((o,C)=>o+parseFloat(C.total||0),0);c.value={total_sales:e,total_invoices:s.value.length,average_invoice:s.value.length?e/s.value.length:0,profit:e*.3}}finally{_.value=!1}};return E(v),(n,e)=>(N(),I("div",A,[e[10]||(e[10]=l("div",{class:"mb-6 px-6 pt-6"},[l("h1",{class:"text-h4 font-weight-bold"},"تقرير المبيعات التفصيلي"),l("p",{class:"text-body-1 text-grey"},"تحليل أداء المبيعات والإيرادات والأرباح التشغيلية")],-1)),l("div",B,[t(T,{title:"خيارات البحث والفلترة",icon:"ri-filter-3-line"},{default:a(()=>[t(x,{dense:""},{default:a(()=>[t(r,{cols:"12",sm:"4",md:"3"},{default:a(()=>[t(b,{modelValue:i.value.date_from,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.date_from=o),label:"من تاريخ",type:"date","prepend-inner-icon":"ri-calendar-line"},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",sm:"4",md:"3"},{default:a(()=>[t(b,{modelValue:i.value.date_to,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.date_to=o),label:"إلى تاريخ",type:"date","prepend-inner-icon":"ri-calendar-check-line"},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",sm:"4",md:"6",class:"d-flex align-center pt-2"},{default:a(()=>[t(g,{color:"primary",block:"","prepend-icon":"ri-search-line",onClick:v,class:"me-2"},{default:a(()=>e[2]||(e[2]=[h(" عرض التقرير ")])),_:1}),t(g,{variant:"tonal",color:"success","prepend-icon":"ri-file-excel-2-line",onClick:V,disabled:!s.value.length},{default:a(()=>e[3]||(e[3]=[h(" تصدير ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),t(x,{class:"px-6 mx-0 mb-4",dense:""},{default:a(()=>[t(r,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(m,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-success"},{default:a(()=>[t(p,{class:"pa-4 bg-success-lighten-5"},{default:a(()=>[e[4]||(e[4]=l("div",{class:"text-caption font-weight-bold text-success mb-1"},"إجمالي المبيعات",-1)),l("div",F,d(u(c.value.total_sales)),1)]),_:1})]),_:1})]),_:1}),t(r,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(m,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1"},{default:a(()=>[t(p,{class:"pa-4 bg-grey-lighten-5"},{default:a(()=>[e[5]||(e[5]=l("div",{class:"text-caption font-weight-bold text-grey-darken-2 mb-1"},"عدد الفواتير",-1)),l("div",G,d(c.value.total_invoices),1)]),_:1})]),_:1})]),_:1}),t(r,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(m,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1"},{default:a(()=>[t(p,{class:"pa-4 bg-grey-lighten-5"},{default:a(()=>[e[6]||(e[6]=l("div",{class:"text-caption font-weight-bold text-grey-darken-2 mb-1"},"متوسط الفاتورة",-1)),l("div",O,d(u(c.value.average_invoice)),1)]),_:1})]),_:1})]),_:1}),t(r,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(m,{border:"",flat:"",class:"rounded-xl overflow-hidden pa-1 border-info"},{default:a(()=>[t(p,{class:"pa-4 bg-info-lighten-5"},{default:a(()=>[e[7]||(e[7]=l("div",{class:"text-caption font-weight-bold text-info mb-1"},"الربح التقديري",-1)),l("div",P,d(u(c.value.profit)),1)]),_:1})]),_:1})]),_:1})]),_:1}),l("div",U,[t($,{headers:k,items:s.value,loading:_.value,title:"كشف الفواتير التفصيلي",icon:"ri-file-list-3-line"},{"item.invoice_number":a(({item:o})=>[l("div",z,"#"+d(o.invoice_number),1)]),"item.total":a(({item:o})=>[l("div",J,d(u(o.total)),1)]),"no-data":a(()=>[l("div",L,[t(R,{icon:"ri-file-history-line",size:"64",color:"grey-lighten-2",class:"mb-4"}),e[8]||(e[8]=l("div",{class:"text-h6 text-grey font-weight-medium"},"لا توجد بيانات متاحة لهذا النطاق الزمني",-1)),e[9]||(e[9]=l("div",{class:"text-body-2 text-grey"},"جرب اختيار تواريخ مختلفة لعرض النتائج",-1))])]),_:1},8,["items","loading"])])]))}};export{Z as default};
