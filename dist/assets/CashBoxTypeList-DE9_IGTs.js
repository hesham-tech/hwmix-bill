import{u as Z}from"./useApi-CjhFmPue.js";import{r as v,v as ne,x as L,I as R,o as i,s as r,w as a,b as l,g as N,d as re,e as F,a as n,z as Y,A as Q,f as te,C as b,j as fe,i as ge,P as G,J as ye,c as H,u as _,F as se,l as z,N as oe,at as _e,h as xe,t as A,B as X,y as he,ac as be,au as Ve,a7 as ke,av as Ce}from"./index-CuR9-sbN.js";import{A as ue}from"./AppDialog-vLCI3uF9.js";import{_ as W}from"./AppInput-06Y7zOXl.js";import{M as we}from"./MediaGallery-DgiLIKzw.js";import{A as q}from"./AppSwitch-CXzOvU1j.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ie}from"./AppCard-CXpBKc1t.js";import{_ as O}from"./AppButton-CREzoRf6.js";import{A as Te}from"./AppDataTable-CnA5lOqV.js";import{_ as Ae}from"./LoadingSpinner-vBlED74H.js";import{_ as Be}from"./EmptyState-FFeUUxeu.js";import{A as Se}from"./AppInfiniteScroll-616_I-vy.js";function Ue(){const M=Z("/api/cash-box-types"),C=v([]),m=v(!1),x=v(0);return{cashBoxTypes:C,loading:m,total:x,fetchCashBoxTypes:async(B={},w={})=>{var h;const{append:V=!1}=w;m.value=!0;try{const p=await M.get(B,{showLoading:!1});let g=[],f=0;return p.data&&Array.isArray(p.data.data)?(g=p.data.data,f=((h=p.data.meta)==null?void 0:h.total)||p.data.data.length):(g=p.data||[],f=p.total||g.length),V?C.value=[...C.value,...g]:C.value=g,x.value=f,p}catch(p){throw C.value=[],x.value=0,p}finally{m.value=!1}},deleteCashBoxType:async B=>await M.remove(B,{successMessage:"تم حذف نوع الخزينة بنجاح"})}}const ze={class:"change-overlay d-flex flex-column align-center justify-center rounded-xl"},$e={class:"d-flex align-center justify-space-between"},Pe={class:"d-flex align-center justify-space-between"},De={__name:"CashBoxTypeForm",props:{modelValue:{type:Boolean,required:!0},cashBoxType:{type:Object,default:null}},emits:["update:modelValue","saved"],setup(M,{emit:C}){const m=ne(),x=L(()=>m.isAdmin),j=L(()=>m.isCompanyAdmin),$=M,B=C,w=L(()=>{var o;return x.value?!0:(o=$.cashBoxType)!=null&&o.is_system?!1:j.value||m.hasPermission(G.CASH_BOX_TYPES_UPDATE_ALL)}),V=Z("/api/cash-box-types"),h=v(null),p=v(!1),g=v(!1),f=v(null),P=v({}),u=v({name:"",description:"",is_active:!0,is_system:!1,image_id:null}),D=L(()=>{var o;return!!((o=$.cashBoxType)!=null&&o.id)}),S={required:o=>!!o||"هذا الحقل مطلوب"},J=o=>{u.value.image_id=o.id,f.value=o.url},y=()=>{var o;u.value={name:"",description:"",is_active:!0,is_system:!1,image_id:null},f.value=null,P.value={},(o=h.value)==null||o.resetValidation()};R(()=>$.cashBoxType,o=>{o?(u.value={name:o.name||"",description:o.description||"",is_active:!!(o.is_active??!0),is_system:!!o.is_system,image_id:o.image_id||null},f.value=o.image_url||null):y()},{immediate:!0});const E=async()=>{var t,d;if(!h.value)return;const{valid:o}=await h.value.validate();if(o){p.value=!0,P.value={};try{D.value?await V.update($.cashBoxType.id,u.value,{successMessage:"تم تحديث نوع الخزينة بنجاح"}):await V.create(u.value,{successMessage:"تم إضافة نوع الخزينة بنجاح"}),B("saved"),B("update:modelValue",!1),y()}catch(I){(d=(t=I.response)==null?void 0:t.data)!=null&&d.errors&&(P.value=I.response.data.errors)}finally{p.value=!1}}};return(o,t)=>(i(),r(ue,{"model-value":M.modelValue,title:D.value?"تعديل نوع الخزينة":"نوع خزينة جديد",icon:D.value?"ri-edit-line":"ri-inbox-archive-line",loading:p.value,"max-width":"600","onUpdate:modelValue":t[6]||(t[6]=d=>o.$emit("update:modelValue",d)),onConfirm:E},{"prepend-title":a(()=>[l(N,{icon:D.value?"ri-edit-line":"ri-inbox-archive-line",class:"me-2"},null,8,["icon"])]),default:a(()=>[l(ge,{ref_key:"formRef",ref:h,onSubmit:fe(E,["prevent"])},{default:a(()=>[l(re,null,{default:a(()=>[l(F,{cols:"12",class:"d-flex justify-center mb-4"},{default:a(()=>[n("div",{class:"logo-preview-zone position-relative cursor-pointer",onClick:t[0]||(t[0]=d=>g.value=!0)},[l(Y,{size:"120",rounded:"xl",color:"grey-lighten-4",class:"border-2 border-dashed elevation-1 hover-scale overflow-hidden"},{default:a(()=>[f.value?(i(),r(Q,{key:0,src:f.value,cover:""},null,8,["src"])):(i(),r(N,{key:1,icon:"ri-image-add-line",size:"40",color:"grey-lighten-1"})),n("div",ze,[l(N,{icon:"ri-exchange-line",color:"white",size:"24"}),t[7]||(t[7]=n("span",{class:"text-white text-caption mt-1 font-weight-bold"},"تغيير الشعار",-1))])]),_:1})])]),_:1}),l(F,{cols:"12"},{default:a(()=>[l(W,{modelValue:u.value.name,"onUpdate:modelValue":t[1]||(t[1]=d=>u.value.name=d),label:"اسم نوع الخزينة *","prepend-inner-icon":"ri-inbox-archive-line",rules:[S.required],"error-messages":P.value.name},null,8,["modelValue","rules","error-messages"])]),_:1}),l(F,{cols:"12"},{default:a(()=>[l(W,{modelValue:u.value.description,"onUpdate:modelValue":t[2]||(t[2]=d=>u.value.description=d),label:"الوصف *","prepend-inner-icon":"ri-article-line",rules:[S.required],"error-messages":P.value.description},null,8,["modelValue","rules","error-messages"])]),_:1}),w.value?(i(),r(F,{key:0,cols:"12"},{default:a(()=>[l(te,{variant:"tonal",color:u.value.is_active?"primary":"grey",class:"pa-4 rounded-lg mt-4"},{default:a(()=>[n("div",$e,[t[8]||(t[8]=n("div",null,[n("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),n("div",{class:"text-subtitle-2 opacity-70"},"تفعيل أو تعطيل هذا النوع في شاشات الخزينة")],-1)),l(q,{modelValue:u.value.is_active,"onUpdate:modelValue":t[3]||(t[3]=d=>u.value.is_active=d),label:"نشط","hide-details":""},null,8,["modelValue"])])]),_:1},8,["color"])]),_:1})):b("",!0),x.value?(i(),r(F,{key:1,cols:"12"},{default:a(()=>[l(te,{variant:"tonal",color:u.value.is_system?"info":"grey",class:"pa-4 rounded-lg"},{default:a(()=>[n("div",Pe,[t[9]||(t[9]=n("div",null,[n("div",{class:"text-subtitle-1 font-weight-bold"},"نوع أساسي (System)"),n("div",{class:"text-subtitle-2 opacity-70"},"إذا تم تفعيلها، ستظهر لجميع الشركات كنظام افتراضي")],-1)),l(q,{modelValue:u.value.is_system,"onUpdate:modelValue":t[4]||(t[4]=d=>u.value.is_system=d),color:"info","hide-details":""},null,8,["modelValue"])])]),_:1},8,["color"])]),_:1})):b("",!0)]),_:1})]),_:1},512),l(we,{modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=d=>g.value=d),type:"logo",onSelect:J},null,8,["modelValue"])]),_:1},8,["model-value","title","icon","loading"]))}},Ee=de(De,[["__scopeId","data-v-2557358b"]]),Ie={class:"cash-box-types-page"},Le={class:"page-header d-flex align-center justify-space-between mb-6"},Me={class:"d-flex align-center flex-wrap gap-4"},je={class:"type-card-header d-flex align-center justify-center pa-6 bg-grey-lighten-4 position-relative"},Oe={class:"text-caption text-grey-darken-1 me-2"},Fe={class:"d-flex align-center justify-space-between mb-1",style:{height:"32px"}},Ne={class:"d-flex align-center"},Re={class:"d-flex align-center py-2"},qe={class:"d-flex flex-column"},He={class:"font-weight-bold"},Xe={class:"d-flex align-center justify-center"},Ye={class:"text-center pa-4"},Ge={class:"text-body-1 text-grey-darken-1"},Je={__name:"CashBoxTypeList",setup(M){const C=(c,s)=>{let e;return(...T)=>{e&&clearTimeout(e),e=setTimeout(()=>c(...T),s)}},{cashBoxTypes:m,loading:x,total:j,fetchCashBoxTypes:$,deleteCashBoxType:B}=Ue(),w=ne(),V=L(()=>w.isAdmin),h=L(()=>w.isCompanyAdmin),p=L(()=>V.value||h.value||w.hasPermission(G.CASH_BOX_TYPES_CREATE)),g=c=>V.value?!0:c.is_system?!1:h.value||w.hasPermission(G.CASH_BOX_TYPES_DELETE_ALL),f=c=>V.value?!0:c.is_system?!1:h.value||w.hasPermission(G.CASH_BOX_TYPES_UPDATE_ALL),P=Z("/api/cash-box-types"),u=v(null),D=async c=>{u.value=c.id;try{await P.update(c.id,{is_active:!c.is_active}),c.is_active=!c.is_active}finally{u.value=null}},S=v(!1),J=()=>{x.value||m.value.length>=j.value||(y.value++,k(!0))},y=v(1),E=v(12),o=v(""),t=v("grid"),d=v(!1),I=v(!1),U=v(null),K=v(!1),ce=[{title:"نوع الخزينة",key:"name",sortable:!0},{title:"عدد الخزن",key:"cash_boxes_count",align:"center",sortable:!0},{title:"الحالة",key:"is_active",align:"center",sortable:!0},{title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}],ve=C(()=>{y.value=1,k()},500),ee=()=>{U.value=null,d.value=!0},ae=c=>{U.value=c,d.value=!0},le=c=>{U.value=c,I.value=!0},pe=async()=>{K.value=!0;try{await B(U.value.id),I.value=!1,k()}finally{K.value=!1}},me=c=>{t.value==="list"&&k()},k=(c={})=>{const s=c===!0,e={page:y.value,per_page:E.value,search:o.value};V.value&&(e.is_system=S.value?1:0),$(e,{append:s})};return ye(k),R(y,()=>{t.value==="list"&&k()}),R(E,()=>{t.value==="list"&&(y.value=1,k())}),R(t,()=>{y.value=1,k()}),R(S,()=>{y.value=1,k()}),(c,s)=>(i(),H("div",Ie,[n("div",Le,[s[9]||(s[9]=n("div",null,[n("h1",{class:"text-h4 font-weight-bold ml-2"},"أنواع الخزائن"),n("p",{class:"text-body-1 text-grey"},"إدارة أنواع الخزائن المتاحة في النظام")],-1)),p.value?(i(),r(O,{key:0,"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:ee},{default:a(()=>s[8]||(s[8]=[z(" نوع جديد ")])),_:1})):b("",!0)]),l(ie,{class:"mb-6"},{default:a(()=>[n("div",Me,[l(W,{modelValue:o.value,"onUpdate:modelValue":[s[0]||(s[0]=e=>o.value=e),_(ve)],label:"بحث عن نوع...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(oe),V.value?(i(),r(q,{key:0,modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=e=>S.value=e),label:S.value?"مشاهدة الأنواع الأساسية (System)":"مشاهدة الأنواع المخصصة (Custom)","hide-details":""},null,8,["modelValue","label"])):b("",!0),l(_e,{variant:"outlined",density:"comfortable",color:"primary"},{default:a(()=>[l(O,{active:t.value==="grid",icon:"ri-grid-fill",onClick:s[2]||(s[2]=e=>t.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(O,{active:t.value==="list",icon:"ri-list-check",onClick:s[3]||(s[3]=e=>t.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),_(x)&&!_(m).length?(i(),r(Ae,{key:0,size:"64",text:"جاري تحميل أنواع الخزائن..."})):_(m).length?(i(),H(se,{key:2},[t.value==="grid"?(i(),r(Se,{key:0,loading:_(x)&&_(m).length>0,"has-more":_(m).length<_(j),"no-more-text":"لا يوجد المزيد من أنواع الخزائن",onLoad:J},{default:a(()=>[l(re,null,{default:a(()=>[(i(!0),H(se,null,xe(_(m),e=>(i(),r(F,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:a(()=>[l(ie,{class:"type-card h-100","no-padding":""},{actions:a(()=>[l(oe),l(O,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:T=>ae(e)},null,8,["onClick"]),g(e)?(i(),r(O,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:T=>le(e)},null,8,["onClick"])):b("",!0)]),default:a(()=>[n("div",je,[l(Y,{size:"120",rounded:"circle",color:e.is_active?"bg-white":"grey-lighten-3",class:"elevation-1 bg-white"},{default:a(()=>[e.image_url?(i(),r(Q,{key:0,src:e.image_url,cover:""},null,8,["src"])):(i(),r(N,{key:1,icon:"ri-inbox-archive-line",size:"60",color:e.is_active?"primary":"grey"},null,8,["color"]))]),_:2},1032,["color"])]),l(Ve,{class:"position-relative pt-4"},{default:a(()=>[l(ke,{class:"text-h6 font-weight-bold pa-0 mb-1"},{default:a(()=>[z(A(e.name),1)]),_:2},1024),n("span",Oe,A(e.description),1),n("div",Fe,[n("div",Ne,[s[10]||(s[10]=n("span",{class:"text-caption text-grey-darken-1 me-2"},"الحالة:",-1)),l(X,{color:e.is_active?"success":"error",size:"x-small",class:"font-weight-bold",variant:"flat"},{default:a(()=>[z(A(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),f(e)?(i(),r(q,{key:0,"model-value":e.is_active,loading:u.value===e.id,"onUpdate:modelValue":T=>D(e)},null,8,["model-value","loading","onUpdate:modelValue"])):b("",!0)]),l(Ce,{class:"pa-0"},{default:a(()=>[z("الخزائن: "+A(e.cash_boxes_count||0),1)]),_:2},1024),e.is_system?(i(),r(X,{key:0,color:"info",size:"x-small",class:"position-absolute",style:{top:"16px",left:"16px"},variant:"tonal"},{default:a(()=>s[11]||(s[11]=[z(" أساسي ")])),_:1})):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(i(),r(Te,{key:1,headers:ce,items:_(m),"total-items":_(j),loading:_(x),page:y.value,"onUpdate:page":s[4]||(s[4]=e=>y.value=e),"items-per-page":E.value,"onUpdate:itemsPerPage":s[5]||(s[5]=e=>E.value=e),searchable:!1,"can-view":!1,"can-delete":!1,"onUpdate:options":me,onEdit:ae},{"item.name":a(({item:e})=>[n("div",Re,[l(Y,{size:"48",rounded:"circle",color:e.is_active?"bg-white":"grey-lighten-4",class:"me-3 border"},{default:a(()=>[e.image_url?(i(),r(Q,{key:0,src:e.image_url,cover:""},null,8,["src"])):(i(),r(N,{key:1,icon:"ri-inbox-archive-line",size:"24",color:e.is_active?"primary":"grey"},null,8,["color"]))]),_:2},1032,["color"]),n("div",qe,[n("span",He,A(e.name),1),e.is_system?(i(),r(X,{key:0,size:"x-small",color:"info",variant:"tonal",class:"mt-1",style:{width:"fit-content"}},{default:a(()=>s[12]||(s[12]=[z("أساسي")])),_:1})):b("",!0)])])]),"item.is_active":a(({item:e})=>[n("div",Xe,[f(e)?(i(),H("span",{key:0,class:he(["text-caption me-2 font-weight-bold",e.is_active?"text-success":"text-error"])},A(e.is_active?"نشط":"معطل"),3)):b("",!0),f(e)?(i(),r(q,{key:1,"model-value":e.is_active,loading:u.value===e.id,"onUpdate:modelValue":T=>D(e)},null,8,["model-value","loading","onUpdate:modelValue"])):(i(),r(X,{key:2,color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:a(()=>[z(A(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"]))])]),"extra-actions":a(({item:e})=>[g(e)?(i(),r(O,{key:0,icon:"ri-delete-bin-line",variant:"text",color:"error",size:"small",onClick:T=>le(e)},null,8,["onClick"])):b("",!0)]),_:1},8,["items","total-items","loading","page","items-per-page"]))],64)):(i(),r(Be,{key:1,icon:"ri-inbox-archive-line",title:"لا توجد أنواع خزائن حالياً",message:"ابدأ بإضافة أول نوع خزينة لنظامك","show-action":p.value,"action-text":"إضافة نوع جديد",onAction:ee},null,8,["show-action"])),l(Ee,{modelValue:d.value,"onUpdate:modelValue":s[6]||(s[6]=e=>d.value=e),"cash-box-type":U.value,onSaved:k},null,8,["modelValue","cash-box-type"]),l(ue,{modelValue:I.value,"onUpdate:modelValue":s[7]||(s[7]=e=>I.value=e),title:"حذف نوع الخزينة؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:K.value,onConfirm:pe},{default:a(()=>{var e,T;return[n("div",Ye,[l(Y,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:a(()=>[l(N,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),n("p",Ge,'هل أنت متأكد من حذف "'+A((e=U.value)==null?void 0:e.name)+'"؟',1),((T=U.value)==null?void 0:T.cash_boxes_count)>0?(i(),r(be,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-4 text-right"},{default:a(()=>[z(" هذا النوع مرتبط بـ "+A(U.value.cash_boxes_count)+" خزينة. لا ينصح بحذفه. ",1)]),_:1})):b("",!0)])]}),_:1},8,["modelValue","loading"])]))}},ua=de(Je,[["__scopeId","data-v-ba9fac65"]]);export{ua as default};
