import{_ as L}from"./ContextMenu-6xvIZgtH.js";import{z as E,g as W,r as a,al as X,Z as Y,w as I,ah as ee,aj as te,P as ae,o as f,c as F,d as r,a as le,k as M,j as u,b as z,t as A,a9 as P,q as U,am as se,a6 as ne,a3 as oe,ai as re,F as $,_ as ie,u as ce,U as ue}from"./index-Tc2OuKZg.js";import{u as de,D as me}from"./DeletedItem-DXpha6iU.js";const pe={id:"dataTable",style:{position:"relative !important"}},ve={__name:"UsersDataTable",async setup(B){let o,g;const d=E(),h=W(),j=de(),s=a([]),y=a(0),c=a([]),i=a(null),x=a(!1),S=a(10),m=a(""),R=a({nickname:"",phone:"",status:"",created_at_from:"",created_at_to:""}),k=a({page:1,sortBy:[],itemsPerPage:10}),q=([o,g]=X(()=>d.can(["admin.super","admin.company"])),o=await o,g(),o),O=a([{title:"#",key:"index",sortable:!1},{title:"اسم الشهره",key:"nickname",align:"start"},...q?[{title:"اسم الشركة",key:"company_name",align:"start"}]:[],{title:"الهاتف",key:"phone",align:"start"},{title:"الرصيد",key:"balance",align:"start"},{title:"تاريخ الإنشاء",key:"created_at",align:"start"},{title:"الإجراءات",key:"action",sortable:!1,align:"center"}]),b=a(null),Q=a(()=>{h.push({name:"edit-user",params:{id:i.value.id}}),v()}),N=a(()=>{s.value.length?b.value=c.value.filter(e=>s.value.includes(e.id)):b.value=[i.value],j.dialogDelete=!0,v()}),Z=a(()=>{v()}),G=a(()=>{const e=i.value.status==="0"?"1":"0";Y("user",{status:e},i.value.id).then(()=>{c.value.forEach(t=>{t.id===i.value.id&&(t.status=e)}),v()})}),C=a([]),V=a([]);I(()=>i.value,async e=>{if(!e)return;const t=await d.can(["users.update_all","users.update_children","users.update_self","users.create","admin.super","admin.company"]),n=await d.can(["users.delete_all","users.delete_children","users.delete_self","admin.super","admin.company"]),l=await d.can(["users.view_any","users.view_children","users.view_self","admin.super","admin.company"]);V.value=[!s.value.length&&t?{title:Number(e==null?void 0:e.status)===1?"تعطيل":"تفعيل",color:Number(e==null?void 0:e.status)===1?"#ffc107":"#28a745",icon:Number(e==null?void 0:e.status)===1?"ri-toggle-line":"ri-toggle-fill",callback:G.value}:null,!s.value.length&&t?{title:"تعديل",color:"#007bff",icon:"ri-pencil-line",callback:Q.value}:null,n?{title:"حذف",color:"#dc3545",icon:"ri-delete-bin-line",callback:N.value}:null,!s.value.length&&l?{title:"عرض",color:"#17a2b8",icon:"ri-eye-line",callback:Z.value}:null].filter(Boolean)},{immediate:!0}),ee(()=>{V.value.length===0?C.value=[{title:"لا تملك إجراءات",color:"#6c757d",icon:"ri-spam-3-line",callback:()=>{}}]:C.value=V.value});const H=e=>{c.value=c.value.filter(t=>!e.includes(t.id)),s.value=[]},p=a(null),T=(e,{item:t})=>{i.value=t,e.preventDefault(),p.value&&p.value.showContextMenu(e)},v=()=>{p.value?p.value.colsContextMenu():console.error("Context menu is not initialized.")};I(m,e=>{(e&&e.length>=3||e.length===0)&&w()});async function w(){x.value=!0;const{page:e,itemsPerPage:t,sortBy:n}=k.value,l=n.length?n[0].key:"id",D=n.length&&n[0].order?n[0].order:"desc",K=t===-1?y.value:t;try{const _=await te("users/search",{page:e,per_page:K,sort_by:l,sort_order:D,...R.value,search:m.value.length>=3?m.value:""},!1,!1,!1);c.value=_.data,y.value=_.total}catch(_){console.error("Error fetching users:",_)}finally{x.value=!1}}function J({item:e,index:t}){return{class:e.status==="active"?"active-row":"inactive-row","data-index":t}}return ae(()=>{}),(e,t)=>{const n=L;return f(),F($,null,[r(me,{onUpdateItems:H,api:"users/delete",dataDelete:{items:b.value,key:"nickname"}},null,8,["dataDelete"]),le("div",pe,[s.value.length?(f(),M(P,{key:0,class:"text-center my-2 mx-10",density:"compact",variant:"flat",style:{"background-color":"#dc3545 !important",color:"white",position:"absolute",top:"-30px","z-index":"10"},"prepend-icon":"ri-delete-bin-line",onClick:N.value},{default:u(()=>[z(" حذف عدد "+A(s.value.length)+" من العناصر ",1)]),_:1},8,["onClick"])):U("",!0),r(re,{"item-value":"id","items-per-page":S.value,"onUpdate:itemsPerPage":t[1]||(t[1]=l=>S.value=l),options:k.value,"onUpdate:options":[t[2]||(t[2]=l=>k.value=l),w],headers:O.value,items:c.value,"items-length":y.value,loading:x.value,hover:"","show-current-page":"","row-props":J,modelValue:s.value,"onUpdate:modelValue":t[3]||(t[3]=l=>s.value=l),"show-select":"","item-selectable":"","loading-text":" جاري تحمل البيانات ","no-data-text":" لا توجد بيانات ","items-per-page-text":"عدد الصفوف في الصفحة","onContextmenu:row":T,onClick:v},{top:u(()=>[r(se,{color:"transparent"},{default:u(()=>[r(ne,{clearable:"",class:"ma-10","max-width":"200",rounded:"",modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),"prepend-inner-icon":"ri-search-line",label:"بحث...","hide-details":""},null,8,["modelValue"])]),_:1})]),"item.index":u(({index:l})=>[z(A(l+1),1)]),"item.action":u(({item:l})=>[r(P,{density:"compact",variant:"text",color:"#0086CD","prepend-icon":"ri-more-2-fill",onClick:oe(D=>T(D,{item:l}),["stop"])},null,8,["onClick"])]),_:1},8,["items-per-page","options","headers","items","items-length","loading","modelValue"]),r(n,{ref_key:"contextMenu",ref:p,actions:C.value},null,8,["actions"])])],64)}}},fe={};function _e(B,o){return f(),M(P,{class:"text-center",density:"compact",variant:"flat",style:{"background-color":"#28a745 !important",color:"white","z-index":"10"},"prepend-icon":"ri-add-line",to:{name:"edit-user"}})}const ge=ie(fe,[["render",_e],["__scopeId","data-v-8b3e4ec3"]]),ke={__name:"users",setup(B){const o=E();return console.log(o.can(["users.create","admin.super","admin.company"])),(g,d)=>{const h=ve;return f(),F($,null,[ce(o).can(["users.create","admin.super","admin.company"])?(f(),M(ge,{key:0,class:"ma-3"})):U("",!0),r(ue,{class:"pa-0",title:"المستخدمين"},{default:u(()=>[r(h)]),_:1})],64)}}};export{ke as default};
