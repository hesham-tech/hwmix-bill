import{r,y as ue,K as ce,J as q,c as B,a as o,b as l,w as s,u as i,v as c,F as G,o as n,O as ee,m as _,D as k,ax as fe,i as pe,d as ae,h as S,t as g,C as U,z as le,j as me,k as ve,e as z,ad as ge,f as he,A as te,as as be,ay as ye,a5 as _e,az as xe,a1 as we}from"./index-DPR0tjT6.js";import{u as O}from"./useApi-CTBDEoea.js";import{u as ke}from"./usePermissions-BOh6stgy.js";import{A as Ve}from"./AppDataTable-CV9gFKLg.js";import{_ as x}from"./AppButton-DiF3_7lr.js";import{A as se}from"./AppDialog-CVbZwWX_.js";import{_ as R}from"./AppInput-CYR4AaBJ.js";import{A as Ce}from"./AppSwitch-D-YUIM8I.js";import{_ as oe}from"./AppCard-DxtAeMMp.js";import{_ as De}from"./LoadingSpinner-BZRbwFnn.js";import{_ as Be}from"./EmptyState-Cza6ENNq.js";import{A as ze}from"./AppInfiniteScroll-DU-_Srv_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Ae(){const E=O("/api/cash-boxes"),b=r([]),p=r(!1),h=r(0);return{cashBoxes:b,loading:p,total:h,fetchCashBoxes:async(V={},M={})=>{var u;const{append:I=!1}=M;p.value=!0;try{const d=await E.get(V,{showLoading:!1});let y=[],f=0;return d.data&&Array.isArray(d.data.data)?(y=d.data.data,f=((u=d.data.meta)==null?void 0:u.total)||d.data.data.length):(y=d.data||[],f=d.total||y.length),I?b.value=[...b.value,...y]:b.value=y,h.value=f,d}catch(d){throw b.value=[],h.value=0,d}finally{p.value=!1}},deleteCashBox:async V=>await E.remove(V,{successMessage:"تم حذف الخزينة بنجاح"})}}const Te={class:"cashbox-page"},$e={class:"px-6 pb-6"},Se={class:"px-6 pb-6"},Ue={class:"d-flex align-center flex-wrap gap-4"},Ee={class:"d-flex align-center gap-3"},Me={class:"cashbox-card-header d-flex align-center justify-center pa-4 bg-grey-lighten-4 position-relative"},Ie={class:"d-flex align-center justify-space-between mt-2"},Le={class:"d-flex align-center"},je={class:"font-weight-bold"},Ne={key:1,class:"text-grey-lighten-1 text-caption"},Fe={class:"d-flex justify-end gap-1"},Pe={class:"d-flex align-center justify-space-between"},qe={class:"text-center pa-4"},Ge={class:"text-body-1 text-grey-darken-1"},Re={class:"mt-2 text-error text-caption font-weight-bold"},sa={__name:"CashBoxList",setup(E){const b=(a,t)=>{let e;return(...D)=>{e&&clearTimeout(e),e=setTimeout(()=>a(...D),t)}},{cashBoxes:p,loading:h,total:A,fetchCashBoxes:H,deleteCashBox:V}=Ae(),M=a=>{m.value==="list"&&v()},I=()=>{h.value||p.value.length>=A.value||(f.value++,v(!0))},{can:u}=ke(),d=O("/api/cash-boxes"),y=O("/api/cash-box-types"),f=r(1),L=r(12),m=r("grid"),j=r(""),C=r(!1),T=r(!1),w=r(null),N=r(!1),F=r(!1),J=r(null),$=r([]),P=r(!1),ie=ue(()=>{const a=[{title:"الاسم",key:"name",sortable:!0},{title:"النوع",key:"type",sortable:!0},{title:"الرصيد",key:"balance",align:"end",sortable:!0},{title:"الحالة",key:"is_active",align:"center",sortable:!0}];return(u("cash_boxes.update_all")||u("cash_boxes.delete_all"))&&a.push({title:"الإجراءات",key:"actions",sortable:!1,align:"end",width:"120px"}),a}),K={required:a=>!!a||"مطلوب"},Q=async()=>{P.value=!0;try{const a=await y.get({per_page:100},{showLoading:!1,showError:!1});$.value=a.data||[]}finally{P.value=!1}},ne=()=>{w.value=null,formData.value={name:"",cash_box_type_id:null,initial_balance:0,is_active:1},C.value=!0,$.value.length||Q()},W=a=>{w.value=a,formData.value={...a},C.value=!0,$.value.length||Q()},X=a=>{w.value=a,T.value=!0},Y=async()=>{const{valid:a}=await J.value.validate();if(a){N.value=!0;try{isEdit.value?await d.update(w.value.id,formData.value,{successMessage:"تم التحديث بنجاح"}):await d.create(formData.value,{successMessage:"تم الإضافة بنجاح"}),C.value=!1,v()}finally{N.value=!1}}},re=async()=>{F.value=!0;try{await V(w.value.id),T.value=!1,v()}finally{F.value=!1}},Z=a=>a==null?"0.00 ج.م":new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(a),de=b(()=>{f.value=1,v()},500),v=(a={})=>{const t=a===!0;return H({page:f.value,per_page:L.value,name:j.value},{append:t})};return ce(v),q(f,()=>{m.value==="list"&&v()}),q(L,()=>{m.value==="list"&&(f.value=1,v())}),q(m,()=>{f.value=1,v()}),(a,t)=>(n(),B("div",Te,[t[13]||(t[13]=o("div",{class:"mb-6 px-6 pt-6"},[o("h1",{class:"text-h4 font-weight-bold"},"الخزائن"),o("p",{class:"text-body-1 text-grey"},"إدارة الخزائن النقدية والأرصدة المتاحة للعمليات")],-1)),o("div",$e,[o("div",Se,[l(oe,{class:"mb-6"},{default:s(()=>[o("div",Ue,[l(R,{modelValue:j.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>j.value=e),i(de)],label:"بحث عن خزينة...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(ee),o("div",Ee,[i(u)("cash_boxes.create")?(n(),c(x,{key:0,color:"primary","prepend-icon":"ri-add-line",onClick:ne},{default:s(()=>t[9]||(t[9]=[_(" خزينة جديدة ")])),_:1})):k("",!0),l(fe,{variant:"outlined",density:"comfortable",color:"primary",class:"bg-white"},{default:s(()=>[l(x,{active:m.value==="grid",icon:"ri-grid-fill",onClick:t[1]||(t[1]=e=>m.value="grid"),title:"عرض شبكي"},null,8,["active"]),l(x,{active:m.value==="list",icon:"ri-list-check",onClick:t[2]||(t[2]=e=>m.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])])]),_:1}),i(h)?(n(),c(De,{key:0})):(n(),B(G,{key:1},[i(p).length===0?(n(),c(Be,{key:0,icon:"ri-safe-2-line",title:"لا توجد خزائن",subtitle:"لم يتم العثور على أي خزائن مطابقة لبحثك."})):(n(),B(G,{key:1},[m.value==="grid"?(n(),c(ze,{key:0,loading:i(h)&&i(p).length>0,"has-more":i(p).length<i(A),"no-more-text":"لا يوجد المزيد من الخزائن",onLoad:I},{default:s(()=>[l(ae,null,{default:s(()=>[(n(!0),B(G,null,pe(i(p),e=>(n(),c(z,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:s(()=>[l(oe,{class:"cashbox-card h-100","no-padding":""},be({default:s(()=>[o("div",Me,[l(te,{size:"80",rounded:"lg",class:"elevation-1 bg-white"},{default:s(()=>[l(S,{icon:"ri-safe-2-line",size:"40",color:"warning"})]),_:1}),l(U,{color:e.is_active?"success":"error",size:"x-small",class:"position-absolute top-2 right-2 font-weight-bold",variant:"flat"},{default:s(()=>[_(g(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),l(ye,null,{default:s(()=>[l(_e,{class:"text-h6 font-weight-bold"},{default:s(()=>[_(g(e.name),1)]),_:2},1024),l(xe,{class:"d-flex align-center mt-1"},{default:s(()=>[e.type?(n(),c(U,{key:0,size:"x-small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:s(()=>[_(g(e.type.name),1)]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024),l(we,{class:"pt-0"},{default:s(()=>[o("div",Ie,[t[10]||(t[10]=o("span",{class:"text-caption text-grey"},"الرصيد الحالي",-1)),o("span",{class:le(["font-weight-black",e.balance>=0?"text-success":"text-error"])},g(Z(e.balance)),3)])]),_:2},1024)]),_:2},[i(u)("cash_boxes.update_all",{resource:e})||i(u)("cash_boxes.delete_all",{resource:e})?{name:"actions",fn:s(()=>[l(ee),i(u)("cash_boxes.update_all",{resource:e})?(n(),c(x,{key:0,icon:"ri-edit-line",variant:"text",color:"primary",tooltip:"تعديل",onClick:D=>W(e)},null,8,["onClick"])):k("",!0),i(u)("cash_boxes.delete_all",{resource:e})?(n(),c(x,{key:1,icon:"ri-delete-bin-line",variant:"text",color:"error",tooltip:"حذف",onClick:D=>X(e)},null,8,["onClick"])):k("",!0)]),key:"0"}:void 0]),1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading","has-more"])):(n(),c(Ve,{key:1,headers:ie.value,items:i(p),loading:i(h),"items-length":i(A),"items-per-page":L.value,page:f.value,title:"قائمة الخزائن",icon:"ri-safe-2-line","permission-module":"cash_boxes","onUpdate:options":M},{"item.name":s(({item:e})=>[o("div",Le,[l(S,{icon:"ri-money-dollar-box-line",size:"small",color:"warning",class:"me-2"}),o("span",je,g(e.name),1)])]),"item.type":s(({item:e})=>[e.type?(n(),c(U,{key:0,size:"small",variant:"flat",color:"primary-lighten-5",class:"text-primary font-weight-bold"},{default:s(()=>[_(g(e.type.name),1)]),_:2},1024)):(n(),B("span",Ne,"غير محدد"))]),"item.balance":s(({item:e})=>[o("div",{class:le(["text-end font-weight-black",e.balance>=0?"text-success":"text-error"])},g(Z(e.balance)),3)]),"item.is_active":s(({item:e})=>[l(U,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold px-3"},{default:s(()=>[_(g(e.is_active?"نشط":"غير نشط"),1)]),_:2},1032,["color"])]),"item.actions":s(({item:e})=>[o("div",Fe,[i(u)("cash_boxes.update_all",{resource:e})?(n(),c(x,{key:0,icon:"ri-edit-line",size:"x-small",variant:"text",color:"primary",tooltip:"تعديل",onClick:D=>W(e)},null,8,["onClick"])):k("",!0),i(u)("cash_boxes.delete_all",{resource:e})?(n(),c(x,{key:1,icon:"ri-delete-bin-line",size:"x-small",variant:"text",color:"error",tooltip:"حذف",onClick:D=>X(e)},null,8,["onClick"])):k("",!0)])]),_:1},8,["headers","items","loading","items-length","items-per-page","page"]))],64))],64))])]),l(se,{modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=e=>C.value=e),title:a.isEdit?"تعديل الخزينة":"إضافة خزينة جديدة",icon:a.isEdit?"ri-edit-line":"ri-safe-2-line",loading:N.value,"max-width":"650",onConfirm:Y},{default:s(()=>[l(me,{ref_key:"formRef",ref:J,onSubmit:ve(Y,["prevent"])},{default:s(()=>[l(ae,{dense:""},{default:s(()=>[l(z,{cols:"12"},{default:s(()=>[l(R,{modelValue:a.formData.name,"onUpdate:modelValue":t[3]||(t[3]=e=>a.formData.name=e),label:"اسم الخزينة *",placeholder:"مثال: الخزينة الرئيسية",rules:[K.required]},null,8,["modelValue","rules"])]),_:1}),l(z,{cols:"12"},{default:s(()=>[l(ge,{modelValue:a.formData.cash_box_type_id,"onUpdate:modelValue":t[4]||(t[4]=e=>a.formData.cash_box_type_id=e),items:$.value,loading:P.value,"item-title":"name","item-value":"id",label:"نوع الخزينة *",variant:"outlined",density:"comfortable","prepend-inner-icon":"ri-list-settings-line",rules:[K.required],"hide-details":"",class:"mb-4"},null,8,["modelValue","items","loading","rules"])]),_:1}),l(z,{cols:"12"},{default:s(()=>[l(R,{modelValue:a.formData.initial_balance,"onUpdate:modelValue":t[5]||(t[5]=e=>a.formData.initial_balance=e),modelModifiers:{number:!0},label:"الرصيد الافتتاحي",type:"number",step:"0.01","prepend-inner-icon":"ri-money-dollar-circle-line",disabled:a.isEdit},null,8,["modelValue","disabled"])]),_:1}),l(z,{cols:"12"},{default:s(()=>[l(he,{variant:"tonal",color:"primary",class:"pa-4 rounded-lg"},{default:s(()=>[o("div",Pe,[t[11]||(t[11]=o("div",null,[o("div",{class:"text-subtitle-1 font-weight-bold"},"حالة النشاط"),o("div",{class:"text-caption"},"تحديد ما إذا كانت الخزينة متاحة حالياً للعمليات")],-1)),l(Ce,{modelValue:a.formData.is_active,"onUpdate:modelValue":t[6]||(t[6]=e=>a.formData.is_active=e),"true-value":1,"false-value":0,"hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue","title","icon","loading"]),l(se,{modelValue:T.value,"onUpdate:modelValue":t[8]||(t[8]=e=>T.value=e),title:"حذف الخزينة؟",icon:"ri-delete-bin-7-line","confirm-color":"error","confirm-text":"تأكيد الحذف",loading:F.value,onConfirm:re},{default:s(()=>{var e;return[o("div",qe,[l(te,{color:"error-lighten-5",size:"80",class:"mb-4 mx-auto"},{default:s(()=>[l(S,{icon:"ri-delete-bin-7-line",color:"error",size:"40"})]),_:1}),o("p",Ge,'هل أنت متأكد من حذف "'+g((e=w.value)==null?void 0:e.name)+'"؟',1),o("div",Re,[l(S,{icon:"ri-error-warning-line",size:"small",class:"me-1"}),t[12]||(t[12]=_(" هذا الإجراء قد يؤثر على السجلات المالية المرتبطة! "))])])]}),_:1},8,["modelValue","loading"])]))}};export{sa as default};
