import{u as E}from"./useApi-C9JqAxpT.js";import{u as R}from"./usePrintExport-CFRwAj9b.js";import{R as S}from"./ReportLayout-zxSmuh_P.js";import{a as T,z as w,t as $,o as x,x as k,w as o,d as l,a3 as B,b as n,c as I,G as M,h,r as f,L as O,n as j,f as y,v as u,u as m,A as D,e as z}from"./index-B0c0aplS.js";import{A as L}from"./AppDataTable-DRQWa6GE.js";import{_ as F}from"./AppInput-B9V4fNt_.js";import{_ as N}from"./AppButton-CoaWq9vh.js";import{f as _}from"./formatters-CKQiR5Fb.js";import"./usePermissions-D1W15K8H.js";const P={class:"chart-wrapper"},U={key:1,class:"d-flex align-center justify-center height-300"},G={__name:"CashFlowChart",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(g){const v=g,c=w(()=>{const e={};return v.data.forEach(a=>{const r=a.transaction_date;e[r]||(e[r]={income:0,expense:0}),a.type==="income"?e[r].income+=parseFloat(a.amount):e[r].expense+=Math.abs(parseFloat(a.amount))}),Object.keys(e).sort().map(a=>({date:a,income:e[a].income,expense:e[a].expense}))}),i=w(()=>[{name:"المقبوضات",data:c.value.map(e=>e.income)},{name:"المدفوعات",data:c.value.map(e=>e.expense)}]),d=w(()=>({chart:{type:"line",toolbar:{show:!1},fontFamily:"Inter, sans-serif"},stroke:{curve:"smooth",width:3},xaxis:{categories:c.value.map(e=>e.date),labels:{style:{colors:"#64748b"}}},yaxis:{labels:{formatter:e=>`${e} ج.م`,style:{colors:"#64748b"}}},colors:["#10b981","#ef4444"],grid:{borderColor:"#f1f5f9"},tooltip:{theme:"light"},legend:{position:"top",horizontalAlign:"right"}}));return(e,a)=>{const r=$("apexchart");return x(),k(h,{variant:"flat",border:"",class:"chart-card rounded-xl overflow-hidden pa-1"},{default:o(()=>[l(B,{class:"pa-4"},{default:o(()=>[a[0]||(a[0]=n("div",{class:"d-flex align-center justify-space-between mb-4"},[n("div",null,[n("div",{class:"text-caption font-weight-bold text-grey-darken-1 mb-1"},"السيولة النقدية"),n("h3",{class:"text-h6 font-weight-black"},"حركة المقبوضات والمدفوعات")])],-1)),n("div",P,[g.loading?(x(),I("div",U,[l(M,{indeterminate:"",color:"primary"})])):(x(),k(r,{key:0,type:"line",height:"300",options:d.value,series:i.value},null,8,["options","series"]))])]),_:1})]),_:1})}}},q=T(G,[["__scopeId","data-v-0713f4c1"]]),H={class:"d-flex flex-column gap-4"},J={class:"text-h4 font-weight-black text-success"},K={class:"text-h4 font-weight-black text-error"},se={__name:"CashFlowReport",setup(g){const v=E("/api/transactions"),{exportToCSV:c}=R(),i=f(!1),d=f({date_from:new Date(new Date().setDate(1)).toISOString().split("T")[0],date_to:new Date().toISOString().split("T")[0]}),e=f({total_inflow:0,total_outflow:0,net_flow:0}),a=f([]),r=[{title:"التاريخ",key:"transaction_date"},{title:"الخزينة",key:"cash_box.name"},{title:"المبلغ",key:"amount",align:"end"},{title:"البيان",key:"description"}],b=async()=>{i.value=!0;try{const p=await v.get({...d.value,per_page:100},{showLoading:!1});a.value=p.data||[];let t=0,s=0;a.value.forEach(C=>{const V=parseFloat(C.amount||0);C.type==="income"?t+=V:s+=Math.abs(V)}),e.value={total_inflow:t,total_outflow:s,net_flow:t-s}}finally{i.value=!1}},A=()=>{const p=a.value.map(t=>{var s;return{التاريخ:t.transaction_date,الخزينة:((s=t.cash_box)==null?void 0:s.name)||"-",المقدار:t.amount,البيان:t.description}});c(p,"تقرير_التدفق_النقدي.csv")};return O(b),(p,t)=>(x(),k(S,{title:"تقرير التدفقات النقدية",description:"تحليل المقبوضات والمدفوعات وحركة السيولة في الصناديق",loading:i.value,onRefresh:b,onExport:A},{filters:o(()=>[n("div",H,[l(F,{modelValue:d.value.date_from,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value.date_from=s),label:"من تاريخ",type:"date"},null,8,["modelValue"]),l(F,{modelValue:d.value.date_to,"onUpdate:modelValue":t[1]||(t[1]=s=>d.value.date_to=s),label:"إلى تاريخ",type:"date"},null,8,["modelValue"]),l(N,{color:"primary",block:"",onClick:b},{default:o(()=>t[2]||(t[2]=[j("تحديث البيانات")])),_:1})])]),summary:o(()=>[l(z,{dense:""},{default:o(()=>[l(y,{cols:"12",md:"4"},{default:o(()=>[l(h,{border:"",flat:"",class:"rounded-xl pa-4 bg-success-lighten-5 border-success"},{default:o(()=>[t[3]||(t[3]=n("div",{class:"text-caption font-weight-bold text-success"},"إجمالي المقبوضات (+)",-1)),n("div",J,u(m(_)(e.value.total_inflow)),1)]),_:1})]),_:1}),l(y,{cols:"12",md:"4"},{default:o(()=>[l(h,{border:"",flat:"",class:"rounded-xl pa-4 bg-error-lighten-5 border-error"},{default:o(()=>[t[4]||(t[4]=n("div",{class:"text-caption font-weight-bold text-error"},"إجمالي المدفوعات (-)",-1)),n("div",K,u(m(_)(e.value.total_outflow)),1)]),_:1})]),_:1}),l(y,{cols:"12",md:"4"},{default:o(()=>[l(h,{border:"",flat:"",class:"rounded-xl pa-4 bg-info-lighten-5 border-info"},{default:o(()=>[t[5]||(t[5]=n("div",{class:"text-caption font-weight-bold text-info"},"صافي التدفق",-1)),n("div",{class:D(["text-h4 font-weight-black",e.value.net_flow>=0?"text-info":"text-error"])},u(m(_)(e.value.net_flow)),3)]),_:1})]),_:1})]),_:1})]),charts:o(()=>[l(q,{data:a.value,loading:i.value},null,8,["data","loading"])]),table:o(()=>[l(L,{headers:r,items:a.value,loading:i.value,title:"سجل حركات الخزينة",icon:"ri-history-line"},{"item.amount":o(({item:s})=>[n("div",{class:D([s.type==="income"?"text-success":"text-error","font-weight-black pr-4"])},u(s.type==="income"?"+":"-")+" "+u(m(_)(Math.abs(s.amount))),3)]),_:1},8,["items","loading"])]),_:1},8,["loading"]))}};export{se as default};
