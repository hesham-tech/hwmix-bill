import{ay as se,r as v,z as ee,s as L,K as G,o as V,x as I,ax as ie,w as l,ar as J,M as re,aj as de,d as a,e as ae,f as D,u as t,b as f,i as T,l as ue,k as ce,a as pe,aM as fe,L as me,c as P,F as Q,af as $,v as k,aN as ve,E as ge,n as W,P as ye,az as he,j as be,B as X,D as Y,aA as we,a7 as Ve,aB as xe,a3 as ke,O as Ce,H as _e}from"./index-a34Ydvtq.js";import{w as U}from"./company.service-C5Gu25KH.js";import"./task-group.service-D9tPUbaB.js";import"./brand.service-BsxnUKZB.js";import"./task.service-CCJ0XYfd.js";import{u as Se,a as $e}from"./index-D7GN0-oA.js";import{A as Ie}from"./AppDataTable-u95EW4-x.js";import{A as Be}from"./AppDialog-BCdceINl.js";import{_ as C}from"./AppButton-CLlOdaZ_.js";import{_ as Z}from"./AppCard-BUDroHe8.js";import{_ as O}from"./AppInput-CvTgrXFc.js";import{_ as We}from"./LoadingSpinner-DEybY_iO.js";import{_ as Ue}from"./EmptyState-k7YPkZHl.js";import{C as ze}from"./ConfirmDialog-BYCUsWbG.js";import{A as Ae}from"./AppSwitch-CI7wxXXU.js";import{r as Ee}from"./validators-CndBNb9f.js";import"./usePermissions-CTYSXYZg.js";const De=se("warehouse",()=>{const u=v([]),g=v(null),o=v(!1),x=v(0),y=v(1),m=v(10),d=v(""),n=v([]),c=ee(()=>{var p,s;return{page:y.value,per_page:m.value,search:d.value,sort_by:((p=n.value[0])==null?void 0:p.key)||"",order:((s=n.value[0])==null?void 0:s.order)||"desc"}});async function r(){o.value=!0;try{const p=await U.getAll(c.value,{showToast:!1});return u.value=p.data.map(s=>({...s,is_active:s.status==="active"})),x.value=p.total,p}catch(p){throw console.error("Error fetching warehouses:",p),p}finally{o.value=!1}}async function h(p){o.value=!0;try{const w=(await U.getOne(p)).data[0];return g.value={...w,is_active:w.status==="active"},g.value}catch(s){throw console.error("Error fetching warehouse:",s),s}finally{o.value=!1}}async function z(p){o.value=!0;try{const s={...p,status:p.is_active?"active":"inactive"},w=await U.save(s);return await r(),L.success("تم إنشاء المخزن بنجاح"),w.data[0]}catch(s){throw console.error("Error creating warehouse:",s),s}finally{o.value=!1}}async function j(p,s){o.value=!0;try{const w={...s,status:s.is_active?"active":"inactive"},F=await U.save(w,p);return await r(),L.success("تم تحديث المخزن بنجاح"),F.data[0]}catch(w){throw console.error("Error updating warehouse:",w),w}finally{o.value=!1}}async function A(p){o.value=!0;try{await U.delete(p),await r(),L.success("تم حذف المخزن بنجاح")}catch(s){throw console.error("Error deleting warehouse:",s),s}finally{o.value=!1}}async function E(p){o.value=!0;try{return(await U.getStock(p)).data}catch(s){throw console.error("Error getting warehouse stock:",s),s}finally{o.value=!1}}return{warehouses:u,currentWarehouse:g,loading:o,totalItems:x,page:y,itemsPerPage:m,search:d,sortBy:n,params:c,fetchWarehouses:r,fetchWarehouse:h,createWarehouse:z,updateWarehouse:j,deleteWarehouse:A,getWarehouseStock:E}}),Te={__name:"AppTextarea",props:{modelValue:{type:String,default:""},label:{type:String,default:""},placeholder:{type:String,default:""},rules:{type:Array,default:()=>[]},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},prependIcon:{type:String,default:""},prependInnerIcon:{type:String,default:""},appendIcon:{type:String,default:""},appendInnerIcon:{type:String,default:""},rows:{type:[Number,String],default:3},autoGrow:{type:Boolean,default:!1},hint:{type:String,default:""},persistentHint:{type:Boolean,default:!1},density:{type:String,default:"default"},variant:{type:String,default:"outlined"}},emits:["update:modelValue","blur","focus"],setup(u,{emit:g}){const o=u,x=g,y=v(o.modelValue),m=ee(()=>{const n=[...o.rules];return o.required&&!n.some(c=>c.toString().includes("required"))&&n.unshift(c=>!!c||"هذا الحقل مطلوب"),n}),d=n=>{x("update:modelValue",n)};return G(()=>o.modelValue,n=>{y.value=n}),(n,c)=>(V(),I(de,re({modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=r=>y.value=r),label:u.label,placeholder:u.placeholder,rules:m.value,disabled:u.disabled,readonly:u.readonly,clearable:u.clearable,"prepend-icon":u.prependIcon,"prepend-inner-icon":u.prependInnerIcon,"append-icon":u.appendIcon,"append-inner-icon":u.appendInnerIcon,rows:u.rows,"auto-grow":u.autoGrow,hint:u.hint,"persistent-hint":u.persistentHint,density:u.density,variant:u.variant},n.$attrs,{"onUpdate:modelValue":d,onBlur:c[1]||(c[1]=r=>n.$emit("blur",r)),onFocus:c[2]||(c[2]=r=>n.$emit("focus",r))}),ie({_:2},[n.$slots.prepend?{name:"prepend",fn:l(()=>[J(n.$slots,"prepend")]),key:"0"}:void 0,n.$slots.append?{name:"append",fn:l(()=>[J(n.$slots,"append")]),key:"1"}:void 0]),1040,["modelValue","label","placeholder","rules","disabled","readonly","clearable","prepend-icon","prepend-inner-icon","append-icon","append-inner-icon","rows","auto-grow","hint","persistent-hint","density","variant"]))}},je={class:"pa-4 border rounded-lg bg-grey-lighten-5 d-flex align-center justify-space-between mb-4"},Pe={class:"d-flex align-center"},Fe={__name:"WarehouseForm",props:{modelValue:{type:Object,default:()=>({})}},emits:["save","cancel"],setup(u,{expose:g,emit:o}){const x=u,y=o,m=v(null);v(!1);const d=v({name:"",location:"",description:"",is_active:!0,...x.modelValue}),n=async()=>{const{valid:c}=await m.value.validate();return c?(y("save",d.value),!0):!1};return g({handleSubmit:n}),G(()=>x.modelValue,c=>{d.value={...d.value,...c}},{deep:!0}),(c,r)=>(V(),I(ce,{ref_key:"formRef",ref:m,onSubmit:ue(n,["prevent"])},{default:l(()=>[a(ae,{dense:""},{default:l(()=>[a(D,{cols:"12"},{default:l(()=>[a(O,{modelValue:d.value.name,"onUpdate:modelValue":r[0]||(r[0]=h=>d.value.name=h),label:"اسم المخزن *",placeholder:"مثال: المخزن الرئيسي",rules:[t(Ee)],"prepend-inner-icon":"ri-building-4-line"},null,8,["modelValue","rules"])]),_:1}),a(D,{cols:"12"},{default:l(()=>[a(O,{modelValue:d.value.location,"onUpdate:modelValue":r[1]||(r[1]=h=>d.value.location=h),label:"وقع المخزن / العنوان",placeholder:"ادخل العنوان بالتفصيل","prepend-inner-icon":"ri-map-pin-line"},null,8,["modelValue"])]),_:1}),a(D,{cols:"12"},{default:l(()=>[a(Te,{modelValue:d.value.description,"onUpdate:modelValue":r[2]||(r[2]=h=>d.value.description=h),label:"وصف إضافي",placeholder:"أي تفاصيل أخرى عن المخزن...",rows:"3","prepend-inner-icon":"ri-file-text-line"},null,8,["modelValue"])]),_:1}),a(D,{cols:"12"},{default:l(()=>[f("div",je,[f("div",Pe,[a(T,{icon:d.value.is_active?"ri-checkbox-circle-line":"ri-close-circle-line",color:d.value.is_active?"success":"grey",class:"me-3"},null,8,["icon","color"]),r[4]||(r[4]=f("div",null,[f("div",{class:"font-weight-bold"},"حالة المستودع"),f("div",{class:"text-caption text-grey"},"تحديد ما إذا كان المخزن متاحاً للاستخدام حالياً")],-1))]),a(Ae,{modelValue:d.value.is_active,"onUpdate:modelValue":r[3]||(r[3]=h=>d.value.is_active=h),"hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1},512))}},Me={class:"warehouses-page"},Re={class:"page-header d-flex align-center justify-space-between mb-6"},Ne={class:"d-flex align-center flex-wrap gap-4"},qe={class:"warehouse-card-header d-flex align-center justify-center pa-4 bg-primary-lighten-5 position-relative"},Le={class:"text-body-2 text-grey-darken-1 text-truncate-2 height-40"},Oe={class:"pa-3 d-flex align-center justify-space-between"},Ge={class:"d-flex gap-2"},He={class:"d-flex align-center py-2"},Ke={class:"font-weight-bold text-body-1"},Je={class:"text-caption text-grey"},Qe={class:"d-flex align-center text-body-2"},Xe={class:"text-secondary"},Ye={class:"d-flex gap-2 justify-end"},Ze={key:2,class:"mt-8 d-flex align-center justify-space-between flex-wrap gap-4 px-2"},ea={class:"text-body-2 text-grey"},aa={__name:"WarehouseList",setup(u){const g=De(),{warehouses:o,loading:x,totalItems:y,page:m,itemsPerPage:d,search:n,sortBy:c}=fe(g),{isOpen:r,formData:h,isEditMode:z,open:j,close:A}=Se(),{showConfirm:E,confirmMessage:p,confirm:s,handleConfirm:w,handleCancel:F}=$e(),M=v(null),R=v(!1),_=v("grid"),te=[{title:"المخزن",key:"name",sortable:!0},{title:"الموقع",key:"location",sortable:!1},{title:"الحالة",key:"status",sortable:!1,align:"center"},{title:"الإجراءات",key:"actions",sortable:!1,align:"end"}],le=((b,i)=>{let e;return(...S)=>{e&&clearTimeout(e),e=setTimeout(()=>b(...S),i)}})(()=>{m.value=1,B()},500),B=async()=>{await g.fetchWarehouses()},N=b=>{j(b)},H=()=>{j({})},q=b=>{s(`هل أنت متأكد من حذف المخزن "${b.name}"؟`,async()=>{await g.deleteWarehouse(b.id)})},oe=()=>{M.value&&M.value.handleSubmit()},ne=async b=>{R.value=!0;try{z.value?await g.updateWarehouse(h.value.id,b):await g.createWarehouse(b),A(),await B()}finally{R.value=!1}},K=b=>{console.log("View stock for warehouse:",b.id)};return me(()=>{B()}),G([m,d],()=>{_.value==="grid"&&B()}),(b,i)=>(V(),P("div",Me,[f("div",Re,[i[10]||(i[10]=f("div",null,[f("h1",{class:"text-h4 font-weight-bold ml-2"},"المخازن"),f("p",{class:"text-body-1 text-grey"},"إدارة ومتابعة المخازن والمخزون الخاص بكل منها")],-1)),a(C,{"prepend-icon":"ri-add-line",size:"large",elevation:"2",onClick:H},{default:l(()=>i[9]||(i[9]=[W(" مخزن جديد ")])),_:1})]),a(Z,{class:"mb-6"},{default:l(()=>[f("div",Ne,[a(O,{modelValue:t(n),"onUpdate:modelValue":[i[0]||(i[0]=e=>$(n)?n.value=e:null),t(le)],label:"بحث عن مخزن...","prepend-inner-icon":"ri-search-line",class:"max-width-300 flex-grow-1","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),a(ye),a(he,{variant:"outlined",density:"comfortable",color:"primary",class:"rounded-pill overflow-hidden"},{default:l(()=>[a(C,{active:_.value==="grid",icon:"ri-grid-fill",onClick:i[1]||(i[1]=e=>_.value="grid"),title:"عرض شبكي"},null,8,["active"]),a(C,{active:_.value==="list",icon:"ri-list-check",onClick:i[2]||(i[2]=e=>_.value="list"),title:"عرض قائمة"},null,8,["active"])]),_:1})])]),_:1}),t(x)&&!t(o).length?(V(),I(We,{key:0,size:"64",text:"جاري تحميل البيانات..."})):t(o).length?(V(),P(Q,{key:2},[_.value==="grid"?(V(),I(ae,{key:0},{default:l(()=>[(V(!0),P(Q,null,be(t(o),e=>(V(),I(D,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:l(()=>[a(Z,{class:"warehouse-card h-100","no-padding":""},{default:l(()=>[f("div",qe,[a(X,{color:"primary",size:"80",class:"elevation-2"},{default:l(()=>[a(T,{icon:"ri-building-4-line",size:"40",color:"white"})]),_:1}),a(Y,{color:e.is_active?"success":"error",size:"x-small",class:"position-absolute top-2 right-2 font-weight-bold",variant:"flat"},{default:l(()=>[W(k(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),a(we,null,{default:l(()=>[a(Ve,{class:"text-h6 font-weight-bold"},{default:l(()=>[W(k(e.name),1)]),_:2},1024),a(xe,{class:"d-flex align-center mt-1"},{default:l(()=>[a(T,{icon:"ri-map-pin-line",size:"14",class:"me-1",color:"primary"}),W(" "+k(e.location||"عنوان غير محدد"),1)]),_:2},1024)]),_:2},1024),a(ke,{class:"pt-0"},{default:l(()=>[f("p",Le,k(e.description||"لا يوجد وصف إضافي لهذا المخزن."),1)]),_:2},1024),a(Ce),f("div",Oe,[a(_e,{variant:"tonal",color:"secondary",size:"small","prepend-icon":"ri-eye-line",class:"rounded-pill font-weight-bold",onClick:S=>K(e)},{default:l(()=>i[11]||(i[11]=[W(" جرد المخزون ")])),_:2},1032,["onClick"]),f("div",Ge,[a(C,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:S=>N(e)},null,8,["onClick"]),a(C,{icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:S=>q(e)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(V(),I(Ie,{key:1,page:t(m),"onUpdate:page":i[3]||(i[3]=e=>$(m)?m.value=e:null),"items-per-page":t(d),"onUpdate:itemsPerPage":i[4]||(i[4]=e=>$(d)?d.value=e:null),"sort-by":t(c),"onUpdate:sortBy":i[5]||(i[5]=e=>$(c)?c.value=e:null),headers:te,items:t(o),"total-items":t(y),loading:t(x),searchable:!1,"onUpdate:options":B,onEdit:N,onDelete:q},{"item.name":l(({item:e})=>[f("div",He,[a(X,{color:"primary-lighten-5",size:"40",class:"me-3 border"},{default:l(()=>[a(T,{icon:"ri-building-4-line",color:"primary",size:"small"})]),_:1}),f("div",null,[f("div",Ke,k(e.name),1),f("div",Je,k(e.description||"بدون وصف"),1)])])]),"item.location":l(({item:e})=>[f("div",Qe,[a(T,{icon:"ri-map-pin-line",size:"small",color:"secondary",class:"me-2"}),f("span",Xe,k(e.location||"غير محدد"),1)])]),"item.status":l(({item:e})=>[a(Y,{color:e.is_active?"success":"error",size:"small",variant:"flat",class:"font-weight-bold"},{default:l(()=>[W(k(e.is_active?"نشط":"معطل"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:e})=>[f("div",Ye,[a(C,{icon:"ri-eye-line",variant:"text",color:"secondary",onClick:S=>K(e),title:"جرد المخزون"},null,8,["onClick"]),a(C,{icon:"ri-edit-line",variant:"text",color:"primary",onClick:S=>N(e)},null,8,["onClick"]),a(C,{icon:"ri-delete-bin-line",variant:"text",color:"error",onClick:S=>q(e)},null,8,["onClick"])])]),_:1},8,["page","items-per-page","sort-by","items","total-items","loading"])),_.value==="grid"?(V(),P("div",Ze,[f("div",ea,"عرض "+k(t(o).length)+" من إجمالي "+k(t(y))+" مخزن",1),a(ve,{modelValue:t(m),"onUpdate:modelValue":[i[6]||(i[6]=e=>$(m)?m.value=e:null),B],length:Math.ceil(t(y)/t(d)),"total-visible":5,rounded:"pill",size:"small","active-color":"primary"},null,8,["modelValue","length"])])):ge("",!0)],64)):(V(),I(Ue,{key:1,icon:"ri-building-4-line",title:"لا توجد مخازن حالياً",message:"ابدأ بإضافة أول مخزن لنظامك لتتمكن من إدارة المخزون","show-action":"","action-text":"إضافة مخزن",onAction:H})),a(Be,{modelValue:t(r),"onUpdate:modelValue":i[7]||(i[7]=e=>$(r)?r.value=e:null),title:t(z)?"تعديل بيانات المخزن":"إضافة مخزن جديد",icon:t(z)?"ri-edit-line":"ri-building-4-line","max-width":"600",loading:R.value,onConfirm:oe,onClose:t(A)},{default:l(()=>[a(Fe,{ref_key:"warehouseFormRef",ref:M,"model-value":t(h),onSave:ne,onCancel:t(A)},null,8,["model-value","onCancel"])]),_:1},8,["modelValue","title","icon","loading","onClose"]),a(ze,{modelValue:t(E),"onUpdate:modelValue":i[8]||(i[8]=e=>$(E)?E.value=e:null),message:t(p),onConfirm:t(w),onCancel:t(F)},null,8,["modelValue","message","onConfirm","onCancel"])]))}},wa=pe(aa,[["__scopeId","data-v-197b0eac"]]);export{wa as default};
