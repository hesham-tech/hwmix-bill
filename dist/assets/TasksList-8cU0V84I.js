const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Flp88uEA.js","assets/index-CYydBTIK.css"])))=>i.map(i=>d[i]);
import{z as $e,r as O,L as _e,o as V,x as H,w as d,d as t,h as ne,a6 as ke,i as re,b as u,O as te,a3 as pe,k as Te,am as ve,ai as Oe,e as ge,f as N,ad as he,ao as Ie,Q as Ue,M as ze,n as F,v as x,D as ie,ar as Ye,P as we,H as G,as as De,s as Z,aQ as Le,g as Ae,a as Me,K as Se,c as ae,F as de,j as ce,B as ye,aR as He,aS as je,G as Ee,u as Pe,ae as Fe,V as Ne,_ as We,a9 as Be,C as Re,E as be,aa as Je,a8 as Ze}from"./index-Flp88uEA.js";import{t as ee}from"./task.service-BnND5amn.js";import{u as Ge,t as Ke}from"./task-group.service-DkDXE5de.js";const Qe={__name:"TaskCreateDialog",props:["modelValue"],emits:["update:modelValue","created"],setup(se,{emit:W}){const I=se,C=W,A=$e({get:()=>I.modelValue,set:D=>C("update:modelValue",D)}),p=O(!1),y=O(!1),T=O(null),b=O({title:"",description:"",priority:"medium",deadline:null}),$=O([]),U=O([]),k=O([]),B=[{title:"عاجل جداً",value:"urgent"},{title:"عالي",value:"high"},{title:"متوسط",value:"medium"},{title:"منخفض",value:"low"}],Y=$e(()=>{const D=U.value.map(n=>({id:n.id,title:n.nickname||n.name||n.username,type:"user"})),r=k.value.map(n=>({id:n.id,title:n.name,type:"group"}));return[...D,...r]}),j=async()=>{try{const[D,r]=await Promise.all([Ge.getAll({per_page:100}),Ke.getAll()]);U.value=D.data,k.value=r.data}catch(D){console.error("Error fetching assignees",D)}},R=async()=>{y.value=!0;try{const D={...b.value,assignments:$.value.map(r=>({type:r.type,id:r.id}))};await ee.create(D),Z.success("تم إنشاء المهمة وإسنادها بنجاح"),C("created"),C("update:modelValue",!1),K()}catch{Z.error("فشل في إنشاء المهمة")}finally{y.value=!1}},K=()=>{b.value={title:"",description:"",priority:"medium",deadline:null},$.value=[]};return _e(j),(D,r)=>(V(),H(De,{modelValue:A.value,"onUpdate:modelValue":r[7]||(r[7]=n=>A.value=n),"max-width":"600px"},{default:d(()=>[t(ne,{class:"rounded-xl overflow-hidden"},{default:d(()=>[t(ke,{class:"pa-6 bg-primary text-white d-flex align-center gap-3"},{default:d(()=>[t(re,{icon:"ri-add-circle-line",size:"28"}),r[8]||(r[8]=u("span",{class:"text-h5 font-weight-bold"},"إسناد مهمة جديدة",-1))]),_:1}),t(te),t(pe,{class:"pa-6"},{default:d(()=>[t(Te,{ref_key:"form",ref:T,modelValue:p.value,"onUpdate:modelValue":r[5]||(r[5]=n=>p.value=n)},{default:d(()=>[t(ve,{modelValue:b.value.title,"onUpdate:modelValue":r[0]||(r[0]=n=>b.value.title=n),label:"عنوان المهمة",placeholder:"مثال: مراجعة مخزون شهر يناير",variant:"outlined",density:"comfortable",rules:[n=>!!n||"العنوان مطلوب"],class:"mb-4"},null,8,["modelValue","rules"]),t(Oe,{modelValue:b.value.description,"onUpdate:modelValue":r[1]||(r[1]=n=>b.value.description=n),label:"تفاصيل المهمة",placeholder:"اشرح المطلوب بالتفصيل...",variant:"outlined",density:"comfortable","auto-grow":"",rows:"3",class:"mb-4"},null,8,["modelValue"]),t(ge,null,{default:d(()=>[t(N,{cols:"12",md:"6"},{default:d(()=>[t(he,{modelValue:b.value.priority,"onUpdate:modelValue":r[2]||(r[2]=n=>b.value.priority=n),label:"الأولوية",items:B,variant:"outlined",density:"comfortable",class:"mb-4"},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",md:"6"},{default:d(()=>[t(ve,{modelValue:b.value.deadline,"onUpdate:modelValue":r[3]||(r[3]=n=>b.value.deadline=n),label:"الموعد النهائي",type:"datetime-local",variant:"outlined",density:"comfortable",class:"mb-4"},null,8,["modelValue"])]),_:1})]),_:1}),t(te,{class:"mb-4"}),r[9]||(r[9]=u("h3",{class:"text-subtitle-1 font-weight-bold mb-3"},"إسناد إلى:",-1)),t(Ie,{modelValue:$.value,"onUpdate:modelValue":r[4]||(r[4]=n=>$.value=n),items:Y.value,label:"اختر موظفين أو مجموعات",variant:"outlined",density:"comfortable",multiple:"",chips:"","closable-chips":"","item-title":"title","item-value":"id","return-object":""},{item:d(({props:n,item:a})=>[t(Ue,ze(n,{"prepend-icon":a.raw.type==="user"?"ri-user-line":"ri-team-line"}),{title:d(()=>[F(x(a.raw.title)+" ",1),t(ie,{size:"x-small",color:a.raw.type==="user"?"info":"success",class:"ms-2"},{default:d(()=>[F(x(a.raw.type==="user"?"موظف":"مجموعة"),1)]),_:2},1032,["color"])]),_:2},1040,["prepend-icon"])]),_:1},8,["modelValue","items"])]),_:1},8,["modelValue"])]),_:1}),t(te),t(Ye,{class:"pa-6"},{default:d(()=>[t(we),t(G,{variant:"text",color:"grey-darken-1",class:"px-6",onClick:r[6]||(r[6]=n=>D.$emit("update:modelValue",!1))},{default:d(()=>r[10]||(r[10]=[F("إلغاء")])),_:1}),t(G,{color:"primary",variant:"flat",class:"px-8 rounded-lg font-weight-bold",loading:y.value,disabled:!p.value||$.value.length===0,onClick:R},{default:d(()=>r[11]||(r[11]=[F(" إنشاء المهمة ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};var Ce={exports:{}};(function(se,W){(function(I,C){se.exports=C()})(Le,function(){var I=1e3,C=6e4,A=36e5,p="millisecond",y="second",T="minute",b="hour",$="day",U="week",k="month",B="quarter",Y="year",j="date",R="Invalid Date",K=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,D=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,r={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var l=["th","st","nd","rd"],e=c%100;return"["+c+(l[(e-20)%10]||l[e]||l[0])+"]"}},n=function(c,l,e){var o=String(c);return!o||o.length>=l?c:""+Array(l+1-o.length).join(e)+c},a={s:n,z:function(c){var l=-c.utcOffset(),e=Math.abs(l),o=Math.floor(e/60),s=e%60;return(l<=0?"+":"-")+n(o,2,"0")+":"+n(s,2,"0")},m:function c(l,e){if(l.date()<e.date())return-c(e,l);var o=12*(e.year()-l.year())+(e.month()-l.month()),s=l.clone().add(o,k),m=e-s<0,f=l.clone().add(o+(m?-1:1),k);return+(-(o+(e-s)/(m?s-f:f-s))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:k,y:Y,w:U,d:$,D:j,h:b,m:T,s:y,ms:p,Q:B}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},i="en",v={};v[i]=r;var _="$isDayjsObject",E=function(c){return c instanceof me||!(!c||!c[_])},Q=function c(l,e,o){var s;if(!l)return i;if(typeof l=="string"){var m=l.toLowerCase();v[m]&&(s=m),e&&(v[m]=e,s=m);var f=l.split("-");if(!s&&f.length>1)return c(f[0])}else{var h=l.name;v[h]=l,s=h}return!o&&s&&(i=s),s||!o&&i},M=function(c,l){if(E(c))return c.clone();var e=typeof l=="object"?l:{};return e.date=c,e.args=arguments,new me(e)},g=a;g.l=Q,g.i=E,g.w=function(c,l){return M(c,{locale:l.$L,utc:l.$u,x:l.$x,$offset:l.$offset})};var me=function(){function c(e){this.$L=Q(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[_]=!0}var l=c.prototype;return l.parse=function(e){this.$d=function(o){var s=o.date,m=o.utc;if(s===null)return new Date(NaN);if(g.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var f=s.match(K);if(f){var h=f[2]-1||0,w=(f[7]||"0").substring(0,3);return m?new Date(Date.UTC(f[1],h,f[3]||1,f[4]||0,f[5]||0,f[6]||0,w)):new Date(f[1],h,f[3]||1,f[4]||0,f[5]||0,f[6]||0,w)}}return new Date(s)}(e),this.init()},l.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},l.$utils=function(){return g},l.isValid=function(){return this.$d.toString()!==R},l.isSame=function(e,o){var s=M(e);return this.startOf(o)<=s&&s<=this.endOf(o)},l.isAfter=function(e,o){return M(e)<this.startOf(o)},l.isBefore=function(e,o){return this.endOf(o)<M(e)},l.$g=function(e,o,s){return g.u(e)?this[o]:this.set(s,e)},l.unix=function(){return Math.floor(this.valueOf()/1e3)},l.valueOf=function(){return this.$d.getTime()},l.startOf=function(e,o){var s=this,m=!!g.u(o)||o,f=g.p(e),h=function(X,L){var J=g.w(s.$u?Date.UTC(s.$y,L,X):new Date(s.$y,L,X),s);return m?J:J.endOf($)},w=function(X,L){return g.w(s.toDate()[X].apply(s.toDate("s"),(m?[0,0,0,0]:[23,59,59,999]).slice(L)),s)},S=this.$W,z=this.$M,P=this.$D,le="set"+(this.$u?"UTC":"");switch(f){case Y:return m?h(1,0):h(31,11);case k:return m?h(1,z):h(0,z+1);case U:var q=this.$locale().weekStart||0,oe=(S<q?S+7:S)-q;return h(m?P-oe:P+(6-oe),z);case $:case j:return w(le+"Hours",0);case b:return w(le+"Minutes",1);case T:return w(le+"Seconds",2);case y:return w(le+"Milliseconds",3);default:return this.clone()}},l.endOf=function(e){return this.startOf(e,!1)},l.$set=function(e,o){var s,m=g.p(e),f="set"+(this.$u?"UTC":""),h=(s={},s[$]=f+"Date",s[j]=f+"Date",s[k]=f+"Month",s[Y]=f+"FullYear",s[b]=f+"Hours",s[T]=f+"Minutes",s[y]=f+"Seconds",s[p]=f+"Milliseconds",s)[m],w=m===$?this.$D+(o-this.$W):o;if(m===k||m===Y){var S=this.clone().set(j,1);S.$d[h](w),S.init(),this.$d=S.set(j,Math.min(this.$D,S.daysInMonth())).$d}else h&&this.$d[h](w);return this.init(),this},l.set=function(e,o){return this.clone().$set(e,o)},l.get=function(e){return this[g.p(e)]()},l.add=function(e,o){var s,m=this;e=Number(e);var f=g.p(o),h=function(z){var P=M(m);return g.w(P.date(P.date()+Math.round(z*e)),m)};if(f===k)return this.set(k,this.$M+e);if(f===Y)return this.set(Y,this.$y+e);if(f===$)return h(1);if(f===U)return h(7);var w=(s={},s[T]=C,s[b]=A,s[y]=I,s)[f]||1,S=this.$d.getTime()+e*w;return g.w(S,this)},l.subtract=function(e,o){return this.add(-1*e,o)},l.format=function(e){var o=this,s=this.$locale();if(!this.isValid())return s.invalidDate||R;var m=e||"YYYY-MM-DDTHH:mm:ssZ",f=g.z(this),h=this.$H,w=this.$m,S=this.$M,z=s.weekdays,P=s.months,le=s.meridiem,q=function(L,J,ue,fe){return L&&(L[J]||L(o,m))||ue[J].slice(0,fe)},oe=function(L){return g.s(h%12||12,L,"0")},X=le||function(L,J,ue){var fe=L<12?"AM":"PM";return ue?fe.toLowerCase():fe};return m.replace(D,function(L,J){return J||function(ue){switch(ue){case"YY":return String(o.$y).slice(-2);case"YYYY":return g.s(o.$y,4,"0");case"M":return S+1;case"MM":return g.s(S+1,2,"0");case"MMM":return q(s.monthsShort,S,P,3);case"MMMM":return q(P,S);case"D":return o.$D;case"DD":return g.s(o.$D,2,"0");case"d":return String(o.$W);case"dd":return q(s.weekdaysMin,o.$W,z,2);case"ddd":return q(s.weekdaysShort,o.$W,z,3);case"dddd":return z[o.$W];case"H":return String(h);case"HH":return g.s(h,2,"0");case"h":return oe(1);case"hh":return oe(2);case"a":return X(h,w,!0);case"A":return X(h,w,!1);case"m":return String(w);case"mm":return g.s(w,2,"0");case"s":return String(o.$s);case"ss":return g.s(o.$s,2,"0");case"SSS":return g.s(o.$ms,3,"0");case"Z":return f}return null}(L)||f.replace(":","")})},l.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},l.diff=function(e,o,s){var m,f=this,h=g.p(o),w=M(e),S=(w.utcOffset()-this.utcOffset())*C,z=this-w,P=function(){return g.m(f,w)};switch(h){case Y:m=P()/12;break;case k:m=P();break;case B:m=P()/3;break;case U:m=(z-S)/6048e5;break;case $:m=(z-S)/864e5;break;case b:m=z/A;break;case T:m=z/C;break;case y:m=z/I;break;default:m=z}return s?m:g.a(m)},l.daysInMonth=function(){return this.endOf(k).$D},l.$locale=function(){return v[this.$L]},l.locale=function(e,o){if(!e)return this.$L;var s=this.clone(),m=Q(e,o,!0);return m&&(s.$L=m),s},l.clone=function(){return g.w(this.$d,this)},l.toDate=function(){return new Date(this.valueOf())},l.toJSON=function(){return this.isValid()?this.toISOString():null},l.toISOString=function(){return this.$d.toISOString()},l.toString=function(){return this.$d.toUTCString()},c}(),Ve=me.prototype;return M.prototype=Ve,[["$ms",p],["$s",y],["$m",T],["$H",b],["$W",$],["$M",k],["$y",Y],["$D",j]].forEach(function(c){Ve[c[1]]=function(l){return this.$g(l,c[0],c[1])}}),M.extend=function(c,l){return c.$i||(c(l,me,M),c.$i=!0),M},M.locale=Q,M.isDayjs=E,M.unix=function(c){return M(1e3*c)},M.en=v[i],M.Ls=v,M.p={},M})})(Ce);var qe=Ce.exports;const xe=Ae(qe),Xe={class:"text-h6 font-weight-bold"},et={class:"text-body-1 text-grey-darken-2 mb-6 whitespace-pre-wrap"},tt={class:"d-flex flex-wrap gap-2 mb-4"},at={class:"activities-container mb-4"},st={class:"text-caption"},lt={class:"flex-grow-1"},nt={class:"d-flex align-center justify-space-between mb-1"},rt={class:"font-weight-bold text-body-2"},it={class:"text-caption text-grey"},ot={class:"text-body-2 mb-0"},ut={class:"d-flex gap-2"},dt={class:"mb-6"},ct={class:"mb-6"},mt={class:"text-caption font-weight-bold"},ft={class:"mb-6"},pt={class:"d-flex flex-wrap gap-2"},vt={class:"mb-6"},gt={class:"d-flex align-center gap-2"},ht={class:"text-body-2"},yt={class:"mb-6"},bt={class:"d-flex align-center gap-2"},$t={class:"text-caption"},xt={class:"text-body-2"},_t={__name:"TaskDetailsDialog",props:["modelValue","taskId"],emits:["update:modelValue","updated"],setup(se,{emit:W}){const I=se,C=W,A=$e({get:()=>I.modelValue,set:a=>C("update:modelValue",a)}),p=O(null),y=O(!0),T=O(""),b=O(!1),$=[{title:"قيد الانتظار",value:"pending"},{title:"جاري العمل",value:"doing"},{title:"قيد المراجعة",value:"review"},{title:"مكتملة",value:"completed"},{title:"ملغاة",value:"cancelled"}],U=async()=>{if(I.taskId){y.value=!0;try{const a=await ee.getOne(I.taskId);p.value=a.data[0]}catch(a){console.error("Error fetching task details",a)}finally{y.value=!1}}},k=async a=>{try{await ee.update(p.value.id,{status:a}),Z.success("تم تحديث الحالة"),U(),C("updated")}catch{Z.error("فشل تحديث الحالة")}},B=async()=>{try{await ee.update(p.value.id,{progress:p.value.progress}),C("updated")}catch{Z.error("فشل تحديث التقدم")}},Y=async()=>{if(T.value.trim()){b.value=!0;try{await ee.addComment(p.value.id,T.value),T.value="",U()}catch{Z.error("فشل إضافة التعليق")}finally{b.value=!1}}},j=async a=>{const i=a.target.files[0];if(!i)return;const v=new FormData;v.append("file",i);try{await ee.uploadAttachment(p.value.id,v),Z.success("تم رفع الملف"),U()}catch{Z.error("فشل رفع الملف")}},R=a=>{const i="https://api.yourdomain.com/api".replace("/api","");window.open(`${i}/storage/${a.file_path}`,"_blank")},K=a=>({pending:"grey",doing:"primary",review:"amber",completed:"success",cancelled:"error"})[a]||"grey",D=a=>{var i;return((i=$.find(v=>v.value===a))==null?void 0:i.title)||a},r=a=>a?xe(a).format("YYYY-MM-DD"):"بدون موعد",n=a=>xe(a).format("DD/MM HH:mm");return Se(()=>I.taskId,U),_e(U),(a,i)=>(V(),H(De,{modelValue:Pe(A),"onUpdate:modelValue":i[5]||(i[5]=v=>Fe(A)?A.value=v:null),"max-width":"800px"},{default:d(()=>[p.value?(V(),H(ne,{key:0,class:"rounded-xl overflow-hidden"},{default:d(()=>[t(ke,{class:"pa-6 bg-grey-lighten-5 d-flex align-center gap-3"},{default:d(()=>[t(ie,{color:K(p.value.status),variant:"flat",size:"small"},{default:d(()=>[F(x(D(p.value.status)),1)]),_:1},8,["color"]),u("span",Xe,x(p.value.title),1),t(we),t(G,{icon:"ri-close-line",variant:"text",onClick:i[0]||(i[0]=v=>a.$emit("update:modelValue",!1))})]),_:1}),t(te),t(pe,{class:"pa-0"},{default:d(()=>[t(ge,{"no-gutters":""},{default:d(()=>[t(N,{cols:"12",md:"7",class:"pa-6 border-e border-grey-lighten-4"},{default:d(()=>[i[6]||(i[6]=u("h4",{class:"text-subtitle-1 font-weight-bold mb-2"},"الوصف",-1)),u("p",et,x(p.value.description||"لا يوجد وصف لهذه المهمة."),1),t(te,{class:"mb-6"}),i[7]||(i[7]=u("h4",{class:"text-subtitle-1 font-weight-bold mb-4"},"المرفقات",-1)),u("div",tt,[(V(!0),ae(de,null,ce(p.value.attachments,v=>(V(),H(ie,{key:v.id,size:"small",variant:"tonal",closable:"",color:"grey-darken-2",onClick:_=>R(v)},{prepend:d(()=>[t(re,{icon:"ri-file-line",size:"14",class:"me-1"})]),default:d(()=>[F(" "+x(v.file_name),1)]),_:2},1032,["onClick"]))),128)),t(G,{icon:"ri-upload-cloud-2-line",variant:"tonal",size:"x-small",onClick:i[1]||(i[1]=v=>a.$refs.fileInput.click())}),u("input",{type:"file",ref:"fileInput",class:"d-none",onChange:j},null,544)]),t(te,{class:"mb-6"}),i[8]||(i[8]=u("h4",{class:"text-subtitle-1 font-weight-bold mb-4"},"النشاط والتعليقات",-1)),u("div",at,[(V(!0),ae(de,null,ce(p.value.activities,v=>{var _;return V(),ae("div",{key:v.id,class:"activity-item mb-4 d-flex gap-3"},[t(ye,{size:"32",color:"primary"},{default:d(()=>{var E,Q;return[u("span",st,x(((Q=(E=v.user)==null?void 0:E.nickname)==null?void 0:Q[0])||"U"),1)]}),_:2},1024),u("div",lt,[u("div",nt,[u("span",rt,x(((_=v.user)==null?void 0:_.nickname)||"مستخدم"),1),u("span",it,x(n(v.created_at)),1)]),t(ne,{variant:"flat",color:v.type==="comment"?"blue-lighten-5":"grey-lighten-4",class:"pa-3 rounded-lg"},{default:d(()=>[u("p",ot,x(v.content),1)]),_:2},1032,["color"])])])}),128))]),u("div",ut,[t(ve,{modelValue:T.value,"onUpdate:modelValue":i[2]||(i[2]=v=>T.value=v),placeholder:"أضف تعليقاً...",variant:"outlined",density:"comfortable","hide-details":"",onKeyup:He(Y,["enter"])},null,8,["modelValue"]),t(G,{color:"primary",icon:"ri-send-plane-2-line",onClick:Y,loading:b.value},null,8,["loading"])])]),_:1}),t(N,{cols:"12",md:"5",class:"pa-6 bg-grey-lighten-5"},{default:d(()=>{var v;return[u("div",dt,[i[9]||(i[9]=u("h4",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2"},"تحديث الحالة",-1)),t(he,{modelValue:p.value.status,"onUpdate:modelValue":[i[3]||(i[3]=_=>p.value.status=_),k],items:$,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),u("div",ct,[i[10]||(i[10]=u("h4",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2"},"التقدم",-1)),t(je,{modelValue:p.value.progress,"onUpdate:modelValue":i[4]||(i[4]=_=>p.value.progress=_),color:"primary","thumb-label":"",step:"5",onEnd:B},{append:d(()=>[u("span",mt,x(p.value.progress)+"%",1)]),_:1},8,["modelValue"])]),t(te,{class:"mb-6"}),u("div",ft,[i[11]||(i[11]=u("h4",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2"},"المسؤولين",-1)),u("div",pt,[(V(!0),ae(de,null,ce(p.value.assignments,_=>(V(),H(ie,{key:_.id,size:"small",variant:"outlined",color:"primary"},{default:d(()=>[F(x(_.assignable.name||_.assignable.nickname||_.assignable.title),1)]),_:2},1024))),128))])]),u("div",vt,[i[12]||(i[12]=u("h4",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2"},"الموعد النهائي",-1)),u("div",gt,[t(re,{icon:"ri-calendar-event-line",size:"18",color:"primary"}),u("span",ht,x(r(p.value.deadline)),1)])]),u("div",yt,[i[13]||(i[13]=u("h4",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2"},"بواسطة",-1)),u("div",bt,[t(ye,{size:"24",color:"grey-lighten-2"},{default:d(()=>{var _,E;return[u("span",$t,x((E=(_=p.value.creator)==null?void 0:_.nickname)==null?void 0:E[0]),1)]}),_:1}),u("span",xt,x(((v=p.value.creator)==null?void 0:v.nickname)||"نظام"),1)])])]}),_:1})]),_:1})]),_:1})]),_:1})):(V(),H(ne,{key:1,class:"rounded-xl pa-12 text-center"},{default:d(()=>[t(Ee,{indeterminate:"",color:"primary"})]),_:1}))]),_:1},8,["modelValue"]))}},wt=Me(_t,[["__scopeId","data-v-87b613b6"]]),Vt={class:"d-flex align-center gap-3 mb-6"},kt={class:"d-flex justify-space-between align-start mb-3"},Dt={class:"text-h6 font-weight-bold mb-2 text-truncate"},Mt={class:"text-body-2 text-grey-darken-1 mb-4 line-clamp-2"},St={class:"d-flex align-center gap-2 mb-4"},Ct={class:"text-caption text-grey"},Tt={class:"d-flex align-center justify-space-between"},Ot={class:"d-flex align-center"},It={class:"d-flex align-center flex-row-reverse ms-2"},Ut={class:"text-caption white--text"},zt={class:"text-caption"},Yt={class:"d-flex align-center gap-2"},Lt={class:"text-caption text-grey"},At={key:2,class:"text-center pa-12"},Ht={__name:"TasksList",setup(se){const W=O([]),I=O(!0),C=O(!1),A=O(!1),p=O(null),y=O({status:null,priority:null,search:""}),T=[{title:"قيد الانتظار",value:"pending"},{title:"جاري العمل",value:"doing"},{title:"قيد المراجعة",value:"review"},{title:"مكتملة",value:"completed"},{title:"ملغاة",value:"cancelled"}],b=[{title:"عاجل جداً",value:"urgent"},{title:"عالي",value:"high"},{title:"متوسط",value:"medium"},{title:"منخفض",value:"low"}],$=async()=>{I.value=!0;try{const r=await ee.getAll({status:y.value.status,priority:y.value.priority,search:y.value.search});W.value=r.data,D()}catch(r){console.error("Error fetching tasks",r)}finally{I.value=!1}},U=()=>{C.value=!0},k=r=>{p.value=r,A.value=!0},B=r=>({urgent:"error",high:"warning",medium:"info",low:"success"})[r]||"grey",Y=r=>({pending:"grey",doing:"primary",review:"amber",completed:"success",cancelled:"error"})[r]||"grey",j=r=>{var n;return((n=b.find(a=>a.value===r))==null?void 0:n.title)||r},R=r=>{var n;return((n=T.find(a=>a.value===r))==null?void 0:n.title)||r},K=r=>r?xe(r).format("YYYY-MM-DD HH:mm"):"بدون موعد",D=()=>{var n;const r=(n=JSON.parse(localStorage.getItem("user")))==null?void 0:n.company_id;r&&We(async()=>{const{echo:a}=await import("./index-Flp88uEA.js").then(i=>i.aU);return{echo:a}},__vite__mapDeps([0,1])).then(({echo:a})=>{a.private(`company.${r}`).listen(".task.updated",i=>{console.log("Task updated:",i),$()})})};return Se(y,$,{deep:!0}),_e($),(r,n)=>(V(),H(Ne,{fluid:"",class:"pa-6"},{default:d(()=>[u("div",Vt,[t(re,{icon:"ri-list-check-3",color:"primary",size:"32"}),n[6]||(n[6]=u("div",null,[u("h1",{class:"text-h4 font-weight-bold"},"إدارة المهام"),u("p",{class:"text-subtitle-1 text-grey-darken-1 mb-0"},"تابع مهامك ومهام الفريق لحظياً")],-1)),t(we),t(G,{color:"primary","prepend-icon":"ri-add-line",class:"px-6 rounded-lg",onClick:U},{default:d(()=>n[5]||(n[5]=[F(" مهمة جديدة ")])),_:1})]),t(ne,{class:"mb-6 rounded-xl border-grey-lighten-4",variant:"flat",border:""},{default:d(()=>[t(pe,{class:"pa-4"},{default:d(()=>[t(ge,{dense:""},{default:d(()=>[t(N,{cols:"12",md:"3"},{default:d(()=>[t(he,{modelValue:y.value.status,"onUpdate:modelValue":n[0]||(n[0]=a=>y.value.status=a),label:"الحالة",items:T,variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",md:"3"},{default:d(()=>[t(he,{modelValue:y.value.priority,"onUpdate:modelValue":n[1]||(n[1]=a=>y.value.priority=a),label:"الأولوية",items:b,variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",md:"4"},{default:d(()=>[t(ve,{modelValue:y.value.search,"onUpdate:modelValue":n[2]||(n[2]=a=>y.value.search=a),"prepend-inner-icon":"ri-search-line",label:"بحث في المهام...",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),t(N,{cols:"12",md:"2",class:"d-flex align-center"},{default:d(()=>[t(G,{icon:"ri-refresh-line",variant:"text",onClick:$,loading:I.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),I.value?(V(),H(Be,{key:1,type:"card@6",class:"bg-transparent"})):(V(),H(ge,{key:0},{default:d(()=>[(V(!0),ae(de,null,ce(W.value,a=>(V(),H(N,{key:a.id,cols:"12",md:"6",lg:"4"},{default:d(()=>[t(ne,{class:"task-card rounded-xl border-grey-lighten-4 transition-all",variant:"flat",border:"",onClick:i=>k(a)},{default:d(()=>[t(pe,{class:"pa-5"},{default:d(()=>[u("div",kt,[t(ie,{color:B(a.priority),size:"x-small",variant:"flat",class:"font-weight-bold"},{default:d(()=>[F(x(j(a.priority)),1)]),_:2},1032,["color"]),t(ie,{color:Y(a.status),size:"x-small",variant:"tonal"},{default:d(()=>[F(x(R(a.status)),1)]),_:2},1032,["color"])]),u("h3",Dt,x(a.title),1),u("p",Mt,x(a.description||"لا يوجد وصف..."),1),u("div",St,[t(re,{icon:"ri-calendar-line",size:"14",color:"grey"}),u("span",Ct,x(K(a.deadline)),1)]),t(Je,{"model-value":a.progress,height:"6",rounded:"",color:"primary",class:"mb-4"},null,8,["model-value"]),u("div",Tt,[u("div",Ot,[u("div",It,[(V(!0),ae(de,null,ce(a.assignments.slice(0,3),(i,v)=>(V(),H(ye,{key:i.id,size:"28",color:i.assignable.color||"primary",class:"border border-white ms-n2",style:Ze({zIndex:10-v})},{default:d(()=>{var _,E;return[u("span",Ut,x(((_=i.assignable.nickname)==null?void 0:_[0])||((E=i.assignable.name)==null?void 0:E[0])),1)]}),_:2},1032,["color","style"]))),128)),a.assignments.length>3?(V(),H(ye,{key:0,size:"28",color:"grey-lighten-2",class:"border border-white ms-n2",style:{"z-index":"0"}},{default:d(()=>[u("span",zt,"+"+x(a.assignments.length-3),1)]),_:2},1024)):be("",!0)])]),u("div",Yt,[t(re,{icon:"ri-chat-4-line",size:"16",color:"grey"}),u("span",Lt,x(a.activities_count||0),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),!I.value&&W.value.length===0?(V(),ae("div",At,[t(Re,{src:"/images/empty-tasks.png",width:"200",class:"mx-auto mb-4 opacity-50"}),n[8]||(n[8]=u("h3",{class:"text-h6 text-grey"},"لا يوجد مهام حالياً",-1)),t(G,{color:"primary",variant:"text",onClick:U},{default:d(()=>n[7]||(n[7]=[F("إضافة مهمة جديدة")])),_:1})])):be("",!0),t(Qe,{modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=a=>C.value=a),onCreated:$},null,8,["modelValue"]),p.value?(V(),H(wt,{key:3,modelValue:A.value,"onUpdate:modelValue":n[4]||(n[4]=a=>A.value=a),"task-id":p.value.id,onUpdated:$},null,8,["modelValue","task-id"])):be("",!0)]),_:1}))}},Ft=Me(Ht,[["__scopeId","data-v-6fed93cd"]]);export{Ft as default};
